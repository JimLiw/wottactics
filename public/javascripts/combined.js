var $jscomp={scope:{},getGlobal:function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global?global:c}};$jscomp.global=$jscomp.getGlobal(this);$jscomp.patches={};$jscomp.patch=function(c,b){($jscomp.patches[c]=$jscomp.patches[c]||[]).push(b);for(var d=$jscomp.global,f=c.split("."),a=0;a<f.length-1&&d;a++)d=d[f[a]];f=f[f.length-1];d&&d[f]instanceof Function&&(d[f]=b(d[f]))};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global.Symbol){$jscomp.global.Symbol=$jscomp.Symbol;var c=[],b=function(b){return function(f){c=[];f=b(f);for(var a=[],e=0,h=f.length;e<h;e++){var g;a:if(g=f[e],g.length<$jscomp.SYMBOL_PREFIX.length)g=!1;else{for(var m=0;m<$jscomp.SYMBOL_PREFIX.length;m++)if(g[m]!=$jscomp.SYMBOL_PREFIX[m]){g=!1;break a}g=!0}g?c.push(f[e]):a.push(f[e])}return a}};$jscomp.patch("Object.keys",b);$jscomp.patch("Object.getOwnPropertyNames",b);$jscomp.patch("Object.getOwnPropertySymbols",
function(d){return function(f){b.unused=Object.getOwnPropertyNames(f);c.push.apply(d(f));return c}})}};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+c+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();$jscomp.global.Symbol.iterator||($jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));$jscomp.initSymbolIterator=function(){}};
(function(c){var b=function(b,c){this.init("simplecolorpicker",b,c)};b.prototype={constructor:b,init:function(b,f,a){var e=this;e.type=b;e.$select=c(f);e.$select.hide();e.options=c.extend({},c.fn.simplecolorpicker.defaults,a);e.$colorList=null;!0===e.options.picker?(b=e.$select.find("> option:selected").text(),e.$icon=c('<span class="simplecolorpicker icon" title="'+b+'" style="background-color: '+e.$select.val()+';" role="button" tabindex="0"></span>').insertAfter(e.$select),e.$icon.on("click."+
e.type,c.proxy(e.showPicker,e)),e.$picker=c('<span class="simplecolorpicker picker '+e.options.theme+'"></span>').appendTo(document.body),e.$colorList=e.$picker,c(document).on("mousedown."+e.type,c.proxy(e.hidePicker,e)),e.$picker.on("mousedown."+e.type,c.proxy(e.mousedown,e))):(e.$inline=c('<span class="simplecolorpicker inline '+e.options.theme+'"></span>').insertAfter(e.$select),e.$colorList=e.$inline);e.$select.find("> option").each(function(){var a=c(this),g=a.val(),b=a.is(":selected"),n=a.is(":disabled"),
k="";!0===b&&(k=" data-selected");b="";!0===n&&(b=" data-disabled");var p="";!1===n&&(p=' title="'+a.text()+'"');var d="";!1===n&&(d=' role="button" tabindex="0"');g=c('<span class="color"'+p+' style="background-color: '+g+';" data-color="'+g+'"'+k+b+d+"></span>");e.$colorList.append(g);g.on("click."+e.type,c.proxy(e.colorSpanClicked,e));!0===a.next().is("optgroup")&&e.$colorList.append('<span class="vr"></span>')})},selectColor:function(b){var f=this.$colorList.find("> span.color").filter(function(){return c(this).data("color").toLowerCase()===
b.toLowerCase()});0<f.length?this.selectColorSpan(f):console.error("The given color '"+b+"' could not be found")},showPicker:function(){var b=this.$icon.offset();this.$picker.css({left:b.left-6,top:b.top+this.$icon.outerHeight()});this.$picker.show(this.options.pickerDelay)},hidePicker:function(){this.$picker.hide(this.options.pickerDelay)},selectColorSpan:function(b){var c=b.data("color"),a=b.prop("title");b.siblings().removeAttr("data-selected");b.attr("data-selected","");!0===this.options.picker&&
(this.$icon.css("background-color",c),this.$icon.prop("title",a),this.hidePicker());this.$select.val(c)},colorSpanClicked:function(b){!1===c(b.target).is("[data-disabled]")&&(this.selectColorSpan(c(b.target)),this.$select.trigger("change"))},mousedown:function(b){b.stopPropagation();b.preventDefault()},destroy:function(){!0===this.options.picker&&(this.$icon.off("."+this.type),this.$icon.remove(),c(document).off("."+this.type));this.$colorList.off("."+this.type);this.$colorList.remove();this.$select.removeData(this.type);
this.$select.show()}};c.fn.simplecolorpicker=function(d){var f=c.makeArray(arguments);f.shift();return this.each(function(){var a=c(this),e=a.data("simplecolorpicker"),h="object"===typeof d&&d;void 0===e&&a.data("simplecolorpicker",e=new b(this,h));"string"===typeof d&&e[d].apply(e,f)})};c.fn.simplecolorpicker.defaults={theme:"",picker:!1,pickerDelay:0}})(jQuery);/*
: http://creativecommons.org/publicdomain/zero/1.0/
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
   2013-2015 GoodBoyDigital
 @license     {@link https://github.com/pixijs/pixi.js/blob/master/LICENSE|MIT License}
*/
(function(c){"object"===typeof exports&&"undefined"!==typeof module?module.exports=c():"function"===typeof define&&define.amd?define([],c):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).PIXI=c()})(function(){return function b(c,f,a){function e(g,n){if(!f[g]){if(!c[g]){var k="function"==typeof require&&require;if(!n&&k)return k(g,!0);if(h)return h(g,!0);k=Error("Cannot find module '"+g+"'");throw k.code="MODULE_NOT_FOUND",k;}k=f[g]={exports:{}};
c[g][0].call(k.exports,function(a){var h=c[g][1][a];return e(h?h:a)},k,k.exports,b,c,f,a)}return f[g].exports}for(var h="function"==typeof require&&require,g=0;g<a.length;g++)e(a[g]);return e}({1:[function(b,c,f){var a=new ArrayBuffer(0),e=function(h,g,b,n){this.gl=h;this.buffer=h.createBuffer();this.type=g||h.ARRAY_BUFFER;this.drawType=n||h.STATIC_DRAW;this.data=a;b&&this.upload(b);this._updateID=0};e.prototype.upload=function(a,g,b){b||this.bind();b=this.gl;a=a||this.data;this.data.byteLength>=
a.byteLength?b.bufferSubData(this.type,g||0,a):b.bufferData(this.type,a,this.drawType);this.data=a};e.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)};e.createVertexBuffer=function(a,g,b){return new e(a,a.ARRAY_BUFFER,g,b)};e.createIndexBuffer=function(a,g,b){return new e(a,a.ELEMENT_ARRAY_BUFFER,g,b)};e.create=function(a,g,b,n){return new e(a,g,b,n)};e.prototype.destroy=function(){this.gl.deleteBuffer(this.buffer)};c.exports=e},{}],2:[function(b,c,f){var a=b("./GLTexture"),e=
function(a,g,b){this.gl=a;this.framebuffer=a.createFramebuffer();this.texture=this.stencil=null;this.width=g||100;this.height=b||100};e.prototype.enableTexture=function(h){var g=this.gl;this.texture=h||new a(g);this.texture.bind();this.bind();g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,this.texture.texture,0)};e.prototype.enableStencil=function(){if(!this.stencil){var a=this.gl;this.stencil=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.stencil);a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.stencil);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_STENCIL,this.width,this.height)}};e.prototype.clear=function(a,g,b,n){this.bind();var k=this.gl;k.clearColor(a,g,b,n);k.clear(k.COLOR_BUFFER_BIT)};e.prototype.bind=function(){var a=this.gl;this.texture&&this.texture.unbind();a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer)};e.prototype.unbind=function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)};e.prototype.resize=function(a,g){var b=this.gl;
this.width=a;this.height=g;this.texture&&this.texture.uploadData(null,a,g);this.stencil&&(b.bindRenderbuffer(b.RENDERBUFFER,this.stencil),b.renderbufferStorage(b.RENDERBUFFER,b.DEPTH_STENCIL,a,g))};e.prototype.destroy=function(){var a=this.gl;this.texture&&this.texture.destroy();a.deleteFramebuffer(this.framebuffer);this.texture=this.stencil=this.gl=null};e.createRGBA=function(b,g,m,n){n=a.fromData(b,null,g,m);n.enableNearestScaling();n.enableWrapClamp();b=new e(b,g,m);b.enableTexture(n);b.unbind();
return b};e.createFloat32=function(b,g,m,n){n=new a.fromData(b,n,g,m);n.enableNearestScaling();n.enableWrapClamp();b=new e(b,g,m);b.enableTexture(n);b.unbind();return b};c.exports=e},{"./GLTexture":4}],3:[function(b,c,f){var a=b("./shader/compileProgram"),e=b("./shader/extractAttributes"),h=b("./shader/extractUniforms"),g=b("./shader/generateUniformAccessObject");b=function(b,n,k,p){this.gl=b;this.program=a(b,n,k,p);this.attributes=e(b,this.program);for(var c in this.attributes)console.log(c+" : "+
this.attributes[c].location);console.log(">>>>>>>");n=h(b,this.program);this.uniforms=g(b,n)};b.prototype.bind=function(){this.gl.useProgram(this.program)};b.prototype.destroy=function(){};c.exports=b},{"./shader/compileProgram":9,"./shader/extractAttributes":11,"./shader/extractUniforms":12,"./shader/generateUniformAccessObject":13}],4:[function(b,c,f){var a=function(a,g,b,n,k){this.gl=a;this.texture=a.createTexture();this.premultiplyAlpha=this.mipmap=!1;this.width=g||-1;this.height=b||-1;this.format=
n||a.RGBA;this.type=k||a.UNSIGNED_BYTE};a.prototype.upload=function(a){this.bind();var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var b=a.videoWidth||a.width,n=a.videoHeight||a.height;n!==this.height||b!==this.width?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,this.type,a):g.texSubImage2D(g.TEXTURE_2D,0,0,0,this.format,this.type,a);this.width=b;this.height=n};var e=!1;a.prototype.uploadData=function(a,g,b){this.bind();var n=this.gl;if(a instanceof Float32Array){if(!e)if(n.getExtension("OES_texture_float"))e=
!0;else throw Error("floating point textures not available");this.type=n.FLOAT}else this.type=n.UNSIGNED_BYTE;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);g!==this.width||b!==this.height?n.texImage2D(n.TEXTURE_2D,0,this.format,g,b,0,this.format,this.type,a||null):n.texSubImage2D(n.TEXTURE_2D,0,0,0,g,b,this.format,this.type,a||null);this.width=g;this.height=b};a.prototype.bind=function(a){var g=this.gl;void 0!==a&&g.activeTexture(g.TEXTURE0+a);g.bindTexture(g.TEXTURE_2D,this.texture)};
a.prototype.unbind=function(){var a=this.gl;a.bindTexture(a.TEXTURE_2D,null)};a.prototype.minFilter=function(a){var g=this.gl;this.bind();this.mipmap?g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a?g.LINEAR_MIPMAP_LINEAR:g.NEAREST_MIPMAP_NEAREST):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,a?g.LINEAR:g.NEAREST)};a.prototype.magFilter=function(a){var g=this.gl;this.bind();g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,a?g.LINEAR:g.NEAREST)};a.prototype.enableMipmap=function(){var a=this.gl;
this.bind();this.mipmap=!0;a.generateMipmap(a.TEXTURE_2D)};a.prototype.enableLinearScaling=function(){this.minFilter(!0);this.magFilter(!0)};a.prototype.enableNearestScaling=function(){this.minFilter(!1);this.magFilter(!1)};a.prototype.enableWrapClamp=function(){var a=this.gl;this.bind();a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)};a.prototype.enableWrapRepeat=function(){var a=this.gl;this.bind();a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_S,a.REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT)};a.prototype.enableWrapMirrorRepeat=function(){var a=this.gl;this.bind();a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.MIRRORED_REPEAT);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.MIRRORED_REPEAT)};a.prototype.destroy=function(){this.gl.deleteTexture(this.texture)};a.fromSource=function(b,g,m){b=new a(b);b.premultiplyAlpha=m||!1;b.upload(g);return b};a.fromData=function(b,g,m,n){b=new a(b);b.uploadData(g,m,n);
return b};c.exports=a},{}],5:[function(b,c,f){function a(b,g){this.nativeVaoExtension=null;a.FORCE_NATIVE||(this.nativeVaoExtension=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"));this.nativeState=g;if(this.nativeVaoExtension){this.nativeVao=this.nativeVaoExtension.createVertexArrayOES();var m=b.getParameter(b.MAX_VERTEX_ATTRIBS);this.nativeState={tempAttribState:Array(m),attribState:Array(m)}}this.gl=b;this.attributes=
[];this.indexBuffer=null;this.dirty=!1}var e=b("./setVertexAttribArrays");a.prototype.constructor=a;c.exports=a;a.FORCE_NATIVE=!0;a.prototype.bind=function(){this.nativeVao?(this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao),this.dirty&&(this.dirty=!1,this.activate())):this.activate();return this};a.prototype.unbind=function(){this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(null);return this};a.prototype.activate=function(){for(var a=this.gl,g=null,b=0;b<this.attributes.length;b++){var n=
this.attributes[b];g!==n.buffer&&(n.buffer.bind(),g=n.buffer);a.vertexAttribPointer(n.attribute.location,n.attribute.size,n.type||a.FLOAT,n.normalized||!1,n.stride||0,n.start||0)}e(a,this.attributes,this.nativeState);this.indexBuffer.bind();return this};a.prototype.addAttribute=function(a,g,b,n,k,p){this.attributes.push({buffer:a,attribute:g,location:g.location,type:b||this.gl.FLOAT,normalized:n||!1,stride:k||0,start:p||0});this.dirty=!0;return this};a.prototype.addIndex=function(a){this.indexBuffer=
a;this.dirty=!0;return this};a.prototype.clear=function(){this.nativeVao&&this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao);this.attributes.length=0;this.indexBuffer=null;return this};a.prototype.draw=function(a,g,b){var n=this.gl;n.drawElements(a,g||this.indexBuffer.data.length,n.UNSIGNED_SHORT,b||0);return this};a.prototype.destroy=function(){this.nativeState=this.attributes=this.indexBuffer=this.gl=null;this.nativeVao&&this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao);this.nativeVao=
this.nativeVaoExtension=null}},{"./setVertexAttribArrays":8}],6:[function(b,c,f){c.exports=function(a,b){var h=a.getContext("webgl",b)||a.getContext("experimental-webgl",b);if(!h)throw Error("This browser does not support webGL. Try using the canvas renderer");return h}},{}],7:[function(b,c,f){b={createContext:b("./createContext"),setVertexAttribArrays:b("./setVertexAttribArrays"),GLBuffer:b("./GLBuffer"),GLFramebuffer:b("./GLFramebuffer"),GLShader:b("./GLShader"),GLTexture:b("./GLTexture"),VertexArrayObject:b("./VertexArrayObject"),
shader:b("./shader")};"undefined"!==typeof c&&c.exports&&(c.exports=b);"undefined"!==typeof window&&(window.PIXI=window.PIXI||{},window.PIXI.glCore=b)},{"./GLBuffer":1,"./GLFramebuffer":2,"./GLShader":3,"./GLTexture":4,"./VertexArrayObject":5,"./createContext":6,"./setVertexAttribArrays":8,"./shader":14}],8:[function(b,c,f){c.exports=function(a,b,h){var g;if(h){var m=h.tempAttribState,n=h.attribState;for(g=0;g<m.length;g++)m[g]=!1;for(g=0;g<b.length;g++)m[b[g].attribute.location]=!0;for(g=0;g<n.length;g++)n[g]!==
m[g]&&(n[g]=m[g],h.attribState[g]?a.enableVertexAttribArray(g):a.disableVertexAttribArray(g))}else for(g=0;g<b.length;g++)a.enableVertexAttribArray(b[g].attribute.location)}},{}],9:[function(b,c,f){var a=function(a,b,g){b=a.createShader(b);a.shaderSource(b,g);a.compileShader(b);return a.getShaderParameter(b,a.COMPILE_STATUS)?b:(console.log(a.getShaderInfoLog(b)),null)};c.exports=function(b,h,g,m){h=a(b,b.VERTEX_SHADER,h);g=a(b,b.FRAGMENT_SHADER,g);var n=b.createProgram();b.attachShader(n,h);b.attachShader(n,
g);if(m)for(var k in m)b.bindAttribLocation(n,m[k],k);b.linkProgram(n);b.getProgramParameter(n,b.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",b.getProgramParameter(n,b.VALIDATE_STATUS)),console.error("gl.getError()",b.getError()),""!==b.getProgramInfoLog(n)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",b.getProgramInfoLog(n)),b.deleteProgram(n),n=null);b.deleteShader(h);b.deleteShader(g);return n}},{}],10:[function(b,c,f){var a=
function(a){a=Array(a);for(var b=0;b<a.length;b++)a[b]=!1;return a};c.exports=function(b,h){switch(b){case "float":return 0;case "vec2":return new Float32Array(2*h);case "vec3":return new Float32Array(3*h);case "vec4":return new Float32Array(4*h);case "int":case "sampler2D":return 0;case "ivec2":return new Int32Array(2*h);case "ivec3":return new Int32Array(3*h);case "ivec4":return new Int32Array(4*h);case "bool":return!1;case "bvec2":return a(2*h);case "bvec3":return a(3*h);case "bvec4":return a(4*
h);case "mat2":return new Float32Array([1,0,0,1]);case "mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case "mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}}},{}],11:[function(b,c,f){var a=b("./mapType"),e=b("./mapSize"),h=function(a,b,h,k){gl.vertexAttribPointer(this.location,this.size,a||gl.FLOAT,b||!1,h||0,k||0)};c.exports=function(g,b){for(var c={},k=g.getProgramParameter(b,g.ACTIVE_ATTRIBUTES),p=0;p<k;p++){var z=g.getActiveAttrib(b,p),d=a(g,z.type);c[z.name]={type:d,size:e(d),
location:g.getAttribLocation(b,z.name),pointer:h}}return c}},{"./mapSize":15,"./mapType":16}],12:[function(b,c,f){var a=b("./mapType"),e=b("./defaultValue");c.exports=function(b,g){for(var m={},c=b.getProgramParameter(g,b.ACTIVE_UNIFORMS),k=0;k<c;k++){var p=b.getActiveUniform(g,k),z=p.name.replace(/\[.*?\]/,""),d=a(b,p.type);m[z]={type:d,size:p.size,location:b.getUniformLocation(g,z),value:e(d,p.size)}}return m}},{"./defaultValue":10,"./mapType":16}],13:[function(b,c,f){var a=function(a){a=h.replace("%%",
a);return new Function(a)},e=function(a,b){var h=g.replace(/%%/g,a),c;(c=1===b.size?m[b.type]:n[b.type])&&(h+="\nthis.gl."+c+";");return new Function("value",h)},h="return this.data.%%.value;",g="this.data.%%.value = value;\nvar location = this.data.%%.location;",m={"float":"uniform1f(location, value)",vec2:"uniform2f(location, value[0], value[1])",vec3:"uniform3f(location, value[0], value[1], value[2])",vec4:"uniform4f(location, value[0], value[1], value[2], value[3])","int":"uniform1i(location, value)",
ivec2:"uniform2i(location, value[0], value[1])",ivec3:"uniform3i(location, value[0], value[1], value[2])",ivec4:"uniform4i(location, value[0], value[1], value[2], value[3])",bool:"uniform1i(location, value)",bvec2:"uniform2i(location, value[0], value[1])",bvec3:"uniform3i(location, value[0], value[1], value[2])",bvec4:"uniform4i(location, value[0], value[1], value[2], value[3])",mat2:"uniformMatrix2fv(location, false, value)",mat3:"uniformMatrix3fv(location, false, value)",mat4:"uniformMatrix4fv(location, false, value)",
sampler2D:"uniform1i(location, value)"},n={"float":"uniform1fv(location, value)",vec2:"uniform2fv(location, value)",vec3:"uniform3fv(location, value)",vec4:"uniform4fv(location, value)","int":"uniform1iv(location, value)",ivec2:"uniform2iv(location, value)",ivec3:"uniform3iv(location, value)",ivec4:"uniform4iv(location, value)",bool:"uniform1iv(location, value)",bvec2:"uniform2iv(location, value)",bvec3:"uniform3iv(location, value)",bvec4:"uniform4iv(location, value)",sampler2D:"uniform1iv(location, value)"};
c.exports=function(b,g){var h={data:{}};h.gl=b;for(var m=Object.keys(g),c=0;c<m.length;c++){for(var n=m[c],d=n.split("."),f=d[d.length-1],u=h,y=0;y<d.length-1;y++)var x=u[d[y]]||{data:{}},u=u[d[y]]=x;d=u;n=g[n];d.data[f]=n;d.gl=b;Object.defineProperty(d,f,{get:a(f),set:e(f,n)})}return h}},{}],14:[function(b,c,f){c.exports={compileProgram:b("./compileProgram"),defaultValue:b("./defaultValue"),extractAttributes:b("./extractAttributes"),extractUniforms:b("./extractUniforms"),generateUniformAccessObject:b("./generateUniformAccessObject"),
mapSize:b("./mapSize"),mapType:b("./mapType")}},{"./compileProgram":9,"./defaultValue":10,"./extractAttributes":11,"./extractUniforms":12,"./generateUniformAccessObject":13,"./mapSize":15,"./mapType":16}],15:[function(b,c,f){var a={"float":1,vec2:2,vec3:3,vec4:4,"int":1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};c.exports=function(b){return a[b]}},{}],16:[function(b,c,f){var a=null,e={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",
INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D"};c.exports=function(b,g){if(!a){var m=Object.keys(e);a={};for(var c=0;c<m.length;++c){var k=m[c];a[b[k]]=e[k]}}return a[g]}},{}],17:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a,b,c,k){(0,e["default"])(b)(a,(0,h["default"])(c),k)};var a=b("./internal/eachOfLimit"),
e=a&&a.__esModule?a:{"default":a},h=(b=b("./internal/withoutIndex"))&&b.__esModule?b:{"default":b};c.exports=f["default"]},{"./internal/eachOfLimit":21,"./internal/withoutIndex":28}],18:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});var a=b("./eachLimit"),a=a&&a.__esModule?a:{"default":a};b=(b=b("./internal/doLimit"))&&b.__esModule?b:{"default":b};f["default"]=(0,b["default"])(a["default"],1);c.exports=f["default"]},{"./eachLimit":17,"./internal/doLimit":20}],19:[function(b,c,f){function a(){this.head=
this.tail=null;this.length=0}Object.defineProperty(f,"__esModule",{value:!0});f["default"]=a;a.prototype.removeLink=function(a){a.prev?a.prev.next=a.next:this.head=a.next;a.next?a.next.prev=a.prev:this.tail=a.prev;a.prev=a.next=null;--this.length;return a};a.prototype.empty=a;a.prototype.insertAfter=function(a,b){b.prev=a;(b.next=a.next)?a.next.prev=b:this.tail=b;a.next=b;this.length+=1};a.prototype.insertBefore=function(a,b){b.prev=a.prev;b.next=a;a.prev?a.prev.next=b:this.head=b;a.prev=b;this.length+=
1};a.prototype.unshift=function(a){this.head?this.insertBefore(this.head,a):(this.length=1,this.head=this.tail=a)};a.prototype.push=function(a){this.tail?this.insertAfter(this.tail,a):(this.length=1,this.head=this.tail=a)};a.prototype.shift=function(){return this.head&&this.removeLink(this.head)};a.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)};c.exports=f["default"]},{}],20:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a,b){return function(h,
g,m){return a(h,b,g,m)}};c.exports=f["default"]},{}],21:[function(b,c,f){function a(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a){return function(b,c,d){function e(a){--u;if(a)w=!0,d(a);else{if(w&&0>=u)return d(null);f()}}function f(){for(;u<a&&!w;){var b=q();if(null===b){w=!0;0>=u&&d(null);break}u+=1;c(b.value,b.key,(0,n["default"])(e))}}d=(0,g["default"])(d||h["default"]);if(0>=a||!b)return d(null);var q=(0,m["default"])(b),w=
!1,u=0;f()}};var e=b("lodash/noop"),h=a(e),e=b("./once"),g=a(e),e=b("./iterator"),m=a(e);b=b("./onlyOnce");var n=a(b);c.exports=f["default"]},{"./iterator":23,"./once":24,"./onlyOnce":25,"lodash/noop":54}],22:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(b){return a&&b[a]&&b[a]()};$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var a="function"===typeof Symbol&&Symbol.iterator;c.exports=f["default"]},{}],23:[function(b,c,f){function a(a){return a&&
a.__esModule?a:{"default":a}}function e(a){var b=-1,g=a.length;return function(){return++b<g?{value:a[b],key:b}:null}}function h(a){var b=-1;return function(){var g=a.next();if(g.done)return null;b++;return{value:g.value,key:b}}}function g(a){var b=(0,p["default"])(a),g=-1,h=b.length;return function(){var m=b[++g];return g<h?{value:a[m],key:m}:null}}Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a){if((0,n["default"])(a))return e(a);var b=(0,k["default"])(a);return b?h(b):
g(a)};var m=b("lodash/isArrayLike"),n=a(m),m=b("./getIterator"),k=a(m);b=b("lodash/keys");var p=a(b);c.exports=f["default"]},{"./getIterator":22,"lodash/isArrayLike":46,"lodash/keys":53}],24:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a){return function(){if(null!==a){var b=a;a=null;b.apply(this,arguments)}}};c.exports=f["default"]},{}],25:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a){return function(){if(null===
a)throw Error("Callback was already called.");var b=a;a=null;b.apply(this,arguments)}};c.exports=f["default"]},{}],26:[function(b,c,f){function a(a){return a&&a.__esModule?a:{"default":a}}Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a,b,c){function d(a,b,k){if(null!=k&&"function"!==typeof k)throw Error("task callback must be a function");x.started=!0;(0,g["default"])(a)||(a=[a]);if(0===a.length&&x.idle())return(0,p["default"])(function(){x.drain()});(0,h["default"])(a,function(a){a=
{data:a,callback:k||m["default"]};b?x._tasks.unshift(a):x._tasks.push(a)});(0,p["default"])(x.process)}function e(a){return(0,n["default"])(function(b){--f;(0,h["default"])(a,function(a){(0,h["default"])(y,function(b,g){if(b===a)return y.splice(g,1),!1});a.callback.apply(a,b);null!=b[0]&&x.error(b[0],a.data)});f<=x.concurrency-x.buffer&&x.unsaturated();x.idle()&&x.drain();x.process()})}if(null==b)b=1;else if(0===b)throw Error("Concurrency must not be zero");var f=0,y=[],x={_tasks:new z["default"],
concurrency:b,payload:c,saturated:m["default"],unsaturated:m["default"],buffer:b/4,empty:m["default"],drain:m["default"],error:m["default"],started:!1,paused:!1,push:function(a,b){d(a,!1,b)},kill:function(){x.drain=m["default"];x._tasks.empty()},unshift:function(a,b){d(a,!0,b)},process:function(){for(;!x.paused&&f<x.concurrency&&x._tasks.length;){var b=[],g=[],h=x._tasks.length;x.payload&&(h=Math.min(h,x.payload));for(var m=0;m<h;m++){var c=x._tasks.shift();b.push(c);g.push(c.data)}0===x._tasks.length&&
x.empty();f+=1;y.push(b[0]);f===x.concurrency&&x.saturated();b=(0,k["default"])(e(b));a(g,b)}},length:function(){return x._tasks.length},running:function(){return f},workersList:function(){return y},idle:function(){return 0===x._tasks.length+f},pause:function(){x.paused=!0},resume:function(){if(!1!==x.paused){x.paused=!1;for(var a=Math.min(x.concurrency,x._tasks.length),b=1;b<=a;b++)(0,p["default"])(x.process)}}};return x};var e=b("lodash/_arrayEach"),h=a(e),e=b("lodash/isArray"),g=a(e),e=b("lodash/noop"),
m=a(e),e=b("lodash/rest"),n=a(e),e=b("./onlyOnce"),k=a(e),e=b("./setImmediate"),p=a(e);b=b("./DoublyLinkedList");var z=a(b);c.exports=f["default"]},{"./DoublyLinkedList":19,"./onlyOnce":25,"./setImmediate":27,"lodash/_arrayEach":35,"lodash/isArray":45,"lodash/noop":54,"lodash/rest":55}],27:[function(b,c,f){(function(a){function c(a){setTimeout(a,0)}function h(a){return(0,m["default"])(function(b,g){a(function(){b.apply(null,g)})})}Object.defineProperty(f,"__esModule",{value:!0});f.hasNextTick=f.hasSetImmediate=
void 0;f.fallback=c;f.wrap=h;var g=b("lodash/rest"),m=g&&g.__esModule?g:{"default":g},g=f.hasSetImmediate="function"===typeof setImmediate&&setImmediate,n=f.hasNextTick="object"===typeof a&&"function"===typeof a.nextTick;f["default"]=h(g?setImmediate:n?a.nextTick:c)}).call(this,b("_process"))},{_process:61,"lodash/rest":55}],28:[function(b,c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(a){return function(b,h,g){return a(b,g)}};c.exports=f["default"]},{}],29:[function(b,
c,f){Object.defineProperty(f,"__esModule",{value:!0});f["default"]=function(b,h){return(0,a["default"])(function(a,h){b(a[0],h)},h,1)};var a=(b=b("./internal/queue"))&&b.__esModule?b:{"default":b};c.exports=f["default"]},{"./internal/queue":26}],30:[function(b,c,f){function a(a){var b=32;(a&=-a)&&b--;a&65535&&(b-=16);a&16711935&&(b-=8);a&252645135&&(b-=4);a&858993459&&(b-=2);a&1431655765&&--b;return b}"use restrict";f.INT_BITS=32;f.INT_MAX=2147483647;f.INT_MIN=-2147483648;f.sign=function(a){return(0<
a)-(0>a)};f.abs=function(a){var b=a>>31;return(a^b)-b};f.min=function(a,b){return b^(a^b)&-(a<b)};f.max=function(a,b){return a^(a^b)&-(a<b)};f.isPow2=function(a){return!(a&a-1)&&!!a};f.log2=function(a){var b,m;b=(65535<a)<<4;a>>>=b;m=(255<a)<<3;a>>>=m;b|=m;m=(15<a)<<2;a>>>=m;b|=m;m=(3<a)<<1;return b|m|a>>>m>>1};f.log10=function(a){return 1E9<=a?9:1E8<=a?8:1E7<=a?7:1E6<=a?6:1E5<=a?5:1E4<=a?4:1E3<=a?3:100<=a?2:10<=a?1:0};f.popCount=function(a){a-=a>>>1&1431655765;a=(a&858993459)+(a>>>2&858993459);return 16843009*
(a+(a>>>4)&252645135)>>>24};f.countTrailingZeros=a;f.nextPow2=function(a){a+=0===a;--a;a|=a>>>1;a|=a>>>2;a|=a>>>4;a|=a>>>8;return(a|a>>>16)+1};f.prevPow2=function(a){a|=a>>>1;a|=a>>>2;a|=a>>>4;a|=a>>>8;a|=a>>>16;return a-(a>>>1)};f.parity=function(a){a^=a>>>16;a^=a>>>8;return 27030>>>((a^a>>>4)&15)&1};var e=Array(256);(function(a){for(var b=0;256>b;++b){for(var m=b,c=b,k=7,m=m>>>1;m;m>>>=1)c<<=1,c|=m&1,--k;a[b]=c<<k&255}})(e);f.reverse=function(a){return e[a&255]<<24|e[a>>>8&255]<<16|e[a>>>16&255]<<
8|e[a>>>24&255]};f.interleave2=function(a,b){a&=65535;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b&=65535;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1};f.deinterleave2=function(a,b){a=a>>>b&1431655765;a=(a|a>>>1)&858993459;a=(a|a>>>2)&252645135;a=(a|a>>>4)&16711935;return((a|a>>>16)&65535)<<16>>16};f.interleave3=function(a,b,m){a&=1023;a=(a|a<<16)&4278190335;a=(a|a<<8)&251719695;a=(a|a<<4)&3272356035;b&=1023;b=
(b|b<<16)&4278190335;b=(b|b<<8)&251719695;b=(b|b<<4)&3272356035;m&=1023;m=(m|m<<16)&4278190335;m=(m|m<<8)&251719695;m=(m|m<<4)&3272356035;return(a|a<<2)&1227133513|((b|b<<2)&1227133513)<<1|((m|m<<2)&1227133513)<<2};f.deinterleave3=function(a,b){a=a>>>b&1227133513;a=(a|a>>>2)&3272356035;a=(a|a>>>4)&251719695;a=(a|a>>>8)&4278190335;return((a|a>>>16)&1023)<<22>>22};f.nextCombination=function(b){var g=b|b-1;return g+1|(~g&-~g)-1>>>a(b)+1}},{}],31:[function(b,c,f){function a(a,b,k){k=k||2;var c=b&&b.length,
z=c?b[0]*k:a.length,d=e(a,0,z,k,!0),r=[];if(!d)return r;var f,v,t,x;if(c){var A=k,c=[],q,u,y;x=0;for(q=b.length;x<q;x++)u=b[x]*A,y=x<q-1?b[x+1]*A:a.length,u=e(a,u,y,A,!1),u===u.next&&(u.steiner=!0),c.push(p(u));c.sort(m);for(x=0;x<c.length;x++){b=c[x];A=d;if(A=n(b,A))b=w(A,b),h(b,b.next);d=h(d,d.next)}}if(a.length>80*k){f=t=a[0];v=c=a[1];for(A=k;A<z;A+=k)x=a[A],b=a[A+1],x<f&&(f=x),b<v&&(v=b),x>t&&(t=x),b>c&&(c=b);t=Math.max(t-f,c-v)}g(d,r,k,f,v,t);return r}function e(a,b,g,m,h){var k;if(h===0<A(a,
b,g,m))for(h=b;h<g;h+=m)k=u(h,a[h],a[h+1],k);else for(h=g-m;h>=b;h-=m)k=u(h,a[h],a[h+1],k);k&&v(k,k.next)&&(y(k),k=k.next);return k}function h(a,b){if(!a)return a;b||(b=a);var g=a,m;do if(m=!1,g.steiner||!v(g,g.next)&&0!==r(g.prev,g,g.next))g=g.next;else{y(g);g=b=g.prev;if(g===g.next)return null;m=!0}while(m||g!==b);return b}function g(a,b,m,c,p,n,d){if(a){if(!d&&n){var e=a,f=e;do null===f.z&&(f.z=k(f.x,f.y,c,p,n)),f.prevZ=f.prev,f=f.nextZ=f.next;while(f!==e);f.prevZ.nextZ=null;f.prevZ=null;var e=
f,x,A,u,L,K,R,N=1;do{f=e;u=e=null;for(L=0;f;){L++;A=f;for(x=K=0;x<N&&(K++,A=A.nextZ,A);x++);for(R=N;0<K||0<R&&A;)0===K?(x=A,A=A.nextZ,R--):0!==R&&A?f.z<=A.z?(x=f,f=f.nextZ,K--):(x=A,A=A.nextZ,R--):(x=f,f=f.nextZ,K--),u?u.nextZ=x:e=x,x.prevZ=u,u=x;f=A}u.nextZ=null;N*=2}while(1<L)}for(e=a;a.prev!==a.next;){f=a.prev;A=a.next;if(n)a:{u=a;R=c;var O=p,S=n;L=u.prev;K=u;N=u.next;if(0<=r(L,K,N))u=!1;else{var T=L.x>K.x?L.x>N.x?L.x:N.x:K.x>N.x?K.x:N.x,U=L.y>K.y?L.y>N.y?L.y:N.y:K.y>N.y?K.y:N.y;x=k(L.x<K.x?L.x<
N.x?L.x:N.x:K.x<N.x?K.x:N.x,L.y<K.y?L.y<N.y?L.y:N.y:K.y<N.y?K.y:N.y,R,O,S);R=k(T,U,R,O,S);for(O=u.nextZ;O&&O.z<=R;){if(O!==u.prev&&O!==u.next&&z(L.x,L.y,K.x,K.y,N.x,N.y,O.x,O.y)&&0<=r(O.prev,O,O.next)){u=!1;break a}O=O.nextZ}for(O=u.prevZ;O&&O.z>=x;){if(O!==u.prev&&O!==u.next&&z(L.x,L.y,K.x,K.y,N.x,N.y,O.x,O.y)&&0<=r(O.prev,O,O.next)){u=!1;break a}O=O.prevZ}u=!0}}else a:if(u=a,L=u.prev,K=u,N=u.next,0<=r(L,K,N))u=!1;else{for(x=u.next.next;x!==u.prev;){if(z(L.x,L.y,K.x,K.y,N.x,N.y,x.x,x.y)&&0<=r(x.prev,
x,x.next)){u=!1;break a}x=x.next}u=!0}if(u)b.push(f.i/m),b.push(a.i/m),b.push(A.i/m),y(a),e=a=A.next;else if(a=A,a===e){if(!d)g(h(a),b,m,c,p,n,1);else if(1===d){d=b;e=m;f=a;do A=f.prev,u=f.next.next,!v(A,u)&&t(A,f,f.next,u)&&q(A,u)&&q(u,A)&&(d.push(A.i/e),d.push(f.i/e),d.push(u.i/e),y(f),y(f.next),f=a=u),f=f.next;while(f!==a);a=f;g(a,b,m,c,p,n,2)}else if(2===d)a:{d=a;do{for(e=d.next.next;e!==d.prev;){if(f=d.i!==e.i){f=d;A=e;if(u=f.next.i!==A.i&&f.prev.i!==A.i){b:{u=f;do{if(u.i!==f.i&&u.next.i!==f.i&&
u.i!==A.i&&u.next.i!==A.i&&t(u,u.next,f,A)){u=!0;break b}u=u.next}while(u!==f);u=!1}u=!u}if(u=u&&q(f,A)&&q(A,f)){u=f;L=!1;K=(f.x+A.x)/2;A=(f.y+A.y)/2;do u.y>A!==u.next.y>A&&K<(u.next.x-u.x)*(A-u.y)/(u.next.y-u.y)+u.x&&(L=!L),u=u.next;while(u!==f);u=L}f=u}if(f){a=w(d,e);d=h(d,d.next);a=h(a,a.next);g(d,b,m,c,p,n);g(a,b,m,c,p,n);break a}e=e.next}d=d.next}while(d!==a)}break}}}}function m(a,b){return a.x-b.x}function n(a,b){var g=b,m=a.x,h=a.y,k=-Infinity,c;do{if(h<=g.y&&h>=g.next.y){var p=g.x+(h-g.y)*
(g.next.x-g.x)/(g.next.y-g.y);if(p<=m&&p>k){k=p;if(p===m){if(h===g.y)return g;if(h===g.next.y)return g.next}c=g.x<g.next.x?g:g.next}}g=g.next}while(g!==b);if(!c)return null;if(m===k)return c.prev;for(var p=c,n=c.x,d=c.y,e=Infinity,r,g=c.next;g!==p;)m>=g.x&&g.x>=n&&z(h<d?m:k,h,n,d,h<d?k:m,h,g.x,g.y)&&(r=Math.abs(h-g.y)/(m-g.x),(r<e||r===e&&g.x>c.x)&&q(g,a)&&(c=g,e=r)),g=g.next;return c}function k(a,b,g,m,h){a=32767*(a-g)/h;b=32767*(b-m)/h;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;
b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function p(a){var b=a,g=a;do b.x<g.x&&(g=b),b=b.next;while(b!==a);return g}function z(a,b,g,m,h,k,c,p){return 0<=(h-c)*(b-p)-(a-c)*(k-p)&&0<=(a-c)*(m-p)-(g-c)*(b-p)&&0<=(g-c)*(k-p)-(h-c)*(m-p)}function r(a,b,g){return(b.y-a.y)*(g.x-b.x)-(b.x-a.x)*(g.y-b.y)}function v(a,b){return a.x===b.x&&a.y===b.y}function t(a,b,g,m){return v(a,b)&&v(g,m)||v(a,m)&&v(g,b)?!0:0<r(a,b,g)!==0<r(a,b,m)&&0<
r(g,m,a)!==0<r(g,m,b)}function q(a,b){return 0>r(a.prev,a,a.next)?0<=r(a,b,a.next)&&0<=r(a,a.prev,b):0>r(a,b,a.prev)||0>r(a,a.next,b)}function w(a,b){var g=new x(a.i,a.x,a.y),m=new x(b.i,b.x,b.y),h=a.next,k=b.prev;a.next=b;b.prev=a;g.next=h;h.prev=g;m.next=g;g.prev=m;k.next=m;m.prev=k;return m}function u(a,b,g,m){a=new x(a,b,g);m?(a.next=m.next,a.prev=m,m.next.prev=a,m.next=a):(a.prev=a,a.next=a);return a}function y(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&
(a.nextZ.prevZ=a.prevZ)}function x(a,b,g){this.i=a;this.x=b;this.y=g;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function A(a,b,g,m){for(var h=0,k=g-m;b<g;b+=m)h+=(a[k]-a[b])*(a[b+1]+a[k+1]),k=b;return h}c.exports=a;a.deviation=function(a,b,g,m){var h=b&&b.length,k=Math.abs(A(a,0,h?b[0]*g:a.length,g));if(h)for(var h=0,c=b.length;h<c;h++)k-=Math.abs(A(a,b[h]*g,h<c-1?b[h+1]*g:a.length,g));for(h=b=0;h<m.length;h+=3){var c=m[h]*g,p=m[h+1]*g,n=m[h+2]*g;b+=Math.abs((a[c]-a[n])*
(a[p+1]-a[c+1])-(a[c]-a[p])*(a[n+1]-a[c+1]))}return 0===k&&0===b?0:Math.abs((b-k)/k)};a.flatten=function(a){for(var b=a[0][0].length,g={vertices:[],holes:[],dimensions:b},m=0,h=0;h<a.length;h++){for(var k=0;k<a[h].length;k++)for(var c=0;c<b;c++)g.vertices.push(a[h][k][c]);0<h&&(m+=a[h-1].length,g.holes.push(m))}return g}},{}],32:[function(b,c,f){function a(a,b,g){this.fn=a;this.context=b;this.once=g||!1}function e(){}var h=Object.prototype.hasOwnProperty,g="function"!==typeof Object.create?"~":!1;
e.prototype._events=void 0;e.prototype.eventNames=function(){var a=this._events,b=[],k;if(!a)return b;for(k in a)h.call(a,k)&&b.push(g?k.slice(1):k);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(a)):b};e.prototype.listeners=function(a,b){var h=g?g+a:a,h=this._events&&this._events[h];if(b)return!!h;if(!h)return[];if(h.fn)return[h.fn];for(var c=0,d=h.length,e=Array(d);c<d;c++)e[c]=h[c].fn;return e};e.prototype.emit=function(a,b,h,c,d,e){var f=g?g+a:a;if(!this._events||!this._events[f])return!1;
var f=this._events[f],t=arguments.length,q,w;if("function"===typeof f.fn){f.once&&this.removeListener(a,f.fn,void 0,!0);switch(t){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,b),!0;case 3:return f.fn.call(f.context,b,h),!0;case 4:return f.fn.call(f.context,b,h,c),!0;case 5:return f.fn.call(f.context,b,h,c,d),!0;case 6:return f.fn.call(f.context,b,h,c,d,e),!0}w=1;for(q=Array(t-1);w<t;w++)q[w-1]=arguments[w];f.fn.apply(f.context,q)}else{var u=f.length,y;for(w=0;w<u;w++)switch(f[w].once&&
this.removeListener(a,f[w].fn,void 0,!0),t){case 1:f[w].fn.call(f[w].context);break;case 2:f[w].fn.call(f[w].context,b);break;case 3:f[w].fn.call(f[w].context,b,h);break;default:if(!q)for(y=1,q=Array(t-1);y<t;y++)q[y-1]=arguments[y];f[w].fn.apply(f[w].context,q)}}return!0};e.prototype.on=function(b,h,k){h=new a(h,k||this);b=g?g+b:b;this._events||(this._events=g?{}:Object.create(null));this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],h]:this._events[b].push(h):this._events[b]=h;
return this};e.prototype.once=function(b,h,k){h=new a(h,k||this,!0);b=g?g+b:b;this._events||(this._events=g?{}:Object.create(null));this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],h]:this._events[b].push(h):this._events[b]=h;return this};e.prototype.removeListener=function(a,b,h,c){a=g?g+a:a;if(!this._events||!this._events[a])return this;var d=this._events[a],e=[];if(b)if(d.fn)(d.fn!==b||c&&!d.once||h&&d.context!==h)&&e.push(d);else for(var f=0,t=d.length;f<t;f++)(d[f].fn!==b||
c&&!d[f].once||h&&d[f].context!==h)&&e.push(d[f]);e.length?this._events[a]=1===e.length?e[0]:e:delete this._events[a];return this};e.prototype.removeAllListeners=function(a){if(!this._events)return this;a?delete this._events[g?g+a:a]:this._events=g?{}:Object.create(null);return this};e.prototype.off=e.prototype.removeListener;e.prototype.addListener=e.prototype.on;e.prototype.setMaxListeners=function(){return this};e.prefixed=g;"undefined"!==typeof c&&(c.exports=e)},{}],33:[function(b,c,f){(function(a){var b=
/iPhone/i,h=/iPod/i,g=/iPad/i,m=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,n=/Android/i,k=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,p=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,z=/IEMobile/i,f=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,v=/BlackBerry/i,t=/BB10/i,q=/Opera Mini/i,w=/(CriOS|Chrome)(?=.*\bMobile\b)/i,u=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,y=/(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)/i,x=function(a){a=a||navigator.userAgent;
var c=a.split("[FBAN");"undefined"!==typeof c[1]&&(a=c[0]);c=a.split("Twitter");"undefined"!==typeof c[1]&&(a=c[0]);this.apple={phone:b.test(a),ipod:h.test(a),tablet:!b.test(a)&&g.test(a),device:b.test(a)||h.test(a)||g.test(a)};this.amazon={phone:k.test(a),tablet:!k.test(a)&&p.test(a),device:k.test(a)||p.test(a)};this.android={phone:k.test(a)||m.test(a),tablet:!k.test(a)&&!m.test(a)&&(p.test(a)||n.test(a)),device:k.test(a)||p.test(a)||m.test(a)||n.test(a)};this.windows={phone:z.test(a),tablet:f.test(a),
device:z.test(a)||f.test(a)};this.other={blackberry:v.test(a),blackberry10:t.test(a),opera:q.test(a),firefox:u.test(a),chrome:w.test(a),device:v.test(a)||t.test(a)||q.test(a)||u.test(a)||w.test(a)};this.seven_inch=y.test(a);this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch;this.phone=this.apple.phone||this.android.phone||this.windows.phone;this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet;if("undefined"===typeof window)return this},
A=function(){var a=new x;a.Class=x;return a};"undefined"!==typeof c&&c.exports&&"undefined"===typeof window?c.exports=x:"undefined"!==typeof c&&c.exports&&"undefined"!==typeof window?c.exports=A():a.isMobile=A()})(this)},{}],34:[function(b,c,f){c.exports=function(a,b,h){switch(h.length){case 0:return a.call(b);case 1:return a.call(b,h[0]);case 2:return a.call(b,h[0],h[1]);case 3:return a.call(b,h[0],h[1],h[2])}return a.apply(b,h)}},{}],35:[function(b,c,f){c.exports=function(a,b){for(var h=-1,g=a?
a.length:0;++h<g&&!1!==b(a[h],h,a););return a}},{}],36:[function(b,c,f){var a=b("./_baseTimes"),e=b("./isArguments"),h=b("./isArray"),g=b("./_isIndex"),m=Object.prototype.hasOwnProperty;c.exports=function(b,c){var p=h(b)||e(b)?a(b.length,String):[],d=p.length,f=!!d,v;for(v in b)!c&&!m.call(b,v)||f&&("length"==v||g(v,d))||p.push(v);return p}},{"./_baseTimes":39,"./_isIndex":40,"./isArguments":44,"./isArray":45}],37:[function(b,c,f){var a=b("./_isPrototype"),e=b("./_nativeKeys"),h=Object.prototype.hasOwnProperty;
c.exports=function(b){if(!a(b))return e(b);var m=[],c;for(c in Object(b))h.call(b,c)&&"constructor"!=c&&m.push(c);return m}},{"./_isPrototype":41,"./_nativeKeys":42}],38:[function(b,c,f){var a=b("./_apply"),e=Math.max;c.exports=function(b,g){g=e(void 0===g?b.length-1:g,0);return function(){for(var m=arguments,c=-1,k=e(m.length-g,0),p=Array(k);++c<k;)p[c]=m[g+c];c=-1;for(k=Array(g+1);++c<g;)k[c]=m[c];k[g]=p;return a(b,this,k)}}},{"./_apply":34}],39:[function(b,c,f){c.exports=function(a,b){for(var h=
-1,g=Array(a);++h<a;)g[h]=b(h);return g}},{}],40:[function(b,c,f){var a=/^(?:0|[1-9]\d*)$/;c.exports=function(b,h){h=null==h?9007199254740991:h;return!!h&&("number"==typeof b||a.test(b))&&-1<b&&0==b%1&&b<h}},{}],41:[function(b,c,f){var a=Object.prototype;c.exports=function(b){var h=b&&b.constructor;return b===("function"==typeof h&&h.prototype||a)}},{}],42:[function(b,c,f){b=b("./_overArg")(Object.keys,Object);c.exports=b},{"./_overArg":43}],43:[function(b,c,f){c.exports=function(a,b){return function(h){return a(b(h))}}},
{}],44:[function(b,c,f){var a=b("./isArrayLikeObject");b=Object.prototype;var e=b.hasOwnProperty,h=b.toString,g=b.propertyIsEnumerable;c.exports=function(b){return a(b)&&e.call(b,"callee")&&(!g.call(b,"callee")||"[object Arguments]"==h.call(b))}},{"./isArrayLikeObject":47}],45:[function(b,c,f){c.exports=Array.isArray},{}],46:[function(b,c,f){var a=b("./isFunction"),e=b("./isLength");c.exports=function(b){return null!=b&&e(b.length)&&!a(b)}},{"./isFunction":48,"./isLength":49}],47:[function(b,c,f){var a=
b("./isArrayLike"),e=b("./isObjectLike");c.exports=function(b){return e(b)&&a(b)}},{"./isArrayLike":46,"./isObjectLike":51}],48:[function(b,c,f){var a=b("./isObject"),e=Object.prototype.toString;c.exports=function(b){b=a(b)?e.call(b):"";return"[object Function]"==b||"[object GeneratorFunction]"==b}},{"./isObject":50}],49:[function(b,c,f){c.exports=function(a){return"number"==typeof a&&-1<a&&0==a%1&&9007199254740991>=a}},{}],50:[function(b,c,f){c.exports=function(a){var b=typeof a;return!!a&&("object"==
b||"function"==b)}},{}],51:[function(b,c,f){c.exports=function(a){return!!a&&"object"==typeof a}},{}],52:[function(b,c,f){var a=b("./isObjectLike"),e=Object.prototype.toString;c.exports=function(b){return"symbol"==typeof b||a(b)&&"[object Symbol]"==e.call(b)}},{"./isObjectLike":51}],53:[function(b,c,f){var a=b("./_arrayLikeKeys"),e=b("./_baseKeys"),h=b("./isArrayLike");c.exports=function(b){return h(b)?a(b):e(b)}},{"./_arrayLikeKeys":36,"./_baseKeys":37,"./isArrayLike":46}],54:[function(b,c,f){c.exports=
function(){}},{}],55:[function(b,c,f){var a=b("./_baseRest"),e=b("./toInteger");c.exports=function(b,g){if("function"!=typeof b)throw new TypeError("Expected a function");g=void 0===g?g:e(g);return a(b,g)}},{"./_baseRest":38,"./toInteger":57}],56:[function(b,c,f){var a=b("./toNumber"),e=1/0;c.exports=function(b){if(!b)return 0===b?b:0;b=a(b);return b===e||b===-e?1.7976931348623157E308*(0>b?-1:1):b===b?b:0}},{"./toNumber":58}],57:[function(b,c,f){var a=b("./toFinite");c.exports=function(b){b=a(b);
var h=b%1;return b===b?h?b-h:b:0}},{"./toFinite":56}],58:[function(b,c,f){var a=b("./isObject"),e=b("./isSymbol"),h=0/0,g=/^\s+|\s+$/g,m=/^[-+]0x[0-9a-f]+$/i,n=/^0b[01]+$/i,k=/^0o[0-7]+$/i,p=parseInt;c.exports=function(b){if("number"==typeof b)return b;if(e(b))return h;a(b)&&(b="function"==typeof b.valueOf?b.valueOf():b,b=a(b)?b+"":b);if("string"!=typeof b)return 0===b?b:+b;b=b.replace(g,"");var c=n.test(b);return c||k.test(b)?p(b.slice(2),c?2:8):m.test(b)?h:+b}},{"./isObject":50,"./isSymbol":52}],
59:[function(b,c,f){var a=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;c.exports=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;for(var b={},a=0;10>a;a++)b["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var m={};"abcdefghijklmnopqrst".split("").forEach(function(a){m[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},
m)).join("")?!1:!0}catch(c){return!1}}()?Object.assign:function(b,g){var m,c;if(null===b||void 0===b)throw new TypeError("Object.assign cannot be called with null or undefined");c=Object(b);for(var k,p=1;p<arguments.length;p++){m=Object(arguments[p]);for(var d in m)a.call(m,d)&&(c[d]=m[d]);if(Object.getOwnPropertySymbols){k=Object.getOwnPropertySymbols(m);for(var f=0;f<k.length;f++)e.call(m,k[f])&&(c[k[f]]=m[k[f]])}}return c}},{}],60:[function(b,c,f){(function(a){function b(a,g){for(var m=0,c=a.length-
1;0<=c;c--){var h=a[c];"."===h?a.splice(c,1):".."===h?(a.splice(c,1),m++):m&&(a.splice(c,1),m--)}if(g)for(;m--;m)a.unshift("..");return a}function c(a,b){if(a.filter)return a.filter(b);for(var g=[],m=0;m<a.length;m++)b(a[m],m,a)&&g.push(a[m]);return g}var g=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;f.resolve=function(){for(var g="",m=!1,p=arguments.length-1;-1<=p&&!m;p--){var d=0<=p?arguments[p]:a.cwd();if("string"!==typeof d)throw new TypeError("Arguments to path.resolve must be strings");
d&&(g=d+"/"+g,m="/"===d.charAt(0))}g=b(c(g.split("/"),function(a){return!!a}),!m).join("/");return(m?"/":"")+g||"."};f.normalize=function(a){var g=f.isAbsolute(a),p="/"===m(a,-1);(a=b(c(a.split("/"),function(a){return!!a}),!g).join("/"))||g||(a=".");a&&p&&(a+="/");return(g?"/":"")+a};f.isAbsolute=function(a){return"/"===a.charAt(0)};f.join=function(){var a=Array.prototype.slice.call(arguments,0);return f.normalize(c(a,function(a,b){if("string"!==typeof a)throw new TypeError("Arguments to path.join must be strings");
return a}).join("/"))};f.relative=function(a,b){function g(a){for(var b=0;b<a.length&&""===a[b];b++);for(var m=a.length-1;0<=m&&""===a[m];m--);return b>m?[]:a.slice(b,m-b+1)}a=f.resolve(a).substr(1);b=f.resolve(b).substr(1);for(var m=g(a.split("/")),c=g(b.split("/")),h=Math.min(m.length,c.length),d=h,e=0;e<h;e++)if(m[e]!==c[e]){d=e;break}h=[];for(e=d;e<m.length;e++)h.push("..");h=h.concat(c.slice(d));return h.join("/")};f.sep="/";f.delimiter=":";f.dirname=function(a){var b=g.exec(a).slice(1);a=b[0];
b=b[1];if(!a&&!b)return".";b&&(b=b.substr(0,b.length-1));return a+b};f.basename=function(a,b){var m=g.exec(a).slice(1)[2];b&&m.substr(-1*b.length)===b&&(m=m.substr(0,m.length-b.length));return m};f.extname=function(a){return g.exec(a).slice(1)[3]};var m="b"==="ab".substr(-1)?function(a,b,g){return a.substr(b,g)}:function(a,b,g){0>b&&(b=a.length+b);return a.substr(b,g)}}).call(this,b("_process"))},{_process:61}],61:[function(b,c,f){function a(){throw Error("setTimeout has not been defined");}function e(){throw Error("clearTimeout has not been defined");
}function h(b){if(z===setTimeout)return setTimeout(b,0);if((z===a||!z)&&setTimeout)return z=setTimeout,setTimeout(b,0);try{return z(b,0)}catch(g){try{return z.call(null,b,0)}catch(m){return z.call(this,b,0)}}}function g(a){if(r===clearTimeout)return clearTimeout(a);if((r===e||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(a);try{return r(a)}catch(b){try{return r.call(null,a)}catch(g){return r.call(this,a)}}}function m(){t&&q&&(t=!1,q.length?v=q.concat(v):w=-1,v.length&&n())}function n(){if(!t){var a=
h(m);t=!0;for(var b=v.length;b;){q=v;for(v=[];++w<b;)q&&q[w].run();w=-1;b=v.length}q=null;t=!1;g(a)}}function k(a,b){this.fun=a;this.array=b}function p(){}b=c.exports={};var z,r;try{z="function"===typeof setTimeout?setTimeout:a}catch(u){z=a}try{r="function"===typeof clearTimeout?clearTimeout:e}catch(u){r=e}var v=[],t=!1,q,w=-1;b.nextTick=function(a){var b=Array(arguments.length-1);if(1<arguments.length)for(var g=1;g<arguments.length;g++)b[g-1]=arguments[g];v.push(new k(a,b));1!==v.length||t||h(n)};
k.prototype.run=function(){this.fun.apply(null,this.array)};b.title="browser";b.browser=!0;b.env={};b.argv=[];b.version="";b.versions={};b.on=p;b.addListener=p;b.once=p;b.off=p;b.removeListener=p;b.removeAllListeners=p;b.emit=p;b.binding=function(a){throw Error("process.binding is not supported");};b.cwd=function(){return"/"};b.chdir=function(a){throw Error("process.chdir is not supported");};b.umask=function(){return 0}},{}],62:[function(b,c,f){(function(a){(function(b){function h(a){throw new RangeError(A[a]);
}function g(a,b){for(var g=a.length,m=[];g--;)m[g]=b(a[g]);return m}function m(a,b){var m=a.split("@"),c="";1<m.length&&(c=m[0]+"@",a=m[1]);a=a.replace(x,".");m=a.split(".");m=g(m,b).join(".");return c+m}function n(a){for(var b=[],g=0,m=a.length,c,h;g<m;)c=a.charCodeAt(g++),55296<=c&&56319>=c&&g<m?(h=a.charCodeAt(g++),56320==(h&64512)?b.push(((c&1023)<<10)+(h&1023)+65536):(b.push(c),g--)):b.push(c);return b}function k(a){return g(a,function(a){var b="";65535<a&&(a-=65536,b+=H(a>>>10&1023|55296),a=
56320|a&1023);return b+=H(a)}).join("")}function p(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function z(a,b,g){var m=0;a=g?F(a/700):a>>1;for(a+=F(a/b);455<a;m+=36)a=F(a/35);return F(m+36*a/(a+38))}function r(a){var b=[],g=a.length,m,c=0,p=128,n=72,d,e,f,r,v;d=a.lastIndexOf("-");0>d&&(d=0);for(e=0;e<d;++e)128<=a.charCodeAt(e)&&h("not-basic"),b.push(a.charCodeAt(e));for(d=0<d?d+1:0;d<g;){e=c;m=1;for(f=36;;f+=36){d>=g&&h("invalid-input");r=a.charCodeAt(d++);r=10>r-48?r-22:26>r-65?r-65:26>r-97?r-97:36;(36<=
r||r>F((2147483647-c)/m))&&h("overflow");c+=r*m;v=f<=n?1:f>=n+26?26:f-n;if(r<v)break;r=36-v;m>F(2147483647/r)&&h("overflow");m*=r}m=b.length+1;n=z(c-e,m,0==e);F(c/m)>2147483647-p&&h("overflow");p+=F(c/m);c%=m;b.splice(c++,0,p)}return k(b)}function v(a){var b,g,m,c,k,d,e,f,r,v=[],t,A,x;a=n(a);t=a.length;b=128;g=0;k=72;for(d=0;d<t;++d)r=a[d],128>r&&v.push(H(r));for((m=c=v.length)&&v.push("-");m<t;){e=2147483647;for(d=0;d<t;++d)r=a[d],r>=b&&r<e&&(e=r);A=m+1;e-b>F((2147483647-g)/A)&&h("overflow");g+=
(e-b)*A;b=e;for(d=0;d<t;++d)if(r=a[d],r<b&&2147483647<++g&&h("overflow"),r==b){f=g;for(e=36;;e+=36){r=e<=k?1:e>=k+26?26:e-k;if(f<r)break;x=f-r;f=36-r;v.push(H(p(r+x%f,0)));f=F(x/f)}v.push(H(p(f,0)));k=z(g,A,m==c);g=0;++m}++g;++b}return v.join("")}var t="object"==typeof f&&f&&!f.nodeType&&f,q="object"==typeof c&&c&&!c.nodeType&&c,w="object"==typeof a&&a;if(w.global===w||w.window===w||w.self===w)b=w;var u=/^xn--/,y=/[^\x20-\x7E]/,x=/[\x2E\u3002\uFF0E\uFF61]/g,A={overflow:"Overflow: input needs wider integers to process",
"not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=Math.floor,H=String.fromCharCode,D,w={version:"1.4.1",ucs2:{decode:n,encode:k},decode:r,encode:v,toASCII:function(a){return m(a,function(a){return y.test(a)?"xn--"+v(a):a})},toUnicode:function(a){return m(a,function(a){return u.test(a)?r(a.slice(4).toLowerCase()):a})}};if(t&&q)if(c.exports==t)q.exports=w;else for(D in w)w.hasOwnProperty(D)&&(t[D]=w[D]);else b.punycode=w})(this)}).call(this,"undefined"!==
typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],63:[function(b,c,f){c.exports=function(b,c,g,m){g=g||"=";var n={};if("string"!==typeof b||0===b.length)return n;var k=/\+/g;b=b.split(c||"&");c=1E3;m&&"number"===typeof m.maxKeys&&(c=m.maxKeys);m=b.length;0<c&&m>c&&(m=c);for(c=0;c<m;++c){var p=b[c].replace(k,"%20"),d=p.indexOf(g),f;0<=d?(f=p.substr(0,d),p=p.substr(d+1)):(f=p,p="");f=decodeURIComponent(f);p=decodeURIComponent(p);Object.prototype.hasOwnProperty.call(n,
f)?a(n[f])?n[f].push(p):n[f]=[n[f],p]:n[f]=p}return n};var a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)}},{}],64:[function(b,c,f){function a(a,b){if(a.map)return a.map(b);for(var g=[],c=0;c<a.length;c++)g.push(b(a[c],c));return g}var e=function(a){switch(typeof a){case "string":return a;case "boolean":return a?"true":"false";case "number":return isFinite(a)?a:"";default:return""}};c.exports=function(b,c,k,p){c=c||"&";k=k||"=";null===b&&(b=void 0);return"object"===
typeof b?a(g(b),function(g){var p=encodeURIComponent(e(g))+k;return h(b[g])?a(b[g],function(a){return p+encodeURIComponent(e(a))}).join(c):p+encodeURIComponent(e(b[g]))}).join(c):p?encodeURIComponent(e(p))+k+encodeURIComponent(e(b)):""};var h=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},g=Object.keys||function(a){var b=[],g;for(g in a)Object.prototype.hasOwnProperty.call(a,g)&&b.push(g);return b}},{}],65:[function(b,c,f){f.decode=f.parse=b("./decode");f.encode=
f.stringify=b("./encode")},{"./decode":63,"./encode":64}],66:[function(b,c,f){function a(a,b){n.call(this);b=b||10;this.baseUrl=a||"";this.progress=0;this.loading=!1;this._progressChunk=0;this._beforeMiddleware=[];this._afterMiddleware=[];this._boundLoadResource=this._loadResource.bind(this);this._buffer=[];this._numToLoad=0;this._queue=e(this._boundLoadResource,b);this.resources={}}var e=b("async/queue"),h=b("async/eachSeries"),g=b("url"),m=b("./Resource"),n=b("eventemitter3");a.prototype=Object.create(n.prototype);
a.prototype.constructor=a;c.exports=a;a.prototype.add=a.prototype.enqueue=function(a,b,g,c){if(Array.isArray(a)){for(b=0;b<a.length;++b)this.add(a[b]);return this}"object"===typeof a&&(c=b||a.callback||a.onComplete,g=a,b=a.url,a=a.name||a.key||a.url);"string"!==typeof b&&(c=g,g=b,b=a);if("string"!==typeof b)throw Error("No url passed to add resource to loader.");"function"===typeof g&&(c=g,g=null);if(this.resources[a])throw Error('Resource with name "'+a+'" already exists.');b=this._prepareUrl(b);
this.resources[a]=new m(a,b,g);if("function"===typeof c)this.resources[a].once("afterMiddleware",c);this._numToLoad++;this._queue.started?(this._queue.push(this.resources[a]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[a]),this._progressChunk=100/this._buffer.length);return this};a.prototype.before=a.prototype.pre=function(a){this._beforeMiddleware.push(a);return this};a.prototype.after=a.prototype.use=function(a){this._afterMiddleware.push(a);
return this};a.prototype.reset=function(){this.progress=0;this.loading=!1;this._progressChunk=0;this._numToLoad=this._buffer.length=0;this._queue.kill();this._queue.started=!1;for(var a in this.resources){var b=this.resources[a];b.off("complete",this._onLoad,this);b.isLoading&&b.abort()}this.resources={};return this};a.prototype.load=function(a){if("function"===typeof a)this.once("complete",a);if(this._queue.started)return this;this.emit("start",this);this.loading=!0;for(a=0;a<this._buffer.length;++a)this._queue.push(this._buffer[a]);
this._buffer.length=0;return this};a.prototype._prepareUrl=function(a){var b=g.parse(a);return b.protocol||!b.pathname||0===b.pathname.indexOf("//")?a:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==a.charAt(0)?this.baseUrl+"/"+a:this.baseUrl+a};a.prototype._loadResource=function(a,b){var g=this;a._dequeue=b;h(this._beforeMiddleware,function(b,c){b.call(g,a,function(){c(a.isComplete?{}:null)})},function(){a.isComplete?g._onLoad(a):(a.once("complete",g._onLoad,g),
a.load())})};a.prototype._onComplete=function(){this.loading=!1;this.emit("complete",this,this.resources)};a.prototype._onLoad=function(a){var b=this;h(this._afterMiddleware,function(g,c){g.call(b,a,c)},function(){a.emit("afterMiddleware",a);b._numToLoad--;b.progress+=b._progressChunk;b.emit("progress",b,a);a.error?b.emit("error",a.error,b,a):b.emit("load",b,a);0===b._numToLoad&&(b.progress=100,b._onComplete())});a._dequeue()};a.LOAD_TYPE=m.LOAD_TYPE;a.XHR_RESPONSE_TYPE=m.XHR_RESPONSE_TYPE},{"./Resource":67,
"async/eachSeries":18,"async/queue":29,eventemitter3:32,url:72}],67:[function(b,c,f){function a(a,b,c){g.call(this);c=c||{};if("string"!==typeof a||"string"!==typeof b)throw Error("Both name and url are required for constructing a resource.");this.name=a;this.url=b;this.isDataUrl=0===this.url.indexOf("data:");this.data=null;this.crossOrigin=!0===c.crossOrigin?"anonymous":c.crossOrigin;this.loadType=c.loadType||this._determineLoadType();this.xhrType=c.xhrType;this.metadata=c.metadata||{};this.xhr=
this.error=null;this.isLoading=this.isComplete=this.isVideo=this.isAudio=this.isImage=this.isXml=this.isJson=!1;this._dequeue=null;this._boundComplete=this.complete.bind(this);this._boundOnError=this._onError.bind(this);this._boundOnProgress=this._onProgress.bind(this);this._boundXhrOnError=this._xhrOnError.bind(this);this._boundXhrOnAbort=this._xhrOnAbort.bind(this);this._boundXhrOnLoad=this._xhrOnLoad.bind(this);this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function e(a){return a.toString().replace("object ",
"")}function h(a,b,g){b&&0===b.indexOf(".")&&(b=b.substring(1));b&&(a[b]=g)}var g=b("eventemitter3"),m=b("url"),n=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),k=null;a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",
this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1));this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null));if(this.isComplete)throw Error("Complete called again for an already completed resource.");
this.isComplete=!0;this.isLoading=!1;this.emit("complete",this)};a.prototype.abort=function(a){if(!this.error){this.error=Error(a);if(this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if("undefined"!==typeof this.data.src)this.data.src="";else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this.complete()}};a.prototype.load=function(b){if(!this.isLoading)if(this.isComplete){if(b){var g=this;setTimeout(function(){b(g)},1)}}else{if(b)this.once("complete",
b);this.isLoading=!0;this.emit("start",this);if(!1===this.crossOrigin||"string"!==typeof this.crossOrigin)this.crossOrigin=this._determineCrossOrigin(this.url);switch(this.loadType){case a.LOAD_TYPE.IMAGE:this._loadElement("image");break;case a.LOAD_TYPE.AUDIO:this._loadSourceElement("audio");break;case a.LOAD_TYPE.VIDEO:this._loadSourceElement("video");break;default:n&&this.crossOrigin?this._loadXdr():this._loadXhr()}}};a.prototype._loadElement=function(a){this.data=this.metadata.loadElement?this.metadata.loadElement:
"image"===a&&"undefined"!==typeof window.Image?new Image:document.createElement(a);this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin);this.metadata.skipSource||(this.data.src=this.url);a="is"+a[0].toUpperCase()+a.substring(1);!1===this[a]&&(this[a]=!0);this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",this._boundOnProgress,!1)};a.prototype._loadSourceElement=function(a){this.data=this.metadata.loadElement?
this.metadata.loadElement:"audio"===a&&"undefined"!==typeof window.Audio?new Audio:document.createElement(a);if(null===this.data)this.abort("Unsupported element "+a);else{if(!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var b=0;b<this.url.length;++b)this.data.appendChild(this._createSource(a,this.url[b]));else this.data.appendChild(this._createSource(a,this.url));this["is"+a[0].toUpperCase()+a.substring(1)]=
!0;this.data.addEventListener("error",this._boundOnError,!1);this.data.addEventListener("load",this._boundComplete,!1);this.data.addEventListener("progress",this._boundOnProgress,!1);this.data.addEventListener("canplaythrough",this._boundComplete,!1);this.data.load()}};a.prototype._loadXhr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var b=this.xhr=new XMLHttpRequest;b.open("GET",this.url,!0);b.responseType=this.xhrType===a.XHR_RESPONSE_TYPE.JSON||this.xhrType===
a.XHR_RESPONSE_TYPE.DOCUMENT?a.XHR_RESPONSE_TYPE.TEXT:this.xhrType;b.addEventListener("error",this._boundXhrOnError,!1);b.addEventListener("abort",this._boundXhrOnAbort,!1);b.addEventListener("progress",this._boundOnProgress,!1);b.addEventListener("load",this._boundXhrOnLoad,!1);b.send()};a.prototype._loadXdr=function(){"string"!==typeof this.xhrType&&(this.xhrType=this._determineXhrType());var a=this.xhr=new XDomainRequest;a.timeout=5E3;a.onerror=this._boundXhrOnError;a.ontimeout=this._boundXdrOnTimeout;
a.onprogress=this._boundOnProgress;a.onload=this._boundXhrOnLoad;a.open("GET",this.url,!0);setTimeout(function(){a.send()},0)};a.prototype._createSource=function(a,b,g){g||(g=a+"/"+b.substr(b.lastIndexOf(".")+1));a=document.createElement("source");a.src=b;a.type=g;return a};a.prototype._onError=function(a){this.abort("Failed to load element using "+a.target.nodeName)};a.prototype._onProgress=function(a){a&&a.lengthComputable&&this.emit("progress",this,a.loaded/a.total)};a.prototype._xhrOnError=function(){var a=
this.xhr;this.abort(e(a)+" Request failed. Status: "+a.status+', text: "'+a.statusText+'"')};a.prototype._xhrOnAbort=function(){this.abort(e(this.xhr)+" Request was aborted by the user.")};a.prototype._xdrOnTimeout=function(){this.abort(e(this.xhr)+" Request timed out.")};a.prototype._xhrOnLoad=function(){var b=this.xhr,g="undefined"===typeof b.status?b.status:200;if(200===g||204===g||0===g&&0<b.responseText.length){if(this.xhrType===a.XHR_RESPONSE_TYPE.TEXT)this.data=b.responseText;else if(this.xhrType===
a.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(b.responseText),this.isJson=!0}catch(c){this.abort("Error trying to parse loaded json:",c);return}else if(this.xhrType===a.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser)this.data=(new DOMParser).parseFromString(b.responseText,"text/xml");else{var m=document.createElement("div");m.innerHTML=b.responseText;this.data=m}this.isXml=!0}catch(c){this.abort("Error trying to parse loaded xml:",c);return}else this.data=b.response||b.responseText;this.complete()}else this.abort("["+
b.status+"]"+b.statusText+":"+b.responseURL)};a.prototype._determineCrossOrigin=function(a,b){if(0===a.indexOf("data:"))return"";b=b||window.location;k||(k=document.createElement("a"));k.href=a;a=m.parse(k.href);var g=!a.port&&""===b.port||a.port===b.port;return a.hostname===b.hostname&&g&&a.protocol===b.protocol?"":"anonymous"};a.prototype._determineXhrType=function(){return a._xhrTypeMap[this._getExtension()]||a.XHR_RESPONSE_TYPE.TEXT};a.prototype._determineLoadType=function(){return a._loadTypeMap[this._getExtension()]||
a.LOAD_TYPE.XHR};a.prototype._getExtension=function(){var a=this.url;if(this.isDataUrl)var b=a.indexOf("/"),a=a.substring(b+1,a.indexOf(";",b));else b=a.indexOf("?"),-1!==b&&(a=a.substring(0,b)),a=a.substring(a.lastIndexOf(".")+1);return a.toLowerCase()};a.prototype._getMimeFromXhrType=function(b){switch(b){case a.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case a.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case a.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case a.XHR_RESPONSE_TYPE.JSON:return"application/json";
default:return"text/plain"}};a.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};a.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};a._loadTypeMap={gif:a.LOAD_TYPE.IMAGE,png:a.LOAD_TYPE.IMAGE,bmp:a.LOAD_TYPE.IMAGE,jpg:a.LOAD_TYPE.IMAGE,jpeg:a.LOAD_TYPE.IMAGE,tif:a.LOAD_TYPE.IMAGE,tiff:a.LOAD_TYPE.IMAGE,webp:a.LOAD_TYPE.IMAGE,tga:a.LOAD_TYPE.IMAGE,"svg+xml":a.LOAD_TYPE.IMAGE};a._xhrTypeMap={xhtml:a.XHR_RESPONSE_TYPE.DOCUMENT,html:a.XHR_RESPONSE_TYPE.DOCUMENT,
htm:a.XHR_RESPONSE_TYPE.DOCUMENT,xml:a.XHR_RESPONSE_TYPE.DOCUMENT,tmx:a.XHR_RESPONSE_TYPE.DOCUMENT,tsx:a.XHR_RESPONSE_TYPE.DOCUMENT,svg:a.XHR_RESPONSE_TYPE.DOCUMENT,gif:a.XHR_RESPONSE_TYPE.BLOB,png:a.XHR_RESPONSE_TYPE.BLOB,bmp:a.XHR_RESPONSE_TYPE.BLOB,jpg:a.XHR_RESPONSE_TYPE.BLOB,jpeg:a.XHR_RESPONSE_TYPE.BLOB,tif:a.XHR_RESPONSE_TYPE.BLOB,tiff:a.XHR_RESPONSE_TYPE.BLOB,webp:a.XHR_RESPONSE_TYPE.BLOB,tga:a.XHR_RESPONSE_TYPE.BLOB,json:a.XHR_RESPONSE_TYPE.JSON,text:a.XHR_RESPONSE_TYPE.TEXT,txt:a.XHR_RESPONSE_TYPE.TEXT};
a.setExtensionLoadType=function(b,g){h(a._loadTypeMap,b,g)};a.setExtensionXhrType=function(b,g){h(a._xhrTypeMap,b,g)}},{eventemitter3:32,url:72}],68:[function(b,c,f){c.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(a){for(var b="",c,g=Array(4),m=0,n;m<a.length;){c=Array(3);for(n=0;n<c.length;n++)c[n]=m<a.length?a.charCodeAt(m++)&255:0;g[0]=c[0]>>2;g[1]=(c[0]&3)<<4|c[1]>>4;g[2]=(c[1]&15)<<2|c[2]>>6;g[3]=c[2]&63;c=m-(a.length-1);switch(c){case 2:g[3]=
64;g[2]=64;break;case 1:g[3]=64}for(n=0;n<g.length;n++)b+=this._keyStr.charAt(g[n])}return b}}},{}],69:[function(b,c,f){c.exports=b("./Loader");c.exports.Resource=b("./Resource");c.exports.middleware={caching:{memory:b("./middlewares/caching/memory")},parsing:{blob:b("./middlewares/parsing/blob")}}},{"./Loader":66,"./Resource":67,"./middlewares/caching/memory":70,"./middlewares/parsing/blob":71}],70:[function(b,c,f){var a={};c.exports=function(){return function(b,c){if(a[b.url])b.data=a[b.url],b.complete();
else b.once("complete",function(){a[this.url]=this.data});c()}}},{}],71:[function(b,c,f){var a=b("../../Resource"),e=b("../../b64"),h=window.URL||window.webkitURL;c.exports=function(){return function(b,c){if(b.data&&b.xhr&&b.xhrType===a.XHR_RESPONSE_TYPE.BLOB)if(!window.Blob||"string"===typeof b.data){var n=b.xhr.getResponseHeader("content-type");if(n&&0===n.indexOf("image")){b.data=new Image;b.data.src="data:"+n+";base64,"+e.encodeBinary(b.xhr.responseText);b.isImage=!0;b.data.onload=function(){b.data.onload=
null;c()};return}}else if(0===b.data.type.indexOf("image")){var k=h.createObjectURL(b.data);b.blob=b.data;b.data=new Image;b.data.src=k;b.isImage=!0;b.data.onload=function(){h.revokeObjectURL(k);b.data.onload=null;c()};return}c()}}},{"../../Resource":67,"../../b64":68}],72:[function(b,c,f){function a(){this.href=this.path=this.pathname=this.query=this.search=this.hash=this.hostname=this.port=this.host=this.auth=this.slashes=this.protocol=null}function e(b,c,m){if(b&&g.isObject(b)&&b instanceof a)return b;
var h=new a;h.parse(b,c,m);return h}var h=b("punycode"),g=b("./util");f.parse=e;f.resolve=function(a,b){return e(a,!1,!0).resolve(b)};f.resolveObject=function(a,b){return a?e(a,!1,!0).resolveObject(b):b};f.format=function(b){g.isString(b)&&(b=e(b));return b instanceof a?b.format():a.prototype.format.call(b)};f.Url=a;var m=/^([a-z0-9.+-]+:)/i,n=/:[0-9]*$/,k=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/;c="{}|\\^`".split("").concat('<>"` \r\n\t'.split(""));var p=["'"].concat(c),z=["%","/","?",";","#"].concat(p),
r=["/","?","#"],v=/^[+a-z0-9A-Z_-]{0,63}$/,t=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,q={javascript:!0,"javascript:":!0},w={javascript:!0,"javascript:":!0},u={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=b("querystring");a.prototype.parse=function(a,b,c){if(!g.isString(a))throw new TypeError("Parameter 'url' must be a string, not "+typeof a);var n=a.indexOf("?"),n=-1!==n&&n<a.indexOf("#")?"?":"#";a=a.split(n);a[0]=a[0].replace(/\\/g,"/");a=a.join(n);
n=a.trim();if(!c&&1===a.split("#").length&&(a=k.exec(n)))return this.href=this.path=n,this.pathname=a[1],a[2]?(this.search=a[2],this.query=b?y.parse(this.search.substr(1)):this.search.substr(1)):b&&(this.search="",this.query={}),this;if(a=m.exec(n)){a=a[0];var d=a.toLowerCase();this.protocol=d;n=n.substr(a.length)}if(c||a||n.match(/^\/\/[^@\/]+@[^@\/]+/)){var e="//"===n.substr(0,2);!e||a&&w[a]||(n=n.substr(2),this.slashes=!0)}if(!w[a]&&(e||a&&!u[a])){e=-1;for(c=0;c<r.length;c++)a=n.indexOf(r[c]),
-1!==a&&(-1===e||a<e)&&(e=a);e=-1===e?n.lastIndexOf("@"):n.lastIndexOf("@",e);-1!==e&&(c=n.slice(0,e),n=n.slice(e+1),this.auth=decodeURIComponent(c));e=-1;for(c=0;c<z.length;c++)a=n.indexOf(z[c]),-1!==a&&(-1===e||a<e)&&(e=a);-1===e&&(e=n.length);this.host=n.slice(0,e);n=n.slice(e);this.parseHost();this.hostname=this.hostname||"";e="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!e){var f=this.hostname.split(/\./);c=0;for(a=f.length;c<a;c++){var J=f[c];if(J&&!J.match(v)){for(var B=
"",C=0,M=J.length;C<M;C++)B=127<J.charCodeAt(C)?B+"x":B+J[C];if(!B.match(v)){a=f.slice(0,c);c=f.slice(c+1);if(J=J.match(t))a.push(J[1]),c.unshift(J[2]);c.length&&(n="/"+c.join(".")+n);this.hostname=a.join(".");break}}}}this.hostname=255<this.hostname.length?"":this.hostname.toLowerCase();e||(this.hostname=h.toASCII(this.hostname));c=this.port?":"+this.port:"";this.host=(this.hostname||"")+c;this.href+=this.host;e&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==n[0]&&(n="/"+n))}if(!q[d])for(c=
0,a=p.length;c<a;c++)e=p[c],-1!==n.indexOf(e)&&(J=encodeURIComponent(e),J===e&&(J=escape(e)),n=n.split(e).join(J));c=n.indexOf("#");-1!==c&&(this.hash=n.substr(c),n=n.slice(0,c));c=n.indexOf("?");-1!==c?(this.search=n.substr(c),this.query=n.substr(c+1),b&&(this.query=y.parse(this.query)),n=n.slice(0,c)):b&&(this.search="",this.query={});n&&(this.pathname=n);u[d]&&this.hostname&&!this.pathname&&(this.pathname="/");if(this.pathname||this.search)c=this.pathname||"",this.path=c+(this.search||"");this.href=
this.format();return this};a.prototype.format=function(){var a=this.auth||"";a&&(a=encodeURIComponent(a),a=a.replace(/%3A/i,":"),a+="@");var b=this.protocol||"",c=this.pathname||"",m=this.hash||"",h=!1,k="";this.host?h=a+this.host:this.hostname&&(h=a+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(h+=":"+this.port));this.query&&g.isObject(this.query)&&Object.keys(this.query).length&&(k=y.stringify(this.query));a=this.search||k&&"?"+k||"";b&&":"!==b.substr(-1)&&(b+=
":");this.slashes||(!b||u[b])&&!1!==h?(h="//"+(h||""),c&&"/"!==c.charAt(0)&&(c="/"+c)):h||(h="");m&&"#"!==m.charAt(0)&&(m="#"+m);a&&"?"!==a.charAt(0)&&(a="?"+a);c=c.replace(/[?#]/g,function(a){return encodeURIComponent(a)});a=a.replace("#","%23");return b+h+c+a+m};a.prototype.resolve=function(a){return this.resolveObject(e(a,!1,!0)).format()};a.prototype.resolveObject=function(b){if(g.isString(b)){var c=new a;c.parse(b,!1,!0);b=c}for(var c=new a,m=Object.keys(this),h=0;h<m.length;h++){var k=m[h];
c[k]=this[k]}c.hash=b.hash;if(""===b.href)return c.href=c.format(),c;if(b.slashes&&!b.protocol){m=Object.keys(b);for(h=0;h<m.length;h++)k=m[h],"protocol"!==k&&(c[k]=b[k]);u[c.protocol]&&c.hostname&&!c.pathname&&(c.path=c.pathname="/");c.href=c.format();return c}if(b.protocol&&b.protocol!==c.protocol){if(!u[b.protocol]){m=Object.keys(b);for(h=0;h<m.length;h++)k=m[h],c[k]=b[k];c.href=c.format();return c}c.protocol=b.protocol;if(b.host||w[b.protocol])c.pathname=b.pathname;else{for(var n=(b.pathname||
"").split("/");n.length&&!(b.host=n.shift()););b.host||(b.host="");b.hostname||(b.hostname="");""!==n[0]&&n.unshift("");2>n.length&&n.unshift("");c.pathname=n.join("/")}c.search=b.search;c.query=b.query;c.host=b.host||"";c.auth=b.auth;c.hostname=b.hostname||b.host;c.port=b.port;if(c.pathname||c.search)c.path=(c.pathname||"")+(c.search||"");c.slashes=c.slashes||b.slashes;c.href=c.format();return c}var m=c.pathname&&"/"===c.pathname.charAt(0),p=b.host||b.pathname&&"/"===b.pathname.charAt(0),e=m=p||
m||c.host&&b.pathname,h=c.pathname&&c.pathname.split("/")||[],n=b.pathname&&b.pathname.split("/")||[];if(k=c.protocol&&!u[c.protocol])c.hostname="",c.port=null,c.host&&(""===h[0]?h[0]=c.host:h.unshift(c.host)),c.host="",b.protocol&&(b.hostname=null,b.port=null,b.host&&(""===n[0]?n[0]=b.host:n.unshift(b.host)),b.host=null),m=m&&(""===n[0]||""===h[0]);if(p)c.host=b.host||""===b.host?b.host:c.host,c.hostname=b.hostname||""===b.hostname?b.hostname:c.hostname,c.search=b.search,c.query=b.query,h=n;else if(n.length)h||
(h=[]),h.pop(),h=h.concat(n),c.search=b.search,c.query=b.query;else if(!g.isNullOrUndefined(b.search))return k&&(c.hostname=c.host=h.shift(),k=c.host&&0<c.host.indexOf("@")?c.host.split("@"):!1)&&(c.auth=k.shift(),c.host=c.hostname=k.shift()),c.search=b.search,c.query=b.query,g.isNull(c.pathname)&&g.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:"")),c.href=c.format(),c;if(!h.length)return c.pathname=null,c.path=c.search?"/"+c.search:null,c.href=c.format(),c;for(var p=h.slice(-1)[0],
n=(c.host||b.host||1<h.length)&&("."===p||".."===p)||""===p,d=0,z=h.length;0<=z;z--)p=h[z],"."===p?h.splice(z,1):".."===p?(h.splice(z,1),d++):d&&(h.splice(z,1),d--);if(!m&&!e)for(;d--;d)h.unshift("..");!m||""===h[0]||h[0]&&"/"===h[0].charAt(0)||h.unshift("");n&&"/"!==h.join("/").substr(-1)&&h.push("");e=""===h[0]||h[0]&&"/"===h[0].charAt(0);k&&(c.hostname=c.host=e?"":h.length?h.shift():"",k=c.host&&0<c.host.indexOf("@")?c.host.split("@"):!1)&&(c.auth=k.shift(),c.host=c.hostname=k.shift());(m=m||c.host&&
h.length)&&!e&&h.unshift("");h.length?c.pathname=h.join("/"):(c.pathname=null,c.path=null);g.isNull(c.pathname)&&g.isNull(c.search)||(c.path=(c.pathname?c.pathname:"")+(c.search?c.search:""));c.auth=b.auth||c.auth;c.slashes=c.slashes||b.slashes;c.href=c.format();return c};a.prototype.parseHost=function(){var a=this.host,b=n.exec(a);b&&(b=b[0],":"!==b&&(this.port=b.substr(1)),a=a.substr(0,a.length-b.length));a&&(this.hostname=a)}},{"./util":73,punycode:62,querystring:65}],73:[function(b,c,f){c.exports=
{isString:function(a){return"string"===typeof a},isObject:function(a){return"object"===typeof a&&null!==a},isNull:function(a){return null===a},isNullOrUndefined:function(a){return null==a}}},{}],74:[function(b,c,f){function a(a){!h.tablet&&!h.phone||navigator.isCocoonJS||this.createTouchHook();var b=document.createElement("div");b.style.width="100px";b.style.height="100px";b.style.position="absolute";b.style.top=0;b.style.left=0;b.style.zIndex=2;this.div=b;this.pool=[];this.renderId=0;this.debug=
!1;this.renderer=a;this.children=[];this._onKeyDown=this._onKeyDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this.isMobileAccessabillity=this.isActive=!1;window.addEventListener("keydown",this._onKeyDown,!1)}var e=b("../core"),h=b("ismobilejs");Object.assign(e.DisplayObject.prototype,b("./accessibleTarget"));a.prototype.constructor=a;c.exports=a;a.prototype.createTouchHook=function(){var a=document.createElement("button");a.style.width="1px";a.style.height="1px";a.style.position=
"absolute";a.style.top="-1000px";a.style.left="-1000px";a.style.zIndex=2;a.style.backgroundColor="#FF0000";a.title="HOOK DIV";a.addEventListener("focus",function(){this.isMobileAccessabillity=!0;this.activate();document.body.removeChild(a)}.bind(this));document.body.appendChild(a)};a.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",
this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))};a.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessabillity&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))};a.prototype.updateAccessibleObjects=function(a){if(a.visible){a.accessible&&
a.interactive&&(a._accessibleActive||this.addChild(a),a.renderId=this.renderId);a=a.children;for(var b=a.length-1;0<=b;b--)this.updateAccessibleObjects(a[b])}};a.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var a=this.renderer.view.getBoundingClientRect(),b=a.width/this.renderer.width,c=a.height/this.renderer.height,h=this.div;h.style.left=a.left+"px";h.style.top=a.top+"px";h.style.width=this.renderer.width+"px";h.style.height=
this.renderer.height+"px";for(a=0;a<this.children.length;a++){var p=this.children[a];if(p.renderId!==this.renderId)p._accessibleActive=!1,e.utils.removeItems(this.children,a,1),this.div.removeChild(p._accessibleDiv),this.pool.push(p._accessibleDiv),p._accessibleDiv=null,a--,0===this.children.length&&this.deactivate();else{var h=p._accessibleDiv,d=p.hitArea,f=p.worldTransform;p.hitArea?(h.style.left=(f.tx+d.x*f.a)*b+"px",h.style.top=(f.ty+d.y*f.d)*c+"px",h.style.width=d.width*f.a*b+"px",h.style.height=
d.height*f.d*c+"px"):(d=p.getBounds(),this.capHitArea(d),h.style.left=d.x*b+"px",h.style.top=d.y*c+"px",h.style.width=d.width*b+"px",h.style.height=d.height*c+"px")}}this.renderId++}};a.prototype.capHitArea=function(a){0>a.x&&(a.width+=a.x,a.x=0);0>a.y&&(a.height+=a.y,a.y=0);a.x+a.width>this.renderer.width&&(a.width=this.renderer.width-a.x);a.y+a.height>this.renderer.height&&(a.height=this.renderer.height-a.y)};a.prototype.addChild=function(a){var b=this.pool.pop();b||(b=document.createElement("button"),
b.style.width="100px",b.style.height="100px",b.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",b.style.position="absolute",b.style.zIndex=2,b.style.borderStyle="none",b.addEventListener("click",this._onClick.bind(this)),b.addEventListener("focus",this._onFocus.bind(this)),b.addEventListener("focusout",this._onFocusOut.bind(this)));a.accessibleTitle?b.title=a.accessibleTitle:a.accessibleTitle||a.accessibleHint||(b.title="displayObject "+this.tabIndex);a.accessibleHint&&b.setAttribute("aria-label",
a.accessibleHint);a._accessibleActive=!0;a._accessibleDiv=b;b.displayObject=a;this.children.push(a);this.div.appendChild(a._accessibleDiv);a._accessibleDiv.tabIndex=a.tabIndex};a.prototype._onClick=function(a){var b=this.renderer.plugins.interaction;b.dispatchEvent(a.target.displayObject,"click",b.eventData)};a.prototype._onFocus=function(a){var b=this.renderer.plugins.interaction;b.dispatchEvent(a.target.displayObject,"mouseover",b.eventData)};a.prototype._onFocusOut=function(a){var b=this.renderer.plugins.interaction;
b.dispatchEvent(a.target.displayObject,"mouseout",b.eventData)};a.prototype._onKeyDown=function(a){9===a.keyCode&&this.activate()};a.prototype._onMouseMove=function(){this.deactivate()};a.prototype.destroy=function(){this.div=null;for(var a=0;a<this.children.length;a++)this.children[a].div=null;window.document.removeEventListener("mousemove",this._onMouseMove);window.removeEventListener("keydown",this._onKeyDown);this.renderer=this.children=this.pool=null};e.WebGLRenderer.registerPlugin("accessibility",
a);e.CanvasRenderer.registerPlugin("accessibility",a)},{"../core":97,"./accessibleTarget":75,ismobilejs:33}],75:[function(b,c,f){c.exports={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1}},{}],76:[function(b,c,f){c.exports={accessibleTarget:b("./accessibleTarget"),AccessibilityManager:b("./AccessibilityManager")}},{"./AccessibilityManager":74,"./accessibleTarget":75}],77:[function(b,c,f){function a(a){if(a instanceof Array)"precision"!==a[0].substring(0,
9)&&(a=a.slice(0),a.unshift("precision "+h.PRECISION.DEFAULT+" float;"));else if("precision"!==a.substring(0,9))return"precision "+h.PRECISION.DEFAULT+" float;\n"+a;return a}var e=b("pixi-gl-core").GLShader,h=b("./const");b=function(b,c,h,k){e.call(this,b,a(c),a(h),k)};b.prototype=Object.create(e.prototype);b.prototype.constructor=b;c.exports=b},{"./const":78,"pixi-gl-core":7}],78:[function(b,c,f){b={VERSION:"4.0.2",PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,
WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},WRAP_MODES:{DEFAULT:0,CLAMP:0,REPEAT:1,MIRRORED_REPEAT:2},GC_MODES:{DEFAULT:0,AUTO:0,MANUAL:1},MIPMAP_TEXTURES:!0,RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,
FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},PRECISION:{DEFAULT:"mediump",LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"},TRANSFORM_MODE:{DEFAULT:0,STATIC:0,DYNAMIC:1},TEXT_GRADIENT:{LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},SPRITE_BATCH_SIZE:4096,SPRITE_MAX_TEXTURES:b("./utils/maxRecommendedTextures")(32)};
c.exports=b},{"./utils/maxRecommendedTextures":152}],79:[function(b,c,f){function a(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity;this.rect=null}var e=b("../math").Rectangle;a.prototype.constructor=a;c.exports=a;a.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY};a.prototype.clear=function(){this.updateID++;this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};a.prototype.getRectangle=function(a){if(this.minX>this.maxX||this.minY>this.maxY)return e.EMPTY;
a=a||new e(0,0,1,1);a.x=this.minX;a.y=this.minY;a.width=this.maxX-this.minX;a.height=this.maxY-this.minY;return a};a.prototype.addPoint=function(a){this.minX=Math.min(this.minX,a.x);this.maxX=Math.max(this.maxX,a.x);this.minY=Math.min(this.minY,a.y);this.maxY=Math.max(this.maxY,a.y)};a.prototype.addQuad=function(a){var b=this.minX,c=this.minY,n=this.maxX,k=this.maxY,p=a[0],e=a[1],b=p<b?p:b,c=e<c?e:c,n=p>n?p:n,k=e>k?e:k,p=a[2],e=a[3],b=p<b?p:b,c=e<c?e:c,n=p>n?p:n,k=e>k?e:k,p=a[4],e=a[5],b=p<b?p:b,
c=e<c?e:c,n=p>n?p:n,k=e>k?e:k,p=a[6],e=a[7];this.minX=p<b?p:b;this.minY=e<c?e:c;this.maxX=p>n?p:n;this.maxY=e>k?e:k};a.prototype.addFrame=function(a,b,c,n,k){var p=a.worldTransform;a=p.a;var e=p.b,d=p.c,f=p.d,t=p.tx,p=p.ty,q=this.minX,w=this.minY,u=this.maxX,y=this.maxY,x=a*b+d*c+t,A=e*b+f*c+p,q=x<q?x:q,w=A<w?A:w,u=x>u?x:u,y=A>y?A:y,x=a*n+d*c+t,A=e*n+f*c+p,q=x<q?x:q,w=A<w?A:w,u=x>u?x:u,y=A>y?A:y,x=a*b+d*k+t,A=e*b+f*k+p,q=x<q?x:q,w=A<w?A:w,u=x>u?x:u,y=A>y?A:y,x=a*n+d*k+t,A=e*n+f*k+p;this.minX=x<q?
x:q;this.minY=A<w?A:w;this.maxX=x>u?x:u;this.maxY=A>y?A:y};a.prototype.addVertices=function(a,b,c,n){var k=a.worldTransform;a=k.a;for(var p=k.b,e=k.c,d=k.d,f=k.tx,k=k.ty,t=this.minX,q=this.minY,w=this.maxX,u=this.maxY;c<n;c+=2)var y=b[c],x=b[c+1],A=a*y+e*x+f,y=d*x+p*y+k,t=A<t?A:t,q=y<q?y:q,w=A>w?A:w,u=y>u?y:u;this.minX=t;this.minY=q;this.maxX=w;this.maxY=u};a.prototype.addBounds=function(a){var b=this.minX,c=this.minY,n=this.maxX,k=this.maxY;this.minX=a.minX<b?a.minX:b;this.minY=a.minY<c?a.minY:c;
this.maxX=a.maxX>n?a.maxX:n;this.maxY=a.maxY>k?a.maxY:k}},{"../math":102}],80:[function(b,c,f){function a(){h.call(this);this.children=[]}var e=b("../utils"),h=b("./DisplayObject");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var b=this.getLocalBounds().width;this.scale.x=0!==b?a/b:1;this._width=a}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},
set:function(a){var b=this.getLocalBounds().height;this.scale.y=0!==b?a/b:1;this._height=a}}});a.prototype.onChildrenChange=function(){};a.prototype.addChild=function(a){var b=arguments.length;if(1<b)for(var c=0;c<b;c++)this.addChild(arguments[c]);else a.parent&&a.parent.removeChild(a),a.parent=this,this.transform._parentID=-1,this.children.push(a),this.onChildrenChange(this.children.length-1),a.emit("added",this);return a};a.prototype.addChildAt=function(a,b){if(0<=b&&b<=this.children.length)return a.parent&&
a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.onChildrenChange(b),a.emit("added",this),a;throw Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length);};a.prototype.swapChildren=function(a,b){if(a!==b){var c=this.getChildIndex(a),h=this.getChildIndex(b);if(0>c||0>h)throw Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[c]=b;this.children[h]=a;this.onChildrenChange(c<h?c:h)}};a.prototype.getChildIndex=
function(a){a=this.children.indexOf(a);if(-1===a)throw Error("The supplied DisplayObject must be a child of the caller");return a};a.prototype.setChildIndex=function(a,b){if(0>b||b>=this.children.length)throw Error("The supplied index is out of bounds");var c=this.getChildIndex(a);e.removeItems(this.children,c,1);this.children.splice(b,0,a);this.onChildrenChange(b)};a.prototype.getChildAt=function(a){if(0>a||a>=this.children.length)throw Error("getChildAt: Supplied index "+a+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");
return this.children[a]};a.prototype.removeChild=function(a){var b=arguments.length;if(1<b)for(var c=0;c<b;c++)this.removeChild(arguments[c]);else{b=this.children.indexOf(a);if(-1===b)return;a.parent=null;e.removeItems(this.children,b,1);this.onChildrenChange(b);a.emit("removed",this)}return a};a.prototype.removeChildAt=function(a){var b=this.getChildAt(a);b.parent=null;e.removeItems(this.children,a,1);this.onChildrenChange(a);b.emit("removed",this);return b};a.prototype.removeChildren=function(a,
b){var c=a||0,h="number"===typeof b?b:this.children.length,p=h-c;if(0<p&&p<=h){c=this.children.splice(c,p);for(h=0;h<c.length;++h)c[h].parent=null;this.onChildrenChange(a);for(h=0;h<c.length;++h)c[h].emit("removed",this);return c}if(0===p&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.");};a.prototype.updateTransform=function(){this._boundsID++;if(this.visible){this.transform.updateTransform(this.parent.transform);this.worldAlpha=
this.alpha*this.parent.worldAlpha;for(var a=0,b=this.children.length;a<b;++a)this.children[a].updateTransform()}};a.prototype.containerUpdateTransform=a.prototype.updateTransform;a.prototype.calculateBounds=function(){this._bounds.clear();if(this.visible){this._calculateBounds();for(var a=0;a<this.children.length;a++){var b=this.children[a];b.calculateBounds();this._bounds.addBounds(b._bounds)}this._boundsID=this._lastBoundsID}};a.prototype._calculateBounds=function(){};a.prototype.renderWebGL=function(a){if(this.visible&&
!(0>=this.worldAlpha)&&this.renderable)if(this._mask||this._filters)this.renderAdvancedWebGL(a);else{this._renderWebGL(a);for(var b=0,c=this.children.length;b<c;++b)this.children[b].renderWebGL(a)}};a.prototype.renderAdvancedWebGL=function(a){a.currentRenderer.flush();var b=this._filters,c=this._mask,h,p;if(b){this._enabledFilters||(this._enabledFilters=[]);for(h=this._enabledFilters.length=0;h<b.length;h++)b[h].enabled&&this._enabledFilters.push(b[h]);this._enabledFilters.length&&a.filterManager.pushFilter(this,
this._enabledFilters)}c&&a.maskManager.pushMask(this,this._mask);a.currentRenderer.start();this._renderWebGL(a);h=0;for(p=this.children.length;h<p;h++)this.children[h].renderWebGL(a);a.currentRenderer.flush();c&&a.maskManager.popMask(this,this._mask);b&&this._enabledFilters&&this._enabledFilters.length&&a.filterManager.popFilter();a.currentRenderer.start()};a.prototype._renderWebGL=function(a){};a.prototype._renderCanvas=function(a){};a.prototype.renderCanvas=function(a){if(this.visible&&!(0>=this.alpha)&&
this.renderable){this._mask&&a.maskManager.pushMask(this._mask);this._renderCanvas(a);for(var b=0,c=this.children.length;b<c;++b)this.children[b].renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};a.prototype.destroy=function(a){h.prototype.destroy.call(this);var b="boolean"===typeof a?a:a&&a.children,c=this.children;this.children=null;if(b)for(b=c.length-1;0<=b;b--){var k=c[b];k.parent=null;k.destroy(a)}}},{"../utils":151,"./DisplayObject":81}],81:[function(b,c,f){function a(){e.call(this);this.transform=
new (h.TRANSFORM_MODE.DEFAULT===h.TRANSFORM_MODE.STATIC?g:m);this.alpha=1;this.renderable=this.visible=!0;this.parent=null;this.worldAlpha=1;this._enabledFilters=this._filters=this.filterArea=null;this._bounds=new n;this._boundsID=0;this._lastBoundsID=-1;this._mask=this._localBoundsRect=this._boundsRect=null}var e=b("eventemitter3"),h=b("../const"),g=b("./TransformStatic"),m=b("./Transform"),n=b("./Bounds"),k=b("../math"),p=new a;a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=
a;Object.defineProperties(a.prototype,{x:{get:function(){return this.position.x},set:function(a){this.transform.position.x=a}},y:{get:function(){return this.position.y},set:function(a){this.transform.position.y=a}},worldTransform:{get:function(){return this.transform.worldTransform}},localTransform:{get:function(){return this.transform.localTransform}},position:{get:function(){return this.transform.position},set:function(a){this.transform.position.copy(a)}},scale:{get:function(){return this.transform.scale},
set:function(a){this.transform.scale.copy(a)}},pivot:{get:function(){return this.transform.pivot},set:function(a){this.transform.pivot.copy(a)}},skew:{get:function(){return this.transform.skew},set:function(a){this.transform.skew.copy(a)}},rotation:{get:function(){return this.transform.rotation},set:function(a){this.transform.rotation=a}},worldVisible:{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}},mask:{get:function(){return this._mask},set:function(a){this._mask&&
(this._mask.renderable=!0);if(this._mask=a)this._mask.renderable=!1}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(a){this._filters=a&&a.slice()}}});a.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform);this.worldAlpha=this.alpha*this.parent.worldAlpha;this._bounds.updateID++};a.prototype.displayObjectUpdateTransform=a.prototype.updateTransform;a.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),
this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(p.transform)};a.prototype.getBounds=function(a,b){a||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=p,this.parent.transform._worldID++,this.updateTransform(),this.parent=null));this._boundsID!==this._lastBoundsID&&this.calculateBounds();b||(this._boundsRect||(this._boundsRect=new k.Rectangle),b=this._boundsRect);return this._bounds.getRectangle(b)};a.prototype.getLocalBounds=
function(a){var b=this.transform,c=this.parent;this.parent=null;this.transform=p.transform;a||(this._localBoundsRect||(this._localBoundsRect=new k.Rectangle),a=this._localBoundsRect);a=this.getBounds(!1,a);this.parent=c;this.transform=b;return a};a.prototype.toGlobal=function(a,b,c){c||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=p,this.displayObjectUpdateTransform(),this.parent=null));return this.worldTransform.apply(a,b)};a.prototype.toLocal=
function(a,b,c,g){b&&(a=b.toGlobal(a,c,g));g||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=p,this.displayObjectUpdateTransform(),this.parent=null));return this.worldTransform.applyInverse(a,c)};a.prototype.renderWebGL=function(a){};a.prototype.renderCanvas=function(a){};a.prototype.setParent=function(a){if(!a||!a.addChild)throw Error("setParent: Argument must be a Container");a.addChild(this);return a};a.prototype.setTransform=function(a,b,c,g,
h,m,k,n,p){this.position.x=a||0;this.position.y=b||0;this.scale.x=c?c:1;this.scale.y=g?g:1;this.rotation=h||0;this.skew.x=m||0;this.skew.y=k||0;this.pivot.x=n||0;this.pivot.y=p||0;return this};a.prototype.destroy=function(){this.removeAllListeners();this.parent&&this.parent.removeChild(this);this.filterArea=this._mask=this._currentBounds=this._bounds=this.parent=this.transform=null;this.interactiveChildren=this.interactive=!1}},{"../const":78,"../math":102,"./Bounds":79,"./Transform":82,"./TransformStatic":84,
eventemitter3:32}],82:[function(b,c,f){function a(){h.call(this);this.position=new e.Point(0,0);this.scale=new e.Point(1,1);this.skew=new e.ObservablePoint(this.updateSkew,this,0,0);this.pivot=new e.Point(0,0);this._rotation=0;this._sr=Math.sin(0);this._cr=Math.cos(0);this._cy=Math.cos(0);this._sy=Math.sin(0);this._nsx=Math.sin(0);this._cx=Math.cos(0)}var e=b("../math"),h=b("./TransformBase");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;a.prototype.updateSkew=function(){this._cy=
Math.cos(this.skew.y);this._sy=Math.sin(this.skew.y);this._nsx=Math.sin(this.skew.x);this._cx=Math.cos(this.skew.x)};a.prototype.updateLocalTransform=function(){var a=this.localTransform,b,c,h,p;b=this._cr*this.scale.x;c=this._sr*this.scale.x;h=-this._sr*this.scale.y;p=this._cr*this.scale.y;a.a=this._cy*b+this._sy*h;a.b=this._cy*c+this._sy*p;a.c=this._nsx*b+this._cx*h;a.d=this._nsx*c+this._cx*p};a.prototype.updateTransform=function(a){a=a.worldTransform;var b=this.worldTransform,c=this.localTransform,
h,p,e,d;h=this._cr*this.scale.x;p=this._sr*this.scale.x;e=-this._sr*this.scale.y;d=this._cr*this.scale.y;c.a=this._cy*h+this._sy*e;c.b=this._cy*p+this._sy*d;c.c=this._nsx*h+this._cx*e;c.d=this._nsx*p+this._cx*d;c.tx=this.position.x-(this.pivot.x*c.a+this.pivot.y*c.c);c.ty=this.position.y-(this.pivot.x*c.b+this.pivot.y*c.d);b.a=c.a*a.a+c.b*a.c;b.b=c.a*a.b+c.b*a.d;b.c=c.c*a.a+c.d*a.c;b.d=c.c*a.b+c.d*a.d;b.tx=c.tx*a.a+c.ty*a.c+a.tx;b.ty=c.tx*a.b+c.ty*a.d+a.ty;this._worldID++};a.prototype.setFromMatrix=
function(a){a.decompose(this)};Object.defineProperties(a.prototype,{rotation:{get:function(){return this._rotation},set:function(a){this._rotation=a;this._sr=Math.sin(a);this._cr=Math.cos(a)}}});c.exports=a},{"../math":102,"./TransformBase":83}],83:[function(b,c,f){function a(){this.worldTransform=new e.Matrix;this.localTransform=new e.Matrix;this._worldID=0}var e=b("../math");a.prototype.constructor=a;a.prototype.updateLocalTransform=function(){};a.prototype.updateTransform=function(a){a=a.worldTransform;
var b=this.worldTransform,c=this.localTransform;b.a=c.a*a.a+c.b*a.c;b.b=c.a*a.b+c.b*a.d;b.c=c.c*a.a+c.d*a.c;b.d=c.c*a.b+c.d*a.d;b.tx=c.tx*a.a+c.ty*a.c+a.tx;b.ty=c.tx*a.b+c.ty*a.d+a.ty;this._worldID++};a.prototype.updateWorldTransform=a.prototype.updateTransform;a.IDENTITY=new a;c.exports=a},{"../math":102}],84:[function(b,c,f){function a(){h.call(this);this.position=new e.ObservablePoint(this.onChange,this,0,0);this.scale=new e.ObservablePoint(this.onChange,this,1,1);this.pivot=new e.ObservablePoint(this.onChange,
this,0,0);this.skew=new e.ObservablePoint(this.updateSkew,this,0,0);this._rotation=0;this._sr=Math.sin(0);this._cr=Math.cos(0);this._cy=Math.cos(0);this._sy=Math.sin(0);this._nsx=Math.sin(0);this._cx=Math.cos(0);this._currentLocalID=this._localID=0}var e=b("../math"),h=b("./TransformBase");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;a.prototype.onChange=function(){this._localID++};a.prototype.updateSkew=function(){this._cy=Math.cos(this.skew._y);this._sy=Math.sin(this.skew._y);
this._nsx=Math.sin(this.skew._x);this._cx=Math.cos(this.skew._x);this._localID++};a.prototype.updateLocalTransform=function(){var a=this.localTransform;if(this._localID!==this._currentLocalID){var b,c,h,p;b=this._cr*this.scale._x;c=this._sr*this.scale._x;h=-this._sr*this.scale._y;p=this._cr*this.scale._y;a.a=this._cy*b+this._sy*h;a.b=this._cy*c+this._sy*p;a.c=this._nsx*b+this._cx*h;a.d=this._nsx*c+this._cx*p;a.tx=this.position._x-(this.pivot._x*a.a+this.pivot._y*a.c);a.ty=this.position._y-(this.pivot._x*
a.b+this.pivot._y*a.d);this._currentLocalID=this._localID;this._parentID=-1}};a.prototype.updateTransform=function(a){var b=a.worldTransform,c=this.worldTransform,h=this.localTransform;if(this._localID!==this._currentLocalID){var p,e,d,f;p=this._cr*this.scale._x;e=this._sr*this.scale._x;d=-this._sr*this.scale._y;f=this._cr*this.scale._y;h.a=this._cy*p+this._sy*d;h.b=this._cy*e+this._sy*f;h.c=this._nsx*p+this._cx*d;h.d=this._nsx*e+this._cx*f;h.tx=this.position._x-(this.pivot._x*h.a+this.pivot._y*h.c);
h.ty=this.position._y-(this.pivot._x*h.b+this.pivot._y*h.d);this._currentLocalID=this._localID;this._parentID=-1}this._parentID!==a._worldID&&(c.a=h.a*b.a+h.b*b.c,c.b=h.a*b.b+h.b*b.d,c.c=h.c*b.a+h.d*b.c,c.d=h.c*b.b+h.d*b.d,c.tx=h.tx*b.a+h.ty*b.c+b.tx,c.ty=h.tx*b.b+h.ty*b.d+b.ty,this._parentID=a._worldID,this._worldID++)};a.prototype.setFromMatrix=function(a){a.decompose(this);this._localID++};Object.defineProperties(a.prototype,{rotation:{get:function(){return this._rotation},set:function(a){this._rotation=
a;this._sr=Math.sin(a);this._cr=Math.cos(a);this._localID++}}});c.exports=a},{"../math":102,"./TransformBase":83}],85:[function(b,c,f){function a(){e.call(this);this.fillAlpha=1;this.lineColor=this.lineWidth=0;this.graphicsData=[];this._prevTint=this.tint=16777215;this.blendMode=p.BLEND_MODES.NORMAL;this.currentPath=null;this._webGL={};this.isMask=!1;this.boundsPadding=0;this._localBounds=new r;this.dirty=0;this.fastRectDirty=-1;this.clearDirty=0;this.boundsDirty=-1;this.cachedSpriteDirty=!1;this._spriteRect=
null;this._fastRect=!1}var e=b("../display/Container"),h=b("../textures/RenderTexture"),g=b("../textures/Texture"),m=b("./GraphicsData"),n=b("../sprites/Sprite"),k=b("../math"),p=b("../const"),z=b("../utils"),r=b("../display/Bounds"),v=b("./utils/bezierCurveTo"),t=b("../renderers/canvas/CanvasRenderer"),q,w=new k.Matrix,u=new k.Point,y=new Float32Array(4),x=new Float32Array(4);a._SPRITE_TEXTURE=null;a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){var b=
new a;b.renderable=this.renderable;b.fillAlpha=this.fillAlpha;b.lineWidth=this.lineWidth;b.lineColor=this.lineColor;b.tint=this.tint;b.blendMode=this.blendMode;b.isMask=this.isMask;b.boundsPadding=this.boundsPadding;b.dirty=0;b.cachedSpriteDirty=this.cachedSpriteDirty;for(var c=0;c<this.graphicsData.length;++c)b.graphicsData.push(this.graphicsData[c].clone());b.currentPath=b.graphicsData[b.graphicsData.length-1];b.updateLocalBounds();return b};a.prototype.lineStyle=function(a,b,c){this.lineWidth=
a||0;this.lineColor=b||0;this.lineAlpha=void 0===c?1:c;this.currentPath&&(this.currentPath.shape.points.length?(a=new k.Polygon(this.currentPath.shape.points.slice(-2)),a.closed=!1,this.drawShape(a)):(this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha));return this};a.prototype.moveTo=function(a,b){var c=new k.Polygon([a,b]);c.closed=!1;this.drawShape(c);return this};a.prototype.lineTo=function(a,b){this.currentPath.shape.points.push(a,
b);this.dirty++;return this};a.prototype.quadraticCurveTo=function(a,b,c,g){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var h,m,k=this.currentPath.shape.points;0===k.length&&this.moveTo(0,0);for(var p=k[k.length-2],n=k[k.length-1],e,d=1;20>=d;++d)e=d/20,h=p+(a-p)*e,m=n+(b-n)*e,k.push(h+(a+(c-a)*e-h)*e,m+(b+(g-b)*e-m)*e);this.dirty++;return this};a.prototype.bezierCurveTo=function(a,b,c,g,h,m){this.currentPath?0===this.currentPath.shape.points.length&&
(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var k=this.currentPath.shape.points,p=k[k.length-2],n=k[k.length-1];k.length-=2;v(p,n,a,b,c,g,h,m,k);this.dirty++;return this};a.prototype.arcTo=function(a,b,c,g,h){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(a,b):this.moveTo(a,b);var m=this.currentPath.shape.points,k=m[m.length-1]-b,p=m[m.length-2]-a;g-=b;c-=a;var n=Math.abs(k*c-p*g);if(1E-8>n||0===h)m[m.length-2]===a&&m[m.length-1]===b||m.push(a,
b);else{var e=k*k+p*p,d=g*g+c*c,z=k*g+p*c,m=h*Math.sqrt(e)/n,n=h*Math.sqrt(d)/n,e=m*z/e,d=n*z/d,z=m*c+n*p,f=m*g+n*k;this.arc(z+a,f+b,h,Math.atan2(k*(n+e)-f,p*(n+e)-z),Math.atan2(g*(m+d)-f,c*(m+d)-z),p*g>c*k)}this.dirty++;return this};a.prototype.arc=function(a,b,c,g,h,m){m=m||!1;if(g===h)return this;!m&&h<=g?h+=2*Math.PI:m&&g<=h&&(g+=2*Math.PI);m=m?-1*(g-h):h-g;var k=40*Math.ceil(Math.abs(m)/(2*Math.PI));if(0===m)return this;h=a+Math.cos(g)*c;var p=b+Math.sin(g)*c;this.currentPath?this.currentPath.shape.points.push(h,
p):this.moveTo(h,p);h=this.currentPath.shape.points;m/=2*k;for(var p=2*m,n=Math.cos(m),e=Math.sin(m),k=k-1,d=k%1/k,z=0;z<=k;z++){var f=m+g+p*(z+d*z),r=Math.cos(f),f=-Math.sin(f);h.push((n*r+e*f)*c+a,(n*-f+e*r)*c+b)}this.dirty++;return this};a.prototype.beginFill=function(a,b){this.filling=!0;this.fillColor=a||0;this.fillAlpha=void 0===b?1:b;this.currentPath&&2>=this.currentPath.shape.points.length&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=
this.fillAlpha);return this};a.prototype.endFill=function(){this.filling=!1;this.fillColor=null;this.fillAlpha=1;return this};a.prototype.drawRect=function(a,b,c,g){this.drawShape(new k.Rectangle(a,b,c,g));return this};a.prototype.drawRoundedRect=function(a,b,c,g,h){this.drawShape(new k.RoundedRectangle(a,b,c,g,h));return this};a.prototype.drawCircle=function(a,b,c){this.drawShape(new k.Circle(a,b,c));return this};a.prototype.drawEllipse=function(a,b,c,g){this.drawShape(new k.Ellipse(a,b,c,g));return this};
a.prototype.drawPolygon=function(a){var b=a,c=!0;b instanceof k.Polygon&&(c=b.closed,b=b.points);if(!Array.isArray(b))for(var b=Array(arguments.length),g=0;g<b.length;++g)b[g]=arguments[g];b=new k.Polygon(b);b.closed=c;this.drawShape(b);return this};a.prototype.clear=function(){this.lineWidth=0;this.filling=!1;this.dirty++;this.clearDirty++;this.graphicsData=[];return this};a.prototype.isFastRect=function(){return 1===this.graphicsData.length&&this.graphicsData[0].shape.type===p.SHAPES.RECT&&!this.graphicsData[0].lineWidth};
a.prototype._renderWebGL=function(a){this.dirty!==this.fastRectDirty&&(this.fastRectDirty=this.dirty,this._fastRect=this.isFastRect());this._fastRect?this._renderSpriteRect(a):(a.setObjectRenderer(a.plugins.graphics),a.plugins.graphics.render(this))};a.prototype._renderSpriteRect=function(b){var c=this.graphicsData[0].shape;if(!this._spriteRect){if(!a._SPRITE_TEXTURE){var h=document.createElement("canvas");h.width=10;h.height=10;var m=h.getContext("2d");m.fillStyle="white";m.fillRect(0,0,10,10);a._SPRITE_TEXTURE=
g.fromCanvas(h)}this._spriteRect=new n(a._SPRITE_TEXTURE)}16777215===this.tint?this._spriteRect.tint=this.graphicsData[0].fillColor:(z.hex2rgb(this.graphicsData[0].fillColor,y),z.hex2rgb(this.tint,x),y[0]*=x[0],y[1]*=x[1],y[2]*=x[2],this._spriteRect.tint=z.rgb2hex(y));this._spriteRect.alpha=this.graphicsData[0].fillAlpha;this._spriteRect.worldAlpha=this.worldAlpha*this._spriteRect.alpha;a._SPRITE_TEXTURE._frame.width=c.width;a._SPRITE_TEXTURE._frame.height=c.height;this._spriteRect.transform.worldTransform=
this.transform.worldTransform;this._spriteRect.anchor.set(-c.x/c.width,-c.y/c.height);this._spriteRect.onAnchorUpdate();this._spriteRect._renderWebGL(b)};a.prototype._renderCanvas=function(a){!0!==this.isMask&&a.plugins.graphics.render(this)};a.prototype._calculateBounds=function(){if(this.renderable){this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.updateLocalBounds(),this.dirty++,this.cachedSpriteDirty=!0);var a=this._localBounds;this._bounds.addFrame(this.transform,a.minX,a.minY,
a.maxX,a.maxY)}};a.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,u);a=this.graphicsData;for(var b=0;b<a.length;b++){var c=a[b];if(c.fill&&c.shape&&c.shape.contains(u.x,u.y))return!0}return!1};a.prototype.updateLocalBounds=function(){var a=Infinity,b=-Infinity,c=Infinity,g=-Infinity;if(this.graphicsData.length)for(var h,m,k,n,e,d=0;d<this.graphicsData.length;d++)if(k=this.graphicsData[d],m=k.type,e=k.lineWidth,h=k.shape,m===p.SHAPES.RECT||m===p.SHAPES.RREC)m=h.x-e/2,k=h.y-
e/2,n=h.width+e,e=h.height+e,a=m<a?m:a,b=m+n>b?m+n:b,c=k<c?k:c,g=k+e>g?k+e:g;else if(m===p.SHAPES.CIRC)m=h.x,k=h.y,n=h.radius+e/2,e=h.radius+e/2,a=m-n<a?m-n:a,b=m+n>b?m+n:b,c=k-e<c?k-e:c,g=k+e>g?k+e:g;else if(m===p.SHAPES.ELIP)m=h.x,k=h.y,n=h.width+e/2,e=h.height+e/2,a=m-n<a?m-n:a,b=m+n>b?m+n:b,c=k-e<c?k-e:c,g=k+e>g?k+e:g;else for(h=h.points,n=0;n<h.length;n+=2)m=h[n],k=h[n+1],a=m-e<a?m-e:a,b=m+e>b?m+e:b,c=k-e<c?k-e:c,g=k+e>g?k+e:g;else g=c=b=a=0;d=this.boundsPadding;this._localBounds.minX=a-d;this._localBounds.maxX=
b+2*d;this._localBounds.minY=c-d;this._localBounds.maxY=g+2*d};a.prototype.drawShape=function(a){this.currentPath&&2>=this.currentPath.shape.points.length&&this.graphicsData.pop();this.currentPath=null;a=new m(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,a);this.graphicsData.push(a);a.type===p.SHAPES.POLY&&(a.shape.closed=a.shape.closed||this.filling,this.currentPath=a);this.dirty++;return a};a.prototype.generateCanvasTexture=function(a,b){b=b||1;var c=this.getLocalBounds(),
m=new h.create(c.width*b,c.height*b);q||(q=new t);w.tx=-c.x;w.ty=-c.y;q.render(this,m,!1,w);c=g.fromCanvas(m.baseTexture._canvasRenderTarget.canvas,a);c.baseTexture.resolution=b;return c};a.prototype.closePath=function(){var a=this.currentPath;a&&a.shape&&a.shape.close();return this};a.prototype.addHole=function(){var a=this.graphicsData.pop();this.currentPath=this.graphicsData[this.graphicsData.length-1];this.currentPath.addHole(a.shape);this.currentPath=null;return this};a.prototype.destroy=function(){e.prototype.destroy.apply(this,
arguments);for(var a=0;a<this.graphicsData.length;++a)this.graphicsData[a].destroy();for(var b in this._webgl)for(a=0;a<this._webgl[b].data.length;++a)this._webgl[b].data[a].destroy();this._spriteRect&&this._spriteRect.destroy();this._localBounds=this._webgl=this.currentPath=this.graphicsData=null}},{"../const":78,"../display/Bounds":79,"../display/Container":80,"../math":102,"../renderers/canvas/CanvasRenderer":109,"../sprites/Sprite":133,"../textures/RenderTexture":143,"../textures/Texture":144,
"../utils":151,"./GraphicsData":86,"./utils/bezierCurveTo":88}],86:[function(b,c,f){function a(a,b,c,m,n,k,p){this.lineWidth=a;this.lineColor=b;this.lineAlpha=c;this._lineTint=b;this.fillColor=m;this.fillAlpha=n;this._fillTint=m;this.fill=k;this.holes=[];this.shape=p;this.type=p.type}a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)};a.prototype.addHole=function(a){this.holes.push(a)};
a.prototype.destroy=function(){this.holes=this.shape=null}},{}],87:[function(b,c,f){function a(a){this.renderer=a}f=b("../../renderers/canvas/CanvasRenderer");var e=b("../../const");a.prototype.constructor=a;c.exports=a;f.registerPlugin("graphics",a);a.prototype.render=function(a){var b=this.renderer,c=b.context,n=a.worldAlpha,k=a.transform.worldTransform,p=b.resolution;this._prevTint!==this.tint&&(this.dirty=!0);c.setTransform(k.a*p,k.b*p,k.c*p,k.d*p,k.tx*p,k.ty*p);a.dirty&&(this.updateGraphicsTint(a),
a.dirty=!1);b.setBlendMode(a.blendMode);for(b=0;b<a.graphicsData.length;b++){var k=a.graphicsData[b],d=k.shape,p=k._fillTint,f=k._lineTint;c.lineWidth=k.lineWidth;if(k.type===e.SHAPES.POLY){c.beginPath();this.renderPolygon(d.points,d.closed,c);for(var v=0;v<k.holes.length;v++)this.renderPolygon(k.holes[v].points,!0,c);k.fill&&(c.globalAlpha=k.fillAlpha*n,c.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),c.fill());k.lineWidth&&(c.globalAlpha=k.lineAlpha*n,c.strokeStyle="#"+("00000"+(f|0).toString(16)).substr(-6),
c.stroke())}else if(k.type===e.SHAPES.RECT){if(k.fillColor||0===k.fillColor)c.globalAlpha=k.fillAlpha*n,c.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),c.fillRect(d.x,d.y,d.width,d.height);k.lineWidth&&(c.globalAlpha=k.lineAlpha*n,c.strokeStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.strokeRect(d.x,d.y,d.width,d.height))}else if(k.type===e.SHAPES.CIRC)c.beginPath(),c.arc(d.x,d.y,d.radius,0,2*Math.PI),c.closePath(),k.fill&&(c.globalAlpha=k.fillAlpha*n,c.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),
c.fill()),k.lineWidth&&(c.globalAlpha=k.lineAlpha*n,c.strokeStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.stroke());else if(k.type===e.SHAPES.ELIP){var t=2*d.width,q=2*d.height,v=d.x-t/2,d=d.y-q/2;c.beginPath();var w=t/2*.5522848,u=q/2*.5522848,y=v+t,x=d+q,t=v+t/2,q=d+q/2;c.moveTo(v,q);c.bezierCurveTo(v,q-u,t-w,d,t,d);c.bezierCurveTo(t+w,d,y,q-u,y,q);c.bezierCurveTo(y,q+u,t+w,x,t,x);c.bezierCurveTo(t-w,x,v,q+u,v,q);c.closePath();k.fill&&(c.globalAlpha=k.fillAlpha*n,c.fillStyle="#"+("00000"+
(p|0).toString(16)).substr(-6),c.fill());k.lineWidth&&(c.globalAlpha=k.lineAlpha*n,c.strokeStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.stroke())}else if(k.type===e.SHAPES.RREC){v=d.x;q=d.y;w=d.width;u=d.height;d=d.radius;y=Math.min(w,u)/2|0;d=d>y?y:d;c.beginPath();c.moveTo(v,q+d);c.lineTo(v,q+u-d);c.quadraticCurveTo(v,q+u,v+d,q+u);c.lineTo(v+w-d,q+u);c.quadraticCurveTo(v+w,q+u,v+w,q+u-d);c.lineTo(v+w,q+d);c.quadraticCurveTo(v+w,q,v+w-d,q);c.lineTo(v+d,q);c.quadraticCurveTo(v,q,v,q+d);c.closePath();
if(k.fillColor||0===k.fillColor)c.globalAlpha=k.fillAlpha*n,c.fillStyle="#"+("00000"+(p|0).toString(16)).substr(-6),c.fill();k.lineWidth&&(c.globalAlpha=k.lineAlpha*n,c.strokeStyle="#"+("00000"+(f|0).toString(16)).substr(-6),c.stroke())}}};a.prototype.updateGraphicsTint=function(a){a._prevTint=a.tint;for(var b=(a.tint>>16&255)/255,c=(a.tint>>8&255)/255,n=(a.tint&255)/255,k=0;k<a.graphicsData.length;k++){var p=a.graphicsData[k],e=p.fillColor|0,d=p.lineColor|0;p._fillTint=((e>>16&255)/255*b*255<<16)+
((e>>8&255)/255*c*255<<8)+(e&255)/255*n*255;p._lineTint=((d>>16&255)/255*b*255<<16)+((d>>8&255)/255*c*255<<8)+(d&255)/255*n*255}};a.prototype.renderPolygon=function(a,b,c){c.moveTo(a[0],a[1]);for(var e=1;e<a.length/2;e++)c.lineTo(a[2*e],a[2*e+1]);b&&c.closePath()};a.prototype.destroy=function(){this.renderer=null}},{"../../const":78,"../../renderers/canvas/CanvasRenderer":109}],88:[function(b,c,f){c.exports=function(a,b,c,g,m,n,k,p,d){d=d||[];var f,v,t,q,w;d.push(a,b);for(var u,y=1;20>=y;++y)u=y/
20,f=1-u,v=f*f,t=v*f,q=u*u,w=q*u,d.push(t*a+3*v*u*c+3*f*q*m+w*k,t*b+3*v*u*g+3*f*q*n+w*p);return d}},{}],89:[function(b,c,f){function a(a){g.call(this,a);this.graphicsDataPool=[];this.primitiveShader=null;this.gl=a.gl;this.CONTEXT_UID=0}var e=b("../../utils"),h=b("../../const"),g=b("../../renderers/webgl/utils/ObjectRenderer");f=b("../../renderers/webgl/WebGLRenderer");var m=b("./WebGLGraphicsData"),n=b("./shaders/PrimitiveShader"),k=b("./utils/buildPoly"),p=b("./utils/buildRectangle"),z=b("./utils/buildRoundedRectangle"),
r=b("./utils/buildCircle");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;f.registerPlugin("graphics",a);a.prototype.onContextChange=function(){this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.primitiveShader=new n(this.gl)};a.prototype.destroy=function(){g.prototype.destroy.call(this);for(var a=0;a<this.graphicsDataPool.length;++a)this.graphicsDataPool[a].destroy();this.graphicsDataPool=null};a.prototype.render=function(a){var b=this.renderer,
c=b.gl,g,h=a._webGL[this.CONTEXT_UID];h&&a.dirty===h.dirty||(this.updateGraphics(a),h=a._webGL[this.CONTEXT_UID]);b.bindShader(this.primitiveShader);b.state.setBlendMode(a.blendMode);for(var m=0,k=h.data.length;m<k;m++){g=h.data[m];var p=g.shader;b.bindShader(p);p.uniforms.translationMatrix=a.transform.worldTransform.toArray(!0);p.uniforms.tint=e.hex2rgb(a.tint);p.uniforms.alpha=a.worldAlpha;g.vao.bind().draw(c.TRIANGLE_STRIP,g.indices.length).unbind()}};a.prototype.updateGraphics=function(a){var b=
this.renderer.gl,c=a._webGL[this.CONTEXT_UID];c||(c=a._webGL[this.CONTEXT_UID]={lastIndex:0,data:[],gl:b,clearDirty:-1,dirty:-1});c.dirty=a.dirty;if(a.clearDirty!==c.clearDirty){c.clearDirty=a.clearDirty;for(b=0;b<c.data.length;b++)this.graphicsDataPool.push(c.data[b]);c.data=[];c.lastIndex=0}for(var g,b=c.lastIndex;b<a.graphicsData.length;b++){var m=a.graphicsData[b];g=this.getWebGLData(c,0);m.type===h.SHAPES.POLY&&k(m,g);m.type===h.SHAPES.RECT?p(m,g):m.type===h.SHAPES.CIRC||m.type===h.SHAPES.ELIP?
r(m,g):m.type===h.SHAPES.RREC&&z(m,g);c.lastIndex++}for(b=0;b<c.data.length;b++)g=c.data[b],g.dirty&&g.upload()};a.prototype.getWebGLData=function(a,b){var c=a.data[a.data.length-1];if(!c||32E4<c.points.length)c=this.graphicsDataPool.pop()||new m(this.renderer.gl,this.primitiveShader,this.renderer.state.attribsState),c.reset(b),a.data.push(c);c.dirty=!0;return c}},{"../../const":78,"../../renderers/webgl/WebGLRenderer":116,"../../renderers/webgl/utils/ObjectRenderer":126,"../../utils":151,"./WebGLGraphicsData":90,
"./shaders/PrimitiveShader":91,"./utils/buildCircle":92,"./utils/buildPoly":94,"./utils/buildRectangle":95,"./utils/buildRoundedRectangle":96}],90:[function(b,c,f){function a(a,b,c){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.buffer=e.GLBuffer.createVertexBuffer(a);this.indexBuffer=e.GLBuffer.createIndexBuffer(a);this.dirty=!0;this.glIndices=this.glPoints=null;this.shader=b;this.vao=(new e.VertexArrayObject(a,c)).addIndex(this.indexBuffer).addAttribute(this.buffer,b.attributes.aVertexPosition,
a.FLOAT,!1,24,0).addAttribute(this.buffer,b.attributes.aColor,a.FLOAT,!1,24,8)}var e=b("pixi-gl-core");a.prototype.constructor=a;c.exports=a;a.prototype.reset=function(){this.points.length=0;this.indices.length=0};a.prototype.upload=function(){this.glPoints=new Float32Array(this.points);this.buffer.upload(this.glPoints);this.glIndices=new Uint16Array(this.indices);this.indexBuffer.upload(this.glIndices);this.dirty=!1};a.prototype.destroy=function(){this.indices=this.points=this.color=null;this.vao.destroy();
this.buffer.destroy();this.indexBuffer.destroy();this.glIndices=this.glPoints=this.indexBuffer=this.buffer=this.gl=null}},{"pixi-gl-core":7}],91:[function(b,c,f){function a(a){e.call(this,a,"attribute vec2 aVertexPosition;\nattribute vec4 aColor;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nuniform float alpha;\nuniform vec3 tint;\nvarying vec4 vColor;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vColor = aColor * vec4(tint * alpha, alpha);\n}",
"varying vec4 vColor;\nvoid main(void){\n   gl_FragColor = vColor;\n}")}var e=b("../../../Shader");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a},{"../../../Shader":77}],92:[function(b,c,f){var a=b("./buildLine"),e=b("../../../const"),h=b("../../../utils");c.exports=function(b,c){var n=b.shape,k=n.x,p=n.y,d,f;b.type===e.SHAPES.CIRC?f=d=n.radius:(d=n.width,f=n.height);var n=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(n.width+n.height)),v=2*Math.PI/n,t;
if(b.fill){t=h.hex2rgb(b.fillColor);var q=b.fillAlpha,w=t[0]*q,u=t[1]*q,y=t[2]*q,x=c.points,A=c.indices,F=x.length/6;A.push(F);for(t=0;t<n+1;t++)x.push(k,p,w,u,y,q),x.push(k+Math.sin(v*t)*d,p+Math.cos(v*t)*f,w,u,y,q),A.push(F++,F++);A.push(F-1)}if(b.lineWidth){q=b.points;b.points=[];for(t=0;t<n+1;t++)b.points.push(k+Math.sin(v*t)*d,p+Math.cos(v*t)*f);a(b,c);b.points=q}}},{"../../../const":78,"../../../utils":151,"./buildLine":93}],93:[function(b,c,f){var a=b("../../../math"),e=b("../../../utils");
c.exports=function(b,c){var m,n=b.points;if(0!==n.length){var k=new a.Point(n[0],n[1]),p=new a.Point(n[n.length-2],n[n.length-1]);if(k.x===p.x&&k.y===p.y){n=n.slice();n.pop();n.pop();var p=new a.Point(n[n.length-2],n[n.length-1]),d=p.x+.5*(k.x-p.x),k=p.y+.5*(k.y-p.y);n.unshift(d,k);n.push(d,k)}var d=c.points,k=c.indices,p=n.length/2,f=n.length,v=d.length/6,t=b.lineWidth/2;m=e.hex2rgb(b.lineColor);var q=b.lineAlpha,w=m[0]*q,u=m[1]*q,y=m[2]*q,x,A,F,H,D,E,I,J,B,C,M,G,P;F=n[0];H=n[1];D=n[2];E=n[3];B=
-(H-E);C=F-D;A=Math.sqrt(B*B+C*C);B=B/A*t;C=C/A*t;d.push(F-B,H-C,w,u,y,q);d.push(F+B,H+C,w,u,y,q);for(m=1;m<p-1;m++)F=n[2*(m-1)],H=n[2*(m-1)+1],D=n[2*m],E=n[2*m+1],I=n[2*(m+1)],J=n[2*(m+1)+1],B=-(H-E),C=F-D,A=Math.sqrt(B*B+C*C),B/=A,C/=A,B*=t,C*=t,M=-(E-J),G=D-I,A=Math.sqrt(M*M+G*G),M/=A,G/=A,M*=t,G*=t,A=-C+H-(-C+E),x=-B+D-(-B+F),F=(-B+F)*(-C+E)-(-B+D)*(-C+H),H=-G+J-(-G+E),P=-M+D-(-M+I),I=(-M+I)*(-G+E)-(-M+D)*(-G+J),J=A*P-H*x,.1>Math.abs(J)?(d.push(D-B,E-C,w,u,y,q),d.push(D+B,E+C,w,u,y,q)):(x=(x*
I-P*F)/J,A=(H*F-A*I)/J,I=(x-D)*(x-D)+(A-E)*(A-E),19600<I?(B-=M,C-=G,A=Math.sqrt(B*B+C*C),B/=A,C/=A,B*=t,C*=t,d.push(D-B,E-C),d.push(w,u,y,q),d.push(D+B,E+C),d.push(w,u,y,q),d.push(D-B,E-C),d.push(w,u,y,q),f++):(d.push(x,A),d.push(w,u,y,q),d.push(D-(x-D),E-(A-E)),d.push(w,u,y,q)));F=n[2*(p-2)];H=n[2*(p-2)+1];D=n[2*(p-1)];E=n[2*(p-1)+1];B=-(H-E);C=F-D;A=Math.sqrt(B*B+C*C);B=B/A*t;C=C/A*t;d.push(D-B,E-C);d.push(w,u,y,q);d.push(D+B,E+C);d.push(w,u,y,q);k.push(v);for(m=0;m<f;m++)k.push(v++);k.push(v-1)}}},
{"../../../math":102,"../../../utils":151}],94:[function(b,c,f){var a=b("./buildLine"),e=b("../../../utils"),h=b("earcut");c.exports=function(b,c){b.points=b.shape.points.slice();var n=b.points;if(b.fill&&6<=n.length){for(var k=[],p=b.holes,d=0;d<p.length;d++){var f=p[d];k.push(n.length/2);n=n.concat(f.points)}var p=c.points,f=c.indices,v=n.length/2,d=e.hex2rgb(b.fillColor),t=b.fillAlpha,q=d[0]*t,w=d[1]*t,u=d[2]*t,k=h(n,k,2);if(!k)return;for(var y=p.length/6,d=0;d<k.length;d+=3)f.push(k[d]+y),f.push(k[d]+
y),f.push(k[d+1]+y),f.push(k[d+2]+y),f.push(k[d+2]+y);for(d=0;d<v;d++)p.push(n[2*d],n[2*d+1],q,w,u,t)}0<b.lineWidth&&a(b,c)}},{"../../../utils":151,"./buildLine":93,earcut:31}],95:[function(b,c,f){var a=b("./buildLine"),e=b("../../../utils");c.exports=function(b,c){var m=b.shape,d=m.x,k=m.y,p=m.width,m=m.height;if(b.fill){var f=e.hex2rgb(b.fillColor),r=b.fillAlpha,v=f[0]*r,t=f[1]*r,f=f[2]*r,q=c.points,w=c.indices,u=q.length/6;q.push(d,k);q.push(v,t,f,r);q.push(d+p,k);q.push(v,t,f,r);q.push(d,k+m);
q.push(v,t,f,r);q.push(d+p,k+m);q.push(v,t,f,r);w.push(u,u,u+1,u+2,u+3,u+3)}b.lineWidth&&(r=b.points,b.points=[d,k,d+p,k,d+p,k+m,d,k+m,d,k],a(b,c),b.points=r)}},{"../../../utils":151,"./buildLine":93}],96:[function(b,c,f){var a=b("earcut"),e=b("./buildLine"),h=b("../../../utils"),g=function(a,b,c,g,h,d,e){var f,q,w,u;e=e||[];for(var y,x=0;20>=x;x++)y=x/20,f=a+(c-a)*y,q=b+(g-b)*y,w=c+(h-c)*y,u=g+(d-g)*y,f+=(w-f)*y,q+=(u-q)*y,e.push(f,q);return e};c.exports=function(b,c){var k=b.shape,d=k.x,f=k.y,r=
k.width,v=k.height,t=k.radius,k=[];k.push(d,f+t);g(d,f+v-t,d,f+v,d+t,f+v,k);g(d+r-t,f+v,d+r,f+v,d+r,f+v-t,k);g(d+r,f+t,d+r,f,d+r-t,f,k);g(d+t,f,d,f,d,f+t+1E-10,k);if(b.fill){var v=h.hex2rgb(b.fillColor),d=b.fillAlpha,f=v[0]*d,r=v[1]*d,v=v[2]*d,t=c.points,q=c.indices,w=t.length/6,u=a(k,null,2),y;for(y=0;y<u.length;y+=3)q.push(u[y]+w),q.push(u[y]+w),q.push(u[y+1]+w),q.push(u[y+2]+w),q.push(u[y+2]+w);for(y=0;y<k.length;y++)t.push(k[y],k[++y],f,r,v,d)}b.lineWidth&&(d=b.points,b.points=k,e(b,c),b.points=
d)}},{"../../../utils":151,"./buildLine":93,earcut:31}],97:[function(b,c,f){var a=c.exports=Object.assign(b("./const"),b("./math"),{utils:b("./utils"),ticker:b("./ticker"),DisplayObject:b("./display/DisplayObject"),Container:b("./display/Container"),Transform:b("./display/Transform"),TransformStatic:b("./display/TransformStatic"),TransformBase:b("./display/TransformBase"),Sprite:b("./sprites/Sprite"),CanvasSpriteRenderer:b("./sprites/canvas/CanvasSpriteRenderer"),CanvasTinter:b("./sprites/canvas/CanvasTinter"),
SpriteRenderer:b("./sprites/webgl/SpriteRenderer"),Text:b("./text/Text"),TextStyle:b("./text/TextStyle"),Graphics:b("./graphics/Graphics"),GraphicsData:b("./graphics/GraphicsData"),GraphicsRenderer:b("./graphics/webgl/GraphicsRenderer"),CanvasGraphicsRenderer:b("./graphics/canvas/CanvasGraphicsRenderer"),Texture:b("./textures/Texture"),BaseTexture:b("./textures/BaseTexture"),RenderTexture:b("./textures/RenderTexture"),BaseRenderTexture:b("./textures/BaseRenderTexture"),VideoBaseTexture:b("./textures/VideoBaseTexture"),
TextureUvs:b("./textures/TextureUvs"),CanvasRenderer:b("./renderers/canvas/CanvasRenderer"),CanvasRenderTarget:b("./renderers/canvas/utils/CanvasRenderTarget"),Shader:b("./Shader"),WebGLRenderer:b("./renderers/webgl/WebGLRenderer"),WebGLManager:b("./renderers/webgl/managers/WebGLManager"),ObjectRenderer:b("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:b("./renderers/webgl/utils/RenderTarget"),Quad:b("./renderers/webgl/utils/Quad"),SpriteMaskFilter:b("./renderers/webgl/filters/spriteMask/SpriteMaskFilter"),
Filter:b("./renderers/webgl/filters/Filter"),glCore:b("pixi-gl-core"),autoDetectRenderer:function(b,c,g,m){b=b||800;c=c||600;return!m&&a.utils.isWebGLSupported()?new a.WebGLRenderer(b,c,g):new a.CanvasRenderer(b,c,g)}})},{"./Shader":77,"./const":78,"./display/Container":80,"./display/DisplayObject":81,"./display/Transform":82,"./display/TransformBase":83,"./display/TransformStatic":84,"./graphics/Graphics":85,"./graphics/GraphicsData":86,"./graphics/canvas/CanvasGraphicsRenderer":87,"./graphics/webgl/GraphicsRenderer":89,
"./math":102,"./renderers/canvas/CanvasRenderer":109,"./renderers/canvas/utils/CanvasRenderTarget":111,"./renderers/webgl/WebGLRenderer":116,"./renderers/webgl/filters/Filter":118,"./renderers/webgl/filters/spriteMask/SpriteMaskFilter":121,"./renderers/webgl/managers/WebGLManager":125,"./renderers/webgl/utils/ObjectRenderer":126,"./renderers/webgl/utils/Quad":127,"./renderers/webgl/utils/RenderTarget":128,"./sprites/Sprite":133,"./sprites/canvas/CanvasSpriteRenderer":134,"./sprites/canvas/CanvasTinter":135,
"./sprites/webgl/SpriteRenderer":137,"./text/Text":139,"./text/TextStyle":140,"./textures/BaseRenderTexture":141,"./textures/BaseTexture":142,"./textures/RenderTexture":143,"./textures/Texture":144,"./textures/TextureUvs":145,"./textures/VideoBaseTexture":146,"./ticker":148,"./utils":151,"pixi-gl-core":7}],98:[function(b,c,f){function a(a){return 0>a?-1:0<a?1:0}var e=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],h=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],g=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],m=[1,1,
0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],n=[],k=b("./Matrix"),p=[];(function(){for(var b=0;16>b;b++){var c=[];p.push(c);for(var d=0;16>d;d++)for(var f=a(e[b]*e[d]+g[b]*h[d]),z=a(h[b]*e[d]+m[b]*h[d]),u=a(e[b]*g[d]+g[b]*m[d]),y=a(h[b]*g[d]+m[b]*m[d]),x=0;16>x;x++)if(e[x]===f&&h[x]===z&&g[x]===u&&m[x]===y){c.push(x);break}}for(b=0;16>b;b++)c=new k,c.set(e[b],h[b],g[b],m[b],0,0),n.push(c)})();var z={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(a){return e[a]},uY:function(a){return h[a]},
vX:function(a){return g[a]},vY:function(a){return m[a]},inv:function(a){return a&8?a&15:-a&7},add:function(a,b){return p[a][b]},sub:function(a,b){return p[a][z.inv(b)]},rotate180:function(a){return a^4},isSwapWidthHeight:function(a){return 2===(a&3)},byDirection:function(a,b){return 2*Math.abs(a)<=Math.abs(b)?0<=b?z.S:z.N:2*Math.abs(b)<=Math.abs(a)?0<a?z.E:z.W:0<b?0<a?z.SE:z.SW:0<a?z.NE:z.NW},matrixAppendRotationInv:function(a,b,c,g){b=n[z.inv(b)];b.tx=c||0;b.ty=g||0;a.append(b)}};c.exports=z},{"./Matrix":99}],
99:[function(b,c,f){function a(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0;this.array=null}var e=b("./Point");a.prototype.constructor=a;c.exports=a;a.prototype.fromArray=function(a){this.a=a[0];this.b=a[1];this.c=a[3];this.d=a[4];this.tx=a[2];this.ty=a[5]};a.prototype.set=function(a,b,c,d,k,e){this.a=a;this.b=b;this.c=c;this.d=d;this.tx=k;this.ty=e;return this};a.prototype.toArray=function(a,b){this.array||(this.array=new Float32Array(9));var c=b||this.array;a?(c[0]=this.a,c[1]=this.b,c[2]=
0,c[3]=this.c,c[4]=this.d,c[5]=0,c[6]=this.tx,c[7]=this.ty):(c[0]=this.a,c[1]=this.c,c[2]=this.tx,c[3]=this.b,c[4]=this.d,c[5]=this.ty,c[6]=0,c[7]=0);c[8]=1;return c};a.prototype.apply=function(a,b){b=b||new e;var c=a.x,d=a.y;b.x=this.a*c+this.c*d+this.tx;b.y=this.b*c+this.d*d+this.ty;return b};a.prototype.applyInverse=function(a,b){b=b||new e;var c=1/(this.a*this.d+this.c*-this.b),d=a.x,k=a.y;b.x=this.d*c*d+-this.c*c*k+(this.ty*this.c-this.tx*this.d)*c;b.y=this.a*c*k+-this.b*c*d+(-this.ty*this.a+
this.tx*this.b)*c;return b};a.prototype.translate=function(a,b){this.tx+=a;this.ty+=b;return this};a.prototype.scale=function(a,b){this.a*=a;this.d*=b;this.c*=a;this.b*=b;this.tx*=a;this.ty*=b;return this};a.prototype.rotate=function(a){var b=Math.cos(a);a=Math.sin(a);var c=this.a,d=this.c,k=this.tx;this.a=c*b-this.b*a;this.b=c*a+this.b*b;this.c=d*b-this.d*a;this.d=d*a+this.d*b;this.tx=k*b-this.ty*a;this.ty=k*a+this.ty*b;return this};a.prototype.append=function(a){var b=this.a,c=this.b,d=this.c,k=
this.d;this.a=a.a*b+a.b*d;this.b=a.a*c+a.b*k;this.c=a.c*b+a.d*d;this.d=a.c*c+a.d*k;this.tx=a.tx*b+a.ty*d+this.tx;this.ty=a.tx*c+a.ty*k+this.ty;return this};a.prototype.setTransform=function(a,b,c,d,k,e,f,r,v){var t,q,w,u;t=Math.sin(f);q=Math.cos(f);f=Math.cos(v);v=Math.sin(v);w=-Math.sin(r);u=Math.cos(r);r=q*k;k*=t;t=-t*e;e*=q;this.a=f*r+v*t;this.b=f*k+v*e;this.c=w*r+u*t;this.d=w*k+u*e;this.tx=a+(c*r+d*t);this.ty=b+(c*k+d*e);return this};a.prototype.prepend=function(a){var b=this.tx;if(1!==a.a||0!==
a.b||0!==a.c||1!==a.d){var c=this.a,d=this.c;this.a=c*a.a+this.b*a.c;this.b=c*a.b+this.b*a.d;this.c=d*a.a+this.d*a.c;this.d=d*a.b+this.d*a.d}this.tx=b*a.a+this.ty*a.c+a.tx;this.ty=b*a.b+this.ty*a.d+a.ty;return this};a.prototype.decompose=function(a){var b=this.a,c=this.b,d=this.c,k=this.d,e=Math.atan2(-d,k),f=Math.atan2(c,b);1E-5>Math.abs(1-e/f)?(a.rotation=f,0>b&&0<=k&&(a.rotation+=0>=a.rotation?Math.PI:-Math.PI),a.skew.x=a.skew.y=0):(a.skew.x=e,a.skew.y=f);a.scale.x=Math.sqrt(b*b+c*c);a.scale.y=
Math.sqrt(d*d+k*k);a.position.x=this.tx;a.position.y=this.ty;return a};a.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,k=this.tx,e=a*d-b*c;this.a=d/e;this.b=-b/e;this.c=-c/e;this.d=a/e;this.tx=(c*this.ty-d*k)/e;this.ty=-(a*this.ty-b*k)/e;return this};a.prototype.identity=function(){this.a=1;this.c=this.b=0;this.d=1;this.ty=this.tx=0;return this};a.prototype.clone=function(){var b=new a;b.a=this.a;b.b=this.b;b.c=this.c;b.d=this.d;b.tx=this.tx;b.ty=this.ty;return b};a.prototype.copy=
function(a){a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.tx=this.tx;a.ty=this.ty;return a};a.IDENTITY=new a;a.TEMP_MATRIX=new a},{"./Point":101}],100:[function(b,c,f){function a(a,b,c,m){this._x=c||0;this._y=m||0;this.cb=a;this.scope=b}a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{x:{get:function(){return this._x},set:function(a){this._x!==a&&(this._x=a,this.cb.call(this.scope))}},y:{get:function(){return this._y},set:function(a){this._y!==a&&(this._y=a,this.cb.call(this.scope))}}});
a.prototype.set=function(a,b){var c=a||0,m=b||(0!==b?c:0);if(this._x!==c||this._y!==m)this._x=c,this._y=m,this.cb.call(this.scope)};a.prototype.copy=function(a){if(this._x!==a.x||this._y!==a.y)this._x=a.x,this._y=a.y,this.cb.call(this.scope)}},{}],101:[function(b,c,f){function a(a,b){this.x=a||0;this.y=b||0}a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.copy=function(a){this.set(a.x,a.y)};a.prototype.equals=function(a){return a.x===this.x&&
a.y===this.y};a.prototype.set=function(a,b){this.x=a||0;this.y=b||(0!==b?this.x:0)}},{}],102:[function(b,c,f){c.exports={Point:b("./Point"),ObservablePoint:b("./ObservablePoint"),Matrix:b("./Matrix"),GroupD8:b("./GroupD8"),Circle:b("./shapes/Circle"),Ellipse:b("./shapes/Ellipse"),Polygon:b("./shapes/Polygon"),Rectangle:b("./shapes/Rectangle"),RoundedRectangle:b("./shapes/RoundedRectangle")}},{"./GroupD8":98,"./Matrix":99,"./ObservablePoint":100,"./Point":101,"./shapes/Circle":103,"./shapes/Ellipse":104,
"./shapes/Polygon":105,"./shapes/Rectangle":106,"./shapes/RoundedRectangle":107}],103:[function(b,c,f){function a(a,b,c){this.x=a||0;this.y=b||0;this.radius=c||0;this.type=h.SHAPES.CIRC}var e=b("./Rectangle"),h=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y,this.radius)};a.prototype.contains=function(a,b){if(0>=this.radius)return!1;var c=this.x-a,h=this.y-b;return c*c+h*h<=this.radius*this.radius};a.prototype.getBounds=function(){return new e(this.x-
this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":78,"./Rectangle":106}],104:[function(b,c,f){function a(a,b,c,k){this.x=a||0;this.y=b||0;this.width=c||0;this.height=k||0;this.type=h.SHAPES.ELIP}var e=b("./Rectangle"),h=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.contains=function(a,b){if(0>=this.width||0>=this.height)return!1;var c=(a-this.x)/this.width,h=(b-this.y)/
this.height;return 1>=c*c+h*h};a.prototype.getBounds=function(){return new e(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":78,"./Rectangle":106}],105:[function(b,c,f){function a(a){var b=a;if(!Array.isArray(b))for(var b=Array(arguments.length),c=0;c<b.length;++c)b[c]=arguments[c];if(b[0]instanceof e){for(var c=[],k=0,d=b.length;k<d;k++)c.push(b[k].x,b[k].y);b=c}this.closed=!0;this.points=b;this.type=h.SHAPES.POLY}var e=b("../Point"),h=b("../../const");a.prototype.constructor=
a;c.exports=a;a.prototype.clone=function(){return new a(this.points.slice())};a.prototype.close=function(){var a=this.points;a[0]===a[a.length-2]&&a[1]===a[a.length-1]||a.push(a[0],a[1])};a.prototype.contains=function(a,b){for(var c=!1,h=this.points.length/2,d=0,e=h-1;d<h;e=d++){var f=this.points[2*d],v=this.points[2*d+1],t=this.points[2*e],e=this.points[2*e+1];v>b!==e>b&&a<(t-f)*(b-v)/(e-v)+f&&(c=!c)}return c}},{"../../const":78,"../Point":101}],106:[function(b,c,f){function a(a,b,c,d){this.x=a||
0;this.y=b||0;this.width=c||0;this.height=d||0;this.type=e.SHAPES.RECT}var e=b("../../const");a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{left:{get:function(){return this.x}},right:{get:function(){return this.x+this.width}},top:{get:function(){return this.y}},bottom:{get:function(){return this.y+this.height}}});a.EMPTY=new a(0,0,0,0);a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)};a.prototype.copy=function(a){this.x=a.x;this.y=a.y;this.width=
a.width;this.height=a.height;return this};a.prototype.contains=function(a,b){return 0>=this.width||0>=this.height?!1:a>=this.x&&a<this.x+this.width&&b>=this.y&&b<this.y+this.height?!0:!1};a.prototype.pad=function(a,b){a=a||0;b=b||(0!==b?a:0);this.x-=a;this.y-=b;this.width+=2*a;this.height+=2*b};a.prototype.fit=function(a){this.x<a.x&&(this.width+=this.x,0>this.width&&(this.width=0),this.x=a.x);this.y<a.y&&(this.height+=this.y,0>this.height&&(this.height=0),this.y=a.y);this.x+this.width>a.x+a.width&&
(this.width=a.width-this.x,0>this.width&&(this.width=0));this.y+this.height>a.y+a.height&&(this.height=a.height-this.y,0>this.height&&(this.height=0))};a.prototype.enlarge=function(b){if(b!==a.EMPTY){var c=Math.min(this.x,b.x),m=Math.max(this.x+this.width,b.x+b.width),d=Math.min(this.y,b.y);b=Math.max(this.y+this.height,b.y+b.height);this.x=c;this.width=m-c;this.y=d;this.height=b-d}}},{"../../const":78}],107:[function(b,c,f){function a(a,b,c,d,k){this.x=a||0;this.y=b||0;this.width=c||0;this.height=
d||0;this.radius=k||20;this.type=e.SHAPES.RREC}var e=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height,this.radius)};a.prototype.contains=function(a,b){return 0>=this.width||0>=this.height?!1:a>=this.x&&a<=this.x+this.width&&b>=this.y&&b<=this.y+this.height?!0:!1}},{"../../const":78}],108:[function(b,c,f){function a(a,b,c,m){n.call(this);e.sayHello(a);if(m)for(var k in h.DEFAULT_RENDER_OPTIONS)"undefined"===typeof m[k]&&
(m[k]=h.DEFAULT_RENDER_OPTIONS[k]);else m=h.DEFAULT_RENDER_OPTIONS;this.type=h.RENDERER_TYPE.UNKNOWN;this.width=b||800;this.height=c||600;this.view=m.view||document.createElement("canvas");this.resolution=m.resolution;this.transparent=m.transparent;this.autoResize=m.autoResize||!1;this.blendModes=null;this.preserveDrawingBuffer=m.preserveDrawingBuffer;this.clearBeforeRender=m.clearBeforeRender;this.roundPixels=m.roundPixels;this._backgroundColor=0;this._backgroundColorRgba=[0,0,0,0];this._backgroundColorString=
"#000000";this.backgroundColor=m.backgroundColor||this._backgroundColor;this._lastObjectRendered=this._tempDisplayObjectParent=new g}var e=b("../utils");f=b("../math");var h=b("../const"),g=b("../display/Container"),m=b("../textures/RenderTexture"),n=b("eventemitter3"),k=new f.Matrix;a.prototype=Object.create(n.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(a){this._backgroundColor=a;
this._backgroundColorString=e.hex2string(a);e.hex2rgb(a,this._backgroundColorRgba)}}});a.prototype.resize=function(a,b){this.width=a*this.resolution;this.height=b*this.resolution;this.view.width=this.width;this.view.height=this.height;this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")};a.prototype.generateTexture=function(a,b,c){var g=a.getLocalBounds();b=m.create(g.width|0,g.height|0,b,c);k.tx=-g.x;k.ty=-g.y;this.render(a,
b,!1,k,!0);return b};a.prototype.destroy=function(a){a&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);this.type=h.RENDERER_TYPE.UNKNOWN;this.height=this.width=0;this.view=null;this.resolution=0;this.autoResize=this.transparent=!1;this.blendModes=null;this.roundPixels=this.clearBeforeRender=this.preserveDrawingBuffer=!1;this._backgroundColor=0;this._backgroundColorString=this._backgroundColorRgba=null;this.backgroundColor=0;this._lastObjectRendered=this._tempDisplayObjectParent=
null}},{"../const":78,"../display/Container":80,"../math":102,"../textures/RenderTexture":143,"../utils":151,eventemitter3:32}],109:[function(b,c,f){function a(a,b,c){c=c||{};e.call(this,"Canvas",a,b,c);this.type=n.RENDERER_TYPE.CANVAS;this.rootContext=this.view.getContext("2d",{alpha:this.transparent});this.rootResolution=this.resolution;this.refresh=!0;this.maskManager=new h(this);this.smoothProperty="imageSmoothingEnabled";this.rootContext.imageSmoothingEnabled||(this.rootContext.webkitImageSmoothingEnabled?
this.smoothProperty="webkitImageSmoothingEnabled":this.rootContext.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.rootContext.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.rootContext.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled"));this.initPlugins();this.blendModes=m();this.context=this._activeBlendMode=null;this.renderingToScreen=!1;this.resize(a,b)}var e=b("../SystemRenderer"),h=b("./utils/CanvasMaskManager"),g=
b("./utils/CanvasRenderTarget"),m=b("./utils/mapCanvasBlendModesToPixi");f=b("../../utils");var n=b("../../const");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;f.pluginTarget.mixin(a);a.prototype.render=function(a,b,c,h,m){if(this.view){this.renderingToScreen=!b;this.emit("prerender");b?(b=b.baseTexture||b,b._canvasRenderTarget||(b._canvasRenderTarget=new g(b.width,b.height,b.resolution),b.source=b._canvasRenderTarget.canvas,b.valid=!0),this.context=b._canvasRenderTarget.context,
this.resolution=b._canvasRenderTarget.resolution):(this.context=this.rootContext,this.resolution=this.rootResolution);var d=this.context;b||(this._lastObjectRendered=a);m||(b=a.parent,m=this._tempDisplayObjectParent.transform.worldTransform,h?h.copy(m):m.identity(),a.parent=this._tempDisplayObjectParent,a.updateTransform(),a.parent=b);d.setTransform(1,0,0,1,0,0);d.globalAlpha=1;d.globalCompositeOperation=this.blendModes[n.BLEND_MODES.NORMAL];navigator.isCocoonJS&&this.view.screencanvas&&(d.fillStyle=
"black",d.clear());(void 0!==c?c:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?d.clearRect(0,0,this.width,this.height):(d.fillStyle=this._backgroundColorString,d.fillRect(0,0,this.width,this.height)));c=this.context;this.context=d;a.renderCanvas(this);this.context=c;this.emit("postrender")}};a.prototype.setBlendMode=function(a){this._activeBlendMode!==a&&(this.context.globalCompositeOperation=this.blendModes[a])};a.prototype.destroy=function(a){this.destroyPlugins();e.prototype.destroy.call(this,
a);this.context=null;this.refresh=!0;this.maskManager.destroy();this.smoothProperty=this.maskManager=null};a.prototype.resize=function(a,b){e.prototype.resize.call(this,a,b);this.smoothProperty&&(this.rootContext[this.smoothProperty]=n.SCALE_MODES.DEFAULT===n.SCALE_MODES.LINEAR)}},{"../../const":78,"../../utils":151,"../SystemRenderer":108,"./utils/CanvasMaskManager":110,"./utils/CanvasRenderTarget":111,"./utils/mapCanvasBlendModesToPixi":113}],110:[function(b,c,f){function a(a){this.renderer=a}var e=
b("../../../const");a.prototype.constructor=a;c.exports=a;a.prototype.pushMask=function(a){var b=this.renderer;b.context.save();var c=a.alpha,d=a.transform.worldTransform,k=b.resolution;b.context.setTransform(d.a*k,d.b*k,d.c*k,d.d*k,d.tx*k,d.ty*k);a._texture||(this.renderGraphicsShape(a),b.context.clip());a.worldAlpha=c};a.prototype.renderGraphicsShape=function(a){var b=this.renderer.context,c=a.graphicsData.length;if(0!==c){b.beginPath();for(var d=0;d<c;d++){var k=a.graphicsData[d],p=k.shape;if(k.type===
e.SHAPES.POLY){k=p.points;b.moveTo(k[0],k[1]);for(var f=1;f<k.length/2;f++)b.lineTo(k[2*f],k[2*f+1]);k[0]===k[k.length-2]&&k[1]===k[k.length-1]&&b.closePath()}else if(k.type===e.SHAPES.RECT)b.rect(p.x,p.y,p.width,p.height),b.closePath();else if(k.type===e.SHAPES.CIRC)b.arc(p.x,p.y,p.radius,0,2*Math.PI),b.closePath();else if(k.type===e.SHAPES.ELIP){var r=2*p.width,f=2*p.height,k=p.x-r/2,p=p.y-f/2,v=r/2*.5522848,t=f/2*.5522848,q=k+r,w=p+f,r=k+r/2,f=p+f/2;b.moveTo(k,f);b.bezierCurveTo(k,f-t,r-v,p,r,
p);b.bezierCurveTo(r+v,p,q,f-t,q,f);b.bezierCurveTo(q,f+t,r+v,w,r,w);b.bezierCurveTo(r-v,w,k,f+t,k,f);b.closePath()}else k.type===e.SHAPES.RREC&&(k=p.x,f=p.y,v=p.width,t=p.height,p=p.radius,q=Math.min(v,t)/2|0,p=p>q?q:p,b.moveTo(k,f+p),b.lineTo(k,f+t-p),b.quadraticCurveTo(k,f+t,k+p,f+t),b.lineTo(k+v-p,f+t),b.quadraticCurveTo(k+v,f+t,k+v,f+t-p),b.lineTo(k+v,f+p),b.quadraticCurveTo(k+v,f,k+v-p,f),b.lineTo(k+p,f),b.quadraticCurveTo(k,f,k,f+p),b.closePath())}}};a.prototype.popMask=function(a){a.context.restore()};
a.prototype.destroy=function(){}},{"../../../const":78}],111:[function(b,c,f){function a(a,b,c){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=c||e.RESOLUTION;this.resize(a,b)}var e=b("../../../const");a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this.canvas.width},set:function(a){this.canvas.width=a}},height:{get:function(){return this.canvas.height},set:function(a){this.canvas.height=
a}}});a.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0);this.context.clearRect(0,0,this.canvas.width,this.canvas.height)};a.prototype.resize=function(a,b){this.canvas.width=a*this.resolution;this.canvas.height=b*this.resolution};a.prototype.destroy=function(){this.canvas=this.context=null}},{"../../../const":78}],112:[function(b,c,f){var a=function(a){var b=document.createElement("canvas");b.width=6;b.height=1;var c=b.getContext("2d");c.fillStyle=a;c.fillRect(0,0,6,1);return b};
c.exports=function(){if("undefined"===typeof document)return!1;var b=a("#ff00ff"),c=a("#ffff00"),g=document.createElement("canvas");g.width=6;g.height=1;g=g.getContext("2d");g.globalCompositeOperation="multiply";g.drawImage(b,0,0);g.drawImage(c,2,0);b=g.getImageData(2,0,1,1);if(!b)return!1;b=b.data;return 255===b[0]&&0===b[1]&&0===b[2]}},{}],113:[function(b,c,f){var a=b("../../../const"),e=b("./canUseNewCanvasBlendModes");c.exports=function(b){b=b||[];e()?(b[a.BLEND_MODES.NORMAL]="source-over",b[a.BLEND_MODES.ADD]=
"lighter",b[a.BLEND_MODES.MULTIPLY]="multiply",b[a.BLEND_MODES.SCREEN]="screen",b[a.BLEND_MODES.OVERLAY]="overlay",b[a.BLEND_MODES.DARKEN]="darken",b[a.BLEND_MODES.LIGHTEN]="lighten",b[a.BLEND_MODES.COLOR_DODGE]="color-dodge",b[a.BLEND_MODES.COLOR_BURN]="color-burn",b[a.BLEND_MODES.HARD_LIGHT]="hard-light",b[a.BLEND_MODES.SOFT_LIGHT]="soft-light",b[a.BLEND_MODES.DIFFERENCE]="difference",b[a.BLEND_MODES.EXCLUSION]="exclusion",b[a.BLEND_MODES.HUE]="hue",b[a.BLEND_MODES.SATURATION]="saturate",b[a.BLEND_MODES.COLOR]=
"color",b[a.BLEND_MODES.LUMINOSITY]="luminosity"):(b[a.BLEND_MODES.NORMAL]="source-over",b[a.BLEND_MODES.ADD]="lighter",b[a.BLEND_MODES.MULTIPLY]="source-over",b[a.BLEND_MODES.SCREEN]="source-over",b[a.BLEND_MODES.OVERLAY]="source-over",b[a.BLEND_MODES.DARKEN]="source-over",b[a.BLEND_MODES.LIGHTEN]="source-over",b[a.BLEND_MODES.COLOR_DODGE]="source-over",b[a.BLEND_MODES.COLOR_BURN]="source-over",b[a.BLEND_MODES.HARD_LIGHT]="source-over",b[a.BLEND_MODES.SOFT_LIGHT]="source-over",b[a.BLEND_MODES.DIFFERENCE]=
"source-over",b[a.BLEND_MODES.EXCLUSION]="source-over",b[a.BLEND_MODES.HUE]="source-over",b[a.BLEND_MODES.SATURATION]="source-over",b[a.BLEND_MODES.COLOR]="source-over",b[a.BLEND_MODES.LUMINOSITY]="source-over");return b}},{"../../../const":78,"./canUseNewCanvasBlendModes":112}],114:[function(b,c,f){function a(a){this.renderer=a;this.checkCount=this.count=0;this.maxIdle=3600;this.checkCountMax=600;this.mode=e.GC_MODES.DEFAULT}var e=b("../../const");a.prototype.constructor=a;c.exports=a;a.prototype.update=
function(){this.count++;this.mode!==e.GC_MODES.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))};a.prototype.run=function(){var a=this.renderer.textureManager,b=a._managedTextures,c=!1,d;for(d=0;d<b.length;d++){var k=b[d];!k._glRenderTargets&&this.count-k.touched>this.maxIdle&&(a.destroyTexture(k,!0),b[d]=null,c=!0)}if(c){for(d=a=0;d<b.length;d++)null!==b[d]&&(b[a++]=b[d]);b.length=a}};a.prototype.unload=function(a){var b=this.renderer.textureManager;
a._texture&&b.destroyTexture(a._texture,!0);for(b=a.children.length-1;0<=b;b--)this.unload(a.children[b])}},{"../../const":78}],115:[function(b,c,f){var a=b("pixi-gl-core").GLTexture,e=b("../../const"),h=b("./utils/RenderTarget"),g=b("../../utils");b=function(a){this.renderer=a;this.gl=a.gl;this._managedTextures=[]};b.prototype.bindTexture=function(){};b.prototype.getTexture=function(){};b.prototype.updateTexture=function(b){b=b.baseTexture||b;var c=!!b._glRenderTargets;if(b.hasLoaded){var g=b._glTextures[this.renderer.CONTEXT_UID];
g?c?b._glRenderTargets[this.renderer.CONTEXT_UID].resize(b.width,b.height):g.upload(b.source):(c?(c=new h(this.gl,b.width,b.height,b.scaleMode,b.resolution),c.resize(b.width,b.height),b._glRenderTargets[this.renderer.CONTEXT_UID]=c,g=c.texture):(g=new a(this.gl),g.premultiplyAlpha=!0,g.upload(b.source)),b._glTextures[this.renderer.CONTEXT_UID]=g,b.on("update",this.updateTexture,this),b.on("dispose",this.destroyTexture,this),this._managedTextures.push(b),b.isPowerOfTwo?(b.mipmap&&g.enableMipmap(),
b.wrapMode===e.WRAP_MODES.CLAMP?g.enableWrapClamp():b.wrapMode===e.WRAP_MODES.REPEAT?g.enableWrapRepeat():g.enableWrapMirrorRepeat()):g.enableWrapClamp(),b.scaleMode===e.SCALE_MODES.NEAREST?g.enableNearestScaling():g.enableLinearScaling());return g}};b.prototype.destroyTexture=function(a,b){a=a.baseTexture||a;if(a.hasLoaded&&a._glTextures[this.renderer.CONTEXT_UID]&&(a._glTextures[this.renderer.CONTEXT_UID].destroy(),a.off("update",this.updateTexture,this),a.off("dispose",this.destroyTexture,this),
delete a._glTextures[this.renderer.CONTEXT_UID],!b)){var c=this._managedTextures.indexOf(a);-1!==c&&g.removeItems(this._managedTextures,c,1)}};b.prototype.removeAll=function(){for(var a=0;a<this._managedTextures.length;++a){var b=this._managedTextures[a];b._glTextures[this.renderer.CONTEXT_UID]&&delete b._glTextures[this.renderer.CONTEXT_UID]}};b.prototype.destroy=function(){for(var a=0;a<this._managedTextures.length;++a){var b=this._managedTextures[a];this.destroyTexture(b,!0);b.off("update",this.updateTexture,
this);b.off("dispose",this.destroyTexture,this)}this._managedTextures=null};c.exports=b},{"../../const":78,"../../utils":151,"./utils/RenderTarget":128,"pixi-gl-core":7}],116:[function(b,c,f){function a(a,b,c){c=c||{};e.call(this,"WebGL",a,b,c);this.type=u.RENDERER_TYPE.WEBGL;this.handleContextLost=this.handleContextLost.bind(this);this.handleContextRestored=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.handleContextLost,!1);this.view.addEventListener("webglcontextrestored",
this.handleContextRestored,!1);this._contextOptions={alpha:this.transparent,antialias:c.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:c.preserveDrawingBuffer};this._backgroundColorRgba[3]=this.transparent?0:1;this.maskManager=new h(this);this.stencilManager=new g(this);this.currentRenderer=this.emptyRenderer=new k(this);this.initPlugins();c.context&&q(c.context);this.gl=c.context||v(this.view,this._contextOptions);this.CONTEXT_UID=
y++;this.state=new r(this.gl);this.renderingToScreen=!0;this._initContext();this.filterManager=new m(this);this.drawModes=t(this.gl);this._activeRenderTarget=this._activeShader=null;this._activeTextureLocation=999;this._activeTexture=null;this.setBlendMode(0)}var e=b("../SystemRenderer"),h=b("./managers/MaskManager"),g=b("./managers/StencilManager"),m=b("./managers/FilterManager"),n=b("./utils/RenderTarget"),k=b("./utils/ObjectRenderer"),p=b("./TextureManager"),z=b("./TextureGarbageCollector"),r=
b("./WebGLState"),v=b("pixi-gl-core").createContext,t=b("./utils/mapWebGLDrawModesToPixi"),q=b("./utils/validateContext");f=b("../../utils");var w=b("pixi-gl-core"),u=b("../../const"),y=0;a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;f.pluginTarget.mixin(a);a.prototype._initContext=function(){var a=this.gl;this.textureManager=new p(this);this.textureGC=new z(this);this.state.resetToDefault();this.rootRenderTarget=new n(a,this.width,this.height,null,this.resolution,!0);
this.rootRenderTarget.clearColor=this._backgroundColorRgba;this.bindRenderTarget(this.rootRenderTarget);this.emit("context",a);this.resize(this.width,this.height)};a.prototype.render=function(a,b,c,g,h){this.renderingToScreen=!b;this.emit("prerender");this.gl&&!this.gl.isContextLost()&&(b||(this._lastObjectRendered=a),h||(h=a.parent,a.parent=this._tempDisplayObjectParent,a.updateTransform(),a.parent=h),this.bindRenderTexture(b,g),this.currentRenderer.start(),(void 0!==c?c:this.clearBeforeRender)&&
this._activeRenderTarget.clear(),a.renderWebGL(this),this.currentRenderer.flush(),this.textureGC.update(),this.emit("postrender"))};a.prototype.setObjectRenderer=function(a){this.currentRenderer!==a&&(this.currentRenderer.stop(),this.currentRenderer=a,this.currentRenderer.start())};a.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)};a.prototype.resize=function(a,b){e.prototype.resize.call(this,a,b);this.rootRenderTarget.resize(a,b);this._activeRenderTarget===this.rootRenderTarget&&
(this.rootRenderTarget.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=this.rootRenderTarget.projectionMatrix.toArray(!0)))};a.prototype.setBlendMode=function(a){this.state.setBlendMode(a)};a.prototype.clear=function(a){this._activeRenderTarget.clear(a)};a.prototype.setTransform=function(a){this._activeRenderTarget.transform=a};a.prototype.bindRenderTexture=function(a,b){var c;if(a){c=a.baseTexture;var g=this.gl;c._glRenderTargets[this.CONTEXT_UID]?(this._activeTextureLocation=
c._id,g.activeTexture(g.TEXTURE0+c._id)):this.textureManager.updateTexture(c);g.bindTexture(g.TEXTURE_2D,null);c=c._glRenderTargets[this.CONTEXT_UID];c.setFrame(a.frame)}else c=this.rootRenderTarget;c.transform=b;this.bindRenderTarget(c);return this};a.prototype.bindRenderTarget=function(a){a!==this._activeRenderTarget&&(this._activeRenderTarget=a,a.activate(),this._activeShader&&(this._activeShader.uniforms.projectionMatrix=a.projectionMatrix.toArray(!0)),this.stencilManager.setMaskStack(a.stencilMaskStack));
return this};a.prototype.bindShader=function(a){this._activeShader!==a&&(this._activeShader=a,a.bind(),a.uniforms.projectionMatrix=this._activeRenderTarget.projectionMatrix.toArray(!0));return this};a.prototype.bindTexture=function(a,b){a=a.baseTexture||a;var c=this.gl;b=b||0;this._activeTextureLocation!==b&&(this._activeTextureLocation=b,c.activeTexture(c.TEXTURE0+b));this._activeTexture=a;a._glTextures[this.CONTEXT_UID]?(a.touched=this.textureGC.count,a._glTextures[this.CONTEXT_UID].bind()):this.textureManager.updateTexture(a);
return this};a.prototype.createVao=function(){return new w.VertexArrayObject(this.gl,this.state.attribState)};a.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer);this._activeShader=null;this._activeRenderTarget=this.rootRenderTarget;this._activeTextureLocation=999;this._activeTexture=null;this.rootRenderTarget.activate();this.state.resetToDefault();return this};a.prototype.handleContextLost=function(a){a.preventDefault()};a.prototype.handleContextRestored=function(){this._initContext();
this.textureManager.removeAll()};a.prototype.destroy=function(a){this.destroyPlugins();this.view.removeEventListener("webglcontextlost",this.handleContextLost);this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);this.textureManager.destroy();e.prototype.destroy.call(this,a);this.uid=0;this.maskManager.destroy();this.stencilManager.destroy();this.filterManager.destroy();this._contextOptions=this.handleContextRestored=this.handleContextLost=this.currentRenderer=this.textureManager=
this.filterManager=this.maskManager=null;this.gl.useProgram(null);this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext();this.gl=null}},{"../../const":78,"../../utils":151,"../SystemRenderer":108,"./TextureGarbageCollector":114,"./TextureManager":115,"./WebGLState":117,"./managers/FilterManager":122,"./managers/MaskManager":123,"./managers/StencilManager":124,"./utils/ObjectRenderer":126,"./utils/RenderTarget":128,"./utils/mapWebGLDrawModesToPixi":131,
"./utils/validateContext":132,"pixi-gl-core":7}],117:[function(b,c,f){function a(a){this.activeState=new Uint8Array(16);this.defaultState=new Uint8Array(16);this.defaultState[0]=1;this.stackIndex=0;this.stack=[];this.gl=a;this.maxAttribs=a.getParameter(a.MAX_VERTEX_ATTRIBS);this.attribState={tempAttribState:Array(this.maxAttribs),attribState:Array(this.maxAttribs)};this.blendModes=e(a);this.nativeVaoExtension=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||
a.getExtension("WEBKIT_OES_vertex_array_object")}var e=b("./utils/mapWebGLBlendModesToPixi");a.prototype.push=function(){var a=this.stack[++this.stackIndex];a||(a=this.stack[this.stackIndex]=new Uint8Array(16));for(var b=0;b<this.activeState.length;b++)this.activeState[b]=a[b]};a.prototype.pop=function(){var a=this.stack[--this.stackIndex];this.setState(a)};a.prototype.setState=function(a){this.setBlend(a[0]);this.setDepthTest(a[1]);this.setFrontFace(a[2]);this.setCullFace(a[3]);this.setBlendMode(a[4])};
a.prototype.setBlend=function(a){if(!(this.activeState[0]===a|0)){this.activeState[0]=a|0;var b=this.gl;a?b.enable(b.BLEND):b.disable(b.BLEND)}};a.prototype.setBlendMode=function(a){a!==this.activeState[4]&&(this.activeState[4]=a,this.gl.blendFunc(this.blendModes[a][0],this.blendModes[a][1]))};a.prototype.setDepthTest=function(a){if(!(this.activeState[1]===a|0)){this.activeState[1]=a|0;var b=this.gl;a?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST)}};a.prototype.setCullFace=function(a){if(!(this.activeState[3]===
a|0)){this.activeState[3]=a|0;var b=this.gl;a?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE)}};a.prototype.setFrontFace=function(a){if(!(this.activeState[2]===a|0)){this.activeState[2]=a|0;var b=this.gl;a?b.frontFace(b.CW):b.frontFace(b.CCW)}};a.prototype.resetAttributes=function(){var a;for(a=0;a<this.attribState.tempAttribState.length;a++)this.attribState.tempAttribState[a]=0;for(a=0;a<this.attribState.attribState.length;a++)this.attribState.attribState[a]=0;var b=this.gl;for(a=1;a<this.maxAttribs;a++)b.disableVertexAttribArray(a)};
a.prototype.resetToDefault=function(){this.nativeVaoExtension&&this.nativeVaoExtension.bindVertexArrayOES(null);this.resetAttributes();for(var a=0;a<this.activeState.length;a++)this.activeState[a]=32;a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);this.setState(this.defaultState)};c.exports=a},{"./utils/mapWebGLBlendModesToPixi":130}],118:[function(b,c,f){function a(b,c,d){this.vertexSrc=b||a.defaultVertexSrc;this.fragmentSrc=c||a.defaultFragmentSrc;this.blendMode=g.BLEND_MODES.NORMAL;this.uniformData=
d||e(this.vertexSrc,this.fragmentSrc,"projectionMatrix|uSampler");this.uniforms={};for(var f in this.uniformData)this.uniforms[f]=this.uniformData[f].value;this.glShaders=[];m[this.vertexSrc+this.fragmentSrc]||(m[this.vertexSrc+this.fragmentSrc]=h.uid());this.glShaderKey=m[this.vertexSrc+this.fragmentSrc];this.padding=4;this.resolution=1;this.enabled=!0}var e=b("./extractUniformsFromSrc"),h=b("../../../utils"),g=b("../../../const"),m={};c.exports=a;a.prototype.apply=function(a,b,c,g){a.applyFilter(this,
b,c,g)};a.defaultVertexSrc="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord ;\n}";a.defaultFragmentSrc="varying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\nuniform sampler2D uSampler;\nuniform sampler2D filterSampler;\nvoid main(void){\n   vec4 masky = texture2D(filterSampler, vFilterCoord);\n   vec4 sample = texture2D(uSampler, vTextureCoord);\n   vec4 color;\n   if(mod(vFilterCoord.x, 1.0) > 0.5)\n   {\n     color = vec4(1.0, 0.0, 0.0, 1.0);\n   }\n   else\n   {\n     color = vec4(0.0, 1.0, 0.0, 1.0);\n   }\n   gl_FragColor = mix(sample, masky, 0.5);\n   gl_FragColor *= sample.a;\n}"},
{"../../../const":78,"../../../utils":151,"./extractUniformsFromSrc":119}],119:[function(b,c,f){function a(a){var b=/^(projectionMatrix|uSampler|filterArea)$/,c={},d;a=a.replace(/\s+/g," ").split(/\s*;\s*/);for(var k=0;k<a.length;k++){var p=a[k].trim();if(-1<p.indexOf("uniform")){d=p.split(" ");var p=d[1],f=d[2],r=1;-1<f.indexOf("[")&&(d=f.split(/\[|\]/),f=d[0],r*=Number(d[1]));f.match(b)||(c[f]={value:e(p,r),name:f,type:p})}}return c}var e=b("pixi-gl-core").shader.defaultValue;c.exports=function(b,
c,m){b=a(b,m);c=a(c,m);return Object.assign(b,c)}},{"pixi-gl-core":7}],120:[function(b,c,f){var a=b("../../../math");c.exports={calculateScreenSpaceMatrix:function(a,b,c){a=a.identity();a.translate(b.x/c.width,b.y/c.height);a.scale(c.width,c.height);return a},calculateNormalizedScreenSpaceMatrix:function(a,b,c){a=a.identity();a.translate(b.x/c.width,b.y/c.height);a.scale(c.width/b.width,c.height/b.height);return a},calculateSpriteMatrix:function(b,c,g,m){var d=m.worldTransform.copy(a.Matrix.TEMP_MATRIX),
k=m._texture.baseTexture;b=b.identity();var p=g.height/g.width;b.translate(c.x/g.width,c.y/g.height);b.scale(1,p);c=g.width/k.width;g=g.height/k.height;d.tx/=k.width*c;d.ty/=k.width*c;d.invert();b.prepend(d);b.scale(1,1/p);b.scale(c,g);b.translate(m.anchor.x,m.anchor.y);return b}}},{"../../../math":102}],121:[function(b,c,f){function a(a){var b=new h.Matrix;e.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",
"#define GLSLIFY 1\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n");
a.renderable=!1;this.maskSprite=a;this.maskMatrix=b}var e=b("../Filter"),h=b("../../../../math");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.apply=function(a,b,c){var k=this.maskSprite;this.uniforms.mask=k._texture;this.uniforms.otherMatrix=a.calculateSpriteMatrix(this.maskMatrix,k);this.uniforms.alpha=k.worldAlpha;a.applyFilter(this,b,c)}},{"../../../../math":102,"../Filter":118}],122:[function(b,c,f){function a(a){e.call(this,a);this.gl=this.renderer.gl;
this.quad=new g(this.gl,a.state.attribState);this.shaderCache={};this.pool={};this.filterData=null}var e=b("./WebGLManager"),h=b("../utils/RenderTarget"),g=b("../utils/Quad"),m=b("../../../math"),n=b("../../../Shader"),k=b("../filters/filterTransforms"),p=b("bit-twiddle"),z=function(){this.renderTarget=null;this.sourceFrame=new m.Rectangle;this.destinationFrame=new m.Rectangle;this.filters=[];this.target=null;this.resolution=1};a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=
a;a.prototype.pushFilter=function(a,b){var c=this.renderer,g=this.filterData;if(!g){var m=new z;m.sourceFrame=m.destinationFrame=this.renderer._activeRenderTarget.size;m.renderTarget=c._activeRenderTarget;this.filterData=this.renderer._activeRenderTarget.filterData=g={index:0,stack:[m]}}(m=g.stack[++g.index])||(m=g.stack[g.index]=new z);var k=b[0].resolution,d=b[0].padding,h=a.filterArea||a.getBounds(!0),e=m.sourceFrame,p=m.destinationFrame;e.x=(h.x*k|0)/k;e.y=(h.y*k|0)/k;e.width=(h.width*k|0)/k;
e.height=(h.height*k|0)/k;g.stack[0].renderTarget.transform||e.fit(g.stack[0].destinationFrame);e.pad(d);p.width=e.width;p.height=e.height;g=this.getPotRenderTarget(c.gl,e.width,e.height,k);m.target=a;m.filters=b;m.resolution=k;m.renderTarget=g;g.setFrame(p,e);c.bindRenderTarget(g);c.clear()};a.prototype.popFilter=function(){var a=this.filterData,b=a.stack[a.index-1],c=a.stack[a.index];this.quad.map(c.renderTarget.size,c.sourceFrame).upload();var g=c.filters;if(1===g.length)g[0].apply(this,c.renderTarget,
b.renderTarget,!1),this.freePotRenderTarget(c.renderTarget);else{var m=c.renderTarget,k=this.getPotRenderTarget(this.renderer.gl,c.sourceFrame.width,c.sourceFrame.height,1);k.setFrame(c.destinationFrame,c.sourceFrame);for(c=0;c<g.length-1;c++){g[c].apply(this,m,k,!0);var d=m,m=k,k=d}g[c].apply(this,m,b.renderTarget,!1);this.freePotRenderTarget(m);this.freePotRenderTarget(k)}a.index--;0===a.index&&(this.filterData=null)};a.prototype.applyFilter=function(a,b,c,g){var m=this.renderer,k=a.glShaders[m.CONTEXT_UID];
k||(a.glShaderKey?(k=this.shaderCache[a.glShaderKey])||(k=a.glShaders[m.CONTEXT_UID]=this.shaderCache[a.glShaderKey]=new n(this.gl,a.vertexSrc,a.fragmentSrc)):k=a.glShaders[m.CONTEXT_UID]=new n(this.gl,a.vertexSrc,a.fragmentSrc),this.quad.initVao(k));m.bindRenderTarget(c);g&&(g=m.gl,g.disable(g.SCISSOR_TEST),m.clear(),g.enable(g.SCISSOR_TEST));c===m.maskManager.scissorRenderTarget&&m.maskManager.pushScissorMask(null,m.maskManager.scissorData);m.bindShader(k);this.syncUniforms(k,a);b.texture.bind(0);
m._activeTextureLocation=0;m.state.setBlendMode(a.blendMode);this.quad.draw()};a.prototype.syncUniforms=function(a,b){var c=b.uniformData,g=b.uniforms,m=1,k;if(a.uniforms.data.filterArea){k=this.filterData.stack[this.filterData.index];var d=a.uniforms.filterArea;d[0]=k.renderTarget.size.width;d[1]=k.renderTarget.size.height;d[2]=k.sourceFrame.x;d[3]=k.sourceFrame.y;a.uniforms.filterArea=d}a.uniforms.data.filterClamp&&(k=this.filterData.stack[this.filterData.index],d=a.uniforms.filterClamp,d[0]=.5/
k.renderTarget.size.width,d[1]=.5/k.renderTarget.size.height,d[2]=(k.sourceFrame.width-.5)/k.renderTarget.size.width,d[3]=(k.sourceFrame.height-.5)/k.renderTarget.size.height,a.uniforms.filterClamp=d);for(var h in c)"sampler2D"===c[h].type?(a.uniforms[h]=m,g[h].baseTexture?this.renderer.bindTexture(g[h].baseTexture,m):(k=this.renderer.gl,this.renderer._activeTextureLocation=k.TEXTURE0+m,k.activeTexture(k.TEXTURE0+m),g[h].texture.bind()),m++):"mat3"===c[h].type?a.uniforms[h]=void 0!==g[h].a?g[h].toArray(!0):
g[h]:"vec2"===c[h].type?void 0!==g[h].x?(k=a.uniforms[h]||new Float32Array(2),k[0]=g[h].x,k[1]=g[h].y,a.uniforms[h]=k):a.uniforms[h]=g[h]:"float"===c[h].type?a.uniforms.data[h].value!==c[h]&&(a.uniforms[h]=g[h]):a.uniforms[h]=g[h]};a.prototype.getRenderTarget=function(a,b){var c=this.filterData.stack[this.filterData.index],g=this.getPotRenderTarget(this.renderer.gl,c.sourceFrame.width,c.sourceFrame.height,b||c.resolution);g.setFrame(c.destinationFrame,c.sourceFrame);return g};a.prototype.returnRenderTarget=
function(a){return this.freePotRenderTarget(a)};a.prototype.calculateScreenSpaceMatrix=function(a){var b=this.filterData.stack[this.filterData.index];return k.calculateScreenSpaceMatrix(a,b.sourceFrame,b.renderTarget.size)};a.prototype.calculateNormalizedScreenSpaceMatrix=function(a){var b=this.filterData.stack[this.filterData.index];return k.calculateNormalizedScreenSpaceMatrix(a,b.sourceFrame,b.renderTarget.size,b.destinationFrame)};a.prototype.calculateSpriteMatrix=function(a,b){var c=this.filterData.stack[this.filterData.index];
return k.calculateSpriteMatrix(a,c.sourceFrame,c.renderTarget.size,b)};a.prototype.destroy=function(){this.shaderCache=[];this.emptyPool()};a.prototype.getPotRenderTarget=function(a,b,c,g){b=p.nextPow2(b*g);c=p.nextPow2(c*g);var m=(b&65535)<<16|c&65535;this.pool[m]||(this.pool[m]=[]);a=this.pool[m].pop()||new h(a,b,c,null,1);a.resolution=g;a.defaultFrame.width=a.size.width=b/g;a.defaultFrame.height=a.size.height=c/g;return a};a.prototype.emptyPool=function(){for(var a in this.pool){var b=this.pool[a];
if(b)for(var c=0;c<b.length;c++)b[c].destroy(!0)}this.pool={}};a.prototype.freePotRenderTarget=function(a){this.pool[(a.size.width*a.resolution&65535)<<16|a.size.height*a.resolution&65535].push(a)}},{"../../../Shader":77,"../../../math":102,"../filters/filterTransforms":120,"../utils/Quad":127,"../utils/RenderTarget":128,"./WebGLManager":125,"bit-twiddle":30}],123:[function(b,c,f){function a(a){e.call(this,a);this.scissor=!1;this.scissorRenderTarget=this.scissorData=null;this.enableScissor=!0;this.alphaMaskPool=
[];this.alphaMaskIndex=0}var e=b("./WebGLManager"),h=b("../filters/spriteMask/SpriteMaskFilter");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.pushMask=function(a,b){if(b.texture)this.pushSpriteMask(a,b);else if(this.enableScissor&&!this.scissor&&!this.renderer.stencilManager.stencilMaskStack.length&&b.isFastRect()){var c=b.worldTransform,c=Math.atan2(c.b,c.a),c=Math.round(180/Math.PI*c);c%90?this.pushStencilMask(b):this.pushScissorMask(a,b)}else this.pushStencilMask(b)};
a.prototype.popMask=function(a,b){b.texture?this.popSpriteMask(a,b):this.enableScissor&&!this.renderer.stencilManager.stencilMaskStack.length?this.popScissorMask(a,b):this.popStencilMask(a,b)};a.prototype.pushSpriteMask=function(a,b){var c=this.alphaMaskPool[this.alphaMaskIndex];c||(c=this.alphaMaskPool[this.alphaMaskIndex]=[new h(b)]);c[0].resolution=this.renderer.resolution;c[0].maskSprite=b;a.filterArea=b.getBounds(!0);this.renderer.filterManager.pushFilter(a,c);this.alphaMaskIndex++};a.prototype.popSpriteMask=
function(){this.renderer.filterManager.popFilter();this.alphaMaskIndex--};a.prototype.pushStencilMask=function(a){this.renderer.currentRenderer.stop();this.renderer.stencilManager.pushStencil(a)};a.prototype.popStencilMask=function(){this.renderer.currentRenderer.stop();this.renderer.stencilManager.popStencil()};a.prototype.pushScissorMask=function(a,b){b.renderable=!0;var c=this.renderer._activeRenderTarget,k=b.getBounds();k.fit(c.size);b.renderable=!1;this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);
var d=this.renderer.resolution;this.renderer.gl.scissor(k.x*d,(c.root?c.size.height-k.y-k.height:k.y)*d,k.width*d,k.height*d);this.scissorRenderTarget=c;this.scissorData=b;this.scissor=!0};a.prototype.popScissorMask=function(){this.scissorData=this.scissorRenderTarget=null;this.scissor=!1;var a=this.renderer.gl;a.disable(a.SCISSOR_TEST)}},{"../filters/spriteMask/SpriteMaskFilter":121,"./WebGLManager":125}],124:[function(b,c,f){function a(a){e.call(this,a);this.stencilMaskStack=null}var e=b("./WebGLManager");
a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.setMaskStack=function(a){this.stencilMaskStack=a;var b=this.renderer.gl;0===a.length?b.disable(b.STENCIL_TEST):b.enable(b.STENCIL_TEST)};a.prototype.pushStencil=function(a){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);this.renderer._activeRenderTarget.attachStencilBuffer();var b=this.renderer.gl,c=this.stencilMaskStack;0===c.length&&(b.enable(b.STENCIL_TEST),b.clear(b.STENCIL_BUFFER_BIT),b.stencilFunc(b.ALWAYS,
1,1));c.push(a);b.colorMask(!1,!1,!1,!1);b.stencilOp(b.KEEP,b.KEEP,b.INCR);this.renderer.plugins.graphics.render(a);b.colorMask(!0,!0,!0,!0);b.stencilFunc(b.NOTEQUAL,0,c.length);b.stencilOp(b.KEEP,b.KEEP,b.KEEP)};a.prototype.popStencil=function(){this.renderer.setObjectRenderer(this.renderer.plugins.graphics);var a=this.renderer.gl,b=this.stencilMaskStack,c=b.pop();0===b.length?a.disable(a.STENCIL_TEST):(a.colorMask(!1,!1,!1,!1),a.stencilOp(a.KEEP,a.KEEP,a.DECR),this.renderer.plugins.graphics.render(c),
a.colorMask(!0,!0,!0,!0),a.stencilFunc(a.NOTEQUAL,0,b.length),a.stencilOp(a.KEEP,a.KEEP,a.KEEP))};a.prototype.destroy=function(){e.prototype.destroy.call(this);this.stencilMaskStack.stencilStack=null}},{"./WebGLManager":125}],125:[function(b,c,f){function a(a){this.renderer=a;this.renderer.on("context",this.onContextChange,this)}a.prototype.constructor=a;c.exports=a;a.prototype.onContextChange=function(){};a.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this);this.renderer=
null}},{}],126:[function(b,c,f){function a(a){e.call(this,a)}var e=b("../managers/WebGLManager");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.start=function(){};a.prototype.stop=function(){this.flush()};a.prototype.flush=function(){};a.prototype.render=function(a){}},{"../managers/WebGLManager":125}],127:[function(b,c,f){function a(a,b){this.gl=a;this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]);this.uvs=new Float32Array([0,0,1,0,1,1,0,1]);this.interleaved=
new Float32Array(16);for(var c=0;4>c;c++)this.interleaved[4*c]=this.vertices[2*c],this.interleaved[4*c+1]=this.vertices[2*c+1],this.interleaved[4*c+2]=this.uvs[2*c],this.interleaved[4*c+3]=this.uvs[2*c+1];this.indices=h(1);this.vertexBuffer=e.GLBuffer.createVertexBuffer(a,this.interleaved,a.STATIC_DRAW);this.indexBuffer=e.GLBuffer.createIndexBuffer(a,this.indices,a.STATIC_DRAW);this.vao=new e.VertexArrayObject(a,b)}var e=b("pixi-gl-core"),h=b("../../../utils/createIndicesForQuads");a.prototype.constructor=
a;a.prototype.initVao=function(a){this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer,a.attributes.aVertexPosition,this.gl.FLOAT,!1,16,0).addAttribute(this.vertexBuffer,a.attributes.aTextureCoord,this.gl.FLOAT,!1,16,8)};a.prototype.map=function(a,b){var c=0,k=0;this.uvs[0]=c;this.uvs[1]=k;this.uvs[2]=c+b.width/a.width;this.uvs[3]=k;this.uvs[4]=c+b.width/a.width;this.uvs[5]=k+b.height/a.height;this.uvs[6]=c;this.uvs[7]=k+b.height/a.height;c=b.x;k=b.y;this.vertices[0]=c;this.vertices[1]=
k;this.vertices[2]=c+b.width;this.vertices[3]=k;this.vertices[4]=c+b.width;this.vertices[5]=k+b.height;this.vertices[6]=c;this.vertices[7]=k+b.height;return this};a.prototype.draw=function(){this.vao.bind().draw(this.gl.TRIANGLES,6,0).unbind();return this};a.prototype.upload=function(){for(var a=0;4>a;a++)this.interleaved[4*a]=this.vertices[2*a],this.interleaved[4*a+1]=this.vertices[2*a+1],this.interleaved[4*a+2]=this.uvs[2*a],this.interleaved[4*a+3]=this.uvs[2*a+1];this.vertexBuffer.upload(this.interleaved);
return this};a.prototype.destroy=function(){var a=this.gl;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.indexBuffer)};c.exports=a},{"../../../utils/createIndicesForQuads":149,"pixi-gl-core":7}],128:[function(b,c,f){var a=b("../../../math"),e=b("../../../const"),h=b("pixi-gl-core").GLFramebuffer;b=function(b,c,d,k,p,f){this.gl=b;this.texture=this.frameBuffer=null;this.clearColor=[0,0,0,0];this.size=new a.Rectangle(0,0,1,1);this.resolution=p||e.RESOLUTION;this.projectionMatrix=new a.Matrix;
this.frame=this.transform=null;this.defaultFrame=new a.Rectangle;this.stencilBuffer=this.sourceFrame=this.destinationFrame=null;this.stencilMaskStack=[];this.filterData=null;this.scaleMode=k||e.SCALE_MODES.DEFAULT;(this.root=f)?(this.frameBuffer=new h(b,100,100),this.frameBuffer.framebuffer=null):(this.frameBuffer=h.createRGBA(b,100,100),this.scaleMode===e.SCALE_MODES.NEAREST?this.frameBuffer.texture.enableNearestScaling():this.frameBuffer.texture.enableLinearScaling(),this.texture=this.frameBuffer.texture);
this.setFrame();this.resize(c,d)};b.prototype.constructor=b;c.exports=b;b.prototype.clear=function(a){a=a||this.clearColor;this.frameBuffer.clear(a[0],a[1],a[2],a[3])};b.prototype.attachStencilBuffer=function(){this.root||this.frameBuffer.enableStencil()};b.prototype.setFrame=function(a,b){this.destinationFrame=a||this.destinationFrame||this.defaultFrame;this.sourceFrame=b||this.sourceFrame||a};b.prototype.activate=function(){var a=this.gl;this.frameBuffer.bind();this.calculateProjection(this.destinationFrame,
this.sourceFrame);this.transform&&this.projectionMatrix.append(this.transform);this.destinationFrame!==this.sourceFrame?(a.enable(a.SCISSOR_TEST),a.scissor(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)):a.disable(a.SCISSOR_TEST);a.viewport(this.destinationFrame.x|0,this.destinationFrame.y|0,this.destinationFrame.width*this.resolution|0,this.destinationFrame.height*this.resolution|0)};b.prototype.calculateProjection=
function(a,b){var c=this.projectionMatrix;b=b||a;c.identity();this.root?(c.a=1/a.width*2,c.d=-1/a.height*2,c.tx=-1-b.x*c.a,c.ty=1-b.y*c.d):(c.a=1/a.width*2,c.d=1/a.height*2,c.tx=-1-b.x*c.a,c.ty=-1-b.y*c.d)};b.prototype.resize=function(a,b){a|=0;b|=0;if(this.size.width!==a||this.size.height!==b)this.size.width=a,this.size.height=b,this.defaultFrame.width=a,this.defaultFrame.height=b,this.frameBuffer.resize(a*this.resolution,b*this.resolution),this.calculateProjection(this.frame||this.size)};b.prototype.destroy=
function(){this.frameBuffer.destroy();this.texture=this.frameBuffer=null}},{"../../../const":78,"../../../math":102,"pixi-gl-core":7}],129:[function(b,c,f){function a(a){for(var b="",c=0;c<a;c++)0<c&&(b+="\nelse "),c<a-1&&(b+="if(test == "+c+".0){}");return b}var e=b("pixi-gl-core");c.exports=function(b,c){var d=!c;if(d){var f=document.createElement("canvas");f.width=1;f.height=1;c=e.createContext(f)}for(f=c.createShader(c.FRAGMENT_SHADER);;){var k="precision mediump float;\nvoid main(void){\nfloat test = 0.1;\n%forloop%\ngl_FragColor = vec4(0.0);\n}".replace(/%forloop%/gi,
a(b));c.shaderSource(f,k);c.compileShader(f);if(c.getShaderParameter(f,c.COMPILE_STATUS))break;else b=b/2|0}d&&c.getExtension("WEBGL_lose_context")&&c.getExtension("WEBGL_lose_context").loseContext();return b}},{"pixi-gl-core":7}],130:[function(b,c,f){var a=b("../../../const");c.exports=function(b,c){c=c||[];c[a.BLEND_MODES.NORMAL]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.ADD]=[b.ONE,b.DST_ALPHA];c[a.BLEND_MODES.MULTIPLY]=[b.DST_COLOR,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.SCREEN]=[b.ONE,b.ONE_MINUS_SRC_COLOR];
c[a.BLEND_MODES.OVERLAY]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.DARKEN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.LIGHTEN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.COLOR_DODGE]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.COLOR_BURN]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.HARD_LIGHT]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.SOFT_LIGHT]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.DIFFERENCE]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.EXCLUSION]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];
c[a.BLEND_MODES.HUE]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.SATURATION]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.COLOR]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];c[a.BLEND_MODES.LUMINOSITY]=[b.ONE,b.ONE_MINUS_SRC_ALPHA];return c}},{"../../../const":78}],131:[function(b,c,f){var a=b("../../../const");c.exports=function(b,c){c=c||{};c[a.DRAW_MODES.POINTS]=b.POINTS;c[a.DRAW_MODES.LINES]=b.LINES;c[a.DRAW_MODES.LINE_LOOP]=b.LINE_LOOP;c[a.DRAW_MODES.LINE_STRIP]=b.LINE_STRIP;c[a.DRAW_MODES.TRIANGLES]=b.TRIANGLES;
c[a.DRAW_MODES.TRIANGLE_STRIP]=b.TRIANGLE_STRIP;c[a.DRAW_MODES.TRIANGLE_FAN]=b.TRIANGLE_FAN}},{"../../../const":78}],132:[function(b,c,f){c.exports=function(a){a.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")}},{}],133:[function(b,c,f){function a(a){g.call(this);this.anchor=new e.ObservablePoint(this.onAnchorUpdate,this);this._texture=null;this._height=this._width=0;this._tintRGB=this._tint=null;this.tint=16777215;
this.blendMode=n.BLEND_MODES.NORMAL;this.shader=null;this.cachedTint=16777215;this.texture=a||h.EMPTY;this.vertexData=new Float32Array(8);this.vertexTrimmedData=null;this._textureID=this._transformID=-1}var e=b("../math"),h=b("../textures/Texture"),g=b("../display/Container"),m=b("../utils"),n=b("../const"),k=new e.Point;a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture.orig.width},
set:function(a){var b=m.sign(this.scale.x)||1;this.scale.x=b*a/this.texture.orig.width;this._width=a}},height:{get:function(){return Math.abs(this.scale.y)*this.texture.orig.height},set:function(a){var b=m.sign(this.scale.y)||1;this.scale.y=b*a/this.texture.orig.height;this._height=a}},tint:{get:function(){return this._tint},set:function(a){this._tint=a;this._tintRGB=(a>>16)+(a&65280)+((a&255)<<16)}},texture:{get:function(){return this._texture},set:function(a){if(this._texture!==a&&(this._texture=
a,this.cachedTint=16777215,this._textureID=-1,a))if(a.baseTexture.hasLoaded)this._onTextureUpdate();else a.once("update",this._onTextureUpdate,this)}}});a.prototype._onTextureUpdate=function(){this._textureID=-1;this._width&&(this.scale.x=m.sign(this.scale.x)*this._width/this.texture.orig.width);this._height&&(this.scale.y=m.sign(this.scale.y)*this._height/this.texture.orig.height)};a.prototype.onAnchorUpdate=function(){this._transformID=-1};a.prototype.calculateVertices=function(){if(this._transformID!==
this.transform._worldID||this._textureID!==this._texture._updateID){this._transformID=this.transform._worldID;this._textureID=this._texture._updateID;var a=this._texture,b=this.transform.worldTransform,c=b.a,g=b.b,k=b.c,d=b.d,m=b.tx,b=b.ty,h=this.vertexData,e,f,n;f=a.trim;n=a.orig;f?(e=f.x-this.anchor._x*n.width,a=e+f.width,n=f.y-this.anchor._y*n.height,f=n+f.height):(a=n.width*(1-this.anchor._x),e=n.width*-this.anchor._x,f=n.height*(1-this.anchor._y),n=n.height*-this.anchor._y);h[0]=c*e+k*n+m;h[1]=
d*n+g*e+b;h[2]=c*a+k*n+m;h[3]=d*n+g*a+b;h[4]=c*a+k*f+m;h[5]=d*f+g*a+b;h[6]=c*e+k*f+m;h[7]=d*f+g*e+b}};a.prototype.calculateTrimmedVertices=function(){this.vertexTrimmedData||(this.vertexTrimmedData=new Float32Array(8));var a=this.vertexTrimmedData,b=this._texture.orig,c=this.transform.worldTransform,g=c.a,k=c.b,d=c.c,m=c.d,h=c.tx,c=c.ty,e,f,n;e=b.width*(1-this.anchor._x);f=b.width*-this.anchor._x;n=b.height*(1-this.anchor._y);b=b.height*-this.anchor._y;a[0]=g*f+d*b+h;a[1]=m*b+k*f+c;a[2]=g*e+d*b+h;
a[3]=m*b+k*e+c;a[4]=g*e+d*n+h;a[5]=m*n+k*e+c;a[6]=g*f+d*n+h;a[7]=m*n+k*f+c};a.prototype._renderWebGL=function(a){this.calculateVertices();a.setObjectRenderer(a.plugins.sprite);a.plugins.sprite.render(this)};a.prototype._renderCanvas=function(a){a.plugins.sprite.render(this)};a.prototype._calculateBounds=function(){var a=this._texture.trim,b=this._texture.orig;!a||a.width===b.width&&a.height===b.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),
this._bounds.addQuad(this.vertexTrimmedData))};a.prototype.getLocalBounds=function(a){return 0===this.children.length?(this._bounds.minX=-this._texture.orig.width*this.anchor._x,this._bounds.minY=-this._texture.orig.height*this.anchor._y,this._bounds.maxX=this._texture.orig.width,this._bounds.maxY=this._texture.orig.height,a||(this._localBoundsRect||(this._localBoundsRect=new e.Rectangle),a=this._localBoundsRect),this._bounds.getRectangle(a)):g.prototype.getLocalBounds.call(this,a)};a.prototype.containsPoint=
function(a){this.worldTransform.applyInverse(a,k);var b=this._texture.orig.width;a=this._texture.orig.height;var c=-b*this.anchor.x;return k.x>c&&k.x<c+b&&(b=-a*this.anchor.y,k.y>b&&k.y<b+a)?!0:!1};a.prototype.destroy=function(a){g.prototype.destroy.call(this,a);this.anchor=null;("boolean"===typeof a?a:a&&a.texture)&&this._texture.destroy(!!("boolean"===typeof a?a:a&&a.baseTexture));this.shader=this._texture=null};a.from=function(b){return new a(h.from(b))};a.fromFrame=function(b){var c=m.TextureCache[b];
if(!c)throw Error('The frameId "'+b+'" does not exist in the texture cache');return new a(c)};a.fromImage=function(b,c,g){return new a(h.fromImage(b,c,g))}},{"../const":78,"../display/Container":80,"../math":102,"../textures/Texture":144,"../utils":151}],134:[function(b,c,f){function a(a){this.renderer=a}f=b("../../renderers/canvas/CanvasRenderer");var e=b("../../const"),h=b("../../math"),g=new h.Matrix,m=b("./CanvasTinter");a.prototype.constructor=a;c.exports=a;f.registerPlugin("sprite",a);a.prototype.render=
function(a){var b=a._texture,c=this.renderer,d=a.transform.worldTransform,f,v,t=b._frame.width,q=b._frame.height;0>=b.orig.width||0>=b.orig.height||!b.baseTexture.source||(c.setBlendMode(a.blendMode),b.valid&&(c.context.globalAlpha=a.worldAlpha,f=b.baseTexture.scaleMode===e.SCALE_MODES.LINEAR,c.smoothProperty&&c.context[c.smoothProperty]!==f&&(c.context[c.smoothProperty]=f),b.trim?(f=b.trim.width/2+b.trim.x-a.anchor.x*b.orig.width,v=b.trim.height/2+b.trim.y-a.anchor.y*b.orig.height):(f=(.5-a.anchor.x)*
b.orig.width,v=(.5-a.anchor.y)*b.orig.height),b.rotate&&(d.copy(g),d=g,h.GroupD8.matrixAppendRotationInv(d,b.rotate,f,v),v=f=0),f-=t/2,v-=q/2,c.roundPixels?(c.context.setTransform(d.a,d.b,d.c,d.d,d.tx*c.resolution|0,d.ty*c.resolution|0),f|=0,v|=0):c.context.setTransform(d.a,d.b,d.c,d.d,d.tx*c.resolution,d.ty*c.resolution),d=b.baseTexture.resolution,16777215!==a.tint?(a.cachedTint!==a.tint&&(a.cachedTint=a.tint,a.tintedTexture=m.getTintedTexture(a,a.tint)),c.context.drawImage(a.tintedTexture,0,0,t*
d,q*d,f*c.resolution,v*c.resolution,t*c.resolution,q*c.resolution)):c.context.drawImage(b.baseTexture.source,b._frame.x*d,b._frame.y*d,t*d,q*d,f*c.resolution,v*c.resolution,t*c.resolution,q*c.resolution)))};a.prototype.destroy=function(){this.renderer=null}},{"../../const":78,"../../math":102,"../../renderers/canvas/CanvasRenderer":109,"./CanvasTinter":135}],135:[function(b,c,f){var a=b("../../utils");b=b("../../renderers/canvas/utils/canUseNewCanvasBlendModes");var e=c.exports={getTintedTexture:function(a,
b){var c=a.texture;b=e.roundColor(b);var d="#"+("00000"+(b|0).toString(16)).substr(-6);c.tintCache=c.tintCache||{};if(c.tintCache[d])return c.tintCache[d];var k=e.canvas||document.createElement("canvas");e.tintMethod(c,b,k);if(e.convertTintToImage){var f=new Image;f.src=k.toDataURL();c.tintCache[d]=f}else c.tintCache[d]=k,e.canvas=null;return k},tintWithMultiply:function(a,b,c){var d=c.getContext("2d"),k=a._frame.clone(),e=a.baseTexture.resolution;k.x*=e;k.y*=e;k.width*=e;k.height*=e;c.width=k.width;
c.height=k.height;d.fillStyle="#"+("00000"+(b|0).toString(16)).substr(-6);d.fillRect(0,0,k.width,k.height);d.globalCompositeOperation="multiply";d.drawImage(a.baseTexture.source,k.x,k.y,k.width,k.height,0,0,k.width,k.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,k.x,k.y,k.width,k.height,0,0,k.width,k.height)},tintWithOverlay:function(a,b,c){var d=c.getContext("2d"),k=a._frame.clone(),e=a.baseTexture.resolution;k.x*=e;k.y*=e;k.width*=e;k.height*=e;c.width=k.width;
c.height=k.height;d.globalCompositeOperation="copy";d.fillStyle="#"+("00000"+(b|0).toString(16)).substr(-6);d.fillRect(0,0,k.width,k.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,k.x,k.y,k.width,k.height,0,0,k.width,k.height)},tintWithPerPixel:function(b,c,d){var e=d.getContext("2d"),k=b._frame.clone(),f=b.baseTexture.resolution;k.x*=f;k.y*=f;k.width*=f;k.height*=f;d.width=k.width;d.height=k.height;e.globalCompositeOperation="copy";e.drawImage(b.baseTexture.source,
k.x,k.y,k.width,k.height,0,0,k.width,k.height);d=a.hex2rgb(c);b=d[0];c=d[1];d=d[2];for(var k=e.getImageData(0,0,k.width,k.height),f=k.data,z=0;z<f.length;z+=4)f[z+0]*=b,f[z+1]*=c,f[z+2]*=d;e.putImageData(k,0,0)},roundColor:function(b){var c=e.cacheStepsPerColorChannel;b=a.hex2rgb(b);b[0]=Math.min(255,b[0]/c*c);b[1]=Math.min(255,b[1]/c*c);b[2]=Math.min(255,b[2]/c*c);return a.rgb2hex(b)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:b(),tintMethod:0};e.tintMethod=e.canUseMultiply?
e.tintWithMultiply:e.tintWithPerPixel},{"../../renderers/canvas/utils/canUseNewCanvasBlendModes":112,"../../utils":151}],136:[function(b,c,f){b=function(a){this.vertices=new ArrayBuffer(a);this.float32View=new Float32Array(this.vertices);this.uint32View=new Uint32Array(this.vertices)};c.exports=b;b.prototype.destroy=function(){this.colors=this.uvs=this.positions=this.vertices=null}},{}],137:[function(b,c,f){function a(a){e.call(this,a);this.vertSize=5;this.vertByteSize=4*this.vertSize;this.size=k.SPRITE_BATCH_SIZE;
this.buffers=[];for(a=1;a<=z.nextPow2(this.size);a*=2)this.buffers.push(new n(4*a*this.vertByteSize));this.indices=h(this.size);this.shaders=null;r=this.currentIndex=0;this.groups=[];for(a=0;a<this.size;a++)this.groups[a]={textures:[],textureCount:0,ids:[],size:0,start:0,blend:0};this.sprites=[];this.vertexBuffers=[];this.vaos=[];this.vaoMax=2;this.vertexCount=0;this.renderer.on("prerender",this.onPrerender,this)}var e=b("../../renderers/webgl/utils/ObjectRenderer");f=b("../../renderers/webgl/WebGLRenderer");
var h=b("../../utils/createIndicesForQuads"),g=b("./generateMultiTextureShader"),m=b("../../renderers/webgl/utils/checkMaxIfStatmentsInShader"),n=b("./BatchBuffer"),k=b("../../const"),p=b("pixi-gl-core"),z=b("bit-twiddle"),r=0;a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;f.registerPlugin("sprite",a);a.prototype.onContextChange=function(){var a=this.renderer.gl;this.MAX_TEXTURES=Math.min(a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),k.SPRITE_MAX_TEXTURES);this.MAX_TEXTURES=
m(this.MAX_TEXTURES,a);this.shaders=Array(this.MAX_TEXTURES);this.shaders[0]=g(a,1);this.shaders[1]=g(a,2);this.indexBuffer=p.GLBuffer.createIndexBuffer(a,this.indices,a.STATIC_DRAW);for(var b=this.shaders[1],c=0;c<this.vaoMax;c++)this.vertexBuffers[c]=p.GLBuffer.createVertexBuffer(a,null,a.STREAM_DRAW),this.vaos[c]=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(this.vertexBuffers[c],b.attributes.aVertexPosition,a.FLOAT,!1,this.vertByteSize,0).addAttribute(this.vertexBuffers[c],
b.attributes.aTextureCoord,a.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(this.vertexBuffers[c],b.attributes.aColor,a.UNSIGNED_BYTE,!0,this.vertByteSize,12).addAttribute(this.vertexBuffers[c],b.attributes.aTextureId,a.FLOAT,!1,this.vertByteSize,16);this.vao=this.vaos[0];this.currentBlendMode=99999};a.prototype.onPrerender=function(){this.vertexCount=0};a.prototype.render=function(a){this.currentIndex>=this.size&&this.flush();a.texture._uvs&&(this.sprites[this.currentIndex++]=a)};a.prototype.flush=
function(){if(0!==this.currentIndex){var a=this.renderer.gl,b=z.nextPow2(this.currentIndex),b=z.log2(b),c=this.buffers[b],d=this.sprites,b=this.groups,k=c.float32View,m=c.uint32View,h=0,e,f,n=1,D=0,E=b[0],I,J,B,C=d[0].blendMode;E.textureCount=0;E.start=0;E.blend=C;r++;for(var M=0;M<this.currentIndex;M++){B=d[M];e=B._texture.baseTexture;C!==B.blendMode&&(C=B.blendMode,f=null,D=this.MAX_TEXTURES,r++);f!==e&&(f=e,e._enabled!==r&&(D===this.MAX_TEXTURES&&(r++,D=0,E.size=M-E.start,E=b[n++],E.textureCount=
0,E.blend=C,E.start=M),e._enabled=r,e._id=D,E.textures[E.textureCount++]=e,D++));I=B.vertexData;J=B._tintRGB+(255*B.worldAlpha<<24);B=B._texture._uvs.uvsUint32;e=e._id;if(this.renderer.roundPixels){var G=this.renderer.resolution;k[h]=(I[0]*G|0)/G;k[h+1]=(I[1]*G|0)/G;k[h+5]=(I[2]*G|0)/G;k[h+6]=(I[3]*G|0)/G;k[h+10]=(I[4]*G|0)/G;k[h+11]=(I[5]*G|0)/G;k[h+15]=(I[6]*G|0)/G;k[h+16]=(I[7]*G|0)/G}else k[h]=I[0],k[h+1]=I[1],k[h+5]=I[2],k[h+6]=I[3],k[h+10]=I[4],k[h+11]=I[5],k[h+15]=I[6],k[h+16]=I[7];m[h+2]=
B[0];m[h+7]=B[1];m[h+12]=B[2];m[h+17]=B[3];m[h+3]=m[h+8]=m[h+13]=m[h+18]=J;k[h+4]=k[h+9]=k[h+14]=k[h+19]=e;h+=20}E.size=M-E.start;this.vertexCount++;this.vaoMax<=this.vertexCount&&(this.vaoMax++,f=this.shaders[1],this.vertexBuffers[this.vertexCount]=p.GLBuffer.createVertexBuffer(a,null,a.STREAM_DRAW),this.vaos[this.vertexCount]=this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(this.vertexBuffers[this.vertexCount],f.attributes.aVertexPosition,a.FLOAT,!1,this.vertByteSize,0).addAttribute(this.vertexBuffers[this.vertexCount],
f.attributes.aTextureCoord,a.UNSIGNED_SHORT,!0,this.vertByteSize,8).addAttribute(this.vertexBuffers[this.vertexCount],f.attributes.aColor,a.UNSIGNED_BYTE,!0,this.vertByteSize,12).addAttribute(this.vertexBuffers[this.vertexCount],f.attributes.aTextureId,a.FLOAT,!1,this.vertByteSize,16));this.vertexBuffers[this.vertexCount].upload(c.vertices,0);this.vao=this.vaos[this.vertexCount].bind();for(M=0;M<n;M++){c=b[M];d=c.textureCount;(f=this.shaders[d-1])||(f=this.shaders[d-1]=g(a,d));this.renderer.bindShader(f);
for(f=0;f<d;f++)this.renderer.bindTexture(c.textures[f],f);this.renderer.state.setBlendMode(c.blend);a.drawElements(a.TRIANGLES,6*c.size,a.UNSIGNED_SHORT,12*c.start)}this.currentIndex=0}};a.prototype.start=function(){};a.prototype.stop=function(){this.flush();this.vao.unbind()};a.prototype.destroy=function(){for(var a=0;a<this.vaoMax;a++)this.vertexBuffers[a].destroy(),this.vaos[a].destroy();this.indexBuffer.destroy();this.renderer.off("prerender",this.onPrerender,this);e.prototype.destroy.call(this);
for(a=0;a<this.shaders.length;a++)this.shaders[a]&&this.shaders[a].destroy();this.sprites=this.indices=this.indexBuffer=this.vaos=this.vertexBuffers=null;for(a=0;a<this.buffers.length;a++)this.buffers[a].destroy()}},{"../../const":78,"../../renderers/webgl/WebGLRenderer":116,"../../renderers/webgl/utils/ObjectRenderer":126,"../../renderers/webgl/utils/checkMaxIfStatmentsInShader":129,"../../utils/createIndicesForQuads":149,"./BatchBuffer":136,"./generateMultiTextureShader":138,"bit-twiddle":30,"pixi-gl-core":7}],
138:[function(b,c,f){function a(a){var b;b="\n\n";for(var c=0;c<a;c++)0<c&&(b+="\nelse "),c<a-1&&(b+="if(textureId == "+c+".0)"),b+="\n{",b+="\n\tcolor = texture2D(uSamplers["+c+"], vTextureCoord);",b+="\n}";return b+"\n\n"}var e=b("../../Shader");c.exports=function(b,c){var d;d="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\nvoid main(void){\nvec4 color;\nfloat textureId = floor(vTextureId+0.5);\n%forloop%\ngl_FragColor = color * vColor;\n}".replace(/%count%/gi,
c);d=d.replace(/%forloop%/gi,a(c));d=new e(b,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vTextureId = aTextureId;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n",
d,{aVertexPosition:3,aColor:2,aTextureCoord:1,aTextureId:0});for(var f=[],k=0;k<c;k++)f[k]=k;d.bind();d.uniforms.uSamplers=f;return d}},{"../../Shader":77}],139:[function(b,c,f){function a(a,b){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.resolution=n.RESOLUTION;this._styleListener=this._style=this._text=null;this._font="";var c=h.fromCanvas(this.canvas);c.orig=new g.Rectangle;c.trim=new g.Rectangle;e.call(this,c);this.text=a;this.style=b;this.localStyleID=
-1}var e=b("../sprites/Sprite"),h=b("../textures/Texture"),g=b("../math"),m=b("../utils"),n=b("../const"),k=b("./TextStyle"),p={texture:!0,children:!1,baseTexture:!0};a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.fontPropertiesCache={};a.fontPropertiesCanvas=document.createElement("canvas");a.fontPropertiesContext=a.fontPropertiesCanvas.getContext("2d");Object.defineProperties(a.prototype,{width:{get:function(){this.updateText(!0);return Math.abs(this.scale.x)*this.texture.orig.width},
set:function(a){this.updateText(!0);var b=m.sign(this.scale.x)||1;this.scale.x=b*a/this.texture.orig.width;this._width=a}},height:{get:function(){this.updateText(!0);return Math.abs(this.scale.y)*this._texture.orig.height},set:function(a){this.updateText(!0);var b=m.sign(this.scale.y)||1;this.scale.y=b*a/this.texture.orig.height;this._height=a}},style:{get:function(){return this._style},set:function(a){a=a||{};this._style=a instanceof k?a:new k(a);this.localStyleID=-1;this.dirty=!0}},text:{get:function(){return this._text},
set:function(a){a=(a||" ").toString();this._text!==a&&(this._text=a,this.dirty=!0)}}});a.prototype.updateText=function(a){var b=this._style;this.localStyleID!==b.styleID&&(this.dirty=!0,this.localStyleID=b.styleID);if(this.dirty||!a){this._font=b.fontStyle+" "+b.fontVariant+" "+b.fontWeight+" "+("number"===typeof b.fontSize?b.fontSize+"px":b.fontSize)+" "+b.fontFamily;this.context.font=this._font;a=(b.wordWrap?this.wordWrap(this._text):this._text).split(/(?:\r\n|\r|\n)/);var c=Array(a.length),g=0,
d=this.determineFontProperties(this._font),k;for(k=0;k<a.length;k++){var m=this.context.measureText(a[k]).width+(a[k].length-1)*b.letterSpacing;c[k]=m;g=Math.max(g,m)}k=g+b.strokeThickness;b.dropShadow&&(k+=b.dropShadowDistance);k+=2*b.padding;this.canvas.width=Math.ceil((k+this.context.lineWidth)*this.resolution);m=this.style.lineHeight||d.fontSize+b.strokeThickness;k=Math.max(m,d.fontSize+b.strokeThickness)+(a.length-1)*m;b.dropShadow&&(k+=b.dropShadowDistance);this.canvas.height=Math.ceil((k+2*
this._style.padding)*this.resolution);this.context.scale(this.resolution,this.resolution);navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height);this.context.font=this._font;this.context.strokeStyle=b.stroke;this.context.lineWidth=b.strokeThickness;this.context.textBaseline=b.textBaseline;this.context.lineJoin=b.lineJoin;this.context.miterLimit=b.miterLimit;var h,e;if(b.dropShadow){0<b.dropShadowBlur?(this.context.shadowColor=b.dropShadowColor,this.context.shadowBlur=
b.dropShadowBlur):this.context.fillStyle=b.dropShadowColor;var f=Math.cos(b.dropShadowAngle)*b.dropShadowDistance,p=Math.sin(b.dropShadowAngle)*b.dropShadowDistance;for(k=0;k<a.length;k++)h=b.strokeThickness/2,e=b.strokeThickness/2+k*m+d.ascent,"right"===b.align?h+=g-c[k]:"center"===b.align&&(h+=(g-c[k])/2),b.fill&&(this.drawLetterSpacing(a[k],h+f+b.padding,e+p+b.padding),b.stroke&&b.strokeThickness&&(this.context.strokeStyle=b.dropShadowColor,this.drawLetterSpacing(a[k],h+f+b.padding,e+p+b.padding,
!0),this.context.strokeStyle=b.stroke))}this.context.fillStyle=this._generateFillStyle(b,a);for(k=0;k<a.length;k++)h=b.strokeThickness/2,e=b.strokeThickness/2+k*m+d.ascent,"right"===b.align?h+=g-c[k]:"center"===b.align&&(h+=(g-c[k])/2),b.stroke&&b.strokeThickness&&this.drawLetterSpacing(a[k],h+b.padding,e+b.padding,!0),b.fill&&this.drawLetterSpacing(a[k],h+b.padding,e+b.padding);this.updateTexture()}};a.prototype.drawLetterSpacing=function(a,b,c,g){var k=this._style.letterSpacing;if(0===k)g?this.context.strokeText(a,
b,c):this.context.fillText(a,b,c);else for(var d=String.prototype.split.call(a,""),m=0,h=b;m<a.length;)b=d[m++],g?this.context.strokeText(b,h,c):this.context.fillText(b,h,c),h+=this.context.measureText(b).width+k};a.prototype.updateTexture=function(){var a=this._texture,b=this._style;a.baseTexture.hasLoaded=!0;a.baseTexture.resolution=this.resolution;a.baseTexture.realWidth=this.canvas.width;a.baseTexture.realHeight=this.canvas.height;a.baseTexture.width=this.canvas.width/this.resolution;a.baseTexture.height=
this.canvas.height/this.resolution;a.trim.width=a._frame.width=this.canvas.width/this.resolution;a.trim.height=a._frame.height=this.canvas.height/this.resolution;a.trim.x=-b.padding;a.trim.y=-b.padding;a.orig.width=a._frame.width-2*b.padding;a.orig.height=a._frame.height-2*b.padding;this._onTextureUpdate();a.baseTexture.emit("update",a.baseTexture);this.dirty=!1};a.prototype.renderWebGL=function(a){this.resolution!==a.resolution&&(this.resolution=a.resolution,this.dirty=!0);this.updateText(!0);e.prototype.renderWebGL.call(this,
a)};a.prototype._renderCanvas=function(a){this.resolution!==a.resolution&&(this.resolution=a.resolution,this.dirty=!0);this.updateText(!0);e.prototype._renderCanvas.call(this,a)};a.prototype.determineFontProperties=function(b){var c=a.fontPropertiesCache[b];if(!c){var c={},g=a.fontPropertiesCanvas,k=a.fontPropertiesContext;k.font=b;var d=Math.ceil(k.measureText("|M\u00c9q").width),m=Math.ceil(k.measureText("M").width),h=2*m,m=1.4*m|0;g.width=d;g.height=h;k.fillStyle="#f00";k.fillRect(0,0,d,h);k.font=
b;k.textBaseline="alphabetic";k.fillStyle="#000";k.fillText("|M\u00c9q",0,m);var g=k.getImageData(0,0,d,h).data,k=g.length,d=4*d,e,f,p=0,n=!1;for(e=0;e<m;e++){for(f=0;f<d;f+=4)if(255!==g[p+f]){n=!0;break}if(n)break;else p+=d}c.ascent=m-e;p=k-d;n=!1;for(e=h;e>m;e--){for(f=0;f<d;f+=4)if(255!==g[p+f]){n=!0;break}if(n)break;else p-=d}c.descent=e-m;c.fontSize=c.ascent+c.descent;a.fontPropertiesCache[b]=c}return c};a.prototype.wordWrap=function(a){var b="";a=a.split("\n");for(var c=this._style.wordWrapWidth,
g=0;g<a.length;g++){for(var k=c,d=a[g].split(" "),m=0;m<d.length;m++){var h=this.context.measureText(d[m]).width;if(this._style.breakWords&&h>c)for(var h=d[m].split(""),e=0;e<h.length;e++){var f=this.context.measureText(h[e]).width;f>k?(b+="\n"+h[e],k=c-f):(0===e&&(b+=" "),b+=h[e],k-=f)}else e=h+this.context.measureText(" ").width,0===m||e>k?(0<m&&(b+="\n"),b+=d[m],k=c-h):(k-=e,b+=" "+d[m])}g<a.length-1&&(b+="\n")}return b};a.prototype._calculateBounds=function(){this.updateText(!0);this.calculateVertices();
this._bounds.addQuad(this.vertexData)};a.prototype._onStyleChange=function(){this.dirty=!0};a.prototype._generateFillStyle=function(a,b){if(Array.isArray(a.fill)){if(navigator.isCocoonJS)return a.fill[0];var c,g,k,d,m;c=this.canvas.width/this.resolution;g=this.canvas.height/this.resolution;if(a.fillGradientType===n.TEXT_GRADIENT.LINEAR_VERTICAL)for(g=this.context.createLinearGradient(c/2,0,c/2,g),k=(a.fill.length+1)*b.length,c=d=0;c<b.length;c++){d+=1;for(var h=0;h<a.fill.length;h++)m=d/k,g.addColorStop(m,
a.fill[h]),d++}else for(g=this.context.createLinearGradient(0,g/2,c,g/2),k=a.fill.length+1,d=1,c=0;c<a.fill.length;c++)m=d/k,g.addColorStop(m,a.fill[c]),d++;return g}return a.fill};a.prototype.destroy=function(a){"boolean"===typeof a&&(a={children:a});a=Object.assign({},p,a);e.prototype.destroy.call(this,a);this._style=this.canvas=this.context=null}},{"../const":78,"../math":102,"../sprites/Sprite":133,"../textures/Texture":144,"../utils":151,"./TextStyle":140}],140:[function(b,c,f){function a(a){this.styleID=
0;Object.assign(this,this._defaults,a)}function e(a){if("number"===typeof a)return h.hex2string(a);if(Array.isArray(a))for(var b=0;b<a.length;++b)"number"===typeof a[b]&&(a[b]=h.hex2string(a[b]));return a}f=b("../const");var h=b("../utils");a.prototype.constructor=a;c.exports=a;a.prototype._defaults={align:"left",breakWords:!1,dropShadow:!1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"#000000",dropShadowDistance:5,fill:"black",fillGradientType:f.TEXT_GRADIENT.LINEAR_VERTICAL,fontFamily:"Arial",
fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",wordWrap:!1,wordWrapWidth:100};a.prototype.clone=function(){var b={},c;for(c in this._defaults)b[c]=this[c];return new a(b)};a.prototype.reset=function(){Object.assign(this,this._defaults)};Object.defineProperties(a.prototype,{align:{get:function(){return this._align},set:function(a){this._align!==a&&
(this._align=a,this.styleID++)}},breakWords:{get:function(){return this._breakWords},set:function(a){this._breakWords!==a&&(this._breakWords=a,this.styleID++)}},dropShadow:{get:function(){return this._dropShadow},set:function(a){this._dropShadow!==a&&(this._dropShadow=a,this.styleID++)}},dropShadowAngle:{get:function(){return this._dropShadowAngle},set:function(a){this._dropShadowAngle!==a&&(this._dropShadowAngle=a,this.styleID++)}},dropShadowBlur:{get:function(){return this._dropShadowBlur},set:function(a){this._dropShadowBlur!==
a&&(this._dropShadowBlur=a,this.styleID++)}},dropShadowColor:{get:function(){return this._dropShadowColor},set:function(a){a=e(a);this._dropShadowColor!==a&&(this._dropShadowColor=a,this.styleID++)}},dropShadowDistance:{get:function(){return this._dropShadowDistance},set:function(a){this._dropShadowDistance!==a&&(this._dropShadowDistance=a,this.styleID++)}},fill:{get:function(){return this._fill},set:function(a){a=e(a);this._fill!==a&&(this._fill=a,this.styleID++)}},fillGradientType:{get:function(){return this._fillGradientType},
set:function(a){this._fillGradientType!==a&&(this._fillGradientType=a,this.styleID++)}},fontFamily:{get:function(){return this._fontFamily},set:function(a){this.fontFamily!==a&&(this._fontFamily=a,this.styleID++)}},fontSize:{get:function(){return this._fontSize},set:function(a){this._fontSize!==a&&(this._fontSize=a,this.styleID++)}},fontStyle:{get:function(){return this._fontStyle},set:function(a){this._fontStyle!==a&&(this._fontStyle=a,this.styleID++)}},fontVariant:{get:function(){return this._fontVariant},
set:function(a){this._fontVariant!==a&&(this._fontVariant=a,this.styleID++)}},fontWeight:{get:function(){return this._fontWeight},set:function(a){this._fontWeight!==a&&(this._fontWeight=a,this.styleID++)}},letterSpacing:{get:function(){return this._letterSpacing},set:function(a){this._letterSpacing!==a&&(this._letterSpacing=a,this.styleID++)}},lineHeight:{get:function(){return this._lineHeight},set:function(a){this._lineHeight!==a&&(this._lineHeight=a,this.styleID++)}},lineJoin:{get:function(){return this._lineJoin},
set:function(a){this._lineJoin!==a&&(this._lineJoin=a,this.styleID++)}},miterLimit:{get:function(){return this._miterLimit},set:function(a){this._miterLimit!==a&&(this._miterLimit=a,this.styleID++)}},padding:{get:function(){return this._padding},set:function(a){this._padding!==a&&(this._padding=a,this.styleID++)}},stroke:{get:function(){return this._stroke},set:function(a){a=e(a);this._stroke!==a&&(this._stroke=a,this.styleID++)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(a){this._strokeThickness!==
a&&(this._strokeThickness=a,this.styleID++)}},textBaseline:{get:function(){return this._textBaseline},set:function(a){this._textBaseline!==a&&(this._textBaseline=a,this.styleID++)}},wordWrap:{get:function(){return this._wordWrap},set:function(a){this._wordWrap!==a&&(this._wordWrap=a,this.styleID++)}},wordWrapWidth:{get:function(){return this._wordWrapWidth},set:function(a){this._wordWrapWidth!==a&&(this._wordWrapWidth=a,this.styleID++)}}})},{"../const":78,"../utils":151}],141:[function(b,c,f){function a(a,
b,c,k){e.call(this,null,c);this.resolution=k||h.RESOLUTION;this.width=a||100;this.height=b||100;this.realWidth=this.width*this.resolution;this.realHeight=this.height*this.resolution;this.scaleMode=c||h.SCALE_MODES.DEFAULT;this.hasLoaded=!0;this._glRenderTargets=[];this._canvasRenderTarget=null;this.valid=!1}var e=b("./BaseTexture"),h=b("../const");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.resize=function(a,b){if(a!==this.width||b!==this.height)this.valid=
0<a&&0<b,this.width=a,this.height=b,this.realWidth=this.width*this.resolution,this.realHeight=this.height*this.resolution,this.valid&&this.emit("update",this)};a.prototype.destroy=function(){e.prototype.destroy.call(this,!0);this.renderer=null}},{"../const":78,"./BaseTexture":142}],142:[function(b,c,f){function a(a,b,c){g.call(this);this.uid=e.uid();this.touched=0;this.resolution=c||h.RESOLUTION;this.realHeight=this.realWidth=this.height=this.width=100;this.scaleMode=b||h.SCALE_MODES.DEFAULT;this.isLoading=
this.hasLoaded=!1;this.source=null;this.premultipliedAlpha=!0;this.imageUrl=null;this.isPowerOfTwo=!1;this.mipmap=h.MIPMAP_TEXTURES;this.wrapMode=h.WRAP_MODES.DEFAULT;this._glTextures=[];this._id=this._enabled=0;a&&this.loadSource(a)}var e=b("../utils"),h=b("../const"),g=b("eventemitter3"),m=b("../utils/determineCrossOrigin"),n=b("bit-twiddle");a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.videoWidth||
this.source.width;this.realHeight=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.width=this.realWidth/this.resolution;this.height=this.realHeight/this.resolution;this.isPowerOfTwo=n.isPow2(this.realWidth)&&n.isPow2(this.realHeight);this.emit("update",this)};a.prototype.loadSource=function(a){var b=this.isLoading;this.isLoading=this.hasLoaded=!1;b&&this.source&&(this.source.onload=null,this.source.onerror=null);this.source=a;if((this.source.complete||this.source.getContext)&&
this.source.width&&this.source.height)this._sourceLoaded();else if(!a.getContext){this.isLoading=!0;var c=this;a.onload=function(){a.onload=null;a.onerror=null;c.isLoading&&(c.isLoading=!1,c._sourceLoaded(),c.emit("loaded",c))};a.onerror=function(){a.onload=null;a.onerror=null;c.isLoading&&(c.isLoading=!1,c.emit("error",c))};a.complete&&a.src&&(this.isLoading=!1,a.onload=null,a.onerror=null,a.width&&a.height?(this._sourceLoaded(),b&&this.emit("loaded",this)):b&&this.emit("error",this))}};a.prototype._sourceLoaded=
function(){this.hasLoaded=!0;this.update()};a.prototype.destroy=function(){this.imageUrl?(delete e.BaseTextureCache[this.imageUrl],delete e.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete e.BaseTextureCache[this.source._pixiId];this.source=null;this.dispose()};a.prototype.dispose=function(){this.emit("dispose",this)};a.prototype.updateSourceImage=function(a){this.source.src=a;this.loadSource(this.source)};a.fromImage=
function(b,c,d){var g=e.BaseTextureCache[b];if(!g){var h=new Image;void 0===c&&0!==b.indexOf("data:")&&(h.crossOrigin=m(b));g=new a(h,d);g.imageUrl=b;h.src=b;e.BaseTextureCache[b]=g;g.resolution=e.getResolutionOfUrl(b)}return g};a.fromCanvas=function(b,c){b._pixiId||(b._pixiId="canvas_"+e.uid());var g=e.BaseTextureCache[b._pixiId];g||(g=new a(b,c),e.BaseTextureCache[b._pixiId]=g);return g}},{"../const":78,"../utils":151,"../utils/determineCrossOrigin":150,"bit-twiddle":30,eventemitter3:32}],143:[function(b,
c,f){function a(a,b,c,d,f){this.legacyRenderer=null;if(!(a instanceof e)){var z=b;d=d||0;f=f||1;console.warn("v4 RenderTexture now expects a new BaseRenderTexture. Please use RenderTexture.create("+z+", "+c+")");this.legacyRenderer=a;b=null;a=new e(z,c,d,f)}h.call(this,a,b);this.valid=!0;this._updateUvs()}var e=b("./BaseRenderTexture"),h=b("./Texture");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.resize=function(a,b,c){this.valid=0<a&&0<b;this._frame.width=
this.orig.width=a;this._frame.height=this.orig.height=b;c||this.baseTexture.resize(a,b);this._updateUvs()};a.create=function(b,c,d,k){return new a(new e(b,c,d,k))}},{"./BaseRenderTexture":141,"./Texture":144}],144:[function(b,c,f){function a(b,c,d,g,k){m.call(this);this.noFrame=!1;c||(this.noFrame=!0,c=new n.Rectangle(0,0,1,1));b instanceof a&&(b=b.baseTexture);this.baseTexture=b;this._frame=c;this.trim=g;this.requiresUpdate=this.valid=!1;this._uvs=null;this.orig=d||c;this._rotate=+(k||0);if(!0===
k)this._rotate=2;else if(0!==this._rotate%2)throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually";if(b.hasLoaded)this.noFrame&&(c=new n.Rectangle(0,0,b.width,b.height),b.on("update",this.onBaseTextureUpdated,this)),this.frame=c;else b.once("loaded",this.onBaseTextureLoaded,this);this._updateID=0}var e=b("./BaseTexture"),h=b("./VideoBaseTexture"),g=b("./TextureUvs"),m=b("eventemitter3"),n=b("../math"),k=b("../utils");a.prototype=Object.create(m.prototype);a.prototype.constructor=
a;c.exports=a;Object.defineProperties(a.prototype,{frame:{get:function(){return this._frame},set:function(a){this._frame=a;this.noFrame=!1;if(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height)throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.hasLoaded;this.trim||this.rotate||(this.orig=a);this.valid&&this._updateUvs()}},rotate:{get:function(){return this._rotate},set:function(a){this._rotate=
a;this.valid&&this._updateUvs()}},width:{get:function(){return this.orig?this.orig.width:0}},height:{get:function(){return this.orig?this.orig.height:0}}});a.prototype.update=function(){this.baseTexture.update()};a.prototype.onBaseTextureLoaded=function(a){this._updateID++;this.frame=this.noFrame?new n.Rectangle(0,0,a.width,a.height):this._frame;this.baseTexture.on("update",this.onBaseTextureUpdated,this);this.emit("update",this)};a.prototype.onBaseTextureUpdated=function(a){this._updateID++;this._frame.width=
a.width;this._frame.height=a.height;this.emit("update",this)};a.prototype.destroy=function(a){this.baseTexture&&(a&&(k.TextureCache[this.baseTexture.imageUrl]&&delete k.TextureCache[this.baseTexture.imageUrl],this.baseTexture.destroy()),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null);this.orig=this.trim=this._uvs=this._frame=null;this.valid=!1;this.off("dispose",this.dispose,this);this.off("update",this.update,
this)};a.prototype.clone=function(){return new a(this.baseTexture,this.frame,this.orig,this.trim,this.rotate)};a.prototype._updateUvs=function(){this._uvs||(this._uvs=new g);this._uvs.set(this._frame,this.baseTexture,this.rotate);this._updateID++};a.fromImage=function(b,c,d){var g=k.TextureCache[b];g||(g=new a(e.fromImage(b,c,d)),k.TextureCache[b]=g);return g};a.fromFrame=function(a){var b=k.TextureCache[a];if(!b)throw Error('The frameId "'+a+'" does not exist in the texture cache');return b};a.fromCanvas=
function(b,c){return new a(e.fromCanvas(b,c))};a.fromVideo=function(b,c){return"string"===typeof b?a.fromVideoUrl(b,c):new a(h.fromVideo(b,c))};a.fromVideoUrl=function(b,c){return new a(h.fromUrl(b,c))};a.from=function(b){if("string"===typeof b){var c=k.TextureCache[b];return c?c:null!==b.match(/\.(mp4|webm|ogg|h264|avi|mov)$/)?a.fromVideoUrl(b):a.fromImage(b)}return b instanceof HTMLCanvasElement?a.fromCanvas(b):b instanceof HTMLVideoElement?a.fromVideo(b):b instanceof e?new a(e):b};a.addTextureToCache=
function(a,b){k.TextureCache[b]=a};a.removeTextureFromCache=function(a){var b=k.TextureCache[a];delete k.TextureCache[a];delete k.BaseTextureCache[a];return b};a.EMPTY=new a(new e);a.EMPTY.destroy=function(){};a.EMPTY.on=function(){};a.EMPTY.once=function(){};a.EMPTY.emit=function(){}},{"../math":102,"../utils":151,"./BaseTexture":142,"./TextureUvs":145,"./VideoBaseTexture":146,eventemitter3:32}],145:[function(b,c,f){function a(){this.y0=this.x0=0;this.x1=1;this.y1=0;this.y2=this.x2=1;this.x3=0;this.y3=
1;this.uvsUint32=new Uint32Array(4)}c.exports=a;var e=b("../math/GroupD8");a.prototype.set=function(a,b,c){var d=b.width,k=b.height;if(c){b=a.width/2/d;var f=a.height/2/k,d=a.x/d+b;a=a.y/k+f;c=e.add(c,e.NW);this.x0=d+b*e.uX(c);this.y0=a+f*e.uY(c);c=e.add(c,2);this.x1=d+b*e.uX(c);this.y1=a+f*e.uY(c);c=e.add(c,2);this.x2=d+b*e.uX(c);this.y2=a+f*e.uY(c);c=e.add(c,2);this.x3=d+b*e.uX(c);this.y3=a+f*e.uY(c)}else this.x0=a.x/d,this.y0=a.y/k,this.x1=(a.x+a.width)/d,this.y1=a.y/k,this.x2=(a.x+a.width)/d,
this.y2=(a.y+a.height)/k,this.x3=a.x/d,this.y3=(a.y+a.height)/k;this.uvsUint32[0]=(65535*this.y0&65535)<<16|65535*this.x0&65535;this.uvsUint32[1]=(65535*this.y1&65535)<<16|65535*this.x1&65535;this.uvsUint32[2]=(65535*this.y2&65535)<<16|65535*this.x2&65535;this.uvsUint32[3]=(65535*this.y3&65535)<<16|65535*this.x3&65535}},{"../math/GroupD8":98}],146:[function(b,c,f){function a(a,b){if(!a)throw Error("No video source element specified.");(a.readyState===a.HAVE_ENOUGH_DATA||a.readyState===a.HAVE_FUTURE_DATA)&&
a.width&&a.height&&(a.complete=!0);h.call(this,a,b);this.autoUpdate=!1;this._onUpdate=this._onUpdate.bind(this);this._onCanPlay=this._onCanPlay.bind(this);a.complete||(a.addEventListener("canplay",this._onCanPlay),a.addEventListener("canplaythrough",this._onCanPlay),a.addEventListener("play",this._onPlayStart.bind(this)),a.addEventListener("pause",this._onPlayStop.bind(this)));this.__loaded=!1}function e(a,b){b||(b="video/"+a.substr(a.lastIndexOf(".")+1));var c=document.createElement("source");c.src=
a;c.type=b;return c}var h=b("./BaseTexture"),g=b("../utils");a.prototype=Object.create(h.prototype);a.prototype.constructor=a;c.exports=a;a.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())};a.prototype._onPlayStart=function(){this.hasLoaded||this._onCanPlay();this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)};a.prototype._onPlayStop=function(){this.autoUpdate=!1};a.prototype._onCanPlay=function(){this.hasLoaded=
!0;this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))};a.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete g.BaseTextureCache[this.source._pixiId],delete this.source._pixiId);h.prototype.destroy.call(this)};a.fromVideo=function(b,c){b._pixiId||
(b._pixiId="video_"+g.uid());var d=g.BaseTextureCache[b._pixiId];d||(d=new a(b,c),g.BaseTextureCache[b._pixiId]=d);return d};a.fromUrl=function(b,c){var d=document.createElement("video");if(Array.isArray(b))for(var g=0;g<b.length;++g)d.appendChild(e(b[g].src||b[g],b[g].mime));else d.appendChild(e(b.src||b,b.mime));d.load();d.play();return a.fromVideo(d,c)};a.fromUrls=a.fromUrl},{"../utils":151,"./BaseTexture":142}],147:[function(b,c,f){function a(){var a=this;this._tick=function(b){a._requestId=null;
a.started&&(a.update(b),a.started&&null===a._requestId&&a._emitter.listeners("tick",!0)&&(a._requestId=requestAnimationFrame(a._tick)))};this._emitter=new h;this._requestId=null;this._maxElapsedMS=100;this.autoStart=!1;this.deltaTime=1;this.elapsedMS=1/e.TARGET_FPMS;this.lastTime=0;this.speed=1;this.started=!1}var e=b("../const"),h=b("eventemitter3");Object.defineProperties(a.prototype,{FPS:{get:function(){return 1E3/this.elapsedMS}},minFPS:{get:function(){return 1E3/this._maxElapsedMS},set:function(a){this._maxElapsedMS=
1/Math.min(Math.max(0,a)/1E3,e.TARGET_FPMS)}}});a.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners("tick",!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))};a.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)};a.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()};a.prototype.add=function(a,b){this._emitter.on("tick",
a,b);this._startIfPossible();return this};a.prototype.addOnce=function(a,b){this._emitter.once("tick",a,b);this._startIfPossible();return this};a.prototype.remove=function(a,b){this._emitter.off("tick",a,b);this._emitter.listeners("tick",!0)||this._cancelIfNeeded();return this};a.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())};a.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())};a.prototype.update=function(a){var b;a=a||performance.now();
a>this.lastTime?(b=this.elapsedMS=a-this.lastTime,b>this._maxElapsedMS&&(b=this._maxElapsedMS),this.deltaTime=b*e.TARGET_FPMS*this.speed,this._emitter.emit("tick",this.deltaTime)):this.deltaTime=this.elapsedMS=0;this.lastTime=a};c.exports=a},{"../const":78,eventemitter3:32}],148:[function(b,c,f){b=b("./Ticker");f=new b;f.autoStart=!0;c.exports={shared:f,Ticker:b}},{"./Ticker":147}],149:[function(b,c,f){c.exports=function(a){a*=6;for(var b=new Uint16Array(a),c=0,d=0;c<a;c+=6,d+=4)b[c+0]=d+0,b[c+1]=
d+1,b[c+2]=d+2,b[c+3]=d+0,b[c+4]=d+2,b[c+5]=d+3;return b}},{}],150:[function(b,c,f){var a,e=b("url");c.exports=function(b,c){if(0===b.indexOf("data:"))return"";c=c||window.location;a||(a=document.createElement("a"));a.href=b;b=e.parse(a.href);var d=!b.port&&""===c.port||b.port===c.port;return b.hostname===c.hostname&&d&&b.protocol===c.protocol?"":"anonymous"}},{url:72}],151:[function(b,c,f){var a=b("../const"),e=c.exports={_uid:0,_saidHello:!1,EventEmitter:b("eventemitter3"),pluginTarget:b("./pluginTarget"),
uid:function(){return++e._uid},hex2rgb:function(a,b){b=b||[];b[0]=(a>>16&255)/255;b[1]=(a>>8&255)/255;b[2]=(a&255)/255;return b},hex2string:function(a){a=a.toString(16);a="000000".substr(0,6-a.length)+a;return"#"+a},rgb2hex:function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},getResolutionOfUrl:function(b){return(b=a.RETINA_PREFIX.exec(b))?parseFloat(b[1]):1},sayHello:function(b){e._saidHello||(-1<navigator.userAgent.toLowerCase().indexOf("chrome")?window.console.log.apply(console,["\n %c %c %c Pixi.js "+
a.VERSION+" - \u2730 "+b+" \u2730  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"]):
window.console&&window.console.log("Pixi.js "+a.VERSION+" - "+b+" - http://www.pixijs.com/"),e._saidHello=!0)},isWebGLSupported:function(){var a={stencil:!0,failIfMajorPerformanceCaveat:!0};try{if(!window.WebGLRenderingContext)return!1;var b=document.createElement("canvas"),c=b.getContext("webgl",a)||b.getContext("experimental-webgl",a),d=!(!c||!c.getContextAttributes().stencil);if(c){var k=c.getExtension("WEBGL_lose_context");k&&k.loseContext()}return d}catch(e){return!1}},sign:function(a){return a?
0>a?-1:1:0},removeItems:function(a,b,c){var d=a.length;if(!(b>=d||0===c)){c=b+c>d?d-b:c;for(d-=c;b<d;++b)a[b]=a[b+c];a.length=d}},TextureCache:{},BaseTextureCache:{}}},{"../const":78,"./pluginTarget":153,eventemitter3:32}],152:[function(b,c,f){var a=b("ismobilejs");c.exports=function(b){return a.tablet||a.phone?2:b}},{ismobilejs:33}],153:[function(b,c,f){function a(a){a.__plugins={};a.registerPlugin=function(b,c){a.__plugins[b]=c};a.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var b in a.__plugins)this.plugins[b]=
new a.__plugins[b](this)};a.prototype.destroyPlugins=function(){for(var a in this.plugins)this.plugins[a].destroy(),this.plugins[a]=null;this.plugins=null}}c.exports={mixin:function(b){a(b)}}},{}],154:[function(b,c,f){function a(a){var b=Error().stack;"undefined"===typeof b?console.warn("Deprecation Warning: ",a):(b=b.split("\n").splice(3).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cDeprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",
a),console.warn(b),console.groupEnd()):(console.warn("Deprecation Warning: ",a),console.warn(b)))}var e=b("./core"),h=b("./mesh"),g=b("./particles"),m=b("./extras");b=b("./filters");e.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.");};e.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.");};Object.defineProperties(e,{Stage:{get:function(){a("You do not need to use a PIXI Stage any more, you can simply render any container.");
return e.Container}},DisplayObjectContainer:{get:function(){a("DisplayObjectContainer has been shortened to Container, please use Container from now on.");return e.Container}},Strip:{get:function(){a("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on.");return h.Mesh}},Rope:{get:function(){a("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on.");return h.Rope}},ParticleContainer:{get:function(){a("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on.");
return g.ParticleContainer}},MovieClip:{get:function(){a("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on.");return m.MovieClip}},TilingSprite:{get:function(){a("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on.");return m.TilingSprite}},BitmapText:{get:function(){a("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on.");return m.BitmapText}},blendModes:{get:function(){a("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on.");
return e.BLEND_MODES}},scaleModes:{get:function(){a("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on.");return e.SCALE_MODES}},BaseTextureCache:{get:function(){a("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on.");return e.utils.BaseTextureCache}},TextureCache:{get:function(){a("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on.");return e.utils.TextureCache}},
math:{get:function(){a("The math namespace is deprecated, please access members already accessible on PIXI.");return e}},AbstractFilter:{get:function(){a("AstractFilter has been renamed to Filter, please use PIXI.Filter");return e.Filter}},TransformManual:{get:function(){a("TransformManual has been renamed to TransformBase, please update your pixi-spine");return e.TransformBase}}});e.DisplayObject.prototype.generateTexture=function(b,c,d){a("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)");
return b.generateTexture(this,c,d)};e.Graphics.prototype.generateTexture=function(b,c){a("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture");return this.generateCanvasTexture(b,c)};e.RenderTexture.prototype.render=function(b,c,d,g){this.legacyRenderer.render(b,this,d,c,!g);a("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)")};e.RenderTexture.prototype.getImage=function(b){a("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)");
return this.legacyRenderer.extract.image(b)};e.RenderTexture.prototype.getBase64=function(b){a("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)");return this.legacyRenderer.extract.base64(b)};e.RenderTexture.prototype.getCanvas=function(b){a("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)");return this.legacyRenderer.extract.canvas(b)};e.RenderTexture.prototype.getPixels=function(b){a("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)");
return this.legacyRenderer.pixels(b)};e.Sprite.prototype.setTexture=function(b){this.texture=b;a("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")};m.BitmapText.prototype.setText=function(b){this.text=b;a("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")};e.Text.prototype.setText=function(b){this.text=b;a("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")};e.Text.prototype.setStyle=
function(b){this.style=b;a("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")};Object.defineProperties(e.TextStyle.prototype,{font:{get:function(){a("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on");return this._fontStyle+" "+this._fontVariant+" "+this._fontWeight+" "+("number"===typeof this._fontSize?this._fontSize+"px":this._fontSize)+" "+this._fontFamily},
set:function(b){a("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on");1<b.indexOf("italic")?this._fontStyle="italic":-1<b.indexOf("oblique")?this._fontStyle="oblique":this._fontStyle="normal";-1<b.indexOf("small-caps")?this._fontVariant="small-caps":this._fontVariant="normal";b=b.split(" ");var c,d=-1;this._fontSize=26;for(c=0;c<b.length;++c)if(b[c].match(/(px|pt|em|%)/)){d=c;this._fontSize=b[c];break}this._fontWeight=
"normal";for(c=0;c<d;++c)if(b[c].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)){this._fontWeight=b[c];break}if(-1<d&&d<b.length-1){this._fontFamily="";for(c=d+1;c<b.length;++c)this._fontFamily+=b[c]+" ";this._fontFamily=this._fontFamily.slice(0,-1)}else this._fontFamily="Arial";this.styleID++}}});e.Texture.prototype.setFrame=function(b){this.frame=b;a("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")};Object.defineProperties(b,{AbstractFilter:{get:function(){a("AstractFilter has been renamed to Filter, please use PIXI.Filter");
return e.AbstractFilter}},SpriteMaskFilter:{get:function(){a("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on.");return e.SpriteMaskFilter}}});e.utils.uuid=function(){a("utils.uuid() is deprecated, please use utils.uid() from now on.");return e.utils.uid()};e.utils.canUseNewCanvasBlendModes=function(){a("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on");return e.CanvasTinter.canUseMultiply}},{"./core":97,
"./extras":164,"./filters":175,"./mesh":191,"./particles":194}],155:[function(b,c,f){function a(a){this.renderer=a;a.extract=this}var e=b("../../core"),h=new e.Rectangle;a.prototype.constructor=a;c.exports=a;a.prototype.image=function(a){var b=new Image;b.src=this.base64(a);return b};a.prototype.base64=function(a){return this.canvas(a).toDataURL()};a.prototype.canvas=function(a){var b=this.renderer,c,d;a&&(d=a instanceof e.RenderTexture?a:b.generateTexture(a));d?(a=d.baseTexture._canvasRenderTarget.context,
b=d.baseTexture._canvasRenderTarget.resolution,c=d.frame):(a=b.rootContext,b=b.rootResolution,c=h,c.width=this.renderer.width,c.height=this.renderer.height);var f=c.width*b,z=c.height*b;d=new e.CanvasRenderTarget(f,z);a=a.getImageData(c.x*b,c.y*b,f,z);d.context.putImageData(a,0,0);return d.canvas};a.prototype.pixels=function(a){var b=this.renderer,c,d;a&&(d=a instanceof e.RenderTexture?a:b.generateTexture(a));d?(a=d.baseTexture._canvasRenderTarget.context,c=d.baseTexture._canvasRenderTarget.resolution,
d=d.frame):(a=b.rootContext,c=b.rootResolution,d=h,d.width=b.width,d.height=b.height);return a.getImageData(0,0,d.width*c,d.height*c).data};a.prototype.destroy=function(){this.renderer=this.renderer.extract=null};e.CanvasRenderer.registerPlugin("extract",a)},{"../../core":97}],156:[function(b,c,f){c.exports={webGL:b("./webgl/WebGLExtract"),canvas:b("./canvas/CanvasExtract")}},{"./canvas/CanvasExtract":155,"./webgl/WebGLExtract":157}],157:[function(b,c,f){function a(a){this.renderer=a;a.extract=this}
var e=b("../../core"),h=new e.Rectangle;a.prototype.constructor=a;c.exports=a;a.prototype.image=function(a){var b=new Image;b.src=this.base64(a);return b};a.prototype.base64=function(a){return this.canvas(a).toDataURL()};a.prototype.canvas=function(a){var b=this.renderer,c,d,f;a&&(f=a instanceof e.RenderTexture?a:this.renderer.generateTexture(a));f?(c=f.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID],a=c.resolution,d=f.frame,f=!1):(c=this.renderer.rootRenderTarget,a=c.resolution,f=!0,d=h,
d.width=c.size.width,d.height=c.size.height);var z=d.width*a,r=d.height*a,v=new e.CanvasRenderTarget(z,r);c&&(b.bindRenderTarget(c),c=new Uint8Array(4*z*r),b=b.gl,b.readPixels(d.x*a,d.y*a,z,r,b.RGBA,b.UNSIGNED_BYTE,c),b=v.context.getImageData(0,0,z,r),b.data.set(c),v.context.putImageData(b,0,0),f&&(v.context.scale(1,-1),v.context.drawImage(v.canvas,0,-r)));return v.canvas};a.prototype.pixels=function(a){var b=this.renderer,c,d;a&&(d=a instanceof e.RenderTexture?a:this.renderer.generateTexture(a));
d?(c=d.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID],a=c.resolution,d=d.frame):(c=this.renderer.rootRenderTarget,a=c.resolution,d=h,d.width=c.size.width,d.height=c.size.height);var f=d.width*a,z=d.height*a,r=new Uint8Array(4*f*z);c&&(b.bindRenderTarget(c),b=b.gl,b.readPixels(d.x*a,d.y*a,f,z,b.RGBA,b.UNSIGNED_BYTE,r));return r};a.prototype.destroy=function(){this.renderer=this.renderer.extract=null};e.WebGLRenderer.registerPlugin("extract",a)},{"../../core":97}],158:[function(b,c,f){function a(a,
b){e.Container.call(this);b=b||{};this.textHeight=this.textWidth=0;this._glyphs=[];this._font={tint:void 0!==b.tint?b.tint:16777215,align:b.align||"left",name:null,size:0};this.font=b.font;this._text=a;this.maxLineHeight=this.maxWidth=0;this._anchor=new h(this.makeDirty,this,0,0);this.dirty=!1;this.updateText()}var e=b("../core"),h=b("../core/math/ObservablePoint");a.prototype=Object.create(e.Container.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{tint:{get:function(){return this._font.tint},
set:function(a){this._font.tint="number"===typeof a&&0<=a?a:16777215;this.dirty=!0}},align:{get:function(){return this._font.align},set:function(a){this._font.align=a||"left";this.dirty=!0}},anchor:{get:function(){return this._anchor},set:function(a){"number"===typeof a?this._anchor.set(a):this._anchor.copy(a)}},font:{get:function(){return this._font},set:function(b){b&&("string"===typeof b?(b=b.split(" "),this._font.name=1===b.length?b[0]:b.slice(1).join(" "),this._font.size=2<=b.length?parseInt(b[0],
10):a.fonts[this._font.name].size):(this._font.name=b.name,this._font.size="number"===typeof b.size?b.size:parseInt(b.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(a){a=a.toString()||" ";this._text!==a&&(this._text=a,this.dirty=!0)}}});a.prototype.updateText=function(){for(var b=a.fonts[this._font.name],c=new e.Point,d=null,k=[],h=0,f=0,r=[],v=0,t=this._font.size/b.size,q=-1,w=0,u=0,y=0;y<this.text.length;y++){var x=this.text.charCodeAt(y);/(\s)/.test(this.text.charAt(y))&&
(q=y,w=h);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(y)))r.push(h),f=Math.max(f,h),v++,c.x=0,c.y+=b.lineHeight,d=null;else if(-1!==q&&0<this.maxWidth&&c.x*t>this.maxWidth)e.utils.removeItems(k,q,y-q),y=q,q=-1,r.push(w),f=Math.max(f,w),v++,c.x=0,c.y+=b.lineHeight,d=null;else{var A=b.chars[x];A&&(d&&A.kerning[d]&&(c.x+=A.kerning[d]),k.push({texture:A.texture,line:v,charCode:x,position:new e.Point(c.x+A.xOffset,c.y+A.yOffset)}),h=c.x+(A.texture.width+A.xOffset),c.x+=A.xAdvance,u=Math.max(u,A.yOffset+
A.texture.height),d=x)}}r.push(h);f=Math.max(f,h);d=[];for(y=0;y<=v;y++)h=0,"right"===this._font.align?h=f-r[y]:"center"===this._font.align&&(h=(f-r[y])/2),d.push(h);r=k.length;v=this.tint;for(y=0;y<r;y++)(h=this._glyphs[y])?h.texture=k[y].texture:(h=new e.Sprite(k[y].texture),this._glyphs.push(h)),h.position.x=(k[y].position.x+d[k[y].line])*t,h.position.y=k[y].position.y*t,h.scale.x=h.scale.y=t,h.tint=v,h.parent||this.addChild(h);for(y=r;y<this._glyphs.length;++y)this.removeChild(this._glyphs[y]);
this.textWidth=f*t;this.textHeight=(c.y+b.lineHeight)*t;if(0!==this.anchor.x||0!==this.anchor.y)for(y=0;y<r;y++)this._glyphs[y].x-=this.textWidth*this.anchor.x,this._glyphs[y].y-=this.textHeight*this.anchor.y;this.maxLineHeight=u*t};a.prototype.updateTransform=function(){this.validate();this.containerUpdateTransform()};a.prototype.getLocalBounds=function(){this.validate();return e.Container.prototype.getLocalBounds.call(this)};a.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=
!1)};a.prototype.makeDirty=function(){this.dirty=!0};a.fonts={}},{"../core":97,"../core/math/ObservablePoint":100}],159:[function(b,c,f){function a(a){e.Sprite.call(this,a[0]instanceof e.Texture?a[0]:a[0].texture);this._durations=this._textures=null;this.textures=a;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this._currentTime=0;this.playing=!1}var e=b("../core");a.prototype=Object.create(e.Sprite.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{totalFrames:{get:function(){return this._textures.length}},
textures:{get:function(){return this._textures},set:function(a){if(a[0]instanceof e.Texture)this._textures=a,this._durations=null;else{this._textures=[];this._durations=[];for(var b=0;b<a.length;b++)this._textures.push(a[b].texture),this._durations.push(a[b].time)}}},currentFrame:{get:function(){var a=Math.floor(this._currentTime)%this._textures.length;0>a&&(a+=this._textures.length);return a}}});a.prototype.stop=function(){this.playing&&(this.playing=!1,e.ticker.shared.remove(this.update,this))};
a.prototype.play=function(){this.playing||(this.playing=!0,e.ticker.shared.add(this.update,this))};a.prototype.gotoAndStop=function(a){this.stop();this._currentTime=a;this._texture=this._textures[this.currentFrame];this._textureID=-1};a.prototype.gotoAndPlay=function(a){this._currentTime=a;this.play()};a.prototype.update=function(a){var b=this.animationSpeed*a;if(null!==this._durations){for(var c=this._currentTime%1*this._durations[this.currentFrame],c=c+b/60*1E3;0>c;)this._currentTime--,c+=this._durations[this.currentFrame];
a=Math.sign(this.animationSpeed*a);for(this._currentTime=Math.floor(this._currentTime);c>=this._durations[this.currentFrame];)c-=this._durations[this.currentFrame]*a,this._currentTime+=a;this._currentTime+=c/this._durations[this.currentFrame]}else this._currentTime+=b;if(0>this._currentTime&&!this.loop){if(this.gotoAndStop(0),this.onComplete)this.onComplete()}else if(this._currentTime>=this._textures.length&&!this.loop){if(this.gotoAndStop(this._textures.length-1),this.onComplete)this.onComplete()}else this._texture=
this._textures[this.currentFrame],this._textureID=-1};a.prototype.destroy=function(){this.stop();e.Sprite.prototype.destroy.call(this)};a.fromFrames=function(b){for(var c=[],d=0;d<b.length;++d)c.push(e.Texture.fromFrame(b[d]));return new a(c)};a.fromImages=function(b){for(var c=[],d=0;d<b.length;++d)c.push(e.Texture.fromImage(b[d]));return new a(c)}},{"../core":97}],160:[function(b,c,f){function a(a,b,c){e.Sprite.call(this,a);this.tileScale=new e.Point(1,1);this.tilePosition=new e.Point(0,0);this._width=
b||100;this._height=c||100;this._uvs=new e.TextureUvs;this._canvasPattern=null;this._glDatas=[]}var e=b("../core"),h=new e.Point,g=b("../core/textures/Texture"),m=b("../core/sprites/canvas/CanvasTinter"),n=b("./webgl/TilingShader"),k=new Float32Array(4);a.prototype=Object.create(e.Sprite.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this._width},set:function(a){this._width=a}},height:{get:function(){return this._height},set:function(a){this._height=
a}}});a.prototype._onTextureUpdate=function(){};a.prototype._renderWebGL=function(a){var b=this._texture;if(b&&b._uvs){a.flush();var c=a.gl,d=this._glDatas[a.CONTEXT_UID];d||(d={shader:new n(c),quad:new e.Quad(c)},this._glDatas[a.CONTEXT_UID]=d,d.quad.initVao(d.shader));c=d.quad.vertices;c[0]=c[6]=this._width*-this.anchor.x;c[1]=c[3]=this._height*-this.anchor.y;c[2]=c[4]=this._width*(1-this.anchor.x);c[5]=c[7]=this._height*(1-this.anchor.y);d.quad.upload();a.bindShader(d.shader);var g=b._uvs,c=b._frame.width,
h=b._frame.height,f=b.baseTexture.width,b=b.baseTexture.height,m=d.shader.uniforms.uPixelSize;m[0]=1/f;m[1]=1/b;d.shader.uniforms.uPixelSize=m;m=d.shader.uniforms.uFrame;m[0]=g.x0;m[1]=g.y0;m[2]=g.x1-g.x0;m[3]=g.y2-g.y0;d.shader.uniforms.uFrame=m;g=d.shader.uniforms.uTransform;g[0]=this.tilePosition.x%(c*this.tileScale.x)/this._width;g[1]=this.tilePosition.y%(h*this.tileScale.y)/this._height;g[2]=f/this._width*this.tileScale.x;g[3]=b/this._height*this.tileScale.y;d.shader.uniforms.uTransform=g;d.shader.uniforms.translationMatrix=
this.worldTransform.toArray(!0);e.utils.hex2rgb(this.tint,k);k[3]=this.worldAlpha;d.shader.uniforms.uColor=k;a.bindTexture(this._texture,0);a.state.setBlendMode(this.blendMode);d.quad.draw()}};a.prototype._renderCanvas=function(a){var b=this._texture;if(b.baseTexture.hasLoaded){var c=a.context,d=this.worldTransform,k=a.resolution,g=b.baseTexture,h=this.tilePosition.x/this.tileScale.x%b._frame.width,f=this.tilePosition.y/this.tileScale.y%b._frame.height;if(!this._canvasPattern){var n=new e.CanvasRenderTarget(b._frame.width,
b._frame.height);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=m.getTintedTexture(this,this.tint)),n.context.drawImage(this.tintedTexture,0,0)):n.context.drawImage(g.source,-b._frame.x,-b._frame.y);this._canvasPattern=n.context.createPattern(n.canvas,"repeat")}c.globalAlpha=this.worldAlpha;c.setTransform(d.a*k,d.b*k,d.c*k,d.d*k,d.tx*k,d.ty*k);c.scale(this.tileScale.x,this.tileScale.y);c.translate(h+this.anchor.x*-this._width,f+this.anchor.y*-this._height);
b=a.blendModes[this.blendMode];b!==a.context.globalCompositeOperation&&(c.globalCompositeOperation=b);c.fillStyle=this._canvasPattern;c.fillRect(-h,-f,this._width/this.tileScale.x,this._height/this.tileScale.y)}};a.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,k=b*(1-this.anchor.y),g=b*-this.anchor.y,b=this.worldTransform,h=b.a,e=b.b,f=b.c,m=b.d,n=b.tx,F=b.ty,H=h*d+f*g+n,b=m*g+e*d+F,a=h*c+f*g+n,g=m*g+e*c+F,D=h*c+f*k+n,c=m*k+e*c+F,h=h*d+f*
k+n,d=m*k+e*d+F,k=H,k=a<k?a:k,k=D<k?D:k,k=h<k?h:k,e=b,e=g<e?g:e,e=c<e?c:e,e=d<e?d:e,H=a>H?a:H,H=D>H?D:H,b=g>b?g:b,b=c>b?c:b,a=this._bounds;a.x=k;a.width=(h>H?h:H)-k;a.y=e;a.height=(d>b?d:b)-e;return this._currentBounds=a};a.prototype.containsPoint=function(a){this.worldTransform.applyInverse(a,h);var b=this._width;a=this._height;var c=-b*this.anchor.x;return h.x>c&&h.x<c+b&&(b=-a*this.anchor.y,h.y>b&&h.y<b+a)?!0:!1};a.prototype.destroy=function(){e.Sprite.prototype.destroy.call(this);this._uvs=this.tilePosition=
this._tileScaleOffset=this.tileScale=null};a.from=function(b,c,d){return new a(g.from(b),c,d)};a.fromFrame=function(b,c,d){var k=e.utils.TextureCache[b];if(!k)throw Error('The frameId "'+b+'" does not exist in the texture cache '+this);return new a(k,c,d)};a.fromImage=function(b,c,d,k,g){return new a(e.Texture.fromImage(b,k,g),c,d)}},{"../core":97,"../core/sprites/canvas/CanvasTinter":135,"../core/textures/Texture":144,"./webgl/TilingShader":165}],161:[function(b,c,f){var a=b("../core");b=a.DisplayObject;
var e=new a.Matrix;b.prototype._cacheAsBitmap=!1;b.prototype._cacheData=!1;var h=function(){this.sprite=this.originalFilterArea=this.originalMask=this.originalDestroy=this.originalHitTest=this.originalUpdateTransform=this.originalGetLocalBounds=this.originalCalculateBounds=this.originalRenderCanvas=this.originalRenderWebGL=null};Object.defineProperties(b.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&((this._cacheAsBitmap=a)?(this._cacheData||
(this._cacheData=new h),a=this._cacheData,a.originalRenderWebGL=this.renderWebGL,a.originalRenderCanvas=this.renderCanvas,a.originalUpdateTransform=this.updateTransform,a.originalCalculateBounds=this._calculateBounds,a.originalGetLocalBounds=this.getLocalBounds,a.originalDestroy=this.destroy,a.originalContainsPoint=this.containsPoint,a.originalMask=this._mask,a.originalFilterArea=this.filterArea,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):
(a=this._cacheData,a.sprite&&this._destroyCachedDisplayObject(),this.renderWebGL=a.originalRenderWebGL,this.renderCanvas=a.originalRenderCanvas,this._calculateBounds=a.originalCalculateBounds,this.getLocalBounds=a.originalGetLocalBounds,this.destroy=a.originalDestroy,this.updateTransform=a.originalUpdateTransform,this.containsPoint=a.originalContainsPoint,this._mask=a.originalMask,this.filterArea=a.originalFilterArea))}}});b.prototype._renderCachedWebGL=function(a){!this.visible||0>=this.worldAlpha||
!this.renderable||(this._initCachedDisplayObject(a),this._cacheData.sprite._transformID=-1,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderWebGL(a))};b.prototype._initCachedDisplayObject=function(b){if(!this._cacheData||!this._cacheData.sprite){var c=this.alpha;this.alpha=1;b.currentRenderer.flush();var d=this.getLocalBounds().clone();this._filters&&d.pad(this._filters[0].padding);var k=b._activeRenderTarget,h=b.filterManager.filterStack,f=a.RenderTexture.create(d.width|
0,d.height|0);e.tx=-d.x;e.ty=-d.y;this.transform.worldTransform.identity();this.renderWebGL=this._cacheData.originalRenderWebGL;b.render(this,f,!0,e,!0);b.bindRenderTarget(k);b.filterManager.filterStack=h;this.renderWebGL=this._renderCachedWebGL;this.updateTransform=this.displayObjectUpdateTransform;this.filterArea=this._mask=null;b=new a.Sprite(f);b.transform.worldTransform=this.transform.worldTransform;b.anchor.x=-(d.x/d.width);b.anchor.y=-(d.y/d.height);b.alpha=c;b._bounds=this._bounds;this._calculateBounds=
this._calculateCachedBounds;this.getLocalBounds=this._getCachedLocalBounds;this._cacheData.sprite=b;this.transform._parentID=-1;this.updateTransform();this.containsPoint=b.containsPoint.bind(b)}};b.prototype._renderCachedCanvas=function(a){!this.visible||0>=this.worldAlpha||!this.renderable||(this._initCachedDisplayObjectCanvas(a),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite.renderCanvas(a))};b.prototype._initCachedDisplayObjectCanvas=function(b){if(!this._cacheData||!this._cacheData.sprite){var c=
this.getLocalBounds(),d=this.alpha;this.alpha=1;var k=b.context,h=new a.RenderTexture.create(c.width|0,c.height|0);this.transform.worldTransform.copy(e);e.invert();e.tx-=c.x;e.ty-=c.y;this.renderCanvas=this._cacheData.originalRenderCanvas;b.render(this,h,!0,e,!1);b.context=k;this.renderCanvas=this._renderCachedCanvas;this._calculateBounds=this._calculateCachedBounds;this.filterArea=this._mask=null;b=new a.Sprite(h);b.transform.worldTransform=this.transform.worldTransform;b.anchor.x=-(c.x/c.width);
b.anchor.y=-(c.y/c.height);b._bounds=this._bounds;b.alpha=d;this.updateTransform();this.updateTransform=this.displayObjectUpdateTransform;this._cacheData.sprite=b;this.containsPoint=b.containsPoint.bind(b)}};b.prototype._calculateCachedBounds=function(){return this._cacheData.sprite._calculateBounds()};b.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()};b.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0);this._cacheData.sprite=
null};b.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1;this.destroy()}},{"../core":97}],162:[function(b,c,f){b=b("../core");b.DisplayObject.prototype.name=null;b.Container.prototype.getChildByName=function(a){for(var b=0;b<this.children.length;b++)if(this.children[b].name===a)return this.children[b];return null}},{"../core":97}],163:[function(b,c,f){var a=b("../core");a.DisplayObject.prototype.getGlobalPosition=function(b){b=b||new a.Point;this.parent?(this.displayObjectUpdateTransform(),
b.x=this.worldTransform.tx,b.y=this.worldTransform.ty):(b.x=this.position.x,b.y=this.position.y);return b}},{"../core":97}],164:[function(b,c,f){b("./cacheAsBitmap");b("./getChildByName");b("./getGlobalPosition");c.exports={MovieClip:b("./MovieClip"),TilingSprite:b("./TilingSprite"),BitmapText:b("./BitmapText")}},{"./BitmapText":158,"./MovieClip":159,"./TilingSprite":160,"./cacheAsBitmap":161,"./getChildByName":162,"./getGlobalPosition":163}],165:[function(b,c,f){function a(a){e.call(this,a,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\n\nuniform vec4 uFrame;\nuniform vec4 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vec2 coord = aTextureCoord;\n    coord -= uTransform.xy;\n    coord /= uTransform.zw;\n    vTextureCoord = coord;\n}\n",
"#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform vec4 uFrame;\nuniform vec2 uPixelSize;\n\nvoid main(void)\n{\n\n   \tvec2 coord = mod(vTextureCoord, uFrame.zw);\n   \tcoord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);\n   \tcoord += uFrame.xy;\n\n   \tvec4 sample = texture2D(uSampler, coord);\n  \tvec4 color = vec4(uColor.rgb * uColor.a, uColor.a);\n\n   \tgl_FragColor = sample * color ;\n}\n")}var e=b("../../core/Shader");a.prototype=
Object.create(e.prototype);a.prototype.constructor=a;c.exports=a},{"../../core/Shader":77}],166:[function(b,c,f){function a(a,b,c){e.Filter.call(this);this.blurXFilter=new h;this.blurYFilter=new g;this.resolution=1;this.padding=0;this.resolution=c||1;this.quality=b||4;this.blur=a||8}var e=b("../../core"),h=b("./BlurXFilter"),g=b("./BlurYFilter");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.apply=function(a,b,c){var d=a.getRenderTarget(!0);this.blurXFilter.apply(a,
b,d,!0);this.blurYFilter.apply(a,d,c,!1);a.returnRenderTarget(d)};Object.defineProperties(a.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a;this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}},quality:{get:function(){return this.blurXFilter.quality},set:function(a){this.blurXFilter.quality=this.blurYFilter.quality=a}},blurX:{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=
a;this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}},blurY:{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a;this.padding=2*Math.max(Math.abs(this.blurYFilter.strength),Math.abs(this.blurYFilter.strength))}}})},{"../../core":97,"./BlurXFilter":167,"./BlurYFilter":168}],167:[function(b,c,f){function a(a,b,c){var d=h(5,!0),f=g(5);e.Filter.call(this,d,f);this.resolution=c||1;this._quality=0;this.quality=b||4;this.strength=
a||8;this.firstRun=!0}var e=b("../../core"),h=b("./generateBlurVertSource"),g=b("./generateBlurFragSource"),m=b("./getMaxBlurKernelSize");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.apply=function(a,b,c,d){if(this.firstRun){var e=m(a.renderer.gl);this.vertexSrc=h(e,!0);this.fragmentSrc=g(e);this.firstRun=!1}this.uniforms.strength=1/c.size.width*(c.size.width/b.size.width);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;
if(1===this.passes)a.applyFilter(this,b,c,d);else{for(var f=e=a.getRenderTarget(!0),t=0;t<this.passes-1;t++){a.applyFilter(this,b,f,!0);var q=f,f=b;b=q}a.applyFilter(this,b,c,d);a.returnRenderTarget(e)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=2*Math.abs(a);this.strength=a}},quality:{get:function(){return this._quality},set:function(a){this.passes=this._quality=a}}})},{"../../core":97,"./generateBlurFragSource":169,"./generateBlurVertSource":170,
"./getMaxBlurKernelSize":171}],168:[function(b,c,f){function a(a,b,c){var d=h(5,!1),f=g(5);e.Filter.call(this,d,f);this.resolution=c||1;this._quality=0;this.quality=b||4;this.strength=a||8;this.firstRun=!0}var e=b("../../core"),h=b("./generateBlurVertSource"),g=b("./generateBlurFragSource"),m=b("./getMaxBlurKernelSize");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.apply=function(a,b,c,d){if(this.firstRun){var e=m(a.renderer.gl);this.vertexSrc=h(e,
!1);this.fragmentSrc=g(e);this.firstRun=!1}this.uniforms.strength=1/c.size.height*(c.size.height/b.size.height);this.uniforms.strength*=this.strength;this.uniforms.strength/=this.passes;if(1===this.passes)a.applyFilter(this,b,c,d);else{for(var f=e=a.getRenderTarget(!0),t=0;t<this.passes-1;t++){a.applyFilter(this,b,f,!0);var q=f,f=b;b=q}a.applyFilter(this,b,c,d);a.returnRenderTarget(e)}};Object.defineProperties(a.prototype,{blur:{get:function(){return this.strength},set:function(a){this.padding=2*
Math.abs(a);this.strength=a}},quality:{get:function(){return this._quality},set:function(a){this.passes=this._quality=a}}})},{"../../core":97,"./generateBlurFragSource":169,"./generateBlurVertSource":170,"./getMaxBlurKernelSize":171}],169:[function(b,c,f){var a={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[4.89E-4,.002403,
.009246,.02784,.065602,.120999,.174697,.197448]};c.exports=function(b){for(var c=a[b],d=c.length,f="varying vec2 vBlurTexCoords[%size%];\nuniform sampler2D uSampler;\nvoid main(void)\n{\n\tgl_FragColor = vec4(0.0);\n\t%blur%\n}",n="",k,p=0;p<b;p++){var z="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",p);k=p;p>=d&&(k=b-p-1);z=z.replace("%value%",c[k]);n+=z;n+="\n"}f=f.replace("%blur%",n);return f=f.replace("%size%",b)}},{}],170:[function(b,c,f){c.exports=
function(a,b){var c=Math.ceil(a/2),d="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform float strength;\nuniform mat3 projectionMatrix;\nvarying vec2 vBlurTexCoords[%size%];\nvoid main(void)\n{\ngl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n%blur%\n}",f="",n;n=b?"vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";for(var k=0;k<a;k++)var p=
n.replace("%index%",k),p=p.replace("%sampleIndex%",k-(c-1)+".0"),f=f+p,f=f+"\n";d=d.replace("%blur%",f);return d=d.replace("%size%",a)}},{}],171:[function(b,c,f){c.exports=function(a){a=a.getParameter(a.MAX_VARYING_VECTORS);for(var b=15;b>a;)b-=2;return b}},{}],172:[function(b,c,f){function a(){e.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",
"#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4] * c.a;\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9] * c.a;\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14] * c.a;\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19] * c.a;\n\n//    gl_FragColor = vec4(m[0]);\n}\n");
this.uniforms.m=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}var e=b("../../core");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype._loadMatrix=function(a,b){var c=a;b&&(this._multiply(c,this.uniforms.m,a),c=this._colorMatrix(c));this.uniforms.m=c};a.prototype._multiply=function(a,b,c){a[0]=b[0]*c[0]+b[1]*c[5]+b[2]*c[10]+b[3]*c[15];a[1]=b[0]*c[1]+b[1]*c[6]+b[2]*c[11]+b[3]*c[16];a[2]=b[0]*c[2]+b[1]*c[7]+b[2]*c[12]+b[3]*c[17];a[3]=b[0]*c[3]+b[1]*c[8]+b[2]*
c[13]+b[3]*c[18];a[4]=b[0]*c[4]+b[1]*c[9]+b[2]*c[14]+b[3]*c[19];a[5]=b[5]*c[0]+b[6]*c[5]+b[7]*c[10]+b[8]*c[15];a[6]=b[5]*c[1]+b[6]*c[6]+b[7]*c[11]+b[8]*c[16];a[7]=b[5]*c[2]+b[6]*c[7]+b[7]*c[12]+b[8]*c[17];a[8]=b[5]*c[3]+b[6]*c[8]+b[7]*c[13]+b[8]*c[18];a[9]=b[5]*c[4]+b[6]*c[9]+b[7]*c[14]+b[8]*c[19];a[10]=b[10]*c[0]+b[11]*c[5]+b[12]*c[10]+b[13]*c[15];a[11]=b[10]*c[1]+b[11]*c[6]+b[12]*c[11]+b[13]*c[16];a[12]=b[10]*c[2]+b[11]*c[7]+b[12]*c[12]+b[13]*c[17];a[13]=b[10]*c[3]+b[11]*c[8]+b[12]*c[13]+b[13]*
c[18];a[14]=b[10]*c[4]+b[11]*c[9]+b[12]*c[14]+b[13]*c[19];a[15]=b[15]*c[0]+b[16]*c[5]+b[17]*c[10]+b[18]*c[15];a[16]=b[15]*c[1]+b[16]*c[6]+b[17]*c[11]+b[18]*c[16];a[17]=b[15]*c[2]+b[16]*c[7]+b[17]*c[12]+b[18]*c[17];a[18]=b[15]*c[3]+b[16]*c[8]+b[17]*c[13]+b[18]*c[18];a[19]=b[15]*c[4]+b[16]*c[9]+b[17]*c[14]+b[18]*c[19];return a};a.prototype._colorMatrix=function(a){a=new Float32Array(a);a[4]/=255;a[9]/=255;a[14]/=255;a[19]/=255;return a};a.prototype.brightness=function(a,b){this._loadMatrix([a,0,0,0,
0,0,a,0,0,0,0,0,a,0,0,0,0,0,1,0],b)};a.prototype.greyscale=function(a,b){this._loadMatrix([a,a,a,0,0,a,a,a,0,0,a,a,a,0,0,0,0,0,1,0],b)};a.prototype.grayscale=a.prototype.greyscale;a.prototype.blackAndWhite=function(a){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],a)};a.prototype.hue=function(a,b){a=(a||0)/180*Math.PI;var c=Math.cos(a),d=Math.sin(a),k=Math.sqrt,e=1/3,k=k(e);this._loadMatrix([c+(1-c)*e,e*(1-c)-k*d,e*(1-c)+k*d,0,0,e*(1-c)+k*d,c+e*(1-c),e*(1-c)-k*d,0,0,e*(1-c)-k*
d,e*(1-c)+k*d,c+e*(1-c),0,0,0,0,0,1,0],b)};a.prototype.contrast=function(a,b){var c=(a||0)+1,d=-128*(c-1);this._loadMatrix([c,0,0,0,d,0,c,0,0,d,0,0,c,0,d,0,0,0,1,0],b)};a.prototype.saturate=function(a,b){var c=2*(a||0)/3+1,d=-.5*(c-1);this._loadMatrix([c,d,d,0,0,d,c,d,0,0,d,d,c,0,0,0,0,0,1,0],b)};a.prototype.desaturate=function(){this.saturate(-1)};a.prototype.negative=function(a){this._loadMatrix([0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0],a)};a.prototype.sepia=function(a){this._loadMatrix([.393,.7689999,
.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],a)};a.prototype.technicolor=function(a){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],a)};a.prototype.polaroid=function(a){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,
0,0,0,0,0,1,0],a)};a.prototype.toBGR=function(a){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],a)};a.prototype.kodachrome=function(a){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],a)};a.prototype.browni=function(a){this._loadMatrix([.5997023498159715,.34553243048391263,
-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],a)};a.prototype.vintage=function(a){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],a)};
a.prototype.colorTone=function(a,b,c,d,k){c=c||16770432;d=d||3375104;var e=(c>>16&255)/255,f=(c>>8&255)/255;c=(c&255)/255;var r=(d>>16&255)/255,v=(d>>8&255)/255;d=(d&255)/255;this._loadMatrix([.3,.59,.11,0,0,e,f,c,a||.2,0,r,v,d,b||.15,0,e-r,f-v,c-d,0,0],k)};a.prototype.night=function(a,b){a=a||.1;this._loadMatrix([-2*a,-a,0,0,0,-a,0,a,0,0,0,a,2*a,0,0,0,0,0,1,0],b)};a.prototype.predator=function(a,b){this._loadMatrix([11.224130630493164*a,-4.794486999511719*a,-2.8746118545532227*a,0*a,.40342438220977783*
a,-3.6330697536468506*a,9.193157196044922*a,-2.951810836791992*a,0*a,-1.316135048866272*a,-3.2184197902679443*a,-4.2375030517578125*a,7.476448059082031*a,0*a,.8044459223747253*a,0,0,0,1,0],b)};a.prototype.lsd=function(a){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],a)};a.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)};Object.defineProperties(a.prototype,{matrix:{get:function(){return this.uniforms.m},set:function(a){this.uniforms.m=
a}}})},{"../../core":97}],173:[function(b,c,f){function a(a,b){var c=new e.Matrix;a.renderable=!1;e.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}",
"#define GLSLIFY 1\nvarying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n");this.maskSprite=a;this.maskMatrix=c;this.uniforms.mapSampler=
a.texture;this.uniforms.filterMatrix=c.toArray(!0);this.uniforms.scale={x:1,y:1};if(null===b||void 0===b)b=20;this.scale=new e.Point(b,b)}var e=b("../../core");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.apply=function(a,b,c){var d=1/c.destinationFrame.width*(c.size.width/b.size.width);this.uniforms.filterMatrix=a.calculateSpriteMatrix(this.maskMatrix,this.maskSprite);this.uniforms.scale.x=this.scale.x*d;this.uniforms.scale.y=this.scale.y*d;a.applyFilter(this,
b,c)};Object.defineProperties(a.prototype,{map:{get:function(){return this.uniforms.mapSampler},set:function(a){this.uniforms.mapSampler=a}}})},{"../../core":97}],174:[function(b,c,f){function a(){e.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}",
'#define GLSLIFY 1\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n  \tvec2 fragCoord = vTextureCoord * filterArea.xy;\n\n  \tvec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n  \tgl_FragColor = color;\n}\n')}
var e=b("../../core");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a},{"../../core":97}],175:[function(b,c,f){c.exports={FXAAFilter:b("./fxaa/FXAAFilter"),NoiseFilter:b("./noise/NoiseFilter"),DisplacementFilter:b("./displacement/DisplacementFilter"),BlurFilter:b("./blur/BlurFilter"),BlurXFilter:b("./blur/BlurXFilter"),BlurYFilter:b("./blur/BlurYFilter"),ColorMatrixFilter:b("./colormatrix/ColorMatrixFilter"),VoidFilter:b("./void/VoidFilter")}},{"./blur/BlurFilter":166,
"./blur/BlurXFilter":167,"./blur/BlurYFilter":168,"./colormatrix/ColorMatrixFilter":172,"./displacement/DisplacementFilter":173,"./fxaa/FXAAFilter":174,"./noise/NoiseFilter":176,"./void/VoidFilter":177}],176:[function(b,c,f){function a(){e.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",
"precision highp float;\n#define GLSLIFY 1\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(gl_FragCoord.xy) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n");this.noise=.5}var e=
b("../../core");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{noise:{get:function(){return this.uniforms.noise},set:function(a){this.uniforms.noise=a}}})},{"../../core":97}],177:[function(b,c,f){function a(){e.Filter.call(this,"#define GLSLIFY 1\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",
"#define GLSLIFY 1\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n");this.glShaderKey="void"}var e=b("../../core");a.prototype=Object.create(e.Filter.prototype);a.prototype.constructor=a;c.exports=a},{"../../core":97}],178:[function(b,c,f){function a(){this.global=new e.Point;this.originalEvent=this.target=null}var e=b("../core");a.prototype.constructor=a;c.exports=a;a.prototype.getLocalPosition=function(a,
b,c){return a.worldTransform.applyInverse(c||this.global,b)}},{"../core":97}],179:[function(b,c,f){function a(a,b){g.call(this);b=b||{};this.renderer=a;this.autoPreventDefault=void 0!==b.autoPreventDefault?b.autoPreventDefault:!0;this.interactionFrequency=b.interactionFrequency||10;this.mouse=new h;this.mouse.global.set(-999999);this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}};this.interactiveDataPool=[];this.interactionDOMElement=null;
this.eventsAdded=this.moveWhenInside=!1;this.onMouseUp=this.onMouseUp.bind(this);this.processMouseUp=this.processMouseUp.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.processMouseDown=this.processMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.processMouseMove=this.processMouseMove.bind(this);this.onMouseOut=this.onMouseOut.bind(this);this.processMouseOverOut=this.processMouseOverOut.bind(this);this.onMouseOver=this.onMouseOver.bind(this);this.onTouchStart=this.onTouchStart.bind(this);
this.processTouchStart=this.processTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.processTouchEnd=this.processTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.processTouchMove=this.processTouchMove.bind(this);this.currentCursorStyle=this.defaultCursorStyle="inherit";this._tempPoint=new e.Point;this.resolution=1;this.setTargetElement(this.renderer.view,this.renderer.resolution)}var e=b("../core"),h=b("./InteractionData"),g=b("eventemitter3");Object.assign(e.DisplayObject.prototype,
b("./interactiveTarget"));a.prototype=Object.create(g.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.setTargetElement=function(a,b){this.removeEvents();this.interactionDOMElement=a;this.resolution=b||1;this.addEvents()};a.prototype.addEvents=function(){this.interactionDOMElement&&(e.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",
this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onMouseOver,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",
this.onMouseUp,!0),this.eventsAdded=!0)};a.prototype.removeEvents=function(){this.interactionDOMElement&&(e.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",
this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onMouseOver,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)};a.prototype.update=function(a){this._deltaTime+=a;this._deltaTime<
this.interactionFrequency||(this._deltaTime=0,this.interactionDOMElement&&(this.didMove?this.didMove=!1:(this.cursor=this.defaultCursorStyle,this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor))))};a.prototype.dispatchEvent=function(a,b,c){if(!c.stopped&&(c.target=a,c.type=b,a.emit(b,c),a[b]))a[b](c)};a.prototype.mapPositionToPoint=
function(a,b,c){var d;d=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};a.x=this.interactionDOMElement.width/d.width*(b-d.left)/this.resolution;a.y=this.interactionDOMElement.height/d.height*(c-d.top)/this.resolution};a.prototype.processInteractive=function(a,b,c,d,e){if(!b||!b.visible)return!1;var f=!1,g=e=b.interactive||e;b.hitArea&&(g=!1);d&&b._mask&&(b._mask.containsPoint(a)||(d=!1));d&&b.filterArea&&(b.filterArea.contains(a.x,
a.y)||(d=!1));if(b.interactiveChildren)for(var h=b.children,q=h.length-1;0<=q;q--){var w=h[q];this.processInteractive(a,w,c,d,g)&&w.parent&&(f=!0,d=g=!1)}e&&(d&&!f&&(b.hitArea?(b.worldTransform.applyInverse(a,this._tempPoint),f=b.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):b.containsPoint&&(f=b.containsPoint(a))),b.interactive&&c(b,f));return f};a.prototype.onMouseDown=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,
a.clientX,a.clientY);this.autoPreventDefault&&this.mouse.originalEvent.preventDefault();this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0);this.emit(2===a.button||3===a.which?"rightdown":"mousedown",this.eventData)};a.prototype.processMouseDown=function(a,b){var c=this.mouse.originalEvent,c=2===c.button||3===c.which;b&&(a[c?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(a,c?"rightdown":"mousedown",this.eventData))};a.prototype.onMouseUp=function(a){this.mouse.originalEvent=
a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0);this.emit(2===a.button||3===a.which?"rightup":"mouseup",this.eventData)};a.prototype.processMouseUp=function(a,b){var c=this.mouse.originalEvent,d=(c=2===c.button||3===c.which)?"_isRightDown":"_isLeftDown";b?(this.dispatchEvent(a,c?"rightup":"mouseup",this.eventData),a[d]&&(a[d]=
!1,this.dispatchEvent(a,c?"rightclick":"click",this.eventData))):a[d]&&(a[d]=!1,this.dispatchEvent(a,c?"rightupoutside":"mouseupoutside",this.eventData))};a.prototype.onMouseMove=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.didMove=!0;this.cursor=this.defaultCursorStyle;this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0);this.emit("mousemove",
this.eventData);this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)};a.prototype.processMouseMove=function(a,b){this.processMouseOverOut(a,b);this.moveWhenInside&&!b||this.dispatchEvent(a,"mousemove",this.eventData)};a.prototype.onMouseOut=function(a){this.mouse.originalEvent=a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.interactionDOMElement.style.cursor=
this.defaultCursorStyle;this.mapPositionToPoint(this.mouse.global,a.clientX,a.clientY);this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1);this.emit("mouseout",this.eventData)};a.prototype.processMouseOverOut=function(a,b){b?(a._over||(a._over=!0,this.dispatchEvent(a,"mouseover",this.eventData)),a.buttonMode&&(this.cursor=a.defaultCursor)):a._over&&(a._over=!1,this.dispatchEvent(a,"mouseout",this.eventData))};a.prototype.onMouseOver=function(a){this.mouse.originalEvent=
a;this.eventData.data=this.mouse;this.eventData.stopped=!1;this.emit("mouseover",this.eventData)};a.prototype.onTouchStart=function(a){this.autoPreventDefault&&a.preventDefault();for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,this.processTouchStart,!0);this.emit("touchstart",this.eventData);this.returnTouchData(e)}};a.prototype.processTouchStart=
function(a,b){b&&(a._touchDown=!0,this.dispatchEvent(a,"touchstart",this.eventData))};a.prototype.onTouchEnd=function(a){this.autoPreventDefault&&a.preventDefault();for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0);this.emit("touchend",this.eventData);this.returnTouchData(e)}};a.prototype.processTouchEnd=function(a,
b){b?(this.dispatchEvent(a,"touchend",this.eventData),a._touchDown&&(a._touchDown=!1,this.dispatchEvent(a,"tap",this.eventData))):a._touchDown&&(a._touchDown=!1,this.dispatchEvent(a,"touchendoutside",this.eventData))};a.prototype.onTouchMove=function(a){this.autoPreventDefault&&a.preventDefault();for(var b=a.changedTouches,c=b.length,d=0;d<c;d++){var e=this.getTouchData(b[d]);e.originalEvent=a;this.eventData.data=e;this.eventData.stopped=!1;this.processInteractive(e.global,this.renderer._lastObjectRendered,
this.processTouchMove,this.moveWhenInside);this.emit("touchmove",this.eventData);this.returnTouchData(e)}};a.prototype.processTouchMove=function(a,b){this.moveWhenInside&&!b||this.dispatchEvent(a,"touchmove",this.eventData)};a.prototype.getTouchData=function(a){var b=this.interactiveDataPool.pop();b||(b=new h);b.identifier=a.identifier;this.mapPositionToPoint(b.global,a.clientX,a.clientY);navigator.isCocoonJS&&(b.global.x/=this.resolution,b.global.y/=this.resolution);a.globalX=b.global.x;a.globalY=
b.global.y;return b};a.prototype.returnTouchData=function(a){this.interactiveDataPool.push(a)};a.prototype.destroy=function(){this.removeEvents();this.removeAllListeners();this._tempPoint=this.processTouchMove=this.onTouchMove=this.processTouchEnd=this.onTouchEnd=this.processTouchStart=this.onTouchStart=this.onMouseOver=this.processMouseOverOut=this.onMouseOut=this.processMouseMove=this.onMouseMove=this.processMouseDown=this.onMouseDown=this.processMouseUp=this.onMouseUp=this.interactionDOMElement=
this.interactiveDataPool=this.eventData=this.mouse=this.renderer=null};e.WebGLRenderer.registerPlugin("interaction",a);e.CanvasRenderer.registerPlugin("interaction",a)},{"../core":97,"./InteractionData":178,"./interactiveTarget":181,eventemitter3:32}],180:[function(b,c,f){c.exports={InteractionData:b("./InteractionData"),InteractionManager:b("./InteractionManager"),interactiveTarget:b("./interactiveTarget")}},{"./InteractionData":178,"./InteractionManager":179,"./interactiveTarget":181}],181:[function(b,
c,f){c.exports={interactive:!1,interactiveChildren:!0,hitArea:null,buttonMode:!1,defaultCursor:"pointer",_over:!1,_isLeftDown:!1,_isRightDown:!1,_touchDown:!1}},{}],182:[function(b,c,f){function a(a,b){var c={},d=a.data.getElementsByTagName("info")[0],e=a.data.getElementsByTagName("common")[0];c.font=d.getAttribute("face");c.size=parseInt(d.getAttribute("size"),10);c.lineHeight=parseInt(e.getAttribute("lineHeight"),10);c.chars={};e=a.data.getElementsByTagName("char");for(d=0;d<e.length;d++){var f=
parseInt(e[d].getAttribute("id"),10),m=new h.Rectangle(parseInt(e[d].getAttribute("x"),10)+b.frame.x,parseInt(e[d].getAttribute("y"),10)+b.frame.y,parseInt(e[d].getAttribute("width"),10),parseInt(e[d].getAttribute("height"),10));c.chars[f]={xOffset:parseInt(e[d].getAttribute("xoffset"),10),yOffset:parseInt(e[d].getAttribute("yoffset"),10),xAdvance:parseInt(e[d].getAttribute("xadvance"),10),kerning:{},texture:new h.Texture(b.baseTexture,m)}}e=a.data.getElementsByTagName("kerning");for(d=0;d<e.length;d++){var f=
parseInt(e[d].getAttribute("first"),10),m=parseInt(e[d].getAttribute("second"),10),q=parseInt(e[d].getAttribute("amount"),10);c.chars[m]&&(c.chars[m].kerning[f]=q)}a.bitmapFont=c;g.BitmapText.fonts[c.font]=c}var e=b("resource-loader").Resource,h=b("../core"),g=b("../extras"),m=b("path");c.exports=function(){return function(b,c){if(!b.data||!b.isXml||0===b.data.getElementsByTagName("page").length||0===b.data.getElementsByTagName("info").length||null===b.data.getElementsByTagName("info")[0].getAttribute("face"))return c();
var d=b.isDataUrl?"":m.dirname(b.url);b.isDataUrl&&("."===d&&(d=""),this.baseUrl&&d&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(d+="/"),d=d.replace(this.baseUrl,"")));d&&"/"!==d.charAt(d.length-1)&&(d+="/");d+=b.data.getElementsByTagName("page")[0].getAttribute("file");h.utils.TextureCache[d]?(a(b,h.utils.TextureCache[d]),c()):this.add(b.name+"_image",d,{crossOrigin:b.crossOrigin,loadType:e.LOAD_TYPE.IMAGE,metadata:b.metadata.imageMetadata},function(d){a(b,d.texture);c()})}}},{"../core":97,
"../extras":164,path:60,"resource-loader":69}],183:[function(b,c,f){c.exports={Loader:b("./loader"),bitmapFontParser:b("./bitmapFontParser"),spritesheetParser:b("./spritesheetParser"),textureParser:b("./textureParser"),Resource:b("resource-loader").Resource}},{"./bitmapFontParser":182,"./loader":184,"./spritesheetParser":185,"./textureParser":186,"resource-loader":69}],184:[function(b,c,f){function a(b,c){e.call(this,b,c);for(var d=0;d<a._pixiMiddleware.length;++d)this.use(a._pixiMiddleware[d]())}
var e=b("resource-loader");f=b("./textureParser");var h=b("./spritesheetParser");b=b("./bitmapFontParser");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a._pixiMiddleware=[e.middleware.parsing.blob,f,h,b];a.addPixiMiddleware=function(b){a._pixiMiddleware.push(b)};c=e.Resource;c.setExtensionXhrType("fnt",c.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":182,"./spritesheetParser":185,"./textureParser":186,"resource-loader":69}],185:[function(b,c,f){var a=b("resource-loader").Resource,
e=b("path"),h=b("../core");c.exports=function(){return function(b,c){var d,k=b.name+"_image";if(!b.data||!b.isJson||!b.data.frames||this.resources[k])return c();var f={crossOrigin:b.crossOrigin,loadType:a.LOAD_TYPE.IMAGE,metadata:b.metadata.imageMetadata};d=b.isDataUrl?b.data.meta.image:e.dirname(b.url.replace(this.baseUrl,""))+"/"+b.data.meta.image;this.add(k,d,f,function(a){function d(c,k){for(var e=c;e-c<k&&e<p.length;){var m=p[e],r=f[m].frame;if(r){var t=null,v=new h.Rectangle(0,0,f[m].sourceSize.w/
n,f[m].sourceSize.h/n),r=f[m].rotated?new h.Rectangle(r.x/n,r.y/n,r.h/n,r.w/n):new h.Rectangle(r.x/n,r.y/n,r.w/n,r.h/n);f[m].trimmed&&(t=new h.Rectangle(f[m].spriteSourceSize.x/n,f[m].spriteSourceSize.y/n,f[m].spriteSourceSize.w/n,f[m].spriteSourceSize.h/n));b.textures[m]=new h.Texture(a.texture.baseTexture,r,v,t,f[m].rotated?2:0);h.utils.TextureCache[m]=b.textures[m]}e++}}function k(a){d(1E3*y,1E3);y++;setTimeout(a,0)}function e(){k(function(){1E3*y<p.length?e():c()})}b.textures={};var f=b.data.frames,
p=Object.keys(f),n=h.utils.getResolutionOfUrl(b.url),y=0;1E3>=p.length?(d(0,1E3),c()):e()})}}},{"../core":97,path:60,"resource-loader":69}],186:[function(b,c,f){var a=b("../core");c.exports=function(){return function(b,c){if(b.data&&b.isImage){var d=new a.BaseTexture(b.data,null,a.utils.getResolutionOfUrl(b.url));d.imageUrl=b.url;b.texture=new a.Texture(d);a.utils.BaseTextureCache[b.url]=d;a.utils.TextureCache[b.url]=b.texture}c()}}},{"../core":97}],187:[function(b,c,f){function a(b,c,d,f,h){e.Container.call(this);
this._texture=null;this.uvs=d||new Float32Array([0,0,1,0,1,1,0,1]);this.vertices=c||new Float32Array([0,0,100,0,100,100,0,100]);this.indices=f||new Uint16Array([0,1,3,2]);this.indexDirty=this.dirty=0;this.blendMode=e.BLEND_MODES.NORMAL;this.canvasPadding=0;this.drawMode=h||a.DRAW_MODES.TRIANGLE_MESH;this.texture=b;this.shader=null;this.tintRgb=new Float32Array([1,1,1]);this._glDatas=[]}var e=b("../core"),h=b("pixi-gl-core"),g=b("./webgl/MeshShader"),m=new e.Point,n=new e.Polygon;a.prototype=Object.create(e.Container.prototype);
a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{texture:{get:function(){return this._texture},set:function(a){if(this._texture!==a&&(this._texture=a))if(a.baseTexture.hasLoaded)this._onTextureUpdate();else a.once("update",this._onTextureUpdate,this)}},tint:{get:function(){return e.utils.rgb2hex(this.tintRgb)},set:function(a){this.tintRgb=e.utils.hex2rgb(a,this.tintRgb)}}});a.prototype._renderWebGL=function(b){b.flush();var c=b.gl,d=this._glDatas[b.CONTEXT_UID];d||(d={shader:new g(c),
vertexBuffer:h.GLBuffer.createVertexBuffer(c,this.vertices,c.STREAM_DRAW),uvBuffer:h.GLBuffer.createVertexBuffer(c,this.uvs,c.STREAM_DRAW),indexBuffer:h.GLBuffer.createIndexBuffer(c,this.indices,c.STATIC_DRAW),vao:new h.VertexArrayObject(c),dirty:this.dirty,indexDirty:this.indexDirty},d.vao=(new h.VertexArrayObject(c)).addIndex(d.indexBuffer).addAttribute(d.vertexBuffer,d.shader.attributes.aVertexPosition,c.FLOAT,!1,8,0).addAttribute(d.uvBuffer,d.shader.attributes.aTextureCoord,c.FLOAT,!1,8,0),this._glDatas[b.CONTEXT_UID]=
d);this.dirty!==d.dirty&&(d.dirty=this.dirty,d.uvBuffer.upload());this.indexDirty!==d.indexDirty&&(d.indexDirty=this.indexDirty,d.indexBuffer.upload());d.vertexBuffer.upload();b.bindShader(d.shader);b.bindTexture(this._texture,0);b.state.setBlendMode(this.blendMode);d.shader.uniforms.translationMatrix=this.worldTransform.toArray(!0);d.shader.uniforms.alpha=this.worldAlpha;d.shader.uniforms.tint=this.tintRgb;b=this.drawMode===a.DRAW_MODES.TRIANGLE_MESH?c.TRIANGLE_STRIP:c.TRIANGLES;d.vao.bind().draw(b,
this.indices.length).unbind()};a.prototype._renderCanvas=function(b){var c=b.context,d=this.worldTransform,e=b.resolution;b.roundPixels?c.setTransform(d.a*e,d.b*e,d.c*e,d.d*e,d.tx*e|0,d.ty*e|0):c.setTransform(d.a*e,d.b*e,d.c*e,d.d*e,d.tx*e,d.ty*e);this.drawMode===a.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(c):this._renderCanvasTriangles(c)};a.prototype._renderCanvasTriangleMesh=function(a){for(var b=this.vertices,c=this.uvs,d=b.length/2,e=0;e<d-2;e++){var f=2*e;this._renderCanvasDrawTriangle(a,
b,c,f,f+2,f+4)}};a.prototype._renderCanvasTriangles=function(a){for(var b=this.vertices,c=this.uvs,d=this.indices,e=d.length,f=0;f<e;f+=3)this._renderCanvasDrawTriangle(a,b,c,2*d[f],2*d[f+1],2*d[f+2])};a.prototype._renderCanvasDrawTriangle=function(a,b,c,d,e,f){var h=this._texture.baseTexture,g=h.source,m=h.width,n=h.height,x=b[d],A=b[e],F=b[f],H=b[d+1],D=b[e+1];b=b[f+1];var E=c[d]*h.width,I=c[e]*h.width,J=c[f]*h.width;d=c[d+1]*h.height;e=c[e+1]*h.height;c=c[f+1]*h.height;if(0<this.canvasPadding){f=
this.canvasPadding/this.worldTransform.a;var B=this.canvasPadding/this.worldTransform.d,C=(x+A+F)/3,M=(H+D+b)/3,G=x-C,P=H-M,Q=Math.sqrt(G*G+P*P),x=C+G/Q*(Q+f),H=M+P/Q*(Q+B),G=A-C,P=D-M,Q=Math.sqrt(G*G+P*P),A=C+G/Q*(Q+f),D=M+P/Q*(Q+B),G=F-C,P=b-M,Q=Math.sqrt(G*G+P*P),F=C+G/Q*(Q+f);b=M+P/Q*(Q+B)}a.save();a.beginPath();a.moveTo(x,H);a.lineTo(A,D);a.lineTo(F,b);a.closePath();a.clip();f=E*e+d*J+I*c-e*J-d*I-E*c;a.transform((x*e+d*F+A*c-e*F-d*A-x*c)/f,(H*e+d*b+D*c-e*b-d*D-H*c)/f,(E*A+x*J+I*F-A*J-x*I-E*F)/
f,(E*D+H*J+I*b-D*J-H*I-E*b)/f,(E*e*F+d*A*J+x*I*c-x*e*J-d*I*F-E*A*c)/f,(E*e*b+d*D*J+H*I*c-H*e*J-d*I*b-E*D*c)/f);a.drawImage(g,0,0,m*h.resolution,n*h.resolution,0,0,m,n);a.restore()};a.prototype.renderMeshFlat=function(a){var b=this.context;a=a.vertices;var c=a.length/2;b.beginPath();for(var d=1;d<c-2;d++){var e=2*d,f=a[e+2],h=a[e+4],g=a[e+3],m=a[e+5];b.moveTo(a[e],a[e+1]);b.lineTo(f,g);b.lineTo(h,m)}b.fillStyle="#FF0000";b.fill();b.closePath()};a.prototype._onTextureUpdate=function(){};a.prototype._calculateBounds=
function(){this._bounds.addVertices(this.transform,this.vertices,0,this.vertices.length)};a.prototype.containsPoint=function(b){if(!this.getBounds().contains(b.x,b.y))return!1;this.worldTransform.applyInverse(b,m);b=this.vertices;for(var c=n.points,d=this.indices,e=this.indices.length,f=this.drawMode===a.DRAW_MODES.TRIANGLES?3:1,h=0;h+2<e;h+=f){var g=2*d[h],w=2*d[h+1],u=2*d[h+2];c[0]=b[g];c[1]=b[g+1];c[2]=b[w];c[3]=b[w+1];c[4]=b[u];c[5]=b[u+1];if(n.contains(m.x,m.y))return!0}return!1};a.DRAW_MODES=
{TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":97,"./webgl/MeshShader":192,"pixi-gl-core":7}],188:[function(b,c,f){function a(a,b,c,d,f){e.call(this,a,4,4);var p=this.uvs;p[6]=p[14]=p[22]=p[30]=1;p[25]=p[27]=p[29]=p[31]=1;this._origWidth=a.width;this._origHeight=a.height;this._uvw=1/this._origWidth;this._uvh=1/this._origHeight;this.width=a.width;this.height=a.height;p[2]=p[10]=p[18]=p[26]=this._uvw*b;p[4]=p[12]=p[20]=p[28]=1-this._uvw*d;p[9]=p[11]=p[13]=p[15]=this._uvh*c;p[17]=p[19]=p[21]=p[23]=1-this._uvh*
f;this.leftWidth="undefined"!==typeof b?b:10;this.rightWidth="undefined"!==typeof d?d:10;this.topHeight="undefined"!==typeof c?c:10;this.bottomHeight="undefined"!==typeof f?f:10}var e=b("./Plane");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;Object.defineProperties(a.prototype,{width:{get:function(){return this._width},set:function(a){this._width=a;this.updateVerticalVertices()}},height:{get:function(){return this._height},set:function(a){this._height=a;this.updateHorizontalVertices()}},
leftWidth:{get:function(){return this._leftWidth},set:function(a){this._leftWidth=a;var b=this.uvs,c=this.vertices;b[2]=b[10]=b[18]=b[26]=this._uvw*a;c[2]=c[10]=c[18]=c[26]=a;this.dirty=!0}},rightWidth:{get:function(){return this._rightWidth},set:function(a){this._rightWidth=a;var b=this.uvs,c=this.vertices;b[4]=b[12]=b[20]=b[28]=1-this._uvw*a;c[4]=c[12]=c[20]=c[28]=this._width-a;this.dirty=!0}},topHeight:{get:function(){return this._topHeight},set:function(a){this._topHeight=a;var b=this.uvs,c=this.vertices;
b[9]=b[11]=b[13]=b[15]=this._uvh*a;c[9]=c[11]=c[13]=c[15]=a;this.dirty=!0}},bottomHeight:{get:function(){return this._bottomHeight},set:function(a){this._bottomHeight=a;var b=this.uvs,c=this.vertices;b[17]=b[19]=b[21]=b[23]=1-this._uvh*a;c[17]=c[19]=c[21]=c[23]=this._height-a;this.dirty=!0}}});a.prototype.updateHorizontalVertices=function(){var a=this.vertices;a[9]=a[11]=a[13]=a[15]=this._topHeight;a[17]=a[19]=a[21]=a[23]=this._height-this._bottomHeight;a[25]=a[27]=a[29]=a[31]=this._height};a.prototype.updateVerticalVertices=
function(){var a=this.vertices;a[2]=a[10]=a[18]=a[26]=this._leftWidth;a[4]=a[12]=a[20]=a[28]=this._width-this._rightWidth;a[6]=a[14]=a[22]=a[30]=this._width};a.prototype._renderCanvas=function(a){var b=a.context;b.globalAlpha=this.worldAlpha;var c=this.worldTransform,d=a.resolution;a.roundPixels?b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,c.tx*d|0,c.ty*d|0):b.setTransform(c.a*d,c.b*d,c.c*d,c.d*d,c.tx*d,c.ty*d);d=this._texture.baseTexture;a=d.source;c=d.width;d=d.height;this.drawSegment(b,a,c,d,0,1,10,
11);this.drawSegment(b,a,c,d,2,3,12,13);this.drawSegment(b,a,c,d,4,5,14,15);this.drawSegment(b,a,c,d,8,9,18,19);this.drawSegment(b,a,c,d,10,11,20,21);this.drawSegment(b,a,c,d,12,13,22,23);this.drawSegment(b,a,c,d,16,17,26,27);this.drawSegment(b,a,c,d,18,19,28,29);this.drawSegment(b,a,c,d,20,21,30,31)};a.prototype.drawSegment=function(a,b,c,d,e,f,z,r){var v=this.uvs,t=this.vertices,q=(v[z]-v[e])*c,w=(v[r]-v[f])*d;z=t[z]-t[e];r=t[r]-t[f];1>q&&(q=1);1>w&&(w=1);1>z&&(z=1);1>r&&(r=1);a.drawImage(b,v[e]*
c,v[f]*d,q,w,t[e],t[f],z,r)}},{"./Plane":189}],189:[function(b,c,f){function a(a,b,c){e.call(this,a);this._ready=!0;this.verticesX=b||10;this.verticesY=c||10;this.drawMode=e.DRAW_MODES.TRIANGLES;this.refresh()}var e=b("./Mesh");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.refresh=function(){var a=this.verticesX*this.verticesY,b=[],c=[],d=[],e=this.texture,f=this.verticesX-1,z=this.verticesY-1,r,v=e.width/f,t=e.height/z;for(r=0;r<a;r++){var q=r%this.verticesX,
w=r/this.verticesX|0;b.push(q*v,w*t);c.push(e._uvs.x0+q/(this.verticesX-1)*(e._uvs.x1-e._uvs.x0),e._uvs.y0+w/(this.verticesY-1)*(e._uvs.y3-e._uvs.y0))}a=f*z;for(r=0;r<a;r++)e=r%f,z=r/f|0,v=z*this.verticesX+e+1,t=(z+1)*this.verticesX+e,q=(z+1)*this.verticesX+e+1,d.push(z*this.verticesX+e,v,t),d.push(v,q,t);this.vertices=new Float32Array(b);this.uvs=new Float32Array(c);this.colors=new Float32Array([]);this.indices=new Uint16Array(d);this.indexDirty=!0};a.prototype._onTextureUpdate=function(){e.prototype._onTextureUpdate.call(this);
this._ready&&this.refresh()}},{"./Mesh":187}],190:[function(b,c,f){function a(a,b){e.call(this,a);this.points=b;this.vertices=new Float32Array(4*b.length);this.uvs=new Float32Array(4*b.length);this.colors=new Float32Array(2*b.length);this.indices=new Uint16Array(2*b.length);this._ready=!0;this.refresh()}var e=b("./Mesh"),h=b("../core");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.refresh=function(){var a=this.points;if(!(1>a.length)&&this._texture._uvs){var b=
this.uvs,c=this.indices,d=this.colors,e=this._texture._uvs,f=new h.Point(e.x0,e.y0),e=new h.Point(e.x2-e.x0,e.y2-e.y0);b[0]=0+f.x;b[1]=0+f.y;b[2]=0+f.x;b[3]=1*e.y+f.y;d[0]=1;d[1]=1;c[0]=0;c[1]=1;for(var a=a.length,r,v,t=1;t<a;t++)r=4*t,v=t/(a-1),b[r]=v*e.x+f.x,b[r+1]=0+f.y,b[r+2]=v*e.x+f.x,b[r+3]=1*e.y+f.y,r=2*t,d[r]=1,d[r+1]=1,r=2*t,c[r]=r,c[r+1]=r+1;this.indexDirty=this.dirty=!0}};a.prototype._onTextureUpdate=function(){e.prototype._onTextureUpdate.call(this);this._ready&&this.refresh()};a.prototype.updateTransform=
function(){var a=this.points;if(!(1>a.length)){for(var b=a[0],c,d,e=this.vertices,f=a.length,h,v,t,q=0;q<f;q++)h=a[q],v=4*q,c=q<a.length-1?a[q+1]:h,d=-(c.x-b.x),b=c.y-b.y,c=Math.sqrt(b*b+d*d),t=this._texture.height/2,b/=c,d/=c,b*=t,d*=t,e[v]=h.x+b,e[v+1]=h.y+d,e[v+2]=h.x-b,e[v+3]=h.y-d,b=h;this.containerUpdateTransform()}}},{"../core":97,"./Mesh":187}],191:[function(b,c,f){c.exports={Mesh:b("./Mesh"),Plane:b("./Plane"),NineSlicePlane:b("./NineSlicePlane"),Rope:b("./Rope"),MeshShader:b("./webgl/MeshShader")}},
{"./Mesh":187,"./NineSlicePlane":188,"./Plane":189,"./Rope":190,"./webgl/MeshShader":192}],192:[function(b,c,f){function a(a){e.call(this,a,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nuniform mat3 translationMatrix;\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\nuniform float alpha;\nuniform vec3 tint;\nuniform sampler2D uSampler;\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * vec4(tint * alpha, alpha);\n}")}
var e=b("../../core/Shader");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a},{"../../core/Shader":77}],193:[function(b,c,f){function a(a,b,c){e.Container.call(this);c=c||15E3;a=a||15E3;16384<c&&(c=16384);c>a&&(c=a);this._properties=[!1,!0,!1,!1,!1];this._maxSize=a;this._batchSize=c;this._glBuffers=[];this._bufferToUpdate=0;this.interactiveChildren=!1;this.blendMode=e.BLEND_MODES.NORMAL;this.roundPixels=!0;this.baseTexture=null;this.setProperties(b)}var e=b("../core");
a.prototype=Object.create(e.Container.prototype);a.prototype.constructor=a;c.exports=a;a.prototype.setProperties=function(a){a&&(this._properties[0]="scale"in a?!!a.scale:this._properties[0],this._properties[1]="position"in a?!!a.position:this._properties[1],this._properties[2]="rotation"in a?!!a.rotation:this._properties[2],this._properties[3]="uvs"in a?!!a.uvs:this._properties[3],this._properties[4]="alpha"in a?!!a.alpha:this._properties[4])};a.prototype.updateTransform=function(){this.displayObjectUpdateTransform()};
a.prototype.renderWebGL=function(a){if(this.visible&&!(0>=this.worldAlpha)&&this.children.length&&this.renderable){if(!this.baseTexture&&(this.baseTexture=this.children[0]._texture.baseTexture,!this.baseTexture.hasLoaded))this.baseTexture.once("update",function(){this.onChildrenChange(0)},this);a.setObjectRenderer(a.plugins.particle);a.plugins.particle.render(this)}};a.prototype.onChildrenChange=function(a){a=Math.floor(a/this._batchSize);a<this._bufferToUpdate&&(this._bufferToUpdate=a)};a.prototype.renderCanvas=
function(a){if(this.visible&&!(0>=this.worldAlpha)&&this.children.length&&this.renderable){var b=a.context,c=this.worldTransform,d=!0,e,f,z,r,v=a.blendModes[this.blendMode];v!==b.globalCompositeOperation&&(b.globalCompositeOperation=v);b.globalAlpha=this.worldAlpha;this.displayObjectUpdateTransform();for(v=0;v<this.children.length;++v){var t=this.children[v];if(t.visible){var q=t.texture.frame;b.globalAlpha=this.worldAlpha*t.alpha;0===t.rotation%(2*Math.PI)?(d&&(b.setTransform(c.a,c.b,c.c,c.d,c.tx*
a.resolution,c.ty*a.resolution),d=!1),e=t.anchor.x*-q.width*t.scale.x+t.position.x+.5,f=t.anchor.y*-q.height*t.scale.y+t.position.y+.5,z=q.width*t.scale.x,r=q.height*t.scale.y):(d||(d=!0),t.displayObjectUpdateTransform(),e=t.worldTransform,a.roundPixels?b.setTransform(e.a,e.b,e.c,e.d,e.tx*a.resolution|0,e.ty*a.resolution|0):b.setTransform(e.a,e.b,e.c,e.d,e.tx*a.resolution,e.ty*a.resolution),e=t.anchor.x*-q.width+.5,f=t.anchor.y*-q.height+.5,z=q.width,r=q.height);var w=t.texture.baseTexture.resolution;
b.drawImage(t.texture.baseTexture.source,q.x*w,q.y*w,q.width*w,q.height*w,e*w,f*w,z*w,r*w)}}}};a.prototype.destroy=function(){e.Container.prototype.destroy.apply(this,arguments);if(this._buffers)for(var a=0;a<this._buffers.length;++a)this._buffers[a].destroy();this._buffers=this._properties=null}},{"../core":97}],194:[function(b,c,f){c.exports={ParticleContainer:b("./ParticleContainer"),ParticleRenderer:b("./webgl/ParticleRenderer")}},{"./ParticleContainer":193,"./webgl/ParticleRenderer":196}],195:[function(b,
c,f){function a(a,b,c,d){this.gl=a;this.vertSize=2;this.vertByteSize=4*this.vertSize;this.size=d;this.dynamicProperties=[];this.staticProperties=[];for(a=0;a<b.length;a++)d=b[a],d={attribute:d.attribute,size:d.size,uploadFunction:d.uploadFunction,offset:d.offset},c[a]?this.dynamicProperties.push(d):this.staticProperties.push(d);this.staticStride=0;this.staticData=this.staticBuffer=null;this.dynamicStride=0;this.dynamicData=this.dynamicBuffer=null;this.initBuffers()}var e=b("pixi-gl-core"),h=b("../../core/utils/createIndicesForQuads");
a.prototype.constructor=a;c.exports=a;a.prototype.initBuffers=function(){var a=this.gl,b,c,d=0;this.indices=h(this.size);this.indexBuffer=e.GLBuffer.createIndexBuffer(a,this.indices,a.STATIC_DRAW);for(b=this.dynamicStride=0;b<this.dynamicProperties.length;b++)c=this.dynamicProperties[b],c.offset=d,d+=c.size,this.dynamicStride+=c.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4);this.dynamicBuffer=e.GLBuffer.createVertexBuffer(a,this.dynamicData,a.STREAM_DRAW);for(b=this.staticStride=
d=0;b<this.staticProperties.length;b++)c=this.staticProperties[b],c.offset=d,d+=c.size,this.staticStride+=c.size;this.staticData=new Float32Array(this.size*this.staticStride*4);this.staticBuffer=e.GLBuffer.createVertexBuffer(a,this.staticData,a.STATIC_DRAW);this.vao=(new e.VertexArrayObject(a)).addIndex(this.indexBuffer);for(b=0;b<this.dynamicProperties.length;b++)c=this.dynamicProperties[b],this.vao.addAttribute(this.dynamicBuffer,c.attribute,a.FLOAT,!1,4*this.dynamicStride,4*c.offset);for(b=0;b<
this.staticProperties.length;b++)c=this.staticProperties[b],this.vao.addAttribute(this.staticBuffer,c.attribute,a.FLOAT,!1,4*this.staticStride,4*c.offset)};a.prototype.uploadDynamic=function(a,b,c){for(var d=0;d<this.dynamicProperties.length;d++){var e=this.dynamicProperties[d];e.uploadFunction(a,b,c,this.dynamicData,this.dynamicStride,e.offset)}this.dynamicBuffer.upload()};a.prototype.uploadStatic=function(a,b,c){for(var d=0;d<this.staticProperties.length;d++){var e=this.staticProperties[d];e.uploadFunction(a,
b,c,this.staticData,this.staticStride,e.offset)}this.staticBuffer.upload()};a.prototype.bind=function(){this.vao.bind()};a.prototype.destroy=function(){this.dynamicData=this.dynamicProperties=null;this.dynamicBuffer.destroy();this.staticData=this.staticProperties=null;this.staticBuffer.destroy()}},{"../../core/utils/createIndicesForQuads":149,"pixi-gl-core":7}],196:[function(b,c,f){function a(a){e.ObjectRenderer.call(this,a);this.properties=this.indexBuffer=this.shader=null;this.tempMatrix=new e.Matrix;
this.CONTEXT_UID=0}var e=b("../../core"),h=b("./ParticleShader"),g=b("./ParticleBuffer");a.prototype=Object.create(e.ObjectRenderer.prototype);a.prototype.constructor=a;c.exports=a;e.WebGLRenderer.registerPlugin("particle",a);a.prototype.onContextChange=function(){var a=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID;this.shader=new h(a);this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,
size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]};a.prototype.start=function(){this.renderer.bindShader(this.shader)};a.prototype.render=function(a){var b=a.children,c=b.length,d=a._maxSize,e=a._batchSize;if(0!==c){c>
d&&(c=d);(d=a._glBuffers[this.renderer.CONTEXT_UID])||(d=a._glBuffers[this.renderer.CONTEXT_UID]=this.generateBuffers(a));this.renderer.setBlendMode(a.blendMode);var f=this.renderer.gl,h=a.worldTransform.copy(this.tempMatrix);h.prepend(this.renderer._activeRenderTarget.projectionMatrix);this.shader.uniforms.projectionMatrix=h.toArray(!0);this.shader.uniforms.uAlpha=a.worldAlpha;this.renderer.bindTexture(b[0]._texture.baseTexture);for(var g=h=0;h<c;h+=e,g+=1){var q=c-h;q>e&&(q=e);var w=d[g];w.uploadDynamic(b,
h,q);a._bufferToUpdate===g&&(w.uploadStatic(b,h,q),a._bufferToUpdate=g+1);w.vao.bind().draw(f.TRIANGLES,6*q).unbind()}}};a.prototype.generateBuffers=function(a){var b=this.renderer.gl,c=[],d=a._maxSize,e=a._batchSize;a=a._properties;var f;for(f=0;f<d;f+=e)c.push(new g(b,this.properties,a,e));return c};a.prototype.uploadVertices=function(a,b,c,d,e,f){for(var h,g,q,w,u,y,x,A=0;A<c;A++)h=a[b+A],g=h._texture,u=h.scale.x,y=h.scale.y,q=g.trim,w=g.orig,q?(x=q.x-h.anchor.x*w.width,g=x+q.width,h=q.y-h.anchor.y*
w.height,q=h+q.height):(g=w.width*(1-h.anchor.x),x=w.width*-h.anchor.x,q=w.height*(1-h.anchor.y),h=w.height*-h.anchor.y),d[f]=x*u,d[f+1]=h*y,d[f+e]=g*u,d[f+e+1]=h*y,d[f+2*e]=g*u,d[f+2*e+1]=q*y,d[f+3*e]=x*u,d[f+3*e+1]=q*y,f+=4*e};a.prototype.uploadPosition=function(a,b,c,d,e,f){for(var h=0;h<c;h++){var g=a[b+h].position;d[f]=g.x;d[f+1]=g.y;d[f+e]=g.x;d[f+e+1]=g.y;d[f+2*e]=g.x;d[f+2*e+1]=g.y;d[f+3*e]=g.x;d[f+3*e+1]=g.y;f+=4*e}};a.prototype.uploadRotation=function(a,b,c,d,e,f){for(var h=0;h<c;h++){var g=
a[b+h].rotation;d[f]=g;d[f+e]=g;d[f+2*e]=g;d[f+3*e]=g;f+=4*e}};a.prototype.uploadUvs=function(a,b,c,d,e,f){for(var h=0;h<c;h++){var g=a[b+h]._texture._uvs;g?(d[f]=g.x0,d[f+1]=g.y0,d[f+e]=g.x1,d[f+e+1]=g.y1,d[f+2*e]=g.x2,d[f+2*e+1]=g.y2,d[f+3*e]=g.x3,d[f+3*e+1]=g.y3):(d[f]=0,d[f+1]=0,d[f+e]=0,d[f+e+1]=0,d[f+2*e]=0,d[f+2*e+1]=0,d[f+3*e]=0,d[f+3*e+1]=0);f+=4*e}};a.prototype.uploadAlpha=function(a,b,c,d,e,f){for(var h=0;h<c;h++){var g=a[b+h].alpha;d[f]=g;d[f+e]=g;d[f+2*e]=g;d[f+3*e]=g;f+=4*e}};a.prototype.destroy=
function(){this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer);e.ObjectRenderer.prototype.destroy.apply(this,arguments);this.shader.destroy();this.tempMatrix=this.indices=null}},{"../../core":97,"./ParticleBuffer":195,"./ParticleShader":197}],197:[function(b,c,f){function a(a){e.call(this,a,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aColor;\nattribute vec2 aPositionCoord;\nattribute vec2 aScale;\nattribute float aRotation;\nuniform mat3 projectionMatrix;\nvarying vec2 vTextureCoord;\nvarying float vColor;\nvoid main(void){\n   vec2 v = aVertexPosition;\n   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n   v = v + aPositionCoord;\n   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = aColor;\n}",
"varying vec2 vTextureCoord;\nvarying float vColor;\nuniform sampler2D uSampler;\nuniform float uAlpha;\nvoid main(void){\n  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;\n  if (color.a == 0.0) discard;\n  gl_FragColor = color;\n}")}var e=b("../../core/Shader");a.prototype=Object.create(e.prototype);a.prototype.constructor=a;c.exports=a},{"../../core/Shader":77}],198:[function(b,c,f){Math.sign||(Math.sign=function(a){a=+a;return 0===a||isNaN(a)?a:0<a?1:-1})},{}],199:[function(b,
c,f){Object.assign||(Object.assign=b("object-assign"))},{"object-assign":59}],200:[function(b,c,f){b("./Object.assign");b("./requestAnimationFrame");b("./Math.sign");window.ArrayBuffer||(window.ArrayBuffer=Array);window.Float32Array||(window.Float32Array=Array);window.Uint32Array||(window.Uint32Array=Array);window.Uint16Array||(window.Uint16Array=Array)},{"./Math.sign":198,"./Object.assign":199,"./requestAnimationFrame":201}],201:[function(b,c,f){(function(a){Date.now&&Date.prototype.getTime||(Date.now=
function(){return(new Date).getTime()});if(!a.performance||!a.performance.now){var b=Date.now();a.performance||(a.performance={});a.performance.now=function(){return Date.now()-b}}for(var c=Date.now(),d=["ms","moz","webkit","o"],f=0;f<d.length&&!a.requestAnimationFrame;++f)a.requestAnimationFrame=a[d[f]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[d[f]+"CancelAnimationFrame"]||a[d[f]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(a){if("function"!==
typeof a)throw new TypeError(a+"is not a function");var b=Date.now(),d=16+c-b;0>d&&(d=0);c=b;return setTimeout(function(){c=Date.now();a(performance.now())},d)});a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],202:[function(b,c,f){function a(){}b=b("../../core");a.prototype.constructor=a;c.exports=a;a.prototype.upload=function(a,b){"function"===typeof a&&
(b=a);b()};a.prototype.register=function(){return this};a.prototype.add=function(){return this};a.prototype.destroy=function(){};b.CanvasRenderer.registerPlugin("prepare",a)},{"../../core":97}],203:[function(b,c,f){c.exports={webGL:b("./webgl/WebGLPrepare"),canvas:b("./canvas/CanvasPrepare")}},{"./canvas/CanvasPrepare":202,"./webgl/WebGLPrepare":204}],204:[function(b,c,f){function a(a){this.renderer=a;this.queue=[];this.addHooks=[];this.uploadHooks=[];this.completes=[];this.ticking=!1;this.register(g,
e).register(m,h)}function e(a,b){return b instanceof n.BaseTexture?(a.textureManager.updateTexture(b),!0):!1}function h(a,b){return b instanceof n.Graphics?(a.plugins.graphics.updateGraphics(b),!0):!1}function g(a,b){if(a instanceof n.BaseTexture)return-1===b.indexOf(a)&&b.push(a),!0;if(a._texture&&a._texture instanceof n.Texture){var c=a._texture.baseTexture;-1===b.indexOf(c)&&b.push(c);return!0}return!1}function m(a,b){return a instanceof n.Graphics?(b.push(a),!0):!1}var n=b("../../core"),k=n.ticker.shared;
a.UPLOADS_PER_FRAME=4;a.prototype.constructor=a;c.exports=a;a.prototype.upload=function(b,c){"function"===typeof b&&(c=b,b=null);b&&this.add(b);this.queue.length?(this.numLeft=a.UPLOADS_PER_FRAME,this.completes.push(c),this.ticking||(this.ticking=!0,k.add(this.tick,this))):c()};a.prototype.tick=function(){for(var b,c;this.queue.length&&0<this.numLeft;){var d=this.queue[0],e=!1;b=0;for(c=this.uploadHooks.length;b<c;b++)if(this.uploadHooks[b](this.renderer,d)){this.numLeft--;this.queue.shift();e=!0;
break}e||this.queue.shift()}if(this.queue.length)this.numLeft=a.UPLOADS_PER_FRAME;else for(this.ticking=!1,k.remove(this.tick,this),d=this.completes.slice(0),b=this.completes.length=0,c=d.length;b<c;b++)d[b]()};a.prototype.register=function(a,b){a&&this.addHooks.push(a);b&&this.uploadHooks.push(b);return this};a.prototype.add=function(a){var b,c;b=0;for(c=this.addHooks.length;b<c&&!this.addHooks[b](a,this.queue);b++);if(a instanceof n.Container)for(b=a.children.length-1;0<=b;b--)this.add(a.children[b]);
return this};a.prototype.destroy=function(){this.ticking&&k.remove(this.tick,this);this.ticking=!1;this.queue=this.completes=this.renderer=this.uploadHooks=this.addHooks=null};n.WebGLRenderer.registerPlugin("prepare",a)},{"../../core":97}],205:[function(b,c,f){f="undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{};b("./polyfill");c=c.exports=b("./core");c.extras=b("./extras");c.filters=b("./filters");c.interaction=b("./interaction");c.loaders=b("./loaders");
c.mesh=b("./mesh");c.particles=b("./particles");c.accessibility=b("./accessibility");c.extract=b("./extract");c.prepare=b("./prepare");c.loader=new c.loaders.Loader;Object.assign(c,b("./deprecation"));f.PIXI=c},{"./accessibility":76,"./core":97,"./deprecation":154,"./extract":156,"./extras":164,"./filters":175,"./interaction":180,"./loaders":183,"./mesh":191,"./particles":194,"./polyfill":200,"./prepare":203}]},{},[205])(205)});PIXI.TransparencyHitArea=function(c){this.sprite=c};PIXI.TransparencyHitArea.create=function(c,b){var d;d=b?new PIXI.WebGLTransparencyHitArea(c):new PIXI.CanvasTransparencyHitArea(c);d.init();return d};PIXI.TransparencyHitArea.prototype.init=function(){};
PIXI.TransparencyHitArea.prototype.contains=function(c,b){if(0===Math.abs(this.sprite.width)||0===Math.abs(this.sprite.height))return!1;var d=this.sprite.texture.frame.width,f=this.sprite.texture.frame.height;c+=this.sprite.anchor.x*d;b+=this.sprite.anchor.y*f;return 0<=c&&c<=d&&0<=b&&b<=f?!this.isTextureTransparentAt(Math.round(c+this.sprite.texture.frame.x),Math.round(b+this.sprite.texture.frame.y)):!1};PIXI.TransparencyHitArea.prototype.getTexture=function(){return this.sprite.texture};
PIXI.CanvasTransparencyHitArea=function(c){PIXI.TransparencyHitArea.call(this,c);this.textureWidth=this.textureData=null};PIXI.CanvasTransparencyHitArea.prototype=Object.create(PIXI.TransparencyHitArea.prototype);PIXI.CanvasTransparencyHitArea.constructor=PIXI.CanvasTransparencyHitArea;PIXI.CanvasTransparencyHitArea.prototype.clone=function(){return new PIXI.CanvasTransparencyHitArea(this.sprite)};
PIXI.CanvasTransparencyHitArea.prototype.init=function(){PIXI.TransparencyHitArea.prototype.init.call(this);null===PIXI.CanvasTransparencyHitArea.cachedRenderer&&(PIXI.CanvasTransparencyHitArea.cachedRenderer=new PIXI.CanvasRenderer(1,1));this.initTextureData()};
PIXI.CanvasTransparencyHitArea.prototype.initTextureData=function(){if(!this.textureData){var c=this.getTexture(),b=c.baseTexture.source;this.textureWidth=b.width;b=b.src;void 0===PIXI.CanvasTransparencyHitArea.TextureData[b]&&(c=this.createTextureData(c),PIXI.CanvasTransparencyHitArea.TextureData[b]=c);this.textureData=PIXI.CanvasTransparencyHitArea.TextureData[b]}};
PIXI.CanvasTransparencyHitArea.prototype.createTextureData=function(c){c=c.baseTexture.source;var b=PIXI.CanvasTransparencyHitArea.cachedRenderer,d=b.view;d.width=c.width;d.height=c.height;b=b.view.getContext("2d");b.clearRect(0,0,c.width,c.height);b.drawImage(c,0,0);return b.getImageData(0,0,c.width,c.height).data};
PIXI.CanvasTransparencyHitArea.prototype.isTextureTransparentAt=function(c,b){if(!this.textureData)throw Error("CanvasTransparencyHitArea#init() not called.");return 1>this.textureData[4*(c+b*this.textureWidth)+3]};PIXI.CanvasTransparencyHitArea.TextureData=[];PIXI.CanvasTransparencyHitArea.cachedRenderer=null;PIXI.WebGLTransparencyHitArea=function(c){PIXI.TransparencyHitArea.call(this,c);this.textureWidth=this.textureData=null};PIXI.WebGLTransparencyHitArea.prototype=Object.create(PIXI.TransparencyHitArea.prototype);
PIXI.WebGLTransparencyHitArea.constructor=PIXI.WebGLTransparencyHitArea;PIXI.WebGLTransparencyHitArea.prototype.clone=function(){return new PIXI.WebGLTransparencyHitArea(this.sprite)};PIXI.WebGLTransparencyHitArea.prototype.init=function(){PIXI.TransparencyHitArea.prototype.init.call(this);null===PIXI.WebGLTransparencyHitArea.cachedRenderer&&(PIXI.WebGLTransparencyHitArea.cachedRenderer=new PIXI.WebGLRenderer(1,1));this.initTextureData()};
PIXI.WebGLTransparencyHitArea.prototype.initTextureData=function(){if(!this.textureData){var c=this.getTexture(),b=c.baseTexture.source;this.textureWidth=b.width;b=b.src;void 0===PIXI.WebGLTransparencyHitArea.TextureData[b]&&(c=this.createTextureData(c),PIXI.WebGLTransparencyHitArea.TextureData[b]=c);this.textureData=PIXI.WebGLTransparencyHitArea.TextureData[b]}};
PIXI.WebGLTransparencyHitArea.prototype.createTextureData=function(c){var b=c.baseTexture.source,d=PIXI.WebGLTransparencyHitArea.cachedRenderer.view;d.width=b.width;d.height=b.height;var d=PIXI.WebGLTransparencyHitArea.cachedRenderer.gl,f=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,f);void 0===c.baseTexture._glTextures[d.id]&&PIXI.WebGLTransparencyHitArea.cachedRenderer.updateTexture(c.baseTexture);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c.baseTexture._glTextures[d.id],
0);c=new Uint8Array(b.width*b.height*4);try{d.readPixels(0,0,b.width,b.height,d.RGBA,d.UNSIGNED_BYTE,c)}catch(a){console.log(error)}d.bindFramebuffer(d.FRAMEBUFFER,null);return c};PIXI.WebGLTransparencyHitArea.prototype.isTextureTransparentAt=function(c,b){if(!this.textureData)throw Error("WebGLTransparencyHitArea#init() not called.");return 255>this.textureData[4*(c+b*this.textureWidth)+3]};PIXI.WebGLTransparencyHitArea.TextureData=[];PIXI.WebGLTransparencyHitArea.cachedRenderer=null;function getCurvePoints(c,b,d,f){function a(a,b,c,e){for(var f=2,k;f<c;f+=2){var h=a[f],g=a[f+1],p=a[f+2],t=a[f+3],v=(p-a[f-2])*e,q=(t-a[f-1])*e,r=(a[f+4]-h)*e,z=(a[f+5]-g)*e,G=0,P,Q,L,K;for(k=0;k<d;k++)P=b[G++],Q=b[G++],L=b[G++],K=b[G++],n[m++]=P*h+Q*p+L*v+K*r,n[m++]=P*g+Q*t+L*q+K*z}}b="number"===typeof b?b:.5;d="number"===typeof d?d:25;var e,h=1,g=c.length,m=0,n=new Float32Array((g-2)*d+2+(f?2*d:0)),k=new Float32Array(4*(d+2)),p=4;e=c.slice(0);f?(e.unshift(c[g-1]),e.unshift(c[g-2]),e.push(c[0],
c[1])):(e.unshift(c[1]),e.unshift(c[0]),e.push(c[g-2],c[g-1]));for(k[0]=1;h<d;h++){var z=h/d,r=z*z,v=r*z,t=2*v,q=3*r;k[p++]=t-q+1;k[p++]=q-t;k[p++]=v-2*r+z;k[p++]=v-r}k[++p]=1;a(e,k,g,b);f&&(e=[],e.push(c[g-4],c[g-3],c[g-2],c[g-1],c[0],c[1],c[2],c[3]),a(e,k,4,b));g=f?0:c.length-2;n[m++]=c[g++];n[m]=c[g];return n}"undefined"!==typeof exports&&(exports.getCurvePoints=getCurvePoints);var servers=$("#socket_io_servers").attr("data-socket_io_servers").split(","),is_video_replay=!1;-1!=location.pathname.indexOf("planner3")&&(is_video_replay=!0);var image_host;function is_safari(){return navigator.vendor&&-1<navigator.vendor.indexOf("Apple")}var static_host=$("#static_host").attr("data-static_host");image_host=is_safari()?"http://"+location.host+"/icons/":static_host+"/icons/";var asset_host=static_host+"/",game=$("meta[name=game]").attr("content"),loader=PIXI.loader,assets=[];
"wows"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"bb.png",image_host+"cv.png",image_host+"ca.png",image_host+"dd.png"),assets.push(image_host+"circle.png",image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"blitz"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"light.png",image_host+"medium.png",image_host+"heavy.png",image_host+"td.png",image_host+"arty.png"),assets.push(image_host+"circle.png",
image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"aw"==game?(assets.push(image_host+"rotate.png"),loader.add("aw_assets.png",asset_host+"aw_assets.png"),loader.add("aw_assets.json",asset_host+"aw_assets.json")):"lol"==game?(assets.push(image_host+"rotate.png"),assets.push(image_host+"circle.png",image_host+"recticle.png",image_host+"dot.png",image_host+"note.png",image_host+"cursor.png",image_host+"grid.png")):"hots"==game?(assets.push(image_host+
"rotate.png"),loader.add("hots_assets.png",asset_host+"hots_assets.png"),loader.add("hots_assets.json",asset_host+"hots_assets.json")):(assets.push(image_host+"rotate.png"),loader.add("wot_assets.png",asset_host+"wot_assets.png"),loader.add("wot_assets.json",asset_host+"wot_assets.json"));for(var i in assets)loader.add(assets[i],assets[i]);loader.load(setup_assets);var texture_atlas;
function setup_assets(){texture_atlas={};for(var c in loader.resources)if("json"==c.slice(-4))for(var b in loader.resources[c].data.tiles)texture_atlas[b]=loader.resources[c].data.tiles[b]}var room=location.search.split("room=")[1].split("&")[0],nowebgl=-1!=location.search.indexOf("nowebgl"),wot_live=-1!=location.search.indexOf("wot_live");function hashstring(c){var b=0;for(i=0;i<c.length;i++)b+=c.charCodeAt(i);return b}var server=servers[hashstring(room)%servers.length];
console.log("connecting to server: ",server);function parse_domain(c){c=c.split(".");2<c.length&&(c=c.slice(1));return"."+c.join(".")}var sid=$("#sid").attr("data-sid"),socket;try{socket=io.connect(server,{reconnectionDelay:100,reconnectionDelayMax:500,"reconnection limit":1E3,"max reconnection attempts":Infinity,query:"connect_sid="+sid+"&host="+parse_domain(location.hostname)})}catch(c){console.log(c)}var valid_chars="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
function newUid(){for(var c="",b=0;14>b;b++)c+=valid_chars.charAt(Math.floor(Math.random()*valid_chars.length));return c}function is_chrome(){return-1<navigator.userAgent.toLowerCase().indexOf("chrome")}function is_firefox(){return-1<navigator.userAgent.toLowerCase().indexOf("firefox")}function is_ie(){return-1<navigator.userAgent.toLowerCase().indexOf("msie")||-1<navigator.userAgent.toLowerCase().indexOf("trident")}function is_edge(){return-1<navigator.userAgent.toLowerCase().indexOf("edge")}
var last=function(c){return c[c.length-1]};function random_darkish_color(){var c=Math.round(127*Math.random()).toString(16),b=Math.round(127*Math.random()).toString(16),d=Math.round(127*Math.random()).toString(16);return"#"+c+b+d}function random_color(){var c=Math.round(256*Math.random()).toString(16),b=Math.round(256*Math.random()).toString(16),d=Math.round(256*Math.random()).toString(16);return"#"+("00"+c.toString(16)).slice(-2)+("00"+b.toString(16)).slice(-2)+("00"+d.toString(16)).slice(-2)}
var ARROW_LOOKBACK=4,MOUSE_DRAW_SMOOTHING=.5,LEFT_BAR_MIN_WIDTH=340,RIGHT_BAR_MIN_WIDTH=302,SINGLE_SIDE_BAR_MIN_WIDTH;SINGLE_SIDE_BAR_MIN_WIDTH="blitz"==game?350:630;
var MIN_POLYGON_END_DISTANCE=.01,MIN_POLYGON_END_DISTANCE_TOUCH=.025,MIN_TRACK_MOVE_DISTANCE_SQ=1E-4,ICON_SCALE=.00125,NOTE_SCALE=.03,THICKNESS_SCALE=1,FONT_SCALE=.002,TEXT_QUALITY=8,DRAW_QUALITY=4,ARROW_SCALE=.008,ARROW_SCALE2=1.7,TEND_SCALE=.008,TEND_SCALE2=1.5,MAGIC_NUMBER=25,EPSILON=1E-9,ROTATE_ARROW_SCALE=.05,ROTATE_ARROW_MARGIN=.02,TEXT_BOX_QUALITY=4,VIDEO_EXTENSIONS=["mp4","webgl","avi"],VIDEO_SYNC_DELAY=1E4,MOUSE_IDLE_HIDE_TIME=5E3,MAX_CANVAS_SIZE=4096,ICON_LABEL_SCALE=1,TEXT_SCALE=.8,BACKGROUND_TEXT_SCALE=
.8,PING_TIME=500,dpi,chat_color=random_darkish_color(),room_data,active_slide=0,active_context="ping_context",active_menu="ping_context",userlist={},selected_icon,selected_icon_no_color=!1,label_position="pos_bottom",icon_extra_scale=1,icon_color=16711680,draw_color=16711680,ping_color=16711680,track_color=16711680,line_color=16711680,curve_color=16711680,text_color=16777215,background_text_color=0,rectangle_outline_color=16711680,rectangle_fill_color=16711680,circle_outline_color=16711680,circle_fill_color=
16711680,polygon_outline_color=16711680,polygon_fill_color=16711680,area_outline_color=16711680,area_fill_color=16711680,background,draw_thickness,curve_thickness,line_thickness,icon_size,ping_size,track_size,draw_end_size,line_end_size,curve_end_size,rectangle_outline_thickness,rectangle_outline_transparancy,rectangle_fill_transparancy,circle_outline_thickness,circle_outline_transparancy,circle_fill_transparancy,polygon_outline_thickness,polygon_outline_transparancy,polygon_fill_transparancy,area_outline_thickness,
area_outline_transparancy,area_fill_transparancy,my_user,undo_list=[],redo_list=[],is_room_locked,tactic_name="",graphics,new_drawing,left_click_origin,selected_entities=[],previously_selected_entities=[],label_font_size=30,last_ping_time,trackers={},my_tracker,last_track_position,tracker_width=.05,tracker_height=.05,my_user_id,clipboard=[],slide_name,assets_loaded=!1,select_alpha=.6,resources_loading=0,circle_draw_style="edge",drag_delay_running=!1,current_text_element,last_mouse_location,ping_texture,
just_activated,select_box,rotate_arrow0,rotate_arrow1,rotate_arrow2,rotate_arrow3,select_box_dirty=!1,select_center,objectContainer,fast_container,background_sprite,renderer,size,size_x,size_y,useWebGL,last_pan_loc,panning,last_move_func,last_end_func,draw_canvas,temp_draw_canvas,draw_context,temp_draw_context,grid_layer,zoom_level=1,control_camera=!1,dragging_enabled=!0,offset=0,sync_start_time,progress=0,progress_update=Date.now(),video_layer,manual_pause=!1,sync_seek=!1,sync_event,clock_sync_event,
last_video_sync=null,timeline,timeline_entities={},video_ready=!1,video_paused=!0,initiated_play=!1,im_syncing=!1,idleMouseTimer,playback_rate=1,base_playback_rate=1,mouse_down_interrupted;document.body.onmouseup=function(){mouse_down_interrupted=!0};var shifted;
$(document).on("keyup keydown",function(c){can_edit()&&(shifted=c.shiftKey,"input"!=document.activeElement.localName&&("keydown"==c.type?c.ctrlKey?90==c.keyCode?undo():89==c.keyCode?redo():65==c.keyCode?(select_all(),c.preventDefault()):83==c.keyCode?my_user.logged_in&&tactic_name&&""!=tactic_name&&socket&&socket.emit("store",room,tactic_name):67==c.keyCode?copy():88==c.keyCode?cut():86==c.keyCode&&paste():32==c.keyCode&&video_layer&&can_edit()&&(toggle_play(),c.preventDefault()):"keyup"==c.type&&
(46==c.keyCode?clear_selected():16==c.keyCode&&"line_context"==active_context&&new_drawing&&on_line_end(c))))});function cut(){copy();clear_selected()}function copy(){clipboard=[];for(var c in selected_entities){var b=selected_entities[c].container;selected_entities[c].container=null;clipboard.push(JSON.parse(JSON.stringify(selected_entities[c])));selected_entities[c].container=b}}
function paste(){if(0!=clipboard.length){deselect_all();var c=renderer.plugins.interaction.eventData.data.global,b=from_x_local(c.x),c=from_y_local(c.y);if(1<Math.abs(b)||1<Math.abs(c))b=c=0;var d=1,f=1,a;for(a in clipboard)d=Math.min(d,clipboard[a].y),f=Math.min(f,clipboard[a].x);var e=[];for(a in clipboard){var h=JSON.parse(JSON.stringify(clipboard[a]));h.uid=newUid();h.x=b+(h.x-f);h.y=c+(h.y-d);e.push(h);create_entity(h);snap_and_emit_entity(h);selected_entities.push(h);render_scene()}select_entities();
undo_list.push(clone_action(["add",e]))}}function adjust_icon_zoom(c){if(c.container&&c.draw_zoom_level){var b=c.container,d=zoom_level/c.draw_zoom_level,f=b.width/b.height;b.height=x_abs(c.size)*d;b.width=b.height*f}}
function zoom(c,b,d,f){c=1+c*(b?1:-1);objectContainer.scale.x*=c;objectContainer.scale.y*=c;objectContainer.x-=x_abs(d[0]*(1-1/c)*objectContainer.scale.x);objectContainer.y-=y_abs(d[1]*(1-1/c)*objectContainer.scale.y);correct();zoom_level=size_y/(background_sprite.height*objectContainer.scale.y);for(var a in room_data.slides[active_slide].entities)d=room_data.slides[active_slide].entities[a],"icon"==d.type&&d.container&&d.draw_zoom_level&&adjust_icon_zoom(d)}
function emit_pan_zoom(){socket.emit("pan_zoom",room,zoom_level,from_x_local_vect(objectContainer.x),from_y_local_vect(objectContainer.y))}function pan_zoom(c,b,d){c=zoom_level/c;objectContainer.scale.x*=c;objectContainer.scale.y*=c;objectContainer.x=to_x_local_vect(b);objectContainer.y=to_y_local_vect(d);zoom_level=size_y/(background_sprite.height*objectContainer.scale.y);$("#zoom_level").text((1/zoom_level).toFixed(2));render_scene()}
function correct(){objectContainer.x=Math.min(0,objectContainer.x);objectContainer.y=Math.min(0,objectContainer.y);background_sprite.width*objectContainer.scale.x+objectContainer.x<draw_canvas.width&&(objectContainer.x=Math.min(0,draw_canvas.width-background_sprite.width*objectContainer.scale.x),0==objectContainer.x&&(objectContainer.scale.x=draw_canvas.width/background_sprite.width));background_sprite.height*objectContainer.scale.y+objectContainer.y<draw_canvas.height&&(objectContainer.y=Math.min(0,
draw_canvas.height-background_sprite.height*objectContainer.scale.y),0==objectContainer.y&&(objectContainer.scale.y=draw_canvas.height/background_sprite.height));objectContainer.scale.y!=objectContainer.scale.x&&(objectContainer.scale.x=Math.max(objectContainer.scale.x,objectContainer.scale.y),objectContainer.scale.y=Math.max(objectContainer.scale.x,objectContainer.scale.y));if(room_data)for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[c]&&"note"==room_data.slides[active_slide].entities[c].type&&
align_note_text(room_data.slides[active_slide].entities[c]);my_tracker&&on_track_move();render_scene()}var pan_state={};function on_pan(c){limit_rate(15,pan_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=b.x-last_pan_loc[0],f=b.y-last_pan_loc[1];last_pan_loc=[b.x,b.y];objectContainer.x+=c;objectContainer.y+=f;correct()})}
function resize_renderer(c,b){if(video_layer){var d=c*(1-(0<video_layer[0].videoWidth?video_layer[0].videoWidth/video_layer[0].videoHeight:16/9)/(c/b))/2;$("#edit_window").css("left",""+d+"px");c-=2*d;video_layer.width(c);video_layer.height(b)}else $("#edit_window").css("left","0px");d=size_y;size_x=c;size_y=b;draw_canvas.width=c;draw_canvas.height=b;temp_draw_canvas.width=c;temp_draw_canvas.height=b;objectContainer.scale.x*=size_y/d;objectContainer.scale.y*=size_y/d;$("#edit_window").css("width",
""+c+"px");$("#edit_window").css("height",""+b+"px");renderer.resize(c,b);grid_layer.width=background_sprite.width;grid_layer.height=background_sprite.height;d=renderer.plugins.interaction.eventData.data.global;zoom(0,!0,[from_x_local(d.x),from_y_local(d.y)])}
window.onresize=function(){change_background_dim(renderer.view.height);if(-1!=window.location.pathname.indexOf("planner3"))resize_renderer($(window).width(),$(window).height());else{var c=1;background_sprite.texture&&(c=background_sprite.texture.width/background_sprite.texture.height);var b;b=$("#single_side_bar").length?SINGLE_SIDE_BAR_MIN_WIDTH:LEFT_BAR_MIN_WIDTH+RIGHT_BAR_MIN_WIDTH;if(b<window.innerWidth/2){var d;$("#left_side_bar").length&&($("#left_side_bar").detach().prependTo($("body")),$("#map_select_box").prependTo($("#map_select_section")),
$("#home_button").prependTo($("#left_navbar")));d=window.innerHeight-5;var f=d*c;f+b+MAGIC_NUMBER>window.innerWidth&&(f=window.innerWidth-b-MAGIC_NUMBER,d=f/c)}else $("#left_side_bar").length&&($("#left_side_bar").detach().appendTo($("body")),$("#map_select_box").prependTo($(".left_column")),$("#home_button").prependTo($("#right_navbar")),b=RIGHT_BAR_MIN_WIDTH),f=window.innerWidth-b,d=f/c,f<RIGHT_BAR_MIN_WIDTH&&(f=window.innerWidth,d=f/c),d>window.innerHeight&&(d=window.innerHeight,f=d*c);resize_renderer(f,
d);render_scene()}};function x_rel(c){return c/background_sprite.height}function x_abs(c){return c*background_sprite.height}function y_rel(c){return c/background_sprite.height}function y_abs(c){return c*background_sprite.height}function to_x_local(c){return objectContainer.x+c*background_sprite.height*objectContainer.scale.x}function to_x_local_vect(c){return c*background_sprite.height*objectContainer.scale.x}
function from_x_local(c){return(c-objectContainer.x)/objectContainer.scale.x/background_sprite.height}function from_x_local_vect(c){return c/objectContainer.scale.x/background_sprite.height}function to_y_local(c){return objectContainer.y+c*background_sprite.height*objectContainer.scale.y}function to_y_local_vect(c){return c*background_sprite.height*objectContainer.scale.y}function from_y_local(c){return(c-objectContainer.y)/objectContainer.scale.y/background_sprite.height}
function from_y_local_vect(c){return c/objectContainer.scale.y/background_sprite.height}function mouse_x_abs(c){return c}function mouse_y_abs(c){return c}function mouse_x_rel(c){return c/(background_sprite.height/background_sprite.scale.x)}function mouse_y_rel(c){return c/(background_sprite.height/background_sprite.scale.y)}function is_video(c){return""!=get_video_type(c)}
function get_video_type(c){for(var b=c.split(".").pop(),d=0;d<VIDEO_EXTENSIONS.length;d++)if(b.startsWith(VIDEO_EXTENSIONS[d]))return"video/"+VIDEO_EXTENSIONS[d];return-1!=c.toUpperCase().indexOf("YOUTUBE")?"video/youtube":-1!=c.toUpperCase().indexOf("VIMEO")?"video/vimeo":""}
function reset_background(){video_ready=!1;video_media&&video_media.setCurrentTime(0);video_player&&(video_player.pause(),video_player.remove());$("#video_player")&&$("#video_player").remove();video_layer=null;$("#left_detect").unbind("mouseenter");$("#right_detect").unbind("mouseenter");$("#left_side_bar").unbind("mouseleave");$("#right_side_bar").unbind("mouseleave");$("#left_side_bar").show();$("#right_side_bar").show();clearTimeout(idleMouseTimer)}var video_player,video_media;
function init_video_controls(){$("#left_detect").mouseenter(function(){$("#left_side_bar").show()});$("#right_detect").mouseenter(function(){$("#right_side_bar").show()});$("#left_side_bar").mouseleave(function(){$("#left_side_bar").hide()});$("#right_side_bar").mouseleave(function(){$("#right_side_bar").hide()});$("#left_side_bar").hide();$("#right_side_bar").hide()}
function start_syncing(){clearInterval(sync_event);im_syncing=!0;for(var c=0;5>c;c++)setTimeout(function(){var b=video_progress();socket.emit("sync_video",room,b,get_server_time())},2E3*c);sync_event=setInterval(function(){var b=video_progress();socket.emit("sync_video",room,b,get_server_time())},1E4)}
function play_video_controls(){$(".mejs-controls").mouseenter(function(){$(".mejs-controls").css("opacity",1)});$(".mejs-controls").mouseleave(function(){$(".mejs-controls").css("opacity",0)});$(".mejs-controls").css("opacity",0);can_edit()?$(".mejs-controls").show():$(".mejs-controls").hide()}function pause_video_controls(){$(".mejs-controls").unbind("mouseenter");$(".mejs-controls").unbind("mouseleave");$(".mejs-controls").css("opacity",1)}
function toggle_play(){if(background.is_video)if(video_paused){var c=video_progress();socket.emit("play_video",room,c,base_playback_rate);initiated_play=!0;play_video_controls();start_syncing()}else manual_pause=!0,video_player.pause(),pause_video_controls()}var ignore_jump=!1;
function init_video_triggers(){video_media.addEventListener("pause",function(c){manual_pause&&(clearInterval(sync_event),im_syncing=!1,video_paused=!0,socket.emit("pause_video",room,video_progress()),manual_pause=!1)});video_media.addEventListener("play",function(c){initiated_play?(start_syncing(),initiated_play=!1):stop_syncing();video_paused&&(video_player.pause(),video_media.currentTime=last_video_sync?last_video_sync[0]:0,video_player.pause())});video_media.addEventListener("ended",function(c){im_syncing&&
socket.emit("pause_video",room,0)});video_media.addEventListener("timeupdate",function(c){progress=video_media.currentTime;progress_update=Date.now()});$(".mejs-playpause-button").unbind("click");$(".mejs-playpause-button").click(function(c){toggle_play();c.preventDefault();return!1});$(".mejs-time-rail").on("mousedown",function(){wait_for_seek(function(){socket.emit("seek_video",room,video_progress(),get_server_time());video_paused||start_syncing();rebuild_timeline()})})}
function wait_for_seek(c){var b=Date.now(),d=video_progress(),f=setInterval(function(){video_progress();.05<Math.abs(video_progress()-(d+(Date.now()-b)/1E3))&&(c(),clearInterval(f));1E4<Date.now()-b&&clearInterval(f)},5)}
function change_background_dim(c){var b=zoom_level,d=background_sprite.texture.width/background_sprite.texture.height,f=background_sprite.height;background_sprite.width=c*d;background_sprite.height=c;grid_layer.width=background_sprite.width;grid_layer.height=background_sprite.height;d=c/f;if(1!=d)for(var a in room_data.slides[active_slide].entities)c=room_data.slides[active_slide].entities[a],c.container&&(c.container.x*=d,c.container.y*=d,c.container.width*=d,c.container.height*=d);zoom_level=size_y/
(background_sprite.height*objectContainer.scale.y);pan_zoom(b,from_x_local_vect(objectContainer.x),from_y_local_vect(objectContainer.y))}
function set_background(c,b){if(""!=c.path)if(c.is_video){reset_background();background=c;history[background.uid]=background;add_custom_map(background.path);$("#wotbase_map_select_container").hide();$("#map_select_container").show();var d=get_video_type(c.path);video_layer=$("<video />",{id:"video_player",autoplay:!1,controls:!0});$("<source />",{type:d,src:c.path}).appendTo(video_layer);video_layer.appendTo($("#video_div"));video_layer.mediaelementplayer({videoHeight:"100%",loop:!1,autoPlay:!1,enableAutosize:!0,
alwaysShowControls:!0,speeds:"0.25 0.50 1.00 1.25 1.50 2.00".split(" "),defaultSpeed:"1.00",speedChar:"x",features:"playpause speed progress current duration tracks volume".split(" "),success:function(a,c,e){video_media=a;video_paused=!room_data.playing;video_player=e;"video/youtube"==d&&video_media.pluginApi.pauseVideo();init_video_controls();$(".mejs-controls").css("z-index",9);$(".mejs-controls").css("position","fixed");$(".mejs-controls").css("left","0px");$(".mejs-controls").css("bottom","0px");
$(".mejs-controls").css("height","3%");init_video_triggers();timeline=new FastPriorityQueue;video_ready=!0;room_data.playing?room_data.last_sync?handle_play(room_data.last_sync[0],Date.now()):handle_play(0,Date.now()):room_data.last_sync&&(video_media.setCurrentTime(room_data.last_sync[0]),video_player.pause());"youtube"==video_media.pluginType&&(a=video_media.pluginType,video_player.options.speeds=video_media.pluginApi.getAvailablePlaybackRates().map(function(a){return a.toFixed(2)}),video_player.options.defaultSpeed=
"1.00",video_media.pluginType="native",video_player.buildspeed(e,e.controls,e.layers,e.media),$(".mejs-playpause-button").after($(".mejs-speed-button")),video_media.pluginType=a);playback_rate=base_playback_rate=1;$(".mejs-speed-button").find(".mejs-speed-selector").on("click",'input[type="radio"]',function(){var a=parseFloat($(this).attr("value"));socket.emit("change_rate",room,a);set_playback_rate(a,a);start_syncing()});var f=!1;$(renderer.view).css("cursor","none");$(renderer.view).mousemove(function(a){f||
($(renderer.view).css("cursor","default"),clearTimeout(idleMouseTimer),idleMouseTimer=setTimeout(function(){$(renderer.view).css("cursor","none");f=!0;setTimeout(function(){f=!1},200)},MOUSE_IDLE_HIDE_TIME))});socket.emit("request_sync",room);window.onresize();render_scene();b&&b(!0)}})}else{resources_loading++;var f=PIXI.Texture.fromImage(c.path),a=function(){reset_background();background=c;history[background.uid]=background;background_sprite.texture=f;room_data.slides[active_slide].entities[c.uid]=
c;resources_loading--;0<$("#map_select option[value='"+background.path+"']").length?($("#map_select").val(background.path).change(),$("#use_wotbase").prop("checked",!1),$("#map_select_container").show(),$("#wotbase_map_select_container").hide()):0<$("#map_select_wotbase option[value='"+background.path+"']").length?($("#map_select_wotbase").val(background.path).change(),$("#use_wotbase").prop("checked",!0),$("#map_select_container").hide(),$("#wotbase_map_select_container").show()):(add_custom_map(background.path),
$("#wotbase_map_select_container").hide(),$("#map_select_container").show());background.size_x&&background.size_y&&0<background.size_x&&0<background.size_y?$("#map_size").text("("+background.size_x+" x "+background.size_y+")"):$("#map_size").text("");window.onresize();render_scene();b&&b(!0)};f.baseTexture.hasLoaded?a():(f.baseTexture.on("loaded",function(){a()}),f.baseTexture.on("error",function(a){alert("Image exists, but the host does not allow embedding. Try uploading your map to a service such as http://imgur.com.");
resources_loading--;b&&b(!1)}))}else{reset_background();background=c;history[background.uid]=background;$("#map_select").val(background.path).change();$("#use_wotbase").prop("checked",!1);$("#map_select_container").show();$("#wotbase_map_select_container").hide();var e=new PIXI.Graphics;e.beginFill(16777215,1);e.moveTo(0,0);is_video_replay?(e.lineTo(window.innerWidth,0),e.lineTo(window.innerWidth,window.innerHeight),e.lineTo(0,window.innerHeight)):(e.lineTo(renderer.width,0),e.lineTo(renderer.width,
renderer.height),e.lineTo(0,renderer.height));e.lineTo(0,0);e.endFill();background_sprite.texture=renderer.generateTexture(e);$("#map_size").text("");window.onresize();render_scene();b&&b(!0)}}var context_before_drag,move_selected,drag_timeout,last_drag_position,last_drag_update,dragged_entity;
function on_drag_start(c){this==select_box&&(limit_rate(15,select_box_move_state,function(){}),select_box.mousemove=void 0,select_box.mouseover=void 0,select_box.mouseout=void 0);drag_delay_running=!0;drag_timeout&&clearTimeout(drag_timeout);_this=this;var b=c.data.getLocalPosition(background_sprite);last_mouse_location=[mouse_x_rel(b.x),mouse_y_rel(b.y)];mouse_down_interrupted=!1;b=0;if("ping_context"!=active_context||_this.entity&&"note"==_this.entity.type){if("remove_context"==active_context||
"eraser_context"==active_context){_this.entity&&(deselect_all(),remove(_this.entity.uid),undo_list.push(clone_action(["remove",[_this.entity]])),socket.emit("remove",room,_this.entity.uid,active_slide),"eraser_context"==active_context&&on_left_click(c));_this==select_box&&clear_selected();c.stopPropagation();return}"drag_context"!=active_context&&(context_before_drag=active_context);active_context="drag_context";c.stopPropagation()}else b=300;drag_timeout=setTimeout(function(){if(mouse_down_interrupted)drag_delay_running=
!1,deselect_all();else if(is_room_locked&&!my_user.role)_this.entity&&"note"==_this.entity.type&&(_this.mouseup=toggle_note,_this.touchend=toggle_note,_this.mouseupoutside=toggle_note,_this.touchendoutside=toggle_note);else{var b=renderer.plugins.interaction.eventData.data.global;last_drag_update=Date.now();last_drag_position=[from_x_local(b.x),from_y_local(b.y)];dragged_entity=_this;objectContainer.buttonMode=!0;"drag_context"!=active_context&&(context_before_drag=active_context);active_context=
"drag_context";_this.mouseup=on_drag_end;_this.touchend=on_drag_end;_this.mouseupoutside=on_drag_end;_this.touchendoutside=on_drag_end;_this.mousemove=on_drag_move;_this.touchmove=on_drag_move;$("html,body").css("cursor","pointer");move_selected=!1;if(_this.entity)for(var c in selected_entities){if(selected_entities[c].uid==_this.entity.uid){move_selected=!0;break}}else move_selected=!0;move_selected||deselect_all();for(c in selected_entities)selected_entities[c].origin_x=selected_entities[c].x,selected_entities[c].origin_y=
selected_entities[c].y,objectContainer.removeChild(selected_entities[c].container),objectContainer.addChild(selected_entities[c].container);_this.entity&&(_this.entity.origin_x=_this.entity.x,_this.entity.origin_y=_this.entity.y);drag_delay_running=!1;select_box&&(objectContainer.removeChild(select_box),objectContainer.addChild(select_box));render_scene()}},b)}function toggle_note(c){this.entity.is_open=this.entity.is_open?!1:!0;align_note_text(this.entity)}
function move_entity(c,b,d){c.container&&(b=c.container.x+x_abs(b),d=c.container.y+y_abs(d),drag_entity(c,c.x+x_rel(b-c.container.x),c.y+y_rel(d-c.container.y)))}function limit_rate(c,b,d){clearTimeout(b.timeout);b.last_trigger||(b.last_trigger=Date.now());Date.now()-b.last_trigger>c?(d(),b.last_trigger=Date.now()):b.timeout=setTimeout(function(){d();b.last_trigger=Date.now()},c+5)}var drag_state={};
function on_drag_move(c){_this=this;limit_rate(15,drag_state,function(){var b=c.data.getLocalPosition(background_sprite),b=[mouse_x_rel(b.x),mouse_y_rel(b.y)],d=b[0]-last_mouse_location[0],f=b[1]-last_mouse_location[1];if(move_selected)for(var a in selected_entities)move_entity(selected_entities[a],d,f);else move_entity(_this.entity,d,f);select_box&&(select_box.x+=x_abs(d),select_box.y+=y_abs(f));select_box&&(objectContainer.removeChild(select_box),objectContainer.addChild(select_box));last_mouse_location=
b;render_scene()})}
function on_drag_end(c){limit_rate(15,drag_state,function(){});if(this.entity&&Math.abs(this.entity.origin_x-this.entity.x)<EPSILON&&Math.abs(this.entity.origin_y-this.entity.y)<EPSILON)"remove_context"==context_before_drag?(remove(this.entity.uid),undo_list.push(clone_action(["remove",[this.entity]])),socket.emit("remove",room,this.entity.uid,active_slide)):"note"==this.entity.type&&(toggle_note.call(this,c),deselect_all());else{c=["drag",[]];if(0<selected_entities.length)for(var b in selected_entities){var d=[selected_entities[b].origin_x,
selected_entities[b].origin_y];c[1].push([d,selected_entities[b].uid]);delete selected_entities[b].origin_x;delete selected_entities[b].origin_y;socket.emit("drag",room,selected_entities[b].uid,active_slide,selected_entities[b].x,selected_entities[b].y)}else d=[this.entity.origin_x,this.entity.origin_y],c[1].push([d,this.entity.uid]),delete this.entity.origin_x,delete this.entity.origin_y,socket.emit("drag",room,this.entity.uid,active_slide,this.entity.x,this.entity.y);undo_list.push(clone_action(c))}cancel_drag();
render_scene()}
function remove(c,b){var d=room_data.slides[active_slide].entities[c];if(d&&d.container&&(dragged_entity&&dragged_entity.entity&&dragged_entity.entity.uid==c&&cancel_drag(!0),"note"==d.type&&d.container.menu.remove(),objectContainer.removeChild(d.container),delete d.container,"icon"==d.type))try{var f=$('button[id*="'+room_data.slides[active_slide].entities[c].tank+'"]').find("span");f[0].innerHTML=parseInt(f[0].innerHTML)-1;f=$("#icon_context").find("span").first();f.text((parseInt(f.text())-1).toString())}catch(a){}for(d=
selected_entities.length;d--;)if(selected_entities[d].uid==c){selected_entities.splice(d,1);"drag_context"==active_context&&move_selected&&cancel_drag(!0);break}b||delete room_data.slides[active_slide].entities[c];select_box_dirty=!0;render_scene()}function move_tracker(c,b,d){var f=.1*b,a=.1*d,e=10,h=setInterval(function(){trackers[c]&&(trackers[c].x+=f,trackers[c].y+=a,trackers[c].container.x+=x_abs(f),trackers[c].container.y+=y_abs(a),render_scene());e--;0==e&&clearInterval(h)},15)}
var scene_dirty=!1;function render_scene(){scene_dirty=!0}function get_offset(){return offset}function get_server_time(){return Date.now()+offset}function get_local_time(c){return c-offset}var ping_container_atlas={},ping_texture_atlas={},active_pings=[];
function ping(c,b,d,f){var a;if(ping_container_atlas[d])a=ping_container_atlas[d];else{a=new PIXI.particles.ParticleContainer(500,{scale:!0,alpha:!0});ping_container_atlas[d]=a;var e=new PIXI.Sprite(ping_texture),e=PIXI.CanvasTinter.getTintedTexture(e,d);ping_texture_atlas[d]=new PIXI.Texture.fromCanvas(e);objectContainer.addChild(a)}d=new PIXI.Sprite(ping_texture_atlas[d]);d.anchor.set(.5);d.start_size=y_abs(.01)*(f/10)*zoom_level;d.height=d.start_size;d.width=d.start_size;d.x=x_abs(c);d.y=y_abs(b);
d.container=a;a.addChild(d);d.stop_time=Date.now()+PING_TIME;d.growth=5*d.height;render_scene();active_pings.push(d)}function update_pings(){var c=Date.now();active_pings=active_pings.filter(function(b){var d=b.stop_time-c,f=1-d/PING_TIME,a=b.start_size+f*b.growth;b.height=a;b.width=a;b.alpha=.5+.5*(1-f);if(0>=d)return b.container.removeChild(b),render_scene(),!1;render_scene();return!0})}
function setup_mouse_events(c,b){objectContainer.mouseup=b;objectContainer.touchend=b;objectContainer.mouseupoutside=b;objectContainer.touchendoutside=b;objectContainer.mousemove=c;objectContainer.touchmove=c}
function align_note_text(c){if(c.container)if(c.is_open){var b=$("#edit_window")[0].getBoundingClientRect(),d=b.left+to_x_local(c.x)+c.container.width*objectContainer.scale.x,b=b.top+to_y_local(c.y);c.container.menu.attr("style","top:"+b+"px; left:"+d+"px; display:block; z-index:20")}else c.container.menu.css("visibility","hidden")}
var drawArrow=function(c,b,d,f,a,e,h,g,m){var n=Math.atan2(a-d,f-b);e=Math.abs(m/Math.cos(g));h=n+Math.PI+g;m=f+Math.cos(h)*e;h=a+Math.sin(h)*e;g=n+Math.PI-g;f+=Math.cos(g)*e;a+=Math.sin(g)*e;c.beginPath();c.moveTo(m,h);c.lineTo(b,d);c.lineTo(f,a);c.lineTo(m,h);c.stroke();c.fill()};function hexToRGBA(c,b){var d=parseInt(c.slice(1,3),16),f=parseInt(c.slice(3,5),16),a=parseInt(c.slice(5,7),16);return"rgba("+d+", "+f+", "+a+", "+b+")"}
function init_canvas(c,b,d,f,a,e,h){d="#"+("00000"+(d|0).toString(16)).substr(-6);c.lineWidth=size_y/1E3*b*THICKNESS_SCALE;c.strokeStyle=d;c.fillStyle=d;c.shadowBlur=c.lineWidth/2;c.shadowColor="#000000";"setLineDash"in c&&("dashed"==f?(c.setLineDash([10,10]),c.lineJoin=c.lineCap="round"):"dotted"==f?(c.setLineDash([b,b]),c.lineJoin=c.lineCap="butt"):c.lineJoin=c.lineCap="round");"undefined"!==typeof a&&(e="#"+("00000"+(e|0).toString(16)).substr(-6),b=hexToRGBA(e,a),c.fillStyle=b,("00000"+(e|0).toString(16)).substr(-6),
d=hexToRGBA(d,h),c.strokeStyle=d)}function init_canvases(c,b,d,f,a,e){start_drawing();init_canvas(draw_context,c,b,d,f,a,e);init_canvas(temp_draw_context,c,b,d,f,a,e);draw_context.beginPath();temp_draw_context.beginPath()}function can_edit(){return!is_room_locked||my_user.role}function t2o(c){return 1-c/100}var last_draw_time,last_point;
function on_left_click(c){"drag_context"==active_context&&cancel_drag(!0);var b=c.data.getLocalPosition(background_sprite);if(can_edit()){try{document.activeElement.blur()}catch(d){}"drag_context"!=active_context&&("ping_context"!=active_context&&deselect_all(),"draw_context"==active_context?(setup_mouse_events(on_draw_move,on_draw_end),point_buffer=[],new_drawing={uid:newUid(),type:"drawing",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],color:draw_color,alpha:1,thickness:parseFloat(draw_thickness)*
zoom_level,end:$("#draw_end_type").find(".active").attr("data-end"),style:$("#draw_type").find(".active").attr("data-style"),path:[[0,0]],end_size:draw_end_size*zoom_level,draw_zoom_level:zoom_level},init_canvases(parseFloat(draw_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),last_draw_time=Date.now(),last_point=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))]):"ruler_context"==active_context?(setup_mouse_events(on_ruler_move,
on_ruler_end),init_canvases(.1,16777215,"full"),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)]):"line_context"==active_context?new_drawing||(setup_mouse_events(on_line_move,on_line_end),new_drawing={uid:newUid(),type:"line",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],color:line_color,alpha:1,thickness:parseFloat(line_thickness)*zoom_level,path:[[0,0]],end:$("#line_end_type").find(".active").attr("data-end"),style:$("#line_type").find(".active").attr("data-style"),end_size:line_end_size*
zoom_level,draw_zoom_level:zoom_level},init_canvases(parseFloat(line_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),just_activated=!0):"polygon_context"==active_context?new_drawing||(setup_mouse_events(on_line_move,on_polygon_end),new_drawing={uid:newUid(),type:"polygon",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],outline_thickness:polygon_outline_thickness*zoom_level,outline_color:polygon_outline_color,outline_opacity:t2o(polygon_outline_transparancy),
fill_color:polygon_fill_color,fill_opacity:t2o(polygon_fill_transparancy),alpha:1,path:[[0,0]],style:$("#polygon_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level},init_canvases(polygon_outline_thickness,new_drawing.outline_color,new_drawing.style,new_drawing.fill_opacity,new_drawing.fill_color,new_drawing.outline_opacity),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),c="touchstart"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE,graphics=
new PIXI.Graphics,graphics.lineStyle(new_drawing.outline_thickness*THICKNESS_SCALE,new_drawing.outline_color,new_drawing.outline_opacity),graphics.moveTo(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y)),size_y*c*zoom_level)),objectContainer.addChild(graphics),just_activated=!0,render_scene()):"curve_context"==active_context?new_drawing||(new_drawing={uid:newUid(),type:"curve",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,
1],color:curve_color,alpha:1,thickness:parseFloat(curve_thickness)*zoom_level,path:[[0,0]],end:$("#curve_end_type").find(".active").attr("data-end"),style:$("#curve_type").find(".active").attr("data-style"),end_size:curve_end_size*zoom_level,draw_zoom_level:zoom_level},point_buffer=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))],init_canvases(parseFloat(curve_thickness),new_drawing.color,new_drawing.style),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),setup_mouse_events(on_curve_move,
on_curve_end),just_activated=!0):"area_context"==active_context?new_drawing||(new_drawing={uid:newUid(),type:"area",x:mouse_x_rel(b.x),y:mouse_y_rel(b.y),scale:[1,1],outline_thickness:parseFloat(area_outline_thickness)*zoom_level,outline_color:area_outline_color,outline_opacity:t2o(area_outline_transparancy),fill_color:area_fill_color,fill_opacity:t2o(area_fill_transparancy),alpha:1,path:[[0,0]],style:$("#area_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level},point_buffer=[to_x_local(mouse_x_rel(b.x)),
to_y_local(mouse_y_rel(b.y))],init_canvases(parseFloat(area_outline_thickness),new_drawing.outline_color,new_drawing.style,new_drawing.fill_opacity,new_drawing.fill_color,new_drawing.outline_opacity),draw_context.moveTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),c="touchstart"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE,graphics=new PIXI.Graphics,graphics.lineStyle(new_drawing.outline_thickness*THICKNESS_SCALE,new_drawing.outline_color,new_drawing.outline_opacity),graphics.moveTo(x_abs(mouse_x_rel(b.x)),
y_abs(mouse_y_rel(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(mouse_x_rel(b.x)),y_abs(mouse_y_rel(b.y)),size_y*c*zoom_level)),objectContainer.addChild(graphics),setup_mouse_events(on_curve_move,on_area_end),just_activated=!0,render_scene()):"icon_context"==active_context?setup_mouse_events(void 0,on_icon_end):"eraser_context"==active_context?setup_mouse_events(on_eraser_move,on_eraser_end):"ping_context"==active_context?(drag_delay_running||deselect_all(),last_ping_time=new Date,setup_mouse_events(on_ping_move,
on_ping_end)):"select_context"==active_context?(setup_mouse_events(on_select_move,on_select_end),init_canvases(2,12303291,"dotted",.25,12303291,1),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)],deselect_all()):"text_context"==active_context?setup_mouse_events(void 0,on_text_end):"background_text_context"==active_context?setup_mouse_events(void 0,on_background_text_end):"rectangle_context"==active_context?new_drawing||(setup_mouse_events(on_rectangle_move,on_rectangle_end),left_click_origin=
[mouse_x_rel(b.x),mouse_y_rel(b.y)],init_canvases(rectangle_outline_thickness,rectangle_outline_color,$("#rectangle_type").find(".active").attr("data-style"),t2o(rectangle_fill_transparancy),rectangle_fill_color,t2o(rectangle_outline_transparancy)),just_activated=new_drawing=!0):"circle_context"==active_context?new_drawing||(setup_mouse_events(on_circle_move,on_circle_end),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)],init_canvases(circle_outline_thickness,circle_outline_color,$("#circle_type").find(".active").attr("data-style"),
t2o(circle_fill_transparancy),circle_fill_color,t2o(circle_outline_transparancy)),circle_draw_style=$("#circle_draw_style").find(".active").attr("data-draw_style"),just_activated=new_drawing=!0):"track_context"==active_context?my_tracker?stop_tracking():(start_tracking(b),on_track_move(c)):"note_context"==active_context&&setup_mouse_events(void 0,on_note_end))}else setup_mouse_events(on_ruler_move,on_ruler_end),init_canvases(.1,16777215,"full"),left_click_origin=[mouse_x_rel(b.x),mouse_y_rel(b.y)]}
var eraser_state={};function on_eraser_move(c){var b=renderer.plugins.interaction.eventData.data.global;limit_rate(5,eraser_state,function(){renderer.plugins.interaction.processInteractive(b,objectContainer,function(b,c){if(c&&b.entity&&"background"!=b.entity.type){var a=b.entity;remove(a.uid);undo_list.push(clone_action(["remove",[a]]));socket.emit("remove",room,a.uid,active_slide)}},!0)})}function on_eraser_end(c){setup_mouse_events(void 0,void 0)}
function stop_tracking(){limit_rate(15,track_state,function(){});setup_mouse_events(void 0,void 0);socket.emit("stop_track",room,my_tracker.uid);objectContainer.removeChild(my_tracker.container);my_tracker=void 0;render_scene()}
function start_tracking(c){setup_mouse_events(on_track_move);var b=$("#track_shape .active").attr("data-cursor"),d;d="dot"==b||"cursor"==b?.025:.05;my_tracker={uid:newUid(),shape:b,size:track_size/10*d,color:track_color,x:mouse_x_rel(c.x),y:mouse_y_rel(c.y),owner:my_user.id};last_track_position=[my_tracker.x,my_tracker.y];socket.emit("track",room,my_tracker);create_tracker(my_tracker)}
function on_note_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(b.x);b=mouse_y_rel(b.y);c={uid:newUid(),type:"note",x:c,y:b,scale:[1,1],color:text_color,alpha:1,text:"",font_size:font_size,font:"Arial",height:zoom_level};undo_list.push(clone_action(["add",[c]]));create_note(c);c.container.is_open=!0;align_note_text(c);snap_and_emit_entity(c)}
function create_note(c){var b;texture_atlas["note.png"]&&!is_safari()?(b=texture_atlas["note.png"],b=new PIXI.Texture(loader.resources[b.sprite].texture,new PIXI.Rectangle(b.x,b.y,b.width,b.height))):b=PIXI.Texture.fromImage(image_host+"note.png");b=new PIXI.Sprite(b);var d=b.width/b.height;b.height=x_abs(NOTE_SCALE)*c.height;b.width=b.height*d;b.x=x_abs(c.x);b.y=y_abs(c.y);c.container=b;c.container.entity=c;c.container.is_open=!1;c.container.menu=$('<div class="popover fade right in" role="tooltip"><h3 style="display: none;" class="popover-title"></h3><div class="popover-content"><textarea style="height:400px; width:300px;" id="note_box"></textarea><br /><span id="notification_area" style="float: left;" hidden>Saved</span><div style="float:right; padding:3px;"></div></div></div>');
$("#note_box",c.container.menu).val(c.text);is_room_locked&&!my_user.role&&($("textarea",c.container.menu).prop("readonly",!0),$("button",c.container.menu).hide());$("body").append(c.container.menu);$("#note_box",c.container.menu).on("blur",function(){can_edit()&&(c.text=$("#note_box",c.container.menu).val(),$("#notification_area",c.container.menu).show(),$("#notification_area",c.container.menu).fadeOut("slow"),snap_and_emit_entity(c))});align_note_text(c);make_draggable(c.container);objectContainer.addChild(c.container);
render_scene();b.texture.on("update",function(){render_scene()});room_data.slides[active_slide].entities[c.uid]=c}
function create_tracker(c){var b;texture_atlas[c.shape+".png"]&&!is_safari()?(b=texture_atlas[c.shape+".png"],b=new PIXI.Texture(loader.resources[b.sprite].texture,new PIXI.Rectangle(b.x,b.y,b.width,b.height))):b=PIXI.Texture.fromImage(image_host+c.shape+".png");c.container=new PIXI.Sprite(b);c.container.tint=c.color;"cursor"!=c.shape&&c.container.anchor.set(.5);c.container.x=x_abs(c.x);c.container.y=y_abs(c.y);b=c.container.width/c.container.height;c.container.height=y_abs(c.size);c.container.width=
c.container.height*b;trackers[c.uid]=c;objectContainer.addChild(trackers[c.uid].container);render_scene()}function remove_tracker(c){objectContainer.removeChild(trackers[c].container);render_scene();delete trackers[c]}var last_track_update=Date.now(),count,track_timeout,track_state={};
function on_track_move(c){limit_rate(15,track_state,function(){clearTimeout(track_timeout);var b=renderer.plugins.interaction.eventData.data.global,c=from_x_local(b.x),b=from_y_local(b.y);my_tracker.x=c;my_tracker.y=b;my_tracker.container.x=x_abs(c);my_tracker.container.y=y_abs(b);c=(last_track_position[0]-my_tracker.x)*(last_track_position[0]-my_tracker.x)+(last_track_position[1]-my_tracker.y)*(last_track_position[1]-my_tracker.y);render_scene();b=Date.now()-last_track_update;c>MIN_TRACK_MOVE_DISTANCE_SQ||
50<b?(last_track_update=Date.now(),0<Math.abs(my_tracker.x-last_track_position[0]+my_tracker.y-last_track_position[1])&&(socket.emit("track_move",room,my_tracker.uid,my_tracker.x-last_track_position[0],my_tracker.y-last_track_position[1]),last_track_position=[my_tracker.x,my_tracker.y])):track_timeout=setTimeout(function(){my_tracker&&(last_track_update=Date.now(),socket.emit("track_move",room,my_tracker.uid,my_tracker.x-last_track_position[0],my_tracker.y-last_track_position[1]),last_track_position=
[my_tracker.x,my_tracker.y],render_scene())},55)})}
function on_area_end(c){var b=renderer.plugins.interaction.eventData.data.global,d=b.x,f=b.y,a=Math.pow(new_drawing.x-from_x_local(d),2)+Math.pow(new_drawing.y-from_y_local(f),2),e="touchend"==c.type||"touchendoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;if(just_activated&&(just_activated=!1,a<EPSILON))return;a<e*e*zoom_level?(temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height),c=smooth_draw(temp_draw_context,point_buffer,!0),temp_draw_context.fill(),
draw_end(temp_draw_context,new_drawing,c[0],c[1]),canvas2container(temp_draw_context,temp_draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),stop_drawing(),setup_mouse_events(void 0,void 0),new_drawing=null):(point_buffer.push(b.x,b.y),new_drawing.path.push([from_x_local(d)-new_drawing.x,from_y_local(f)-new_drawing.y]),on_curve_move(c))}var curve_state={},point_buffer=[];
function on_curve_move(c){limit_rate(20,curve_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=b.x,f=b.y;temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);point_buffer.push(c,f);var a=smooth_draw(temp_draw_context,point_buffer);point_buffer.pop();point_buffer.pop();new_drawing.path.push([from_x_local(b.x)-new_drawing.x,from_y_local(b.y)-new_drawing.y]);draw_end(temp_draw_context,new_drawing,a[0],a[1]);new_drawing.path.pop();last_point=[c,f]})}
function on_curve_end(c){var b=renderer.plugins.interaction.eventData.data.global,d=b.x,f=b.y,a=Math.pow(from_x_local(d)-new_drawing.x-new_drawing.path[new_drawing.path.length-1][0],2)+Math.pow(from_y_local(f)-new_drawing.y-new_drawing.path[new_drawing.path.length-1][1],2);if(just_activated&&(just_activated=!1,a<EPSILON))return;var e="touchend"==c.type||"touchendoutside"==c.type||"touchstart"==c.type||"touchstartoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;a<e*e*zoom_level?
(temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height),c=smooth_draw(temp_draw_context,point_buffer),draw_end(temp_draw_context,new_drawing,c[0],c[1]),canvas2container(temp_draw_context,temp_draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),stop_drawing(),setup_mouse_events(void 0,void 0),new_drawing=null):(point_buffer.push(b.x,b.y),new_drawing.path.push([from_x_local(d)-
new_drawing.x,from_y_local(f)-new_drawing.y]),objectContainer.removeChild(graphics),graphics=new PIXI.Graphics,graphics.lineStyle(new_drawing.thickness*THICKNESS_SCALE,new_drawing.color,1),graphics.moveTo(x_abs(from_x_local(b.x)),y_abs(from_y_local(b.y))),graphics.drawShape(new PIXI.Circle(x_abs(from_x_local(b.x)),y_abs(from_y_local(b.y)),size_y*e*zoom_level)),objectContainer.addChild(graphics),render_scene(),on_curve_move(c))}
function on_polygon_end(c){try{var b=c.data.getLocalPosition(background_sprite),d=mouse_x_rel(b.x),f=mouse_y_rel(b.y),d=d-new_drawing.x,f=f-new_drawing.y}catch(h){}b=d*d+f*f;c="touchend"==c.type||"touchendoutside"==c.type?MIN_POLYGON_END_DISTANCE_TOUCH:MIN_POLYGON_END_DISTANCE;var a;a=1==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-2][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-2][1]+new_drawing.y)];
var e=[to_x_local(d+new_drawing.x),to_y_local(f+new_drawing.y)];if(just_activated&&(a=Math.pow(a[0]-e[0],2)+Math.pow(a[1]-e[1],2),just_activated=!1,.01>a))return;b<c*c*zoom_level?(new_drawing.path.push([0,0]),draw_context.lineTo(to_x_local(new_drawing.x),to_y_local(new_drawing.y)),draw_context.stroke(),draw_context.fill(),canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),objectContainer.removeChild(graphics),render_scene(),
setup_mouse_events(void 0,void 0),stop_drawing(),new_drawing=null):(0!=new_drawing.path.length&&d==last(new_drawing.path)[0]&&f==last(new_drawing.path)[1]||new_drawing.path.push([d,f]),draw_context.lineTo(e[0],e[1]),draw_context.stroke())}function draw_shape(c,b,d,f,a,e){var h=new PIXI.Graphics;h.lineStyle(c*THICKNESS_SCALE,d,b);h.beginFill(a,f);h.drawShape(e);h.endFill();h.boundsPadding=1;return new PIXI.Sprite(renderer.generateTexture(h))}var ruler_state={};
function on_ruler_move(c){limit_rate(15,ruler_state,function(){var b=c.data.getLocalPosition(background_sprite),d=background.size_x?background.size_x:0,f=background.size_y?background.size_y:0;temp_draw_context.lineWidth=size_x/1E3*2;temp_draw_context.strokeStyle="#FFFFFF";temp_draw_context.fillStyle="#FFFFFF";var a=to_x_local(left_click_origin[0]),e=to_y_local(left_click_origin[1]),h=to_x_local(mouse_x_rel(b.x)),g=to_y_local(mouse_y_rel(b.y)),m=Math.sqrt(Math.pow(a-h,2)+Math.pow(e-g,2));temp_draw_context.clearRect(0,
0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.moveTo(h,g);temp_draw_context.lineTo(a,e);temp_draw_context.moveTo(a+m,e);temp_draw_context.arc(a,e,m,0,2*Math.PI);temp_draw_context.stroke();a=(a+to_x_local(mouse_x_rel(b.x)))/2;e=(e+to_y_local(mouse_y_rel(b.y)))/2;temp_draw_context.font="22px Arial";b=Math.sqrt(Math.pow(d*(left_click_origin[0]-mouse_x_rel(b.x)),2)+Math.pow(f*(left_click_origin[1]-mouse_y_rel(b.y)),2));temp_draw_context.lineWidth=to_x_local(.5)/
1E3;temp_draw_context.strokeStyle="#000000";temp_draw_context.fillStyle="#FFFFFF";d="";d="lol"==game?d+(Math.round(10*b)/10+"u"):"wows"==game?d+(Math.round(.01*b)/10+"km"):d+(Math.round(10*b)/10+"m");temp_draw_context.fillText(d,a,e)})}function on_ruler_end(c){setup_mouse_events(void 0,void 0);limit_rate(15,ruler_state,function(){temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height)})}var circle_state={};
function on_circle_move(c){limit_rate(15,circle_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=from_x_local(b.x),f=from_y_local(b.y),a,e,h;"edge"==circle_draw_style?(a=(left_click_origin[0]+c)/2,e=(left_click_origin[1]+f)/2,h=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(f),2)),h/=2):"radius"==circle_draw_style&&(a=left_click_origin[0],e=left_click_origin[1],h=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-
to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(f),2)));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.arc(to_x_local(a),to_y_local(e),h,0,2*Math.PI);temp_draw_context.fill();temp_draw_context.stroke();"radius"==circle_draw_style&&background.size_x&&0<background.size_x&&background.size_y&&0<background.size_y&&(temp_draw_context.save(),temp_draw_context.lineWidth=size_x/1E3*2,temp_draw_context.strokeStyle=
"#FFFFFF",temp_draw_context.fillStyle="#FFFFFF",temp_draw_context.shadowBlur=0,temp_draw_context.beginPath(),temp_draw_context.moveTo(to_x_local(a),to_y_local(e)),temp_draw_context.lineTo(to_x_local(c),to_y_local(f)),temp_draw_context.stroke(),h=to_x_local((a+c)/2),b=to_y_local((e+f)/2),temp_draw_context.font="22px Arial",c=Math.sqrt(Math.pow(background.size_x*(a-c),2)+Math.pow(background.size_y*(e-f),2)),temp_draw_context.lineWidth=to_x_local(.5)/1E3,temp_draw_context.strokeStyle="#000000",temp_draw_context.fillStyle=
"#FFFFFF",a="",a="lol"==game?a+(Math.round(10*c)/10+"u"):"wows"==game?a+(Math.round(.01*c)/10+"km"):a+(Math.round(10*c)/10+"m"),temp_draw_context.fillText(a,h,b),temp_draw_context.stroke(),temp_draw_context.restore())})}
function on_circle_end(c){limit_rate(15,circle_state,function(){});var b=renderer.plugins.interaction.eventData.data.global;c=from_x_local(b.x);var d=from_y_local(b.y),f,a,e;"edge"==circle_draw_style?(f=(left_click_origin[0]+c)/2,a=(left_click_origin[1]+d)/2,e=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(d),2)),e/=2):"radius"==circle_draw_style&&(f=left_click_origin[0],a=left_click_origin[1],e=Math.sqrt(Math.pow(to_x_local(left_click_origin[0])-
to_x_local(c),2)+Math.pow(to_y_local(left_click_origin[1])-to_y_local(d),2)));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();temp_draw_context.arc(to_x_local(f),to_y_local(a),e,0,2*Math.PI);temp_draw_context.fill();temp_draw_context.stroke();e={uid:newUid(),type:"circle",x:f,y:a,radius:from_y_local_vect(e),outline_thickness:circle_outline_thickness*zoom_level,outline_color:circle_outline_color,outline_opacity:t2o(circle_outline_transparancy),
fill_opacity:t2o(circle_fill_transparancy),fill_color:circle_fill_color,alpha:1,style:$("#circle_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level};new_drawing=void 0;if("radius"==circle_draw_style&&background.size_x&&0<background.size_x&&background.size_y&&0<background.size_y){e.draw_radius=[c-e.x,d-e.y];temp_draw_context.save();temp_draw_context.lineWidth=size_x/1E3*2;temp_draw_context.strokeStyle="#FFFFFF";temp_draw_context.fillStyle="#FFFFFF";temp_draw_context.shadowBlur=0;
temp_draw_context.beginPath();temp_draw_context.moveTo(to_x_local(f),to_y_local(a));temp_draw_context.lineTo(to_x_local(c),to_y_local(d));temp_draw_context.stroke();var b=to_x_local((f+c)/2),h=to_y_local((a+d)/2);temp_draw_context.font="22px Arial";f=Math.sqrt(Math.pow(background.size_x*(f-c),2)+Math.pow(background.size_y*(a-d),2));temp_draw_context.lineWidth=to_x_local(.5)/1E3;temp_draw_context.strokeStyle="#000000";temp_draw_context.fillStyle="#FFFFFF";a="";a="lol"==game?a+(Math.round(10*f)/10+
"u"):"wows"==game?a+(Math.round(.01*f)/10+"km"):a+(Math.round(10*f)/10+"m");temp_draw_context.fillText(a,b,h);temp_draw_context.stroke();temp_draw_context.restore()}canvas2container(temp_draw_context,temp_draw_canvas,e)&&(emit_entity(e),undo_list.push(clone_action(["add",[e]])));stop_drawing();setup_mouse_events(void 0,void 0)}var rectangle_state={};
function on_rectangle_move(c){limit_rate(15,rectangle_state,function(){var b=c.data.getLocalPosition(background_sprite),d=Math.min(left_click_origin[0],mouse_x_rel(b.x)),f=Math.min(left_click_origin[1],mouse_y_rel(b.y)),a=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f));
temp_draw_context.strokeRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f))})}
function on_rectangle_end(c){limit_rate(15,rectangle_state,function(){});var b=c.data.getLocalPosition(background_sprite);c=Math.min(left_click_origin[0],mouse_x_rel(b.x));var d=Math.min(left_click_origin[1],mouse_y_rel(b.y)),f=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));if(just_activated){var a=Math.pow(to_x_local(c-f),2)+Math.pow(to_y_local(d-b),2);just_activated=!1;if(.01>a)return}new_drawing=void 0;temp_draw_context.clearRect(0,0,temp_draw_canvas.width,
temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(c),to_y_local(d),to_x_local(f)-to_x_local(c),to_y_local(b)-to_y_local(d));temp_draw_context.strokeRect(to_x_local(c),to_y_local(d),to_x_local(f)-to_x_local(c),to_y_local(b)-to_y_local(d));c={uid:newUid(),type:"rectangle",x:c,y:d,width:f-c,height:b-d,outline_thickness:rectangle_outline_thickness*zoom_level,outline_color:rectangle_outline_color,outline_opacity:t2o(rectangle_outline_transparancy),fill_opacity:t2o(rectangle_fill_transparancy),
fill_color:rectangle_fill_color,alpha:1,style:$("#rectangle_type").find(".active").attr("data-style"),draw_zoom_level:zoom_level};canvas2container(temp_draw_context,temp_draw_canvas,c)&&(emit_entity(c),undo_list.push(clone_action(["add",[c]])));stop_drawing();setup_mouse_events(void 0,void 0)}
function on_ping_move(c){limit_rate(60,drag_state,function(){var b=Date.now();if(!(10>b-last_ping_time)){var c=renderer.plugins.interaction.eventData.data.global,f=from_x_local(c.x),c=from_y_local(c.y);last_ping_time=b;ping(f,c,ping_color,ping_size);socket.emit("ping_marker",room,f,c,ping_color,ping_size)}})}
function on_ping_end(c){limit_rate(0,drag_state,function(){});var b=renderer.plugins.interaction.eventData.data.global;c=from_x_local(b.x);b=from_y_local(b.y);ping(c,b,ping_color,ping_size);socket.emit("ping_marker",room,c,b,ping_color,ping_size);setup_mouse_events(void 0,void 0)}var select_state={};
function on_select_move(c){limit_rate(15,select_state,function(){var b=c.data.getLocalPosition(background_sprite),d=Math.min(left_click_origin[0],mouse_x_rel(b.x)),f=Math.min(left_click_origin[1],mouse_y_rel(b.y)),a=Math.max(left_click_origin[0],mouse_x_rel(b.x)),b=Math.max(left_click_origin[1],mouse_y_rel(b.y));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.fillRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f));
temp_draw_context.strokeRect(to_x_local(d),to_y_local(f),to_x_local(a)-to_x_local(d),to_y_local(b)-to_y_local(f))})}
function on_select_end(c){limit_rate(15,select_state,function(){temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height)});setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=Math.min(x_abs(mouse_x_rel(b.x)),x_abs(left_click_origin[0]));var d=Math.min(y_abs(mouse_y_rel(b.y)),y_abs(left_click_origin[1])),f=Math.max(x_abs(mouse_x_rel(b.x)),x_abs(left_click_origin[0])),b=Math.max(y_abs(mouse_y_rel(b.y)),y_abs(left_click_origin[1])),a;for(a in room_data.slides[active_slide].entities)if(room_data.slides[active_slide].entities.hasOwnProperty(a)&&
room_data.slides[active_slide].entities[a].container){var e=room_data.slides[active_slide].entities[a].container.getBounds();e.width/=objectContainer.scale.x;e.height/=objectContainer.scale.y;e.x=(-objectContainer.x+e.x)/objectContainer.scale.x;e.y=(-objectContainer.y+e.y)/objectContainer.scale.y;var h=e.y,g=e.x+e.width,m=e.y+e.height;e.x>c&&h>d&&g<f&&m<b&&selected_entities.push(room_data.slides[active_slide].entities[a])}select_entities();undo_list.push(clone_action(["select",selected_entities,previously_selected_entities]));
render_scene()}function measure_text(c){return[x_rel(c.container.width),x_rel(c.container.height)]}
function select_box_mousemove(c,b,d,f,a,e,h){limit_rate(15,select_box_move_state,function(){var c=renderer.plugins.interaction.eventData.data.global;c.x=x_abs(from_x_local(c.x));c.y=y_abs(from_y_local(c.y));var m=Math.abs((c.x-b)/f),n=Math.abs((c.y-d)/a),k;for(k in selected_entities){var p=selected_entities[k];e||(p.container.scale.x=m*p.container.start_scale[0],p.container.x=(p.container.x_orig-b)*m+b);h||(p.container.scale.y=n*p.container.start_scale[1],p.container.y=(p.container.y_orig-d)*n+d)}e||
(select_box.width=Math.abs(b-c.x),select_box.left_x=Math.min(b,c.x),select_box.x=select_box.left_x+select_box.width/2);h||(select_box.height=Math.abs(d-c.y),select_box.upper_y=Math.min(d,c.y),select_box.y=select_box.upper_y+select_box.height/2);render_scene()});c.stopPropagation()}
function select_box_mouseup(c,b,d,f,a,e,h){limit_rate(15,select_box_move_state,function(){});setup_mouse_events(void 0,void 0);var g=renderer.plugins.interaction.eventData.data.global;g.x=x_abs(from_x_local(g.x));g.y=y_abs(from_y_local(g.y));f=Math.abs((g.x-b)/f);a=Math.abs((g.y-d)/a);var m=["drag",[]],n;for(n in selected_entities){var k=selected_entities[n],p=[1,1];k.scale&&(p=[k.scale[0],k.scale[1]]);m[1].push([[k.x,k.y,[p[0],p[1]]],k.uid]);var z=k.x,r=k.y;e||(z=x_rel((k.container.x_orig-b)*f+b-
k.container.x_orig)+k.x,p[0]=f*k.container.start_scale[0]/k.container.orig_scale[0]);h||(r=y_rel((k.container.y_orig-d)*a+d-k.container.y_orig)+k.y,p[1]=a*k.container.start_scale[1]/k.container.orig_scale[1]);k.container.x=k.container.x_orig;k.container.y=k.container.y_orig;drag_entity(k,z,r,p);socket.emit("drag",room,k.uid,active_slide,z,r,p)}undo_list.push(clone_action(m));select_box.mouseover=on_select_over;select_box.mousemove=on_selectbox_move;e||(select_box.width=Math.abs(b-g.x),select_box.left_x=
Math.min(b,g.x),select_box.x=select_box.left_x+select_box.width/2);h||(select_box.height=Math.abs(d-g.y),select_box.upper_y=Math.min(d,g.y),select_box.y=select_box.upper_y+select_box.height/2);render_scene();c.stopPropagation()}
function prepare_resize(c,b,d,f,a,e,h){for(var g in selected_entities){var m=selected_entities[g];m.container.x_orig=m.container.x;m.container.y_orig=m.container.y;m.container.start_scale=[m.container.scale.x,m.container.scale.y]}objectContainer.removeChild(rotate_arrow0);objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);setup_mouse_events(function(c){select_box_mousemove(c,b,d,f,a,e,h)},function(c){select_box_mouseup(c,
b,d,f,a,e,h)});select_box.mouseover=void 0;select_box.mousemove=void 0;c.stopPropagation()}var select_box_move_state={};
function on_selectbox_move(c){limit_rate(15,select_box_move_state,function(){var b=renderer.plugins.interaction.eventData.data.global;b.x=x_abs(from_x_local(b.x));b.y=y_abs(from_y_local(b.y));b.x-=select_box.left_x;b.y-=select_box.upper_y;b.x/=select_box.width;b.y/=select_box.height;var d=y_abs(ROTATE_ARROW_MARGIN)*zoom_level,f=d/select_box.width,d=d/select_box.height,a=select_box.left_x,e=select_box.upper_y,h=a+select_box.width,g=e+select_box.height;b.x<0-f||b.x>1+f||b.y<0-d||b.y>1+d?(on_select_out(c),
c&&c.stopPropagation()):(f=Math.min(f,.25),d=Math.min(d,.25),b.x<f?(b.y<d?($("html,body").css("cursor","nw-resize"),objectContainer.mousedown=function(a){prepare_resize(a,h,g,select_box.width,select_box.height,!1,!1)}):b.y>1-d?($("html,body").css("cursor","sw-resize"),objectContainer.mousedown=function(a){prepare_resize(a,h,e,select_box.width,select_box.height,!1,!1)}):($("html,body").css("cursor","w-resize"),objectContainer.mousedown=function(a){prepare_resize(a,h,0,select_box.width,select_box.height,
!1,!0)}),select_box.mousedown=objectContainer.mousedown):b.x>1-f?(b.y<d?($("html,body").css("cursor","ne-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,g,select_box.width,select_box.height,!1,!1)}):b.y>1-d?($("html,body").css("cursor","se-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,e,select_box.width,select_box.height,!1,!1)}):($("html,body").css("cursor","e-resize"),objectContainer.mousedown=function(b){prepare_resize(b,a,0,select_box.width,select_box.height,
!1,!0)}),select_box.mousedown=objectContainer.mousedown):b.y<d?($("html,body").css("cursor","n-resize"),objectContainer.mousedown=function(a){prepare_resize(a,0,g,select_box.width,select_box.height,!0,!1)},select_box.mousedown=objectContainer.mousedown):b.y>1-d?($("html,body").css("cursor","s-resize"),objectContainer.mousedown=function(a){prepare_resize(a,0,e,select_box.width,select_box.height,!0,!1)},select_box.mousedown=objectContainer.mousedown):($("html,body").css("cursor","move"),select_box.mousedown=
on_drag_start,objectContainer.mousedown=on_left_click))});c&&c.stopPropagation()}function on_select_over(c){select_box.mousemove=on_selectbox_move;select_box.mouseout=on_select_out}function on_select_out(c){limit_rate(15,select_box_move_state,function(){});$("html,body").css("cursor","default");select_box.mousemove=void 0;select_box.mousedown=void 0;objectContainer.mousedown=on_left_click;select_box.mouseout=void 0}function make_resizable(c){c.interactive=!0;c.mouseover=on_select_over}
function redraw_select_box(){if(select_box)if(select_box.rotation=0,0<selected_entities.length){var c=99999,b=-99999,d=99999,f=-99999,a;for(a in selected_entities){var e=selected_entities[a].container,h,g,m;g=-e.rotation;h=Math.abs(e.width*Math.cos(g))+Math.abs(e.height*Math.sin(g));g=Math.abs(e.width*Math.sin(g))+Math.abs(e.height*Math.cos(g));m=e.x-e.anchor.x*h;e=e.y-e.anchor.y*g;c=Math.min(m,c);d=Math.min(e,d);b=Math.max(m+h,b);f=Math.max(e+g,f)}select_center=[x_rel(c+(b-c)/2),y_rel(d+(f-d)/2)];
select_box.left_x=c;select_box.upper_y=d;select_box.width=b-c;select_box.height=f-d;select_box.x=c+select_box.width/2;select_box.y=d+select_box.height/2;rotate_arrow0.x=c+select_box.width+rotate_arrow0.width/2+y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow0.y=d+select_box.height/2;rotate_arrow1.x=c+select_box.width/2;rotate_arrow1.y=d-rotate_arrow1.width/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow2.x=c-rotate_arrow2.width/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level;rotate_arrow2.y=d+select_box.height/
2;rotate_arrow3.x=c+select_box.width/2;rotate_arrow3.y=d+rotate_arrow3.width/2+select_box.height+y_abs(ROTATE_ARROW_MARGIN)*zoom_level;objectContainer.removeChild(rotate_arrow0);objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);objectContainer.addChild(rotate_arrow0);objectContainer.addChild(rotate_arrow1);objectContainer.addChild(rotate_arrow2);objectContainer.addChild(rotate_arrow3);objectContainer.removeChild(select_box);
objectContainer.addChild(select_box)}else remove_select_box();select_box_dirty=!1}
function start_rotate_selection(c,b){limit_rate(15,drag_state,function(){});objectContainer.buttonMode=!0;setup_mouse_events(rotate_selection.bind(void 0,this,c),stop_rotate_selection.bind(void 0,this,c));var d=b.data.getLocalPosition(background_sprite);last_mouse_location=[mouse_x_rel(d.x),mouse_y_rel(d.y)];for(var f in selected_entities)d=room_data.slides[active_slide].entities[selected_entities[f].uid].container,d.x_orig=d.x,d.y_orig=d.y,d.rotation_orig=d.rotation;objectContainer.removeChild(rotate_arrow0);
objectContainer.removeChild(rotate_arrow1);objectContainer.removeChild(rotate_arrow2);objectContainer.removeChild(rotate_arrow3);objectContainer.addChild(this);b.stopPropagation()}
function rotate_selection(c,b,d){limit_rate(15,drag_state,function(){var f=d.data.getLocalPosition(background_sprite),f=[mouse_x_rel(f.x),mouse_y_rel(f.y)],a=f[1]-last_mouse_location[1];c.x+=x_abs(f[0]-last_mouse_location[0]);c.y+=y_abs(a);b=Math.atan2(-(f[1]-select_center[1]),f[0]-select_center[0])-b;var a=Math.sin(-b),e=Math.cos(-b),h;for(h in selected_entities){var g=room_data.slides[active_slide].entities[selected_entities[h].uid].container;g.x=g.x_orig;g.y=g.y_orig;g.x-=x_abs(select_center[0]);
g.y-=y_abs(select_center[1]);var m=g.x;g.x=g.x*e-g.y*a;g.y=m*a+g.y*e;g.x+=x_abs(select_center[0]);g.y+=y_abs(select_center[1]);g.rotation=g.rotation_orig-b}select_box.rotation=-b;last_mouse_location=f;render_scene()})}
function stop_rotate_selection(c,b,d){limit_rate(15,drag_state,function(){});objectContainer.buttonMode=!1;setup_mouse_events(void 0,void 0);d=d.data.getLocalPosition(background_sprite);d=[mouse_x_rel(d.x),mouse_y_rel(d.y)];var f=d[1]-last_mouse_location[1];c.x+=x_abs(d[0]-last_mouse_location[0]);c.y+=y_abs(f);b=Math.atan2(-(d[1]-select_center[1]),d[0]-select_center[0])-b;c=Math.sin(-b);d=Math.cos(-b);var f=["drag",[]],a;for(a in selected_entities){var e=room_data.slides[active_slide].entities[selected_entities[a].uid],
h=e.container,h=room_data.slides[active_slide].entities[selected_entities[a].uid].container;h.x=h.x_orig;h.y=h.y_orig;h.x-=x_abs(select_center[0]);h.y-=y_abs(select_center[1]);var g=h.x;h.x=h.x*d-h.y*c;h.y=g*c+h.y*d;h.x+=x_abs(select_center[0]);h.y+=y_abs(select_center[1]);g=[1,1];e.scale&&(g=[e.scale[0],e.scale[1]]);var m=0;e.rotation&&(m=e.rotation);f[1].push([[e.x,e.y,[g[0],g[1]],m],e.uid]);g=h.x-h.x_orig;m=h.y-h.y_orig;h.x=h.x_orig;h.y=h.y_orig;e.rotation||(e.rotation=0);h=(e.rotation+b)%(2*Math.PI);
socket.emit("drag",room,e.uid,active_slide,x_rel(x_abs(e.x)+g),y_rel(y_abs(e.y)+m),e.scale,h);drag_entity(e,x_rel(x_abs(e.x)+g),y_rel(y_abs(e.y)+m),e.scale,h)}undo_list.push(clone_action(f));select_box_dirty=!0;render_scene()}
function select_entities(){remove_select_box();var c=99999,b=-99999,d=99999,f=-99999,a;for(a in selected_entities){var e=room_data.slides[active_slide].entities[selected_entities[a].uid].container,h,g,m;g=-e.rotation;h=Math.abs(e.width*Math.cos(g))+Math.abs(e.height*Math.sin(g));g=Math.abs(e.width*Math.sin(g))+Math.abs(e.height*Math.cos(g));m=e.x-e.anchor.x*h;e=e.y-e.anchor.y*g;c=Math.min(x_rel(m),c);d=Math.min(y_rel(e),d);b=Math.max(x_rel(m)+x_rel(h),b);f=Math.max(y_rel(e)+y_rel(g),f);room_data.slides[active_slide].entities[selected_entities[a].uid].container.alpha=
select_alpha}if(0<selected_entities.length){select_center=[c+(b-c)/2,d+(f-d)/2];a=new PIXI.Rectangle(0,0,x_abs(b-c),y_abs(f-d),5);select_box=draw_select_box(a);select_box.anchor.x=.5;select_box.anchor.y=.5;a=x_abs(c);h=y_abs(d);select_box.left_x=a;select_box.upper_y=h;select_box.x=a+x_abs(b-c)/2;select_box.y=h+y_abs(f-d)/2;make_resizable(select_box);var n=new PIXI.Texture.fromImage(image_host+"rotate.png"),c=n.width/n.height,k=y_abs(ROTATE_ARROW_SCALE)*zoom_level,p=k*c,c=function(a,b,c){var d=new PIXI.Sprite(n);
d.anchor.x=.5;d.anchor.y=.5;d.width=p;d.height=k;d.interactive=!0;d.buttonMode=!0;d.draggable=!0;d.mousedown=start_rotate_selection.bind(d,c);d.rotation=-c;d.x=a;d.y=b;objectContainer.addChild(d);return d};rotate_arrow0=c(a+select_box.width+p/2+y_abs(ROTATE_ARROW_MARGIN)*zoom_level,h+select_box.height/2,0);rotate_arrow1=c(a+select_box.width/2,h-p/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level,Math.PI/2);rotate_arrow2=c(a-p/2-y_abs(ROTATE_ARROW_MARGIN)*zoom_level,h+select_box.height/2,Math.PI);rotate_arrow3=
c(a+select_box.width/2,h+p/2+select_box.height+y_abs(ROTATE_ARROW_MARGIN)*zoom_level,-Math.PI/2);objectContainer.addChild(select_box)}render_scene()}function draw_select_box(c){var b=new PIXI.Graphics;b.lineStyle(1*zoom_level,16777215,.2);b.beginFill(16777215,.2);b.drawShape(c);b.endFill();return new PIXI.Sprite(renderer.generateTexture(b))}
function select_all(){previously_selected_entities=selected_entities;selected_entities=[];for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(c)&&room_data.slides[active_slide].entities[c].container&&selected_entities.push(room_data.slides[active_slide].entities[c]);select_entities();undo_list.push(clone_action(["select",selected_entities,previously_selected_entities]))}
function remove_select_box(){limit_rate(15,select_box_move_state,function(){});select_box&&(select_box.mousedown=void 0,select_box.mousemove=void 0,select_box.mouseup=void 0,select_box.mouseout=void 0,select_box.mouseover=void 0,select_box.mouseupoutside=void 0,objectContainer.mousedown=on_left_click,objectContainer.removeChild(select_box),objectContainer.removeChild(rotate_arrow0),objectContainer.removeChild(rotate_arrow1),objectContainer.removeChild(rotate_arrow2),objectContainer.removeChild(rotate_arrow3),
select_box=void 0,render_scene());$("html,body").css("cursor","default")}function deselect_all(){remove_select_box();previously_selected_entities=selected_entities;for(var c in selected_entities)selected_entities[c].container.filters=void 0,selected_entities[c].container.alpha=selected_entities[c].alpha;selected_entities=[]}var INTERPOLATION_RESOLUTION=25,INTERPOLATION_TENSION=.5,INTERPOLATION_LOOKBACK=10;
function smooth_draw(c,b,d){b=getCurvePoints(b,INTERPOLATION_TENSION,INTERPOLATION_RESOLUTION,d);c.beginPath();c.moveTo(b[0],b[1]);for(d=2;d<b.length;d+=2)c.lineTo(b[d],b[d+1]);c.stroke();c=b[b.length-2]-b[b.length-20];d=b[b.length-1]-b[b.length-19];var f=Math.sqrt(Math.pow(c,2)+Math.pow(d,2));return[[b[b.length-2]-c/f,b[b.length-1]-d/f],[b[b.length-2],b[b.length-1]]]}
function smooth_draw_incremental(c,b,d,f){var a=getCurvePoints(d,INTERPOLATION_TENSION,INTERPOLATION_RESOLUTION),e=INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION;d.length<2*INTERPOLATION_LOOKBACK&&(e=0);d.length==3*INTERPOLATION_LOOKBACK&&(e=2*INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION);b.moveTo(a[e],a[e+1]);b.beginPath();for(e+=2;e<a.length;e+=2)b.lineTo(a[e],a[e+1]);b.stroke();if(d.length==2*INTERPOLATION_LOOKBACK||d.length==3*INTERPOLATION_LOOKBACK||f){e=INTERPOLATION_LOOKBACK*INTERPOLATION_RESOLUTION;
b=f?a.length:a.length-(INTERPOLATION_LOOKBACK-2)*INTERPOLATION_RESOLUTION;d.length==2*INTERPOLATION_LOOKBACK&&(e=2,c.beginPath(),c.moveTo(a[0],a[1]));for(c.clearRect(0,0,c.canvas.width,c.canvas.height);e<b;e+=2)c.lineTo(a[e],a[e+1]);c.stroke();d.length==3*INTERPOLATION_LOOKBACK&&d.splice(0,INTERPOLATION_LOOKBACK)}}var draw_state={},point_buffer=[];
function on_draw_move(c){limit_rate(20,draw_state,function(){var b=renderer.plugins.interaction.eventData.data.global,c=last_point[0]*MOUSE_DRAW_SMOOTHING+(1-MOUSE_DRAW_SMOOTHING)*b.x,f=last_point[1]*MOUSE_DRAW_SMOOTHING+(1-MOUSE_DRAW_SMOOTHING)*b.y;new_drawing.path.push([from_x_local(c)-new_drawing.x,from_y_local(f)-new_drawing.y]);temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);point_buffer.push(c,f,b.x,b.y);smooth_draw_incremental(draw_context,temp_draw_context,
point_buffer);point_buffer.pop();point_buffer.pop();new_drawing.path.push([from_x_local(b.x)-new_drawing.x,from_y_local(b.y)-new_drawing.y]);draw_end_path(temp_draw_context,new_drawing);new_drawing.path.pop();last_point=[c,f]})}
function on_draw_end(c){limit_rate(20,draw_state,function(){});c=renderer.plugins.interaction.eventData.data.global;point_buffer.push(last_point[0],last_point[1],c.x,c.y);smooth_draw_incremental(draw_context,temp_draw_context,point_buffer,!0);new_drawing.path.push([from_x_local(c.x)-new_drawing.x,from_y_local(c.y)-new_drawing.y]);draw_context.beginPath();draw_end_path(draw_context,new_drawing);canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",
[new_drawing]])));temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);draw_context.clearRect(0,0,draw_canvas.width,draw_canvas.height);draw_context.beginPath();temp_draw_context.beginPath();setup_mouse_events(void 0,void 0);new_drawing=null}
function autocrop_canvas(c){var b=c.getContext("2d"),d=c.width,f=c.height,a=[],e=[],h=b.getImageData(0,0,c.width,c.height),g,m;for(g=0;g<f;g++)for(c=0;c<d;c++)m=4*(g*d+c),0<h.data[m+3]&&(a.push(c),e.push(g));a.sort(function(a,b){return a-b});e.sort(function(a,b){return a-b});f=a.length-1;c=a[0];g=e[0];d=a[f]-a[0]+1;f=e[f]-e[0]+1;a=document.createElement("canvas");a.width=d;a.height=f;e=a.getContext("2d");if(isNaN(c)||isNaN(g)||isNaN(d)||isNaN(f))return null;b=b.getImageData(c,g,d,f);e.putImageData(b,
0,0);a.x=c;a.y=g;return a}function createSprite(c,b){if(b=autocrop_canvas(b)){var d=PIXI.Texture.fromCanvas(b),d=new PIXI.Sprite(d);d.x=x_abs(from_x_local(b.x));d.y=y_abs(from_y_local(b.y));return d}return null}function drawRotatedImage(c,b,d){c.save();c.translate(b.width/2,b.height/2);c.rotate(d);c.translate(-(b.width/2),-(b.height/2));c.drawImage(b,0,0);c.restore()}
function draw_end_path(c,b){if(b.path.length>=ARROW_LOOKBACK){var d=Math.max(0,b.path.length-ARROW_LOOKBACK),d=[to_x_local(b.x+b.path[d][0]),to_y_local(b.y+b.path[d][1])],f=[to_x_local(b.x+b.path[b.path.length-1][0]),to_y_local(b.y+b.path[b.path.length-1][1])];draw_end(c,b,d,f)}}function draw_end(c,b,d,f,a){void 0===a&&(a=1/zoom_level);var e=size_y/1E3*10*a;b.end_size&&(e=size_y/1E3*b.end_size*a);c.stroke();c.beginPath();"arrow"==b.end?draw_arrow(c,d,f,e):"T"==b.end&&draw_T(c,d,f,e)}
function draw_arrow(c,b,d,f){var a=d[0]-b[0];b=d[1]-b[1];l=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));a/=l;b/=l;drawArrow(c,d[0],d[1],d[0]+a,d[1]+b,3,1,Math.PI/8,f*ARROW_SCALE2)}function draw_T(c,b,d,f){f*=TEND_SCALE2;var a=d[0]-b[0];b=d[1]-b[1];l=Math.sqrt(Math.pow(a,2)+Math.pow(b,2));a/=l;b/=l;b=-b;c.stroke();var e=c.getLineDash();c.setLineDash([]);c.beginPath();c.moveTo(d[0]-f*b,d[1]-f*a);c.lineTo(d[0]+f*b,d[1]+f*a);c.stroke();c.setLineDash(e)}
function canvas2sprite(c,b){var d=createSprite(c,b);return d?(d.height/=objectContainer.scale.x,d.width/=objectContainer.scale.y,d):!1}function canvas2container(c,b,d){return(c=createSprite(c,b))?(d.container=c,c.height/=objectContainer.scale.x,c.width/=objectContainer.scale.y,objectContainer.addChild(c),c.texture.baseTexture.source.src=d.uid,c.hitArea=new PIXI.TransparencyHitArea.create(c,!1),make_draggable(c),c.entity=d,room_data.slides[active_slide].entities[d.uid]=d,render_scene(),!0):!1}
function init_shape_canvas(c,b,d){void 0===d&&(d=1);init_canvas(c,b.outline_thickness*d,b.outline_color,b.style,b.fill_opacity,b.fill_color,b.outline_opacity)}
function create_rectangle2(c){var b=document.createElement("canvas"),d=b.getContext("2d"),f=background_sprite.height,a=1;c.draw_zoom_level&&(a=1/c.draw_zoom_level);b.width=f*c.width*a+50;b.height=f*c.height*a+50;init_shape_canvas(d,c,a);d.fillRect(25,25,f*c.width*a,f*c.height*a);d.strokeRect(25,25,f*c.width*a,f*c.height*a);canvas2container2(d,b,c);c.container.x=x_abs(c.x)-25/a;c.container.y=y_abs(c.y)-25/a;c.container.width/=a;c.container.height/=a;c.container.orig_scale=[c.container.scale.x,c.container.scale.y];
objectContainer.addChild(c.container);render_scene()}
function create_circle2(c){var b=document.createElement("canvas"),d=b.getContext("2d"),f=background_sprite.height,a=1;c.draw_zoom_level&&(a=1/c.draw_zoom_level);b.width=2*f*c.radius*a+50;b.height=2*f*c.radius*a+50;init_shape_canvas(d,c,a);to_x_local_vect(c.radius);var e=f*c.radius*a+25;d.beginPath();d.arc(e,e,f*c.radius*a,0,2*Math.PI);d.fill();d.stroke();if(c.draw_radius){d.save();d.lineWidth=size_y/1E3*2;d.strokeStyle="#FFFFFF";d.fillStyle="#FFFFFF";d.beginPath();d.moveTo(e,e);d.lineTo(e+f*a*c.draw_radius[0],
e+f*a*c.draw_radius[1]);d.stroke();var h=e+f*a*c.draw_radius[0]/2,e=e+f*a*c.draw_radius[1]/2;d.font="22px Arial";var g=Math.sqrt(Math.pow(background.size_x*c.draw_radius[0],2)+Math.pow(background.size_y*c.draw_radius[1],2));d.lineWidth=to_y_local(.5)/1E3;d.strokeStyle="#000000";d.fillStyle="#FFFFFF";var m="",m="lol"==game?m+(Math.round(10*g)/10+"u"):"wows"==game?m+(Math.round(.01*g)/10+"km"):m+(Math.round(10*g)/10+"m");d.fillText(m,h,e);d.restore()}canvas2container2(d,b,c);c.container.x=x_abs(c.x)-
f*c.radius-25/a;c.container.y=y_abs(c.y)-f*c.radius-25/a;c.container.width/=a;c.container.height/=a;c.container.orig_scale=[c.container.scale.x,c.container.scale.y];objectContainer.addChild(c.container);render_scene()}function canvas2container2(c,b,d){c=PIXI.Texture.fromCanvas(b);c=new PIXI.Sprite(c);d.container=c;c.texture.baseTexture.source.src=d.uid;c.hitArea=new PIXI.TransparencyHitArea.create(c,!1);make_draggable(c);c.entity=d;room_data.slides[active_slide].entities[d.uid]=d;return!0}
function draw_entity(c,b){("00000"+(c.color|0).toString(16)).substr(-6);var d=document.createElement("canvas"),f=d.getContext("2d"),a=[],e=background_sprite.height,h=1;c.draw_zoom_level&&(h/=c.draw_zoom_level);if(0<c.path.length){for(var g=9999,m=9999,n=-9999,k=-9999,p=0;p<c.path.length;p++){var z=c.path[p][0],r=c.path[p][1],g=Math.min(g,z),m=Math.min(m,r),n=Math.max(n,z),k=Math.max(k,r);a.push(e*z*h,e*r*h)}z=50;c.end_size&&(z=c.end_size*h*3);d.width=e*(n-g)*h+z;d.height=e*(k-m)*h+z;n=-g*e*h+z/2;
e=-m*e*h+z/2;for(p=0;p<a.length;p+=2)a[p]+=n,a[p+1]+=e;b(f,a,h);canvas2container2(f,d,c);c.container.height/=h;c.container.width/=h;c.container.x=x_abs(c.x)+x_abs(g)-z/2/h;c.container.y=y_abs(c.y)+y_abs(m)-z/2/h;c.container.orig_scale=[c.container.scale.x,c.container.scale.y];objectContainer.addChild(c.container);render_scene()}}
function create_drawing2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);var a=smooth_draw(b,d);if(c.end){if(c.path.length>=ARROW_LOOKBACK){var e=Math.max(0,c.path.length-ARROW_LOOKBACK);a[0]=[d[2*e],d[2*e+1]]}draw_end(b,c,a[0],a[1],f)}})}function create_curve2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);d=smooth_draw(b,d,!1);c.end&&draw_end(b,c,d[0],d[1],f)})}
function create_area2(c){c.path[c.path.length-1]==[0,0]&&c.path.pop();draw_entity(c,function(b,d,f){init_shape_canvas(b,c,f);smooth_draw(b,d,!0);b.fill()})}function create_line2(c){draw_entity(c,function(b,d,f){init_canvas(b,c.thickness*f,c.color,c.style);b.moveTo(d[0],d[1]);for(var a=2;a<d.length;a+=2)b.lineTo(d[a],d[a+1]);b.stroke();draw_end(b,c,1==c.path.length?[x_diff,y_diff]:[d[d.length-4],d[d.length-3]],[d[d.length-2],d[d.length-1]],f)})}
function create_polygon2(c){draw_entity(c,function(b,d,f){init_shape_canvas(b,c,f);b.moveTo(d[0],d[1]);for(var a=2;a<d.length;a+=2)b.lineTo(d[a],d[a+1]);b.lineTo(d[0],d[1]);b.stroke();b.fill();draw_end(b,c,1==c.path.length?[x_diff,y_diff]:[d[d.length-4],d[d.length-3]],[d[d.length-2],d[d.length-1]],f)})}
function start_drawing(){draw_context.clearRect(0,0,draw_canvas.width,draw_canvas.height);temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);"setLineDash"in temp_draw_context&&temp_draw_context.setLineDash([]);"setLineDash"in draw_context&&draw_context.setLineDash([]);$(temp_draw_canvas).show();$(draw_canvas).show()}function stop_drawing(){$(temp_draw_canvas).hide();$(draw_canvas).hide()}
function snap_and_emit_entity(c){move_entity(c,0,0);emit_entity(c);render_scene()}function update_timeline(c){if(c.start_time){for(var b=c.start_time;timeline_entities[b];)b+=EPSILON;timeline.add(b);timeline_entities[b]=c;for(b=c.end_time;timeline_entities[b];)b+=EPSILON;timeline.add(b);timeline_entities[b]=c}}
function rebuild_timeline(c){timeline=new FastPriorityQueue;timeline_entities={};for(var b in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(b)&&room_data.slides[active_slide].entities[b].container&&(update_timeline(room_data.slides[active_slide].entities[b]),remove(b,!0))}
function progress_timeline(){if(!timeline.isEmpty())for(var c=video_progress(),b=timeline.peek();c>=b;){b=timeline_entities[b];video_progress()>=b.end_time?b.container&&remove(b.uid,!0):b.start_time<=c&&(b.container||create_entity(b));timeline.poll();if(timeline.isEmpty())break;b=timeline.peek()}}
function emit_entity(c){var b=c.container;background.is_video&&(c.start_time=video_progress(),c.end_time=video_progress()+delay,update_timeline(c));c.container=void 0;socket.emit("create_entity",room,c,active_slide);room_data.slides[active_slide].z_top++;c.z_index=room_data.slides[active_slide].z_top;c.container=b;center_anchor(c.container)}
function on_icon_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=icon_color;selected_icon_no_color&&(c=16777215);var d=icon_size*icon_extra_scale*ICON_SCALE,d=d*zoom_level,f=mouse_x_rel(b.x)-d/2,b=mouse_y_rel(b.y)-d/2;c={uid:newUid(),type:"icon",tank:selected_icon,x:f,y:b,size:d,color:c,alpha:1,label:$("#icon_label").val(),label_font_size:label_font_size*zoom_level,label_color:"#ffffff",label_font:"Arial",label_pos:label_position,label_background:$("#label_background").get(0).checked,
draw_zoom_level:zoom_level};c.label_background&&(c.label_color="#000000");undo_list.push(clone_action(["add",[c]]));create_icon(c,snap_and_emit_entity)}
function on_text_end(c){var b=$("#text_tool_text").val();setup_mouse_events(void 0,void 0);if(""!=b){var d=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(d.x);d=mouse_y_rel(d.y);b={uid:newUid(),type:"text",x:c,y:d,scale:[1,1],color:text_color,alpha:1,text:b,font_size:font_size*zoom_level,font:"Arial"};undo_list.push(clone_action(["add",[b]]));current_text_element=b;create_text2(b);snap_and_emit_entity(b)}}
function on_background_text_end(c){setup_mouse_events(void 0,void 0);var b=c.data.getLocalPosition(background_sprite);c=mouse_x_rel(b.x);b=mouse_y_rel(b.y);c={uid:newUid(),type:"background_text",x:c,y:b,scale:[1,1],color:background_text_color,alpha:1,text:$("#text_tool_background_text").val(),font_size:background_font_size*zoom_level,font:"Arial"};undo_list.push(clone_action(["add",[c]]));create_background_text2(c);snap_and_emit_entity(c)}var line_state={};
function on_line_move(c){limit_rate(15,line_state,function(){var b=c.data.getLocalPosition(background_sprite),d;d=0==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-1][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-1][1]+new_drawing.y)];b=[to_x_local(mouse_x_rel(b.x)),to_y_local(mouse_y_rel(b.y))];temp_draw_context.clearRect(0,0,temp_draw_canvas.width,temp_draw_canvas.height);temp_draw_context.beginPath();
temp_draw_context.moveTo(d[0],d[1]);temp_draw_context.lineTo(b[0],b[1]);temp_draw_context.stroke();draw_end(temp_draw_context,new_drawing,d,b)})}
function on_line_end(c){limit_rate(15,line_state,function(){});try{var b=c.data.getLocalPosition(background_sprite),d=mouse_x_rel(b.x),f=mouse_y_rel(b.y),d=d-new_drawing.x,f=f-new_drawing.y;0!=new_drawing.path.length&&d==last(new_drawing.path)[0]&&f==last(new_drawing.path)[1]||new_drawing.path.push([d,f])}catch(a){}c=1==new_drawing.path.length?[to_x_local(new_drawing.x),to_y_local(new_drawing.y)]:[to_x_local(new_drawing.path[new_drawing.path.length-2][0]+new_drawing.x),to_y_local(new_drawing.path[new_drawing.path.length-
2][1]+new_drawing.y)];b=[to_x_local(last(new_drawing.path)[0]+new_drawing.x),to_y_local(last(new_drawing.path)[1]+new_drawing.y)];if(just_activated&&(d=Math.pow(c[0]-b[0],2)+Math.pow(c[1]-b[1],2),just_activated=!1,.01>d))return;draw_context.lineTo(b[0],b[1]);draw_context.stroke();shifted||(draw_end(draw_context,new_drawing,c,b),canvas2container(draw_context,draw_canvas,new_drawing)&&(emit_entity(new_drawing),undo_list.push(clone_action(["add",[new_drawing]]))),setup_mouse_events(void 0,void 0),stop_drawing(),
new_drawing=null)}
function create_text_sprite(c,b,d,f,a,e,h){void 0===h&&(h="");var g=document.createElement("canvas"),m=objectContainer.scale.y,n=g.getContext("2d"),k=TEXT_QUALITY;n.font=h+" "+Math.round(2*d*m*k)+"px "+f;for(var p=n.measureText(c);p.width>MAX_CANVAS_SIZE;)k/=2,n.font=h+" "+Math.round(2*d*m*k)+"px "+f,p=n.measureText(c);p=n.measureText(c);g.height=d*m*k*2.5;g.width=p.width+.2*g.height;a&&(n.fillStyle="#ffffff",n.lineWidth=25,n.fillRect(0,0,p.width+.2*g.height,g.height),n.strokeRect(0,0,p.width+.2*
g.height,g.height));n.fillStyle=b;n.font=h+" "+Math.round(2*d*m*k)+"px "+f;e&&(n.shadowColor="black",n.shadowOffsetX=k,n.shadowOffsetY=k,n.shadowBlur=5);n.fillText(c,.1*g.height,g.height/1.5+.1*g.height);return(c=createSprite(n,g))?(b=c.width/c.height,c.height=Math.round(2*d*m)/objectContainer.scale.x,c.width=c.height*b,c.x=0,c.y=0,c):!1}
function create_text2(c){var b="#"+("00000"+(c.color|0).toString(16)).substr(-6),b=create_text_sprite(c.text,b,TEXT_SCALE*c.font_size,c.font,!1,!0),d=b.width/b.height;b.height=x_abs(c.font_size/530);b.width=b.height*d;b&&(c.container=b,b.x=x_abs(c.x),b.y=y_abs(c.y),objectContainer.addChild(b),b.texture.baseTexture.source.src=c.uid,make_draggable(b),b.entity=c,room_data.slides[active_slide].entities[c.uid]=c,render_scene())}
function create_background_text2(c){var b="#"+("00000"+(c.color|0).toString(16)).substr(-6),b=create_text_sprite(c.text,b,BACKGROUND_TEXT_SCALE*c.font_size,c.font,!0,!1),d=b.width/b.height;b.height=x_abs(c.font_size/440);b.width=b.height*d;b&&(c.container=b,b.x=x_abs(c.x),b.y=y_abs(c.y),objectContainer.addChild(b),b.texture.baseTexture.source.src=c.uid,make_draggable(b),b.entity=c,room_data.slides[active_slide].entities[c.uid]=c,render_scene())}
function nearestPow2(c){return Math.pow(2,Math.round(Math.log(c)/Math.log(2)))}
function create_icon_cont(c,b){var d=new PIXI.Sprite(b);d.tint=c.color;var f=d.width/d.height;c.container=d;c.container.x=x_abs(c.x);c.container.y=y_abs(c.y);d.height=x_abs(c.size);d.width=d.height*f;center_anchor(d);if(c.label&&""!=c.label){var a=create_text_sprite(c.label,c.label_color,ICON_LABEL_SCALE*c.label_font_size,c.label_font,c.label_background,!c.label_background,c.label_font_modifier),e=c.label_pos;e||(e="pos_bottom");c.container.addChild(a);var h;h=c.label_background?450:680;f=a.width/
a.height;a.height=x_abs(c.label_font_size/h)/c.container.scale.y;a.width=a.height*f;f=d.width/d.scale.x;d=d.height/d.scale.y;"pos_bottom"==e?(a.x-=a.width/2,a.y+=d/2):"pos_top"==e?(a.x-=a.width/2,a.y-=a.height+d/2):"pos_left"==e?(a.x-=a.width+f/2,a.y-=a.height/2):"pos_right"==e?(a.x+=f/2,a.y-=a.height/2):"pos_top_left"==e?(a.x-=a.width+f/2,a.y-=d/2+a.height/2):"pos_top_right"==e?(a.x+=f/2,a.y-=d/2+a.height/2):"pos_bottom_left"==e?a.x-=a.width+f/2:"pos_bottom_right"==e&&(a.x+=f/2)}c.container.entity=
c;c.container.alpha=c.alpha;make_draggable(c.container);objectContainer.addChild(c.container);adjust_icon_zoom(c);render_scene();room_data.slides[active_slide].entities[c.uid]=c}
function create_icon(c,b){try{var d=$('button[id*="'+c.tank+'"]').find("span");d[0].innerHTML=parseInt(d[0].innerHTML)+1;d=$("#icon_counter");d.text((parseInt(d.text())+1).toString())}catch(h){}var d=c.tank,f=c.tank.slice(-3);"png"!=f&&"jpg"!=f&&(d+=".png");var a;texture_atlas[d]&&!is_safari()?(d=texture_atlas[d],a=new PIXI.Texture(loader.resources[d.sprite].texture,new PIXI.Rectangle(d.x,d.y,d.width,d.height))):a=PIXI.Texture.fromImage(image_host+d);resources_loading++;var e=function(){create_icon_cont(c,
a);b&&b(c);resources_loading--};if(a.baseTexture.hasLoaded)e();else a.baseTexture.on("loaded",function(){e()})}function make_draggable(c){dragging_enabled&&(c.interactive=!0,c.buttonMode=!0,c.draggable=!0,c.mousedown=on_drag_start,c.touchstart=on_drag_start);c.orig_scale=[c.scale.x,c.scale.y]}function make_undraggable(c){c.interactive=!1;c.buttonMode=!1;c.draggable=!1;delete c.mousedown;delete c.touchstart}
function center_anchor(c){var b=.5-c.anchor.x,d=.5-c.anchor.y;c.anchor.x=.5;c.anchor.y=.5;c.x+=b*c.width;c.y+=d*c.height}
function create_entity(c){room_data.slides[active_slide].entities[c.uid]&&remove(c.uid);"background"==c.type?set_background(c):"icon"==c.type?create_icon(c):"drawing"==c.type?create_drawing2(c):"curve"==c.type?create_curve2(c):"line"==c.type?create_line2(c):"text"==c.type?create_text2(c):"background_text"==c.type?create_background_text2(c):"note"==c.type?create_note(c):"rectangle"==c.type?create_rectangle2(c):"circle"==c.type?create_circle2(c):"polygon"==c.type?create_polygon2(c):"area"==c.type&&
create_area2(c);c.container&&(c.scale&&(c.container.scale.x=c.container.orig_scale[0]*c.scale[0],c.container.scale.y=c.container.orig_scale[1]*c.scale[1]),c.container.anchor&&center_anchor(c.container),c.rotation&&(c.container.rotation=-c.rotation),background.is_video&&update_timeline(c))}function update_username(c){""!=c&&c!=my_user.name&&(my_user.name=c,socket.emit("update_user",room,my_user));c=$("#"+my_user.id).find("input");c.attr("placeholder",my_user.name);c.val("")}
function add_user(c){my_user_id==c.id&&(my_user=c);if(c.id in userlist){var b=$("#"+c.id);c.id==my_user_id?b.find("input").attr("placeholder",c.name):b.text(c.name)}else c.id==my_user_id?(b="<div class='btn' style='text-align:left;' id='"+c.id+"'><input maxlength='30' type='text' placeholder='"+escapeHtml(c.name)+"'></div>",$("#userlist").prepend(b),b=$("#userlist").find("input"),b.on("blur",function(){update_username(this.value)}),b.onkeypress=function(b){b||(b=window.event);keyCode=b.keyCode||b.which;
"13"==keyCode&&update_username(this.value)}):(b="<button class='btn' style='text-align:left;' data-toggle='tooltip' title='Click to toggle this user&#39;s permission.' id='"+c.id+"'>"+escapeHtml(c.name)+"</button>",$("#userlist").append(b));userlist[c.id]=c;c.role?"owner"==c.role?$("#"+c.id).css("background-color","lime"):"driver"==c.role&&$("#"+c.id).css("background-color","yellow"):$("#"+c.id).css("background-color","#EEEEEE");c.id==my_user_id&&update_my_user();$("#user_count").text(Object.keys(userlist).length.toString())}
function update_my_user(){my_user.logged_in?($("#store_tactic_popover").show(),tactic_name&&""!=tactic_name&&$("#save").show(),$("#sign_in_text").text(my_user.name.substring(0,9)),$("#login_dropdown").removeClass("btn-warning"),$("#login_dropdown").addClass("btn-success")):($("#store_tactic_popover").hide(),$("#save").hide());update_lock()}
function update_lock(){var c=$("#lock div");is_room_locked?c.removeClass("icon-unlock").addClass("icon-lock"):c.removeClass("icon-lock").addClass("icon-unlock");if(is_room_locked&&!my_user.role){$(".mejs-controls").hide();$(".left_column").hide();$("#slide_interactive").hide();$("#slide_static").show();$("#slide_table1").hide();$("#can_not_edit").show();$("#map_select_box").hide();for(var b in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[b]&&"note"==room_data.slides[active_slide].entities[b].type&&
room_data.slides[active_slide].entities[b].container&&($("textarea",room_data.slides[active_slide].entities[b].container.menu).prop("readonly",!0),$("button",room_data.slides[active_slide].entities[b].container.menu).hide());my_tracker&&stop_tracking();"ping_context"==active_context&&(objectContainer.mousemove=void 0)}else for(b in $(".mejs-controls").show(),$(".left_column").show(),$("#slide_interactive").show(),$("#slide_static").hide(),$("#slide_table1").show(),$("#can_not_edit").hide(),$("#map_select_box").show(),
room_data.slides[active_slide].entities)room_data.slides[active_slide].entities[b]&&"note"==room_data.slides[active_slide].entities[b].type&&room_data.slides[active_slide].entities[b].container&&($("textarea",room_data.slides[active_slide].entities[b].container.menu).prop("readonly",!1),$("button",room_data.slides[active_slide].entities[b].container.menu).show());"owner"!=my_user.role&&is_room_locked?($("#store_tactic_popover").hide(),$("#save").hide(),$("#export_tab_button").hide()):(my_user.logged_in?
($("#store_tactic_popover").show(),tactic_name&&""!=tactic_name&&$("#save").show()):($("#store_tactic_popover").hide(),$("#save").hide()),$("#export_tab_button").show());"owner"==my_user.role?($("#lock").show(),$("#nuke_room").show(),$("#lock_camera").show()):($("#lock").hide(),$("#nuke_room").hide(),$("#lock_camera").hide())}function remove_user(c){$("#"+c).remove();delete userlist[c];$("#user_count").text(Object.keys(userlist).length.toString())}
function escapeHtml(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function chat(c,b){c=escapeHtml(c);c=c.split(":");$("#chat_box").append('<div class="chatmsg"><b style="color:'+b+';">'+c[0]+"</b>: "+c.slice(1).join(":")+"<br/></div>");$("#chat_box").scrollTop($("#chat_box")[0].scrollHeight)}
function supports_color_input(){var c=document.createElement("input"),b,d=document.documentElement;c.setAttribute("type","color");if(b="text"!==c.type)c.value=":)",c.style.cssText="position:absolute;visibility:hidden;",d.appendChild(c),d.offsetWidth,b=":)"!=c.value,d.removeChild(c);return b}
function initialize_color_picker(c,b){supports_color_input()?$("#"+c+" ~ input").show():$("#"+c+" ~ input").hide();var d=$('select[id="'+c+'"]').val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+" ~ input").attr("value",d);$("#"+c+" ~ input").val(d);$("#"+c+" ~ input").on("change",function(){var d=$(this).val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+'~ span span[data-selected=""]').removeAttr("data-selected")});$('select[id="'+c+'"]').simplecolorpicker().on("change",function(){var d=
$('select[id="'+c+'"]').val();window[b]=parseInt("0x"+d.substring(1));$("#"+c+" ~ input").first().val(d);"track_color"==b&&(my_tracker&&stop_tracking(),start_tracking({x:2E3,y:2E3}))})}
function initialize_slider(c,b,d){var f=$("#"+c);$("#"+b).val(f.attr("value"));window[d]=parseFloat(f.attr("value"));f.on("change",function(a){$("#"+b).val(this.value);window[d]=parseFloat(this.value)});f.on("input",function(a){$("#"+b).val(this.value);window[d]=parseFloat(this.value)});$("#"+b).change(function(){var a=parseFloat(this.value);isNaN(a)?this.value=window[d]:(window[d]=a,f.slider("setValue",window[d]))})}
function clear(c){var b=[],d;for(d in room_data.slides[active_slide].entities)if(room_data.slides[active_slide].entities.hasOwnProperty(d)&&(room_data.slides[active_slide].entities[d].type==c||!c)&&"background"!=room_data.slides[active_slide].entities[d].type){var f=room_data.slides[active_slide].entities[d];remove(d);b.push(f);socket.emit("remove",room,d,active_slide)}undo_list.push(clone_action(["remove",b]))}
function clone_action(c){if(c[1].length){temp_containers=[];for(var b=0;b<c[1].length;b++)temp_containers.push(c[1][b].container),c[1][b].container=null}var d=JSON.stringify(c);if(c[1].length)for(b=0;b<c[1].length;b++)c[1][b].container=temp_containers[b];return JSON.parse(d)}
function undo(){var c=undo_list.pop();if(c)if("add"==c[0]){for(var b in c[1])c[1][b].uid&&(remove(c[1][b].uid),delete c[1][b].container,socket.emit("remove",room,c[1][b].uid,active_slide));redo_list.push(clone_action(c))}else if("drag"==c[0]){for(b in c[1]){var d=c[1][b][0][0],f=c[1][b][0][1],a=c[1][b][0][2],e=c[1][b][0][3],h=c[1][b][1];room_data.slides[active_slide].entities[h]&&(c[1][b][0][0]=room_data.slides[active_slide].entities[h].x,c[1][b][0][1]=room_data.slides[active_slide].entities[h].y,
c[1][b][0][2]=room_data.slides[active_slide].entities[h].scale?[room_data.slides[active_slide].entities[h].scale[0],room_data.slides[active_slide].entities[h].scale[1]]:[1,1],"undefined"!==typeof room_data.slides[active_slide].entities[h].rotation&&(c[1][b][0][3]=room_data.slides[active_slide].entities[h].rotation),drag_entity(room_data.slides[active_slide].entities[h],d,f,a,e),socket.emit("drag",room,h,active_slide,d,f,a,e))}redo_list.push(clone_action(c))}else if("remove"==c[0]){for(b in c[1])d=
c[1][b],delete d.container,socket.emit("create_entity",room,d,active_slide),create_entity(d);redo_list.push(clone_action(c))}else if("select"==c[0]){f=[];for(b in c[2])d=c[2][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&f.push(d);deselect_all();selected_entities=f;select_entities();redo_list.push(clone_action(c))}render_scene()}
function redo(){var c=redo_list.pop();if(c){if("add"==c[0]){for(var b in c[1])c[1][b].uid&&(socket.emit("create_entity",room,c[1][b],active_slide),create_entity(c[1][b]));undo_list.push(clone_action(c))}else if("drag"==c[0]){for(b in c[1]){var d=c[1][b][0][0],f=c[1][b][0][1],a=c[1][b][0][2],e=c[1][b][0][3],h=c[1][b][1];room_data.slides[active_slide].entities[h]&&(c[1][b][0][0]=room_data.slides[active_slide].entities[h].x,c[1][b][0][1]=room_data.slides[active_slide].entities[h].y,c[1][b][0][2]=room_data.slides[active_slide].entities[h].scale?
[room_data.slides[active_slide].entities[h].scale[0],room_data.slides[active_slide].entities[h].scale[1]]:[1,1],"undefined"!==typeof room_data.slides[active_slide].entities[h].rotation&&(c[1][b][0][3]=room_data.slides[active_slide].entities[h].rotation),drag_entity(room_data.slides[active_slide].entities[h],d,f,a,e),socket.emit("drag",room,h,active_slide,d,f,a,e))}undo_list.push(clone_action(c))}else if("remove"==c[0]){for(b in c[1])d=c[1][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&
(remove(d.uid),delete d.container,socket.emit("remove",room,d.uid,active_slide));undo_list.push(clone_action(c))}else if("select"==c[0]){f=[];for(b in c[1])d=c[1][b],room_data.slides[active_slide].entities.hasOwnProperty(d.uid)&&f.push(d);deselect_all();selected_entities=f;select_entities();undo_list.push(clone_action(c))}render_scene()}}
function clear_selected(){remove_select_box();var c=selected_entities.slice(0),b=[],d;for(d in c){var f=c[d];remove(c[d].uid);b.push(f);socket.emit("remove",room,f.uid,active_slide)}deselect_all();selected_entities=[];undo_list.push(clone_action(["remove",b]));"drag_context"==active_context&&cancel_drag(!0)}
function drag_entity(c,b,d,f,a){if(c.container){c.container.x+=x_abs(b-c.x);c.container.y+=y_abs(d-c.y);c.x=b;c.y=d;c.scale=f;"undefined"!==typeof a&&null!=a&&(c.rotation=a,c.container.rotation=-a);"note"==c.type&&align_note_text(c);c.container&&(objectContainer.removeChild(c.container),objectContainer.addChild(c.container),f&&(c.container.scale.x=c.container.orig_scale[0]*f[0],c.container.scale.y=c.container.orig_scale[1]*f[1]));select_box_dirty=!1;for(var e in selected_entities)selected_entities[e].uid==
c.uid&&(select_box_dirty=!0);render_scene()}}function find_first_slide(){var c=Math.pow(2,52),b=0,d;for(d in room_data.slides){var f=room_data.slides[d].order;f<c&&(c=f,b=d)}return b}function find_previous_slide(c){var b=-9007199254740990,d=0,f;for(f in room_data.slides){var a=room_data.slides[f].order;a<c&&a>b&&(b=a,d=f)}return d}function find_next_slide(c){var b=9007199254740991,d=0,f;for(f in room_data.slides){var a=room_data.slides[f].order;a>c&&a<b&&(b=a,d=f)}return d}
function hash(c){for(var b=0,d=0;d<c.length;d++)b+=c.charCodeAt(d);return b}function resolve_order_conflicts(c){for(var b in room_data.slides)if(room_data.slides[b].order==c.order){if(hash(c.uid)<hash(b)){b=find_previous_slide(c.order);var d=0;0!=b&&(d=room_data.slides[b].order);c.order=Math.floor((c.order-d)/2)}else b=find_next_slide(c.order),d=c.order+4294967296,0!=b&&(d=room_data.slides[b].order),c.order=Math.floor((d-c.order)/2);resolve_order_conflicts(c);break}}
function update_slide_buttons(){var c=find_previous_slide(room_data.slides[active_slide].order),b=find_next_slide(room_data.slides[active_slide].order);0==c?document.getElementById("prev_slide").disabled=!0:document.getElementById("prev_slide").disabled=!1;0==b?document.getElementById("next_slide").disabled=!0:document.getElementById("next_slide").disabled=!1;1==Object.keys(room_data.slides).length?document.getElementById("remove_slide").disabled=!0:document.getElementById("remove_slide").disabled=
!1;grid_layer.visible=room_data.slides[active_slide].show_grid?!0:!1;c=escapeHtml(room_data.slides[active_slide].name);$("#slide_name_field").val(c);$("#slide_name_field2").val(c);var b=find_first_slide(),d=$("#slide_table");d.empty();do c=escapeHtml(room_data.slides[b].name),b==active_slide?d.append("<tr id='"+b+"' style='background-color:#ADD8E6'><td><a id='"+b+"'>"+c+"</a></td></tr>"):d.append("<tr id='"+b+"'><td><a id='"+b+"'>"+c+"</a></td></tr>"),b=find_next_slide(room_data.slides[b].order);
while(0!=b);var f=$("#slide_container").scrollTop();setTimeout(function(){$("#slide_container").scrollTop(f)},0)}
function transition(c){var b=[],d=[],f=[],a;for(a in room_data.slides[active_slide].entities)room_data.slides[c].entities[a]?f.push(a):b.push(a);for(a in room_data.slides[c].entities)room_data.slides[active_slide].entities.hasOwnProperty(a)||d.push(a);for(var e in b)a=b[e],remove(a,!0);var h;for(e in f)a=f[e],"background"==room_data.slides[c].entities[a].type?h=a:(remove(a,!0),d.push(a));active_slide=c;update_slide_buttons();var g=function(){try{d.sort(function(a,b){return room_data.slides[c].entities[a].z_index-
room_data.slides[c].entities[b].z_index})}catch(a){}for(var b in d)create_entity(room_data.slides[c].entities[d[b]])};h?set_background(room_data.slides[c].entities[h],function(){g();render_scene()}):(g(),render_scene())}
function cancel_drag(c){clearTimeout(drag_timeout);objectContainer.buttonMode=!1;context_before_drag&&(active_context=context_before_drag);context_before_drag=null;if(dragged_entity){dragged_entity.mouseup=void 0;dragged_entity.touchend=void 0;dragged_entity.mouseupoutside=void 0;dragged_entity.touchendoutside=void 0;dragged_entity.mousemove=void 0;dragged_entity.touchmove=void 0;if(c)if(move_selected&&0<selected_entities.length)for(var b in selected_entities)drag_entity(selected_entities[b],selected_entities[b].origin_x,
selected_entities[b].origin_y);else drag_entity(dragged_entity.entity,dragged_entity.entity.origin_x,dragged_entity.entity.origin_y);dragged_entity==select_box&&(make_resizable(select_box),on_select_over.bind(select_box)(),on_selectbox_move.bind(select_box)())}dragged_entity=null;move_selected=!1}
function change_slide(c){if(active_slide!=c){"drag_context"==active_context&&cancel_drag(!0);undo_list=[];redo_list=[];deselect_all();transition(c);c=$("#contexts").find(".active");var b=c.attr("id")+"_context";$(this).attr("data-context")&&(b=c.attr("data-context")+"_context");active_context=b}}
function create_new_slide(c){var b={};b.show_grid=room_data.slides[c].show_grid;b.z_top=room_data.slides[c].z_top;b.uid=newUid();var d=room_data.slides[c].name,f=d.split(" ");isNaN(parseFloat(f[f.length-1]))?d+=" 1":(f[f.length-1]=""+(parseFloat(f[f.length-1])+1),d=f.join(" "));b.name=d;b.entities={};for(var a in room_data.slides[c].entities)f=room_data.slides[c].entities[a].container,delete room_data.slides[c].entities[a].container,b.entities[a]=JSON.parse(JSON.stringify(room_data.slides[c].entities[a])),
room_data.slides[c].entities[a].container=f;f=find_next_slide(room_data.slides[c].order);0==f?a=room_data.slides[c].order+4294967296:(a=room_data.slides[c].order+Math.floor((room_data.slides[f].order-room_data.slides[c].order)/2),d==room_data.slides[f].name&&(b.name=room_data.slides[c].name+" - 1"));b.order=a;return b}
function remove_slide(c){if(1<Object.keys(room_data.slides).length){if(c==active_slide){var b=room_data.slides[c].order,d=find_previous_slide(b);0==d&&(d=find_next_slide(b));change_slide(d);active_slide=d}delete room_data.slides[c]}update_slide_buttons()}function rename_slide(c,b){room_data.slides[c].name=b;update_slide_buttons()}function add_slide(c){resolve_order_conflicts(c);room_data.slides[c.uid]=c;update_slide_buttons()}
function initialize_map_select(c){var b=c.find("option").sort(function(b,c){return b.innerHTML<c.innerHTML?-1:b.innerHTML>c.innerHTML?1:0});c.empty().append(b);c.val("");c.change(function(){var b=c.val().trim();background&&background.path==b||try_select_map(c,b)})}function activity_animation(c){var b=$("#userlist #"+c);b.hasClass("sheen")||(b.addClass("sheen"),setTimeout(function(){b.removeClass("sheen")},1E3))}
function try_select_map(c,b,d){c=background?background.uid:newUid();var f=0,a=0,e=$('option[value="'+b+'"]').attr("data-size");e&&(a=e.split("x"),f=parseFloat(a[0]),a=parseFloat(a[1]));d=d?!0:!1;b.split(".").pop().startsWith();var h={uid:c,type:"background",path:b,size_x:f,size_y:a,custom:d};is_video(b)&&(h.is_video=!0);set_background(h,function(a){a&&(socket.emit("create_entity",room,h,active_slide),background.is_video&&(handle_pause(0),socket.emit("pause_video",room,0)))})}
function add_custom_map(c){var b=$("#map_select"),d=$('#map_select option[value="'+c+'"]');0==d.length&&(d=last(c.split("/")),d=$('<option value="'+c+'">'+d+"</option>"),b.append(d));b.val(c)}function cleanup(){deselect_all();undo_list=[];redo_list=[];if(active_slide)for(var c in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(c)&&remove(c);room_data={}}
function stop_syncing(){im_syncing=!1;clearInterval(sync_event);sync_event=setInterval(function(){im_syncing=!1;video_paused?clearInterval(sync_event):2E4<Date.now()-get_local_time(last_video_sync[1])&&start_syncing()},1E4+5E3*Math.random())}function handle_play(c,b){video_paused=!1;last_video_sync=[c,b];var d=Date.now()-get_local_time(b);video_media.setCurrentTime(c);0>=d?video_player.play():setTimeout(function(){video_player.play()},d);video_player.play();stop_syncing();play_video_controls()}
function handle_pause(c,b){video_paused=!0;clearInterval(sync_event);im_syncing=!1;video_media.setCurrentTime(c);video_player.pause();pause_video_controls()}function sync_video(c,b){var d=Date.now()-get_local_time(b),d=c+d*base_playback_rate/1E3,d=video_progress()-d;console.log("lag: ",d);.1<Math.abs(d)/base_playback_rate?hard_sync_video(c,b):"youtube"!=video_media.pluginType&&set_playback_rate(base_playback_rate,base_playback_rate+d/VIDEO_SYNC_DELAY)}
function video_progress(){return video_paused?video_media.currentTime:progress+(Date.now()-progress_update)*playback_rate/1E3}function enable_dragging(){if(!dragging_enabled)for(var c in room_data.slides[active_slide].entities){var b=room_data.slides[active_slide].entities[c];b.container&&"background"!=b.type&&(dragging_enabled=!0,b.container.interactive=!0,b.container.buttonMode=!0,b.container.draggable=!0,b.container.mousedown=on_drag_start,b.container.touchstart=on_drag_start)}}
function disable_dragging(){if(dragging_enabled)for(var c in room_data.slides[active_slide].entities){var b=room_data.slides[active_slide].entities[c];b.container&&"background"!=b.type&&(dragging_enabled=!1,b.container.interactive=!1,b.container.buttonMode=!1,b.container.draggable=!1,delete b.container.mousedown,delete b.container.touchstart)}}var sync_in_progress=!1,press_play_delay=0;
function hard_sync_video(c,b){if(!sync_in_progress){sync_in_progress=!0;var d=Date.now()-get_local_time(b),d=c+d*base_playback_rate/1E3,f=video_progress()-d;0>f||3<f?(video_media.setCurrentTime(d+1),sync_in_progress=!1):(video_progress(),video_player.pause(),setTimeout(function(){sync_in_progress=!1;if(!video_paused){video_player.play();var a=Date.now(),b=function(c){press_play_delay=Date.now()-a;video_media.removeEventListener("play",b)};video_media.addEventListener("play",b)}},Math.max(0,1E3*f/
base_playback_rate-press_play_delay)))}}function handle_sync(c,b,d){video_paused?im_syncing=!1:(d!=my_user.id&&stop_syncing(),last_video_sync=[c,b],sync_video(c,b))}
function set_playback_rate(c,b){base_playback_rate=c;playback_rate=b;var d=c.toFixed(2);$(".mejs-speed-button").find("button").html(d+"x");$(".mejs-speed-button").find(".mejs-speed-selected").removeClass("mejs-speed-selected");$(".mejs-speed-button").find('input[value="'+d+'"]').next().addClass("mejs-speed-selected");"youtube"==video_media.pluginType?video_media.pluginApi.setPlaybackRate(b):video_media.playbackRate=b}
function create_hp_bar(c){void 0===c&&(c=1);var b=to_x_local_vect(.125*c);c=to_y_local_vect(.015*c);var d=document.createElement("canvas"),f=d.getContext("2d");d.width=b;d.height=c;f.fillStyle="#FFFFFF";f.fillRect(0,0,d.width,d.height);d=PIXI.Texture.fromCanvas(d);d=new PIXI.Sprite(d);d.tint=65280;var f=document.createElement("canvas"),a=f.getContext("2d");f.width=b;f.height=c;a.strokeStyle="#000000";a.lineWidth=1;a.strokeRect(0,0,f.width,f.height);var f=PIXI.Texture.fromCanvas(f),f=new PIXI.Sprite(f),
a=document.createElement("canvas"),e=a.getContext("2d");a.width=b;a.height=c;e.fillStyle="#FF0000";e.fillRect(0,0,a.width,a.height);b=PIXI.Texture.fromCanvas(a);b=new PIXI.Sprite(b);c=new PIXI.Container;c.addChild(b);c.addChild(d);c.addChild(f);return c}var icons={};
function wot_connect(){function c(){for(var a in icons)icons[a]&&icons[a].container&&objectContainer.removeChild(icons[a].container);icons={};render_scene()}function b(a){create_icon(a);a.container.x-=x_abs(.012);a.container.y-=y_abs(.012);var b=create_hp_bar();b.scale.x*=zoom_level;b.scale.y*=zoom_level;b.x-=b.width/2;b.y-=a.container.height+b.height;a.container.addChild(b);var c=create_text_sprite(a.player.substring(0,9),a.label_color,8,"Arial",!1,!0,"bold"),d=c.width/c.height;c.height=x_abs(8/
530);c.width=c.height*d;c.x-=c.width/2;c.y-=a.container.height+b.height+c.height;a.container.addChild(c);a.container.scale.x*=zoom_level;a.container.scale.y*=zoom_level}function d(k){k.onclose=function(a){setTimeout(function(){k=new WebSocket("ws://localhost:6412/");d(k)},1E4)};k.onerror=function(a){k.close()};k.onopen=function(a){c()};k.onmessage=function(d){function k(b){return[(parseFloat(b[0])-a)/g,1-(parseFloat(b[2])-f)/m]}var r=new window.FileReader;r.readAsText(d.data);r.onloadend=function(){if("BATTLE_ENDED"==
r.result)c();else{var d=JSON.parse(r.result);if("tank"in d){var p,q;d.team==n?(p=65280,q="#AAFFAA"):(p=16711680,q="#FFAAAA");p={uid:d.id.toString(),type:"icon",tank:d.type,x:-1,y:-1,size:.02,color:p,alpha:1,label:d.tank.substring(0,10),label_font_size:8,label_color:q,label_font:"Arial",label_font_modifier:"bold",label_pos:"pos_bottom",label_background:!1,label_shadow:!0,label_shadow:!1,maxHealth:d.maxHealth,player:d.name};if(d.position){var w=k(d.position);p.x=w[0];p.y=w[1];b(p)}icons[p.uid]=p}else if("map_dimesions"in
d)a=parseFloat(d.map_dimesions[0][0]),h=parseFloat(d.map_dimesions[1][0]),f=parseFloat(d.map_dimesions[0][1]),e=parseFloat(d.map_dimesions[1][1]),g=h-a,m=e-f;else if("player_team"in d)n=d.player_team;else if("map_id"in d)console.log("map id: ",d.map_id),d=d.map_id,(d=$("#map_select").find("[data-mapid='"+d+"']"))&&try_select_map($("#map_select"),d.val(),!1,function(){render_scene()});else if("remove"in d)p=d.remove.toString(),objectContainer.removeChild(icons[p].container),icons[p]=void 0;else{var u=
new Set;for(q in d)p=q.toString(),icons[p]&&(u.add(p),1<=d[q].length?(w=k(d[q][0]),icons[p].container?(drag_entity(icons[p],w[0],w[1]),icons[p].container.alpha=1):(icons[p].x=w[0],icons[p].y=w[1],b(icons[p])),2==d[q].length&&(w=d[q][1],icons[p].hp!=w&&(icons[p].hp=w,w=icons[p].container.children[1],w.children[1].width=d[q][1]/icons[p].maxHealth*w.children[0].width))):icons[p]&&icons[p].container&&(icons[p].container.alpha=.5),2==d[q].length?icons[p].container&&16776960==icons[p].container.children[1].children[1].tint&&
(icons[p].container.children[1].children[1].tint=65280):icons[p].container&&65280==icons[p].container.children[1].children[1].tint&&(icons[p].container.children[1].children[1].tint=16776960));difference=Object.keys(icons).filter(function(a){return!u.has(a)});for(q in difference)icons[q]&&icons[q].container&&(icons[q].container.alpha=.5);render_scene()}}}}}var f,a,e,h,g,m,n=1;websocket=new WebSocket("ws://localhost:6412/");d(websocket)}
$(document).ready(function(){function c(){video_ready&&progress_timeline();update_pings();scene_dirty&&(select_box_dirty&&redraw_select_box(),renderer.render(objectContainer),scene_dirty=!1);requestAnimationFrame(c)}dpi=document.getElementById("dpitest").offsetHeight;initialize_map_select($("#map_select"));initialize_map_select($("#map_select_wotbase"));size_y=size_x=size=Math.min(window.innerHeight,window.innerWidth)-30;renderer=PIXI.autoDetectRenderer(size,size,{transparent:!0});renderer.autoResize=
!0;useWebGL=renderer instanceof PIXI.WebGLRenderer;$(renderer.view).attr("style","position:absolute; z-index: 2; padding:0; margin:0; border:0;");$(".edit_window").append(renderer.view);renderer.view.addEventListener("wheel",function(a){var b=renderer.plugins.interaction.eventData.data.global;zoom(.1,0>a.deltaY,[from_x_local(b.x),from_y_local(b.y)],a);$("#zoom_level").text((1/zoom_level).toFixed(2));control_camera&&emit_pan_zoom();a.preventDefault()});background_sprite=new PIXI.Sprite;objectContainer=
new PIXI.Container;grid_layer="aw"==game?new PIXI.Sprite.fromImage(image_host+"aw_grid.png"):"squad"==game?new PIXI.Sprite.fromImage(image_host+"squad_grid.png"):new PIXI.Sprite.fromImage(image_host+"grid.png");grid_layer.height=renderer.height;grid_layer.width=renderer.width;objectContainer.addChild(background_sprite);objectContainer.addChild(grid_layer);objectContainer.interactive=!0;objectContainer.mousedown=on_left_click;objectContainer.touchstart=on_left_click;$(renderer.view).mousedown(function(a){if(3===
a.which||2===a.which)last_pan_loc=[renderer.plugins.interaction.eventData.data.global.x,renderer.plugins.interaction.eventData.data.global.y],setup_mouse_events(on_pan),a.preventDefault()});renderer.view.addEventListener("contextmenu",function(a){setup_mouse_events(void 0);$("#zoom_level").text((1/zoom_level).toFixed(2));control_camera&&emit_pan_zoom();a.preventDefault()});$(renderer.view).mouseup(function(a){if(3===a.which||2===a.which)$("#zoom_level").text((1/zoom_level).toFixed(2)),setup_mouse_events(void 0),
control_camera&&emit_pan_zoom(),a.preventDefault()});var b=[],d=0,f=!1,a,e=!1,h,g=function(c){$("#zoom_level").text((1/zoom_level).toFixed(2));f&&control_camera&&(emit_pan_zoom(),f=!1);for(var k=c.changedTouches,g=0;g<k.length;g++){var m=k[g],m=b.map(function(a){return a.id}).indexOf(m.identifier);b.splice(m,1)}2==b.length?(c.preventDefault(),objectContainer.interactive=!1,d=Math.sqrt(Math.pow(b[0].pos[0]-b[1].pos[0],2)+Math.pow(b[0].pos[1]-b[1].pos[1],2)),a=[b[0].pos[0]+(b[1].pos[0]-b[0].pos[0])/
2,b[0].pos[1]+(b[1].pos[1]-b[0].pos[1])/2],e=!1,h=null):objectContainer.interactive=!0},m={};renderer.view.addEventListener("touchstart",function(c){for(var f=c.changedTouches,g=0;g<f.length;g++){var m=f[g],r=[from_x_local(m.pageX),from_y_local(m.pageY)];b.push({id:m.identifier,pos:r})}2==b.length?(c.preventDefault(),objectContainer.interactive=!1,d=Math.sqrt(Math.pow(b[0].pos[0]-b[1].pos[0],2)+Math.pow(b[0].pos[1]-b[1].pos[1],2)),a=[b[0].pos[0]+(b[1].pos[0]-b[0].pos[0])/2,b[0].pos[1]+(b[1].pos[1]-
b[0].pos[1])/2],e=!1,h=null):objectContainer.interactive=!0});renderer.view.addEventListener("touchend",g);renderer.view.addEventListener("touchendoutside",g);renderer.view.addEventListener("touchcancel",g);renderer.view.addEventListener("touchmove",function(c){limit_rate(15,m,function(){for(var k=c.changedTouches,g=0;g<k.length;g++){var m=k[g],r=[from_x_local(m.pageX),from_y_local(m.pageY)],v;for(v in b)b[v].id==m.identifier&&(b[v].pos=r)}2==b.length?(c.preventDefault(),objectContainer.interactive=
!1,k=Math.sqrt(Math.pow(b[1].pos[0]-b[0].pos[0],2)+Math.pow(b[1].pos[1]-b[0].pos[1],2)),g=to_y_local_vect(k)/dpi,m=[b[0].pos[0]+(b[1].pos[0]-b[0].pos[0])/2,b[0].pos[1]+(b[1].pos[1]-b[0].pos[1])/2],e||1.5<g?(g=.9*(k/d-1),h=g=h?.8*h+.2*g:g,zoom(Math.abs(g),0<g,a),e=f=!0):(f=!0,g=[to_x_local(m[0])-to_x_local(a[0]),to_y_local(m[1])-to_y_local(a[1])],objectContainer.x+=g[0],objectContainer.y+=g[1],correct()),d=k):objectContainer.interactive=!0})});draw_canvas=document.createElement("canvas");$(draw_canvas).attr("style",
"padding:0px; margin:0px; border:0; position:absolute; z-index:3; pointer-events:none");draw_canvas.width=renderer.view.width;draw_canvas.height=renderer.view.height;draw_context=draw_canvas.getContext("2d");temp_draw_canvas=document.createElement("canvas");$(temp_draw_canvas).attr("style","padding:0px; margin:0px; border:0; position:absolute; z-index:4; pointer-events:none");temp_draw_canvas.width=renderer.view.width;temp_draw_canvas.height=renderer.view.height;temp_draw_context=temp_draw_canvas.getContext("2d");
$(renderer.view).parent().append(temp_draw_canvas);$(renderer.view).parent().append(draw_canvas);$(temp_draw_canvas).hide();$(draw_canvas).hide();c();loader.once("complete",function(){var a=document.querySelectorAll("input[type=range][list]");Array.prototype.slice.call(a).forEach(function(a){if("list"in a&&"min"in a&&"max"in a&&"step"in a){var b=document.createElement("datalist"),c=parseFloat(a.getAttribute("min")),d=parseFloat(a.getAttribute("step")),e=parseFloat(a.getAttribute("max"));b.id=a.getAttribute("list");
if(20>Math.abs(e-c)/d){for(;c<e+d;c+=d)b.innerHTML+="<option value="+c.toFixed(2)+"></option>";a.parentNode.insertBefore(b,a.nextSibling)}}});texture_atlas["circle.png"]&&!is_safari()?(a=texture_atlas["circle.png"],ping_texture=new PIXI.Texture(loader.resources[a.sprite].texture,new PIXI.Rectangle(a.x,a.y,a.width,a.height))):ping_texture=PIXI.Texture.fromImage(image_host+"circle.png");$("#slide_table1 tbody").sortable({helper:function(a,b){b.children().each(function(){$(this).width($(this).width())});
return b},update:function(a,b){var c;b.item[0].previousElementSibling?(c=room_data.slides[b.item[0].previousElementSibling.id].order,b.item[0].nextElementSibling?(c+=room_data.slides[b.item[0].nextElementSibling.id].order,c/=2):c+=4294967296):c=room_data.slides[find_first_slide()].order-4294967296;room_data.slides[b.item[0].id].order=c;socket.emit("change_slide_order",room,b.item[0].id,c);update_slide_buttons()}}).disableSelection();$("#modal_cancel").click(function(a){$("#myModal").modal("hide")});
$("#link_send").click(function(a){a=$("#send_link").val();var b=a.indexOf("room=");-1==b?alert("No room id found in link."):(tactic_uid=a.slice(b+5).split("&")[0],a=servers[hashstring(tactic_uid)%servers.length],b=active_slide,$("#this_slide_only").get(0).checked||(b=void 0),$.post("http://"+a+"/add_to_room",{target:tactic_uid,source:room,session_id:$("#sid").attr("data-sid"),host:parse_domain(location.hostname),stored:"false",slide:b}).done(function(a){"Success"!=a&&alert(a)}));$("#myModal").modal("hide")});
$("#use_wotbase").click(function(){$(this).is(":checked")?($("#map_select_container").hide(),$("#wotbase_map_select_container").show()):($("#map_select_container").show(),$("#wotbase_map_select_container").hide())});$("#send_to_link").click(function(a){socket.emit("save_room",room);$("#myModal").modal("show");$("#myModal").on("shown.bs.modal",function(){$("#send_link").focus()})});$("#custom_map").click(function(a){socket.emit("save_room",room);$("#map_modal").modal("show");$("#map_modal").on("shown.bs.modal",
function(){$("#send_link").focus()})});$("#map_modal_cancel").click(function(a){$("#map_modal").modal("hide")});$("#set_map").click(function(a){(a=$("#map_url").val().trim())&&""!=a&&try_select_map($("#map_select"),a,!0);$("#map_modal").modal("hide")});$("#contexts ~ div").each(function(){$(this).hide()});$("#ping_context").show();$("#store_tactic_popover").hide();$("#save").hide();$("#ping").addClass("active");$("#"+label_position).addClass("active");a=$("#icon_context").find("button:first");a.addClass("selected");
selected_icon_no_color="true"==a.attr("data-no_color")?!0:!1;selected_icon=a.attr("id");icon_extra_scale=a.attr("data-scale")?parseFloat(a.attr("data-scale")):1;slide_name=$("#slide_interactive").attr("slide_name");$(".nav-pills > li > a").click(function(){$(".nav-pills > li.active").removeClass("active");$(this).parent().addClass("active")});initialize_color_picker("curve_colorpicker","curve_color");initialize_color_picker("icon_colorpicker","icon_color");initialize_color_picker("draw_colorpicker",
"draw_color");initialize_color_picker("ping_colorpicker","ping_color");initialize_color_picker("track_colorpicker","track_color");initialize_color_picker("line_colorpicker","line_color");initialize_color_picker("text_colorpicker","text_color");initialize_color_picker("background_text_colorpicker","background_text_color");initialize_color_picker("rectangle_outline_colorpicker","rectangle_outline_color");initialize_color_picker("rectangle_fill_colorpicker","rectangle_fill_color");initialize_color_picker("circle_outline_colorpicker",
"circle_outline_color");initialize_color_picker("circle_fill_colorpicker","circle_fill_color");initialize_color_picker("polygon_outline_colorpicker","polygon_outline_color");initialize_color_picker("polygon_fill_colorpicker","polygon_fill_color");initialize_color_picker("area_outline_colorpicker","area_outline_color");initialize_color_picker("area_fill_colorpicker","area_fill_color");initialize_slider("rectangle_outline_thickness","rectangle_outline_thickness_text","rectangle_outline_thickness");
rectangle_outline_thickness=parseFloat($("#rectangle_outline_thickness").val());initialize_slider("rectangle_outline_transparancy","rectangle_outline_transparancy_text","rectangle_outline_transparancy");initialize_slider("rectangle_fill_transparancy","rectangle_fill_transparancy_text","rectangle_fill_transparancy");initialize_slider("circle_outline_thickness","circle_outline_thickness_text","circle_outline_thickness");initialize_slider("circle_outline_transparancy","circle_outline_transparancy_text",
"circle_outline_transparancy");initialize_slider("circle_fill_transparancy","circle_fill_transparancy_text","circle_fill_transparancy");initialize_slider("polygon_outline_thickness","polygon_outline_thickness_text","polygon_outline_thickness");initialize_slider("polygon_outline_transparancy","polygon_outline_transparancy_text","polygon_outline_transparancy");initialize_slider("polygon_fill_transparancy","polygon_fill_transparancy_text","polygon_fill_transparancy");initialize_slider("area_outline_thickness",
"area_outline_thickness_text","area_outline_thickness");initialize_slider("area_outline_transparancy","area_outline_transparancy_text","area_outline_transparancy");initialize_slider("area_fill_transparancy","area_fill_transparancy_text","area_fill_transparancy");initialize_slider("line_thickness","line_thickness_text","line_thickness");initialize_slider("draw_thickness","draw_thickness_text","draw_thickness");initialize_slider("curve_thickness","curve_thickness_text","curve_thickness");initialize_slider("font_size",
"font_size_text","font_size");initialize_slider("background_font_size","background_font_size_text","background_font_size");initialize_slider("label_font_size","label_font_size_text","label_font_size");initialize_slider("icon_size","icon_size_text","icon_size");initialize_slider("ping_size","ping_size_text","ping_size");initialize_slider("track_size","track_size_text","track_size");initialize_slider("draw_end_size","draw_end_size_text","draw_end_size");initialize_slider("line_end_size","line_end_size_text",
"line_end_size");initialize_slider("curve_end_size","curve_end_size_text","curve_end_size");$("#delay")&&initialize_slider("delay","delay_text","delay");$("html").click(function(a){"tactic_name"!=a.target.id&&$('[data-toggle="popover"]').popover("hide")});$('[data-toggle="popover"]').popover({container:"body",trigger:"manual",html:"true",template:'<div class="popover popover-medium" style="width: 300px;"><div class="arrow"></div><div class="popover-inner"><h3 class="popover-title"></h3><div class="popover-content"></div></div></div>',
content:function(){return $("#popover-content")}}).click(function(a){$(this).popover("toggle");document.getElementById("tactic_name").setAttribute("value",tactic_name);$(this);$(document).on("click","#store_tactic",function(a){var b=$(document).find("#tactic_name")[0].value,b=escapeHtml(b);""==b?alert("Empty name, tactic not stored"):(tactic_name=b,document.title="Tactic - "+tactic_name,socket.emit("store",room,b),$("#save").show(),alert("Tactic stored as: "+b),a.stopPropagation())});a.stopPropagation()});
$("#slide_table").on("click","tr",function(){var a=$(this).attr("id");active_slide!=a&&(socket.emit("change_slide",room,a),change_slide(a))});$("#prev_slide").click(function(){var a=find_previous_slide(room_data.slides[active_slide].order);0!=a&&(socket.emit("change_slide",room,a),change_slide(a))});$("#next_slide").click(function(){var a=find_next_slide(room_data.slides[active_slide].order);0!=a&&(socket.emit("change_slide",room,a),change_slide(a))});$("#new_slide").click(function(){var a=create_new_slide(active_slide);
socket.emit("new_slide",room,a);add_slide(a);change_slide(a.uid)});$("#remove_slide").click(function(){1<Object.keys(room_data.slides).length&&(socket.emit("remove_slide",room,active_slide),remove_slide(active_slide))});$("#save").click(function(){tactic_name&&""!=tactic_name&&socket.emit("store",room,tactic_name)});$("#slide_name_field").focusout(function(){rename_slide(active_slide,$(this).val());socket.emit("rename_slide",room,active_slide,$(this).val())});$("#slide_name_field").keyup(function(a){13==
a.keyCode&&(rename_slide(active_slide,$(this).val()),socket.emit("rename_slide",room,active_slide,$(this).val()))});$("#link").click(function(){document.queryCommandSupported("copy");var a=document.createElement("textarea"),b="http://"+location.host+location.pathname+"?room="+room;a.value=b;document.body.appendChild(a);window.prompt("Copy to clipboard and share with friends:",b);document.body.removeChild(a)});$("#chat_input").keyup(function(a){13==a.keyCode&&(a=my_user.name+": "+$("#chat_input").val()+
"\n",socket.emit("chat",room,a,chat_color),chat(a,chat_color),$("#chat_input").val(""))});$("#export").click(function(){var a=new PIXI.CanvasRenderer(size_x,size_y,{backgroundColor:12303291});a.render(objectContainer);$.getScript("http://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js",function(){$.getScript("http://cdnjs.cloudflare.com/ajax/libs/javascript-canvas-to-blob/3.3.0/js/canvas-to-blob.min.js",function(){a.view.toBlob(function(a){tactic_name&&""!=tactic_name?saveAs(a,
tactic_name+".jpg"):saveAs(a,"map.jpg")})})})});$("#backup").click(function(){$.getScript("https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js",function(){var a=active_slide,b=new JSZip,c=new PIXI.CanvasRenderer(size_x,size_y,{backgroundColor:12303291}),d=find_first_slide(),e=1,f=function(d){change_slide(d);var g=setInterval(function(){if(0==resources_loading){c.render(objectContainer);var h=c.view.toDataURL("image/jpeg",.9),h=h.replace("data:image/jpeg;base64,","");b.file(e.toString()+
"-"+room_data.slides[d].name+".jpg",h,{base64:!0});e++;next_slide_uid=find_next_slide(room_data.slides[d].order);if(0!=next_slide_uid)clearInterval(g),f(next_slide_uid);else{clearInterval(g);c.destroy();var h={},m;for(m in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(m)&&room_data.slides[active_slide].entities[m].container&&(h[m]=room_data.slides[active_slide].entities[m].container,delete room_data.slides[active_slide].entities[m].container);b.file("tactic.json",
JSON.stringify(room_data,null,2));for(m in room_data.slides[active_slide].entities)room_data.slides[active_slide].entities.hasOwnProperty(m)&&h[m]&&(room_data.slides[active_slide].entities[m].container=h[m]);$.getScript("http://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2014-11-29/FileSaver.min.js",function(){var a=b.generate({type:"blob"});tactic_name&&""!=tactic_name?saveAs(a,tactic_name+".zip"):saveAs(a,"backup.zip")});change_slide(a);render_scene()}}},50)};f(d)})});$(".icon_group").each(function(){var a=
this.id;$("#"+a).click(function(){var b=$("#"+a+"_list").text().split("\n"),b=b.map(function(a){return encodeURIComponent(a.trim())}),b=b.filter(function(a){return""==a?!1:!0}),c=$("#"+a+"_list").attr("data-path"),d=parseFloat($("#"+a+"_list").attr("data-scale")),e=parseFloat($("#"+a+"_list").attr("data-height")),f=$("#"+a+"_list").attr("data-no_color"),h=$("#"+a+"_list").attr("data-style");if(!$.trim($("#"+a+"_menu").html()))if(h)for(var g in b)$("#"+a+"_menu").append('<button data-toggle="tooltip" title="'+
b[g]+'" class="tank_select" data-scale="'+d+'" data-no_color="'+f+'" id="'+c+"/"+b[g]+'"><div class="'+c+" "+c+"-"+b[g].slice(0,-4)+' inline"></div></button>');else for(g in b)$("#"+a+"_menu").append("<img height="+e+' class="tank_select" data-scale="'+d+'" data-no_color="'+f+'" id="'+c+"/"+b[g]+'" data-toggle="tooltip" title="'+b[g]+'" src='+image_host+c+"/"+b[g]+"></img>")})});$("[id^=icon][id$=context]").each(function(){$(this).find("a:first").trigger("click")});$("#lock").click(function(){is_room_locked=
$(this).find("div").hasClass("icon-lock")?!1:!0;update_lock();socket.emit("lock_room",room,is_room_locked)});$("#lock_camera").click(function(){var a=$(this).find("div");a.hasClass("icon-lock_camera")?(a.removeClass("icon-lock_camera").addClass("icon-unlock_camera"),emit_pan_zoom(),control_camera=!0):(a.removeClass("icon-unlock_camera").addClass("icon-lock_camera"),control_camera=!1)});$("#grid").click(function(){grid_layer.visible=!grid_layer.visible;room_data.slides[active_slide].show_grid=grid_layer.visible;
can_edit()&&socket.emit("show_grid",room,active_slide,grid_layer.visible);render_scene()});$("#zoom_in").click(function(){zoom(.1,!0,[.5,.5]);$("#zoom_level").text((1/zoom_level).toFixed(2));control_camera&&emit_pan_zoom()});$("#zoom_out").click(function(){zoom(.1,!1,[.5,.5]);$("#zoom_level").text((1/zoom_level).toFixed(2));control_camera&&emit_pan_zoom()});$("#contexts").on("click","button",function(a){stop_drawing();setup_mouse_events(void 0,void 0);new_drawing=null;graphics&&objectContainer.removeChild(graphics);
new_drawing&&(new_drawing=void 0);current_text_element=void 0;if("undo"==$(this).attr("id"))undo();else if("redo"==$(this).attr("id"))redo();else if("cut"==$(this).attr("id"))cut();else if("copy"==$(this).attr("id"))copy();else if("paste"==$(this).attr("id"))paste();else if("clear_all_main"==$(this).attr("id"))clear();else{shifted&&objectContainer.mouseup&&(shifted=!1,objectContainer.mouseup(renderer.plugins.interaction.eventData),shifted=!0);$("#contexts").find("button").removeClass("active");$(this).addClass("active");
a=$(this).attr("id")+"_context";var b=$(this).attr("id")+"_context";"sc2"==game&&"icon"==b.substring(0,4)&&$("#icon_options").detach().appendTo($("#"+b));$(this).attr("data-context")&&(a=$(this).attr("data-context")+"_context");my_tracker&&stop_tracking();"track_context"==a&&start_tracking({x:2E3,y:2E3});if(active_menu!=b)switch("remove_context"!=a&&(deselect_all(),render_scene()),$("#"+active_menu).hide(),$("#"+b).show(),active_menu=b,active_context=a,active_context){case "ping_context":case "track_context":case "icon_context":case "note_context":case "text_context":case "remove_context":case "eraser_context":case "background_text_context":case "select_context":enable_dragging();
break;case "draw_context":case "ruler_context":case "rectangle_context":case "cicle_context":case "line_context":case "curve_context":case "polygon_context":disable_dragging()}}});$("#label_pos").on("click","button",function(a){$("#label_pos").find("button").removeClass("active");$(this).addClass("active");label_position=this.id});$('#rectangle_type button[data-style="full"]').addClass("active");$("#rectangle_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});
$('#circle_type button[data-style="full"]').addClass("active");$("#circle_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#circle_draw_style button[data-draw_style="edge"]').addClass("active");$("#circle_draw_style").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#polygon_type button[data-style="full"]').addClass("active");$("#polygon_type").on("click","button",function(a){$(this).addClass("active");
$(this).siblings().removeClass("active")});$('#area_type button[data-style="full"]').addClass("active");$("#area_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#line_type button[data-style="full"]').addClass("active");$("#line_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#line_end_type button[data-end="arrow"]').addClass("active");$("#line_end_type").on("click","button",
function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#curve_type button[data-style="full"]').addClass("active");$("#curve_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#curve_end_type button[data-end="arrow"]').addClass("active");$("#curve_end_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#track_shape button[data-cursor="cursor"]').addClass("active");
$("#track_shape").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active");my_tracker&&stop_tracking();start_tracking({x:2E3,y:2E3})});$('#draw_type button[data-style="full"]').addClass("active");$("#draw_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});$('#draw_end_type button[data-end="arrow"]').addClass("active");$("#draw_end_type").on("click","button",function(a){$(this).addClass("active");$(this).siblings().removeClass("active")});
$("#userlist").on("click","button",function(){var a=$(this).attr("id");if(a!=my_user.id&&"owner"==my_user.role)return userlist[a].role?"driver"==userlist[a].role?(userlist[a].role="owner",$(this).css("background-color","lime")):"owner"==userlist[a].role&&(delete userlist[a].role,$(this).css("background-color","")):(userlist[a].role="driver",$(this).css("background-color","yellow")),socket.emit("update_user",room,userlist[a]),!1});$("#clear_all").click(function(){clear()});$("#clear_draw").click(function(){clear("drawing")});
$("#clear_icons").click(function(){clear("icon")});$("#clear_lines").click(function(){clear("line")});$("#clear_text").click(function(){clear("text")});$("#clear_curve").click(function(){clear("curve")});$("#clear_rectangle").click(function(){clear("rectangle")});$("#clear_circle").click(function(){clear("circle")});$("#clear_polygon").click(function(){clear("polygon")});$("#clear_area").click(function(){clear("area")});$("#clear_selected").click(function(){clear_selected()});$("#clear_note").click(function(){clear("note")});
$("#nuke_room").click(function(){1==confirm("Warning: all unsaved data will be lost")&&socket.emit("nuke_room",room,game)});$("body").on("click",".tank_select",function(){$(".tank_select.selected").removeClass("selected");$(this).addClass("selected");selected_icon=$(this).attr("id");selected_icon_no_color="true"==$(this).attr("data-no_color")?!0:!1;icon_extra_scale=$(this).attr("data-scale")?parseFloat($(this).attr("data-scale")):1});assets_loaded=!0;socket.on("connect",function(){console.log("Connecting/Reconnecting");
socket.emit("join_room",room,game)});socket.connected&&socket.emit("join_room",room,game)});socket.on("room_data",function(a,b,c,d){cleanup();room_data=a;video_paused=a.video_paused;active_slide=room_data.active_slide;is_room_locked=room_data.locked;my_user_id=b;(tactic_name=c)&&""!=tactic_name&&(document.title="Tactic - "+tactic_name);for(var e in room_data.userlist)add_user(room_data.userlist[e]);var f=[],g,h;for(h in room_data.slides[active_slide].entities)"background"==room_data.slides[active_slide].entities[h].type?
g=room_data.slides[active_slide].entities[h]:f.push(room_data.slides[active_slide].entities[h]);try{f.sort(function(a,b){return a.z_index-b.z_index})}catch(m){}var w=function(){room_data.pan_zoom?pan_zoom(room_data.pan_zoom[0],room_data.pan_zoom[1],room_data.pan_zoom[2]):pan_zoom(1,0,0);wot_live&&wot_connect()};g?set_background(g,function(){if(background.is_video)rebuild_timeline(),room_data.playback_rate&&set_playback_rate(room_data.playback_rate,room_data.playback_rate);else for(var a in f)create_entity(f[a]);
w()}):w();for(h in room_data.trackers)create_tracker(room_data.trackers[h]);delete room_data.trackers;update_slide_buttons();update_my_user();my_tracker&&(stop_tracking(),start_tracking({x:2E3,y:2E3}));is_video_replay&&(sync_start_time=Date.now(),socket.emit("sync_clock"),clearInterval(clock_sync_event),clock_sync_event=setInterval(function(){sync_start_time=Date.now();socket.emit("sync_clock")},2E4));render_scene()});socket.on("create_entity",function(a,b,c){b!=active_slide?room_data.slides[b].entities[a.uid]=
a:create_entity(a);activity_animation(c)});socket.on("drag",function(a,b,c,d,e,f,g){b!=active_slide?room_data.slides[b].entities[a]&&(room_data.slides[b].entities[a].x=c,room_data.slides[b].entities[a].y=d,e&&(room_data.slides[b].entities[a].scale=e),f&&(room_data.slides[b].entities[a].rotation=f)):room_data.slides[b].entities[a]&&drag_entity(room_data.slides[active_slide].entities[a],c,d,e,f);activity_animation(g)});socket.on("ping_marker",function(a,b,c,d,e){ping(a,b,c,d);activity_animation(e)});
socket.on("chat",function(a,b){chat(a,b)});socket.on("identify",function(a){my_user?(my_user.logged_in=a.logged_in,my_user.name=a.name):my_user=a;update_my_user()});socket.on("remove",function(a,b,c){b!=active_slide?delete room_data.slides[b].entities[a]:remove(a);activity_animation(c)});socket.on("add_user",function(a){add_user(a)});socket.on("remove_user",function(a){remove_user(a)});socket.on("lock_room",function(a,b){is_room_locked=a;update_lock();activity_animation(b)});socket.on("change_slide",
function(a){a!=active_slide&&change_slide(a)});socket.on("new_slide",function(a,b){add_slide(a);activity_animation(b)});socket.on("remove_slide",function(a,b){1>=Object.keys(room_data.slides)?socket.emit("join_room",room,game):(remove_slide(a),activity_animation(b))});socket.on("rename_slide",function(a,b,c){rename_slide(a,b);activity_animation(c)});socket.on("change_slide_order",function(a,b,c){room_data.slides[a].order=b;update_slide_buttons();activity_animation(c)});socket.on("track",function(a,
b){trackers[a.uid]&&remove_tracker(uid);create_tracker(a);activity_animation(b)});socket.on("track_move",function(a,b,c){move_tracker(a,b,c)});socket.on("stop_track",function(a){remove_tracker(a)});socket.on("show_grid",function(a,b,c){room_data.slides[a].show_grid=b;a==active_slide&&(grid_layer.visible=b,render_scene());activity_animation(c)});socket.on("pan_zoom",function(a,b,c,d){activity_animation(a,b,c);pan_zoom(a,b,c)});socket.on("force_reconnect",function(){location.reload()});socket.on("play_video",
function(a,b,c,d){activity_animation(d);set_playback_rate(c,c);handle_play(a,b)});socket.on("pause_video",function(a,b){handle_pause(a);activity_animation(b)});socket.on("sync_video",function(a,b,c){handle_sync(a,b,c)});socket.on("request_sync",function(){if(im_syncing)for(var a=0;5>=a;a++)setTimeout(function(){var a=video_progress();socket.emit("sync_video",room,a,get_server_time())},2E3*a)});socket.on("sync_clock",function(a){var b=Date.now();offset=a+(b-sync_start_time)/2-b});socket.on("seek_video",
function(a,b,c){video_media.setCurrentTime(a);video_paused?video_player.pause():(handle_sync(a,b,c),wait_for_seek(function(){rebuild_timeline()}))});socket.on("change_rate",function(a){set_playback_rate(a,a)})});

//# sourceMappingURL=combined.js.map